<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: ccnet/lib/buffer.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ccnet/lib/buffer.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdarg.h&gt;</code><br/>
</div>
<p><a href="buffer_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbuffer.html">buffer</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#aeaa8e530113038526ca73cc72fbcb29f">BUFFER_READ</a>&#160;&#160;&#160;0x01</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a8515b43847a390df2ba90f1ea3eeb270">BUFFER_WRITE</a>&#160;&#160;&#160;0x02</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#aae0eeb8d7cf395295e07094a8d389281">BUFFER_EOF</a>&#160;&#160;&#160;0x10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#ae93aa692df18e0794b1a14e234b77b29">BUFFER_ERROR</a>&#160;&#160;&#160;0x20</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a86005261a44dcc1441cdde04f79a4b39">BUFFER_TIMEOUT</a>&#160;&#160;&#160;0x40</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a702c00cbf6209924acb5d9f6b0fa8ddd">BUFFER_LENGTH</a>(x)&#160;&#160;&#160;(x)-&gt;off</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a736d4e48582bce3489d230ac57046171">BUFFER_DATA</a>(x)&#160;&#160;&#160;(x)-&gt;<a class="el" href="structbuffer.html">buffer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a9361b08c00e2fa94df65b3c98a7680ff">BUFFER_INPUT</a>(x)&#160;&#160;&#160;(x)-&gt;input</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#aefa0b5c396f0a2443e027710313bb2b2">BUFFER_OUTPUT</a>(x)&#160;&#160;&#160;(x)-&gt;output</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a515f33707495a7e78c527659c6461326">buffer_new</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a1e0559eaa1a32cd36154b90ab0eb910f">buffer_free</a> (struct <a class="el" href="structbuffer.html">buffer</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a720417590376dcaeb091a64bea857949">buffer_expand</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, size_t)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a5241e4d8527216adfdd7a35d77d2ddc4">buffer_add</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, const void *, size_t)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a386391cddbe31eecd1e909a6434f03b9">buffer_remove</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, void *, size_t)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#aeb333acbf2f1c570c4a2509a8eb027e7">buffer_readline</a> (struct <a class="el" href="structbuffer.html">buffer</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a3c8b8eb536adde5be2214c6329f97b6d">buffer_add_buffer</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, struct <a class="el" href="structbuffer.html">buffer</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a0a9f13d2fec8dd7014821503659b3154">buffer_add_printf</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, const char *fmt,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a5f207ff45821b5fa15e89f9a2e728f70">buffer_add_vprintf</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, const char *fmt, va_list ap)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a927c97790c5a195db157b153917d32cd">buffer_drain</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, size_t)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#af87e577d4aa1ca130b5cbf9cf6772052">buffer_write</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a9048323bd5c9b135f425d94fbb7603c0">buffer_read</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, int, int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">u_char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a03ffadf215887d06c0fa034f9ffe4546">buffer_find</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, const u_char *, size_t)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffer_8h.html#a5d83ea6a62a1c9c2a942220cbf06a8fb">buffer_setcb</a> (struct <a class="el" href="structbuffer.html">buffer</a> *, void(*)(struct <a class="el" href="structbuffer.html">buffer</a> *, size_t, size_t, void *), void *)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a736d4e48582bce3489d230ac57046171"></a><!-- doxytag: member="buffer.h::BUFFER_DATA" ref="a736d4e48582bce3489d230ac57046171" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#a736d4e48582bce3489d230ac57046171">BUFFER_DATA</a></td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x)-&gt;<a class="el" href="structbuffer.html">buffer</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00032">32</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="aae0eeb8d7cf395295e07094a8d389281"></a><!-- doxytag: member="buffer.h::BUFFER_EOF" ref="aae0eeb8d7cf395295e07094a8d389281" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#aae0eeb8d7cf395295e07094a8d389281">BUFFER_EOF</a>&#160;&#160;&#160;0x10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00027">27</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae93aa692df18e0794b1a14e234b77b29"></a><!-- doxytag: member="buffer.h::BUFFER_ERROR" ref="ae93aa692df18e0794b1a14e234b77b29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#ae93aa692df18e0794b1a14e234b77b29">BUFFER_ERROR</a>&#160;&#160;&#160;0x20</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00028">28</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9361b08c00e2fa94df65b3c98a7680ff"></a><!-- doxytag: member="buffer.h::BUFFER_INPUT" ref="a9361b08c00e2fa94df65b3c98a7680ff" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#a9361b08c00e2fa94df65b3c98a7680ff">BUFFER_INPUT</a></td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x)-&gt;input</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00033">33</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="a702c00cbf6209924acb5d9f6b0fa8ddd"></a><!-- doxytag: member="buffer.h::BUFFER_LENGTH" ref="a702c00cbf6209924acb5d9f6b0fa8ddd" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#a702c00cbf6209924acb5d9f6b0fa8ddd">BUFFER_LENGTH</a></td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x)-&gt;off</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00031">31</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="aefa0b5c396f0a2443e027710313bb2b2"></a><!-- doxytag: member="buffer.h::BUFFER_OUTPUT" ref="aefa0b5c396f0a2443e027710313bb2b2" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#aefa0b5c396f0a2443e027710313bb2b2">BUFFER_OUTPUT</a></td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x)-&gt;output</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00034">34</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="aeaa8e530113038526ca73cc72fbcb29f"></a><!-- doxytag: member="buffer.h::BUFFER_READ" ref="aeaa8e530113038526ca73cc72fbcb29f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#aeaa8e530113038526ca73cc72fbcb29f">BUFFER_READ</a>&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00025">25</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="a86005261a44dcc1441cdde04f79a4b39"></a><!-- doxytag: member="buffer.h::BUFFER_TIMEOUT" ref="a86005261a44dcc1441cdde04f79a4b39" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#a86005261a44dcc1441cdde04f79a4b39">BUFFER_TIMEOUT</a>&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00029">29</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8515b43847a390df2ba90f1ea3eeb270"></a><!-- doxytag: member="buffer.h::BUFFER_WRITE" ref="a8515b43847a390df2ba90f1ea3eeb270" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="buffer_8h.html#a8515b43847a390df2ba90f1ea3eeb270">BUFFER_WRITE</a>&#160;&#160;&#160;0x02</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="buffer_8h_source.html#l00026">26</a> of file <a class="el" href="buffer_8h_source.html">buffer.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a5241e4d8527216adfdd7a35d77d2ddc4"></a><!-- doxytag: member="buffer.h::buffer_add" ref="a5241e4d8527216adfdd7a35d77d2ddc4" args="(struct buffer *, const void *, size_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a5241e4d8527216adfdd7a35d77d2ddc4">buffer_add</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Append data to the end of an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the event buffer to be appended to </td></tr>
    <tr><td class="paramname">data</td><td>pointer to the beginning of the data buffer </td></tr>
    <tr><td class="paramname">datlen</td><td>the number of bytes to be copied from the data buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00246">246</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span> need = buf-&gt;misalign + buf-&gt;off + datlen;
        <span class="keywordtype">size_t</span> oldoff = buf-&gt;off;

        <span class="keywordflow">if</span> (buf-&gt;totallen &lt; need) {
                <span class="keywordflow">if</span> (<a class="code" href="buffer_8c.html#a369379b541617b019b24e8f7879894d1">buffer_expand</a>(buf, datlen) == -1)
                        <span class="keywordflow">return</span> (-1);
        }

        memcpy(buf-&gt;buffer + buf-&gt;off, data, datlen);
        buf-&gt;off += datlen;

        <span class="keywordflow">if</span> (datlen &amp;&amp; buf-&gt;cb != NULL)
                (*buf-&gt;cb)(buf, oldoff, buf-&gt;off, buf-&gt;cbarg);

        <span class="keywordflow">return</span> (0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c8b8eb536adde5be2214c6329f97b6d"></a><!-- doxytag: member="buffer.h::buffer_add_buffer" ref="a3c8b8eb536adde5be2214c6329f97b6d" args="(struct buffer *, struct buffer *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a3c8b8eb536adde5be2214c6329f97b6d">buffer_add_buffer</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Move data from one buffer into another buffer.</p>
<p>This is a destructive add. The data from one buffer moves into the other buffer. The destination buffer is expanded as needed.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">outbuf</td><td>the output buffer </td></tr>
    <tr><td class="paramname">inbuf</td><td>the input buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if successful, or -1 if an error occurred </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00098">98</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">int</span> res;

        <span class="comment">/* Short cut for better performance */</span>
        <span class="keywordflow">if</span> (outbuf-&gt;off == 0) {
                <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> tmp;
                <span class="keywordtype">size_t</span> oldoff = inbuf-&gt;<a class="code" href="structbuffer.html#a8060168e5fff32ee293aac8b27b3f954">off</a>;

                <span class="comment">/* Swap them directly */</span>
                <a class="code" href="buffer_8c.html#a5d9d454d4b9f2ff8106d5199ac0d0186">SWAP</a>(&amp;tmp, outbuf);
                <a class="code" href="buffer_8c.html#a5d9d454d4b9f2ff8106d5199ac0d0186">SWAP</a>(outbuf, inbuf);
                <a class="code" href="buffer_8c.html#a5d9d454d4b9f2ff8106d5199ac0d0186">SWAP</a>(inbuf, &amp;tmp);

                <span class="comment">/* </span>
<span class="comment">                 * Optimization comes with a price; we need to notify the</span>
<span class="comment">                 * buffer if necessary of the changes. oldoff is the amount</span>
<span class="comment">                 * of data that we transfered from inbuf to outbuf</span>
<span class="comment">                 */</span>
                <span class="keywordflow">if</span> (inbuf-&gt;off != oldoff &amp;&amp; inbuf-&gt;cb != NULL)
                        (*inbuf-&gt;cb)(inbuf, oldoff, inbuf-&gt;off, inbuf-&gt;cbarg);
                <span class="keywordflow">if</span> (oldoff &amp;&amp; outbuf-&gt;cb != NULL)
                        (*outbuf-&gt;cb)(outbuf, 0, oldoff, outbuf-&gt;cbarg);
                
                <span class="keywordflow">return</span> (0);
        }

        res = <a class="code" href="buffer_8c.html#aa29c604fefadeed78f230043db841d14">buffer_add</a>(outbuf, inbuf-&gt;buffer, inbuf-&gt;off);
        <span class="keywordflow">if</span> (res == 0) {
                <span class="comment">/* We drain the input buffer on success */</span>
                <a class="code" href="buffer_8c.html#ae2df3dfe562240163aa056ab2a59e7de">buffer_drain</a>(inbuf, inbuf-&gt;off);
        }

        <span class="keywordflow">return</span> (res);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0a9f13d2fec8dd7014821503659b3154"></a><!-- doxytag: member="buffer.h::buffer_add_printf" ref="a0a9f13d2fec8dd7014821503659b3154" args="(struct buffer *, const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a0a9f13d2fec8dd7014821503659b3154">buffer_add_printf</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Append a formatted string to the end of an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the buffer that will be appended to </td></tr>
    <tr><td class="paramname">fmt</td><td>a format string </td></tr>
    <tr><td class="paramname">...</td><td>arguments that will be passed to printf(3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of bytes added if successful, or -1 if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="a5f207ff45821b5fa15e89f9a2e728f70"></a><!-- doxytag: member="buffer.h::buffer_add_vprintf" ref="a5f207ff45821b5fa15e89f9a2e728f70" args="(struct buffer *, const char *fmt, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a5f207ff45821b5fa15e89f9a2e728f70">buffer_add_vprintf</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&#160;</td>
          <td class="paramname"><em>ap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Append a va_list formatted string to the end of an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the buffer that will be appended to </td></tr>
    <tr><td class="paramname">fmt</td><td>a format string </td></tr>
    <tr><td class="paramname">ap</td><td>a varargs va_list argument array that will be passed to vprintf(3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of bytes added if successful, or -1 if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="a927c97790c5a195db157b153917d32cd"></a><!-- doxytag: member="buffer.h::buffer_drain" ref="a927c97790c5a195db157b153917d32cd" args="(struct buffer *, size_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="buffer_8h.html#a927c97790c5a195db157b153917d32cd">buffer_drain</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Remove a specified number of bytes data from the beginning of an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the buffer to be drained </td></tr>
    <tr><td class="paramname">len</td><td>the number of bytes to drain from the beginning of the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if successful, or -1 if an error occurred </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00266">266</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span> oldoff = buf-&gt;off;

        <span class="keywordflow">if</span> (len &gt;= buf-&gt;off) {
                buf-&gt;off = 0;
                buf-&gt;buffer = buf-&gt;orig_buffer;
                buf-&gt;misalign = 0;
                <span class="keywordflow">goto</span> done;
        }

        buf-&gt;buffer += len;
        buf-&gt;misalign += len;

        buf-&gt;off -= len;

 done:
        <span class="comment">/* Tell someone about changes in this buffer */</span>
        <span class="keywordflow">if</span> (buf-&gt;off != oldoff &amp;&amp; buf-&gt;cb != NULL)
                (*buf-&gt;cb)(buf, oldoff, buf-&gt;off, buf-&gt;cbarg);

}
</pre></div>
</div>
</div>
<a class="anchor" id="a720417590376dcaeb091a64bea857949"></a><!-- doxytag: member="buffer.h::buffer_expand" ref="a720417590376dcaeb091a64bea857949" args="(struct buffer *, size_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a720417590376dcaeb091a64bea857949">buffer_expand</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Expands the available space in an event buffer.</p>
<p>Expands the available space in the event buffer to at least datlen</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the event buffer to be expanded </td></tr>
    <tr><td class="paramname">datlen</td><td>the new minimum length requirement </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if successful, or -1 if an error occurred </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00210">210</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span> need = buf-&gt;misalign + buf-&gt;off + datlen;

        <span class="comment">/* If we can fit all the data, then we don&#39;t have to do anything */</span>
        <span class="keywordflow">if</span> (buf-&gt;totallen &gt;= need)
                <span class="keywordflow">return</span> (0);

        <span class="comment">/*</span>
<span class="comment">         * If the misalignment fulfills our data needs, we just force an</span>
<span class="comment">         * alignment to happen.  Afterwards, we have enough space.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (buf-&gt;misalign &gt;= datlen) {
                buffer_align(buf);
        } <span class="keywordflow">else</span> {
                <span class="keywordtype">void</span> *newbuf;
                <span class="keywordtype">size_t</span> length = buf-&gt;totallen;

                <span class="keywordflow">if</span> (length &lt; 256)
                        length = 256;
                <span class="keywordflow">while</span> (length &lt; need)
                        length &lt;&lt;= 1;

                <span class="keywordflow">if</span> (buf-&gt;orig_buffer != buf-&gt;buffer)
                        buffer_align(buf);
                <span class="keywordflow">if</span> ((newbuf = realloc(buf-&gt;buffer, length)) == NULL)
                        <span class="keywordflow">return</span> (-1);

                buf-&gt;orig_buffer = buf-&gt;buffer = newbuf;
                buf-&gt;totallen = length;
        }

        <span class="keywordflow">return</span> (0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a03ffadf215887d06c0fa034f9ffe4546"></a><!-- doxytag: member="buffer.h::buffer_find" ref="a03ffadf215887d06c0fa034f9ffe4546" args="(struct buffer *, const u_char *, size_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u_char* <a class="el" href="buffer_8h.html#a03ffadf215887d06c0fa034f9ffe4546">buffer_find</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const u_char *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Find a string within an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>the buffer to be searched </td></tr>
    <tr><td class="paramname">what</td><td>the string to be searched for </td></tr>
    <tr><td class="paramname">len</td><td>the length of the search string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to the beginning of the search string, or NULL if the search failed. </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00373">373</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        u_char *search = <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a73d5800483fcfe69ac74471ba4730f8c">buffer</a>, *end = search + <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a8060168e5fff32ee293aac8b27b3f954">off</a>;
        u_char *p;

        <span class="keywordflow">while</span> (search &lt; end &amp;&amp;
            (p = memchr(search, *what, end - search)) != NULL) {
                <span class="keywordflow">if</span> (p + len &gt; end)
                        <span class="keywordflow">break</span>;
                <span class="keywordflow">if</span> (memcmp(p, what, len) == 0)
                        <span class="keywordflow">return</span> (p);
                search = p + 1;
        }

        <span class="keywordflow">return</span> (NULL);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1e0559eaa1a32cd36154b90ab0eb910f"></a><!-- doxytag: member="buffer.h::buffer_free" ref="a1e0559eaa1a32cd36154b90ab0eb910f" args="(struct buffer *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="buffer_8h.html#a1e0559eaa1a32cd36154b90ab0eb910f">buffer_free</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Deallocate storage for an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pointer</td><td>to the buffer to be freed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00077">77</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordflow">if</span> (<a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a307412e2e1fb6721eb0c478b9dab3e7c">orig_buffer</a> != NULL)
                free(<a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a307412e2e1fb6721eb0c478b9dab3e7c">orig_buffer</a>);
        free(<a class="code" href="structbuffer.html">buffer</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a515f33707495a7e78c527659c6461326"></a><!-- doxytag: member="buffer.h::buffer_new" ref="a515f33707495a7e78c527659c6461326" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbuffer.html">buffer</a>* <a class="el" href="buffer_8h.html#a515f33707495a7e78c527659c6461326">buffer_new</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allocate storage for a new buffer.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to a newly allocated buffer struct, or NULL if an error occurred </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00067">67</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keyword">struct </span><a class="code" href="structbuffer.html">buffer</a> *<a class="code" href="structbuffer.html#a73d5800483fcfe69ac74471ba4730f8c">buffer</a>;
        
        buffer = calloc(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> buffer));

        <span class="keywordflow">return</span> (buffer);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9048323bd5c9b135f425d94fbb7603c0"></a><!-- doxytag: member="buffer.h::buffer_read" ref="a9048323bd5c9b135f425d94fbb7603c0" args="(struct buffer *, int, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a9048323bd5c9b135f425d94fbb7603c0">buffer_read</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read from a file descriptor and store the result in an buffer.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the buffer to store the result </td></tr>
    <tr><td class="paramname">fd</td><td>the file descriptor to read from </td></tr>
    <tr><td class="paramname">howmuch</td><td>the number of bytes to be read </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes read, or -1 if an error occurred </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="buffer_8c.html#a2748efdd7e3b1547630074001fcfb63f">buffer_write()</a> </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00296">296</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        u_char *p;
        <span class="keywordtype">size_t</span> oldoff = buf-&gt;off;
        <span class="keywordtype">int</span> n = <a class="code" href="buffer_8c.html#adf17bd07f707f4703b23a24d63261144">BUFFER_MAX_READ</a>;

<span class="preprocessor">#if defined(FIONREAD)</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lng = n;
        <span class="keywordflow">if</span> (ioctlsocket(fd, FIONREAD, &amp;lng) == -1 || (n=lng) == 0) {
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (ioctl(fd, FIONREAD, &amp;n) == -1 || n == 0) {
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                n = <a class="code" href="buffer_8c.html#adf17bd07f707f4703b23a24d63261144">BUFFER_MAX_READ</a>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n &gt; <a class="code" href="buffer_8c.html#adf17bd07f707f4703b23a24d63261144">BUFFER_MAX_READ</a> &amp;&amp; n &gt; howmuch) {
                <span class="comment">/*</span>
<span class="comment">                 * It&#39;s possible that a lot of data is available for</span>
<span class="comment">                 * reading.  We do not want to exhaust resources</span>
<span class="comment">                 * before the reader has a chance to do something</span>
<span class="comment">                 * about it.  If the reader does not tell us how much</span>
<span class="comment">                 * data we should read, we artifically limit it.</span>
<span class="comment">                 */</span>
                <span class="keywordflow">if</span> (n &gt; buf-&gt;totallen &lt;&lt; 2)
                        n = buf-&gt;totallen &lt;&lt; 2;
                <span class="keywordflow">if</span> (n &lt; <a class="code" href="buffer_8c.html#adf17bd07f707f4703b23a24d63261144">BUFFER_MAX_READ</a>)
                        n = <a class="code" href="buffer_8c.html#adf17bd07f707f4703b23a24d63261144">BUFFER_MAX_READ</a>;
        }
<span class="preprocessor">#endif  </span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (howmuch &lt; 0 || howmuch &gt; n)
                howmuch = n;

        <span class="comment">/* If we don&#39;t have FIONREAD, we might waste some space here */</span>
        <span class="keywordflow">if</span> (<a class="code" href="buffer_8c.html#a369379b541617b019b24e8f7879894d1">buffer_expand</a>(buf, howmuch) == -1)
                <span class="keywordflow">return</span> (-1);

        <span class="comment">/* We can append new data at this point */</span>
        p = buf-&gt;buffer + buf-&gt;off;

<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>        n = read(fd, p, howmuch);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        n = recv(fd, (<span class="keywordtype">char</span> *)p, howmuch, 0);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (n == -1)
                <span class="keywordflow">return</span> (-1);
        <span class="keywordflow">if</span> (n == 0)
                <span class="keywordflow">return</span> (0);

        buf-&gt;off += n;

        <span class="comment">/* Tell someone about changes in this buffer */</span>
        <span class="keywordflow">if</span> (buf-&gt;off != oldoff &amp;&amp; buf-&gt;cb != NULL)
                (*buf-&gt;cb)(buf, oldoff, buf-&gt;off, buf-&gt;cbarg);

        <span class="keywordflow">return</span> (n);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aeb333acbf2f1c570c4a2509a8eb027e7"></a><!-- doxytag: member="buffer.h::buffer_readline" ref="aeb333acbf2f1c570c4a2509a8eb027e7" args="(struct buffer *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="buffer_8h.html#aeb333acbf2f1c570c4a2509a8eb027e7">buffer_readline</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read a single line from an event buffer.</p>
<p>Reads a line terminated by either '<br/>
', '<br/>
' or '' or '<br/>
'. The returned buffer needs to be freed by the caller.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>the buffer to read from </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>pointer to a single line, or NULL if an error occurred </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00156">156</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        u_char *data = <a class="code" href="buffer_8h.html#a736d4e48582bce3489d230ac57046171">BUFFER_DATA</a>(<a class="code" href="structbuffer.html">buffer</a>);
        <span class="keywordtype">size_t</span> len = <a class="code" href="buffer_8h.html#a702c00cbf6209924acb5d9f6b0fa8ddd">BUFFER_LENGTH</a>(<a class="code" href="structbuffer.html">buffer</a>);
        <span class="keywordtype">char</span> *line;
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;

        <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
                <span class="keywordflow">if</span> (data[i] == <span class="charliteral">&#39;\r&#39;</span> || data[i] == <span class="charliteral">&#39;\n&#39;</span>)
                        <span class="keywordflow">break</span>;
        }

        <span class="keywordflow">if</span> (i == len)
                <span class="keywordflow">return</span> (NULL);

        <span class="keywordflow">if</span> ((line = malloc(i + 1)) == NULL) {
                fprintf(stderr, <span class="stringliteral">&quot;%s: out of memory\n&quot;</span>, __func__);
                <a class="code" href="buffer_8c.html#ae2df3dfe562240163aa056ab2a59e7de">buffer_drain</a>(<a class="code" href="structbuffer.html">buffer</a>, i);
                <span class="keywordflow">return</span> (NULL);
        }

        memcpy(line, data, i);
        line[i] = <span class="charliteral">&#39;\0&#39;</span>;

        <span class="comment">/*</span>
<span class="comment">         * Some protocols terminate a line with &#39;\r\n&#39;, so check for</span>
<span class="comment">         * that, too.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ( i &lt; len - 1 ) {
                <span class="keywordtype">char</span> fch = data[i], sch = data[i+1];

                <span class="comment">/* Drain one more character if needed */</span>
                <span class="keywordflow">if</span> ( (sch == <span class="charliteral">&#39;\r&#39;</span> || sch == <span class="charliteral">&#39;\n&#39;</span>) &amp;&amp; sch != fch )
                        i += 1;
        }

        <a class="code" href="buffer_8c.html#ae2df3dfe562240163aa056ab2a59e7de">buffer_drain</a>(<a class="code" href="structbuffer.html">buffer</a>, i + 1);

        <span class="keywordflow">return</span> (line);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a386391cddbe31eecd1e909a6434f03b9"></a><!-- doxytag: member="buffer.h::buffer_remove" ref="a386391cddbe31eecd1e909a6434f03b9" args="(struct buffer *, void *, size_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#a386391cddbe31eecd1e909a6434f03b9">buffer_remove</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read data from an event buffer and drain the bytes read.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>the event buffer to be read from </td></tr>
    <tr><td class="paramname">data</td><td>the destination buffer to store the result </td></tr>
    <tr><td class="paramname">datlen</td><td>the maximum size of the destination buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes read </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00138">138</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span> nread = datlen;
        <span class="keywordflow">if</span> (nread &gt;= buf-&gt;off)
                nread = buf-&gt;off;

        memcpy(data, buf-&gt;buffer, nread);
        <a class="code" href="buffer_8c.html#ae2df3dfe562240163aa056ab2a59e7de">buffer_drain</a>(buf, nread);
        
        <span class="keywordflow">return</span> (nread);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d83ea6a62a1c9c2a942220cbf06a8fb"></a><!-- doxytag: member="buffer.h::buffer_setcb" ref="a5d83ea6a62a1c9c2a942220cbf06a8fb" args="(struct buffer *, void(*)(struct buffer *, size_t, size_t, void *), void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="buffer_8h.html#a5d83ea6a62a1c9c2a942220cbf06a8fb">buffer_setcb</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(struct <a class="el" href="structbuffer.html">buffer</a> *, size_t, size_t, void *)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set a callback to invoke when the buffer is modified.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>the buffer to be monitored </td></tr>
    <tr><td class="paramname">cb</td><td>the callback function to invoke when the buffer is modified </td></tr>
    <tr><td class="paramname">cbarg</td><td>an argument to be provided to the callback function </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00390">390</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a93971c92f0374a1619e6ef534d3ee722">cb</a> = <a class="code" href="structbuffer.html#a93971c92f0374a1619e6ef534d3ee722">cb</a>;
        <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a65099887868ae5a084c53e49f9a78e73">cbarg</a> = <a class="code" href="structbuffer.html#a65099887868ae5a084c53e49f9a78e73">cbarg</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af87e577d4aa1ca130b5cbf9cf6772052"></a><!-- doxytag: member="buffer.h::buffer_write" ref="af87e577d4aa1ca130b5cbf9cf6772052" args="(struct buffer *, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="buffer_8h.html#af87e577d4aa1ca130b5cbf9cf6772052">buffer_write</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbuffer.html">buffer</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write the contents of an buffer to a file descriptor.</p>
<p>The buffer will be drained after the bytes have been successfully written.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>the buffer to be written and drained </td></tr>
    <tr><td class="paramname">fd</td><td>the file descriptor to be written to </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes written, or -1 if an error occurred </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="buffer_8c.html#a6daff54300df062d3ffbac383c4c2b1c">buffer_read()</a> </dd></dl>

<p>Definition at line <a class="el" href="buffer_8c_source.html#l00354">354</a> of file <a class="el" href="buffer_8c_source.html">buffer.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">int</span> n;

<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>        n = write(fd, <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a73d5800483fcfe69ac74471ba4730f8c">buffer</a>, <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a8060168e5fff32ee293aac8b27b3f954">off</a>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        n = send(fd, (<span class="keywordtype">char</span> *)<a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a73d5800483fcfe69ac74471ba4730f8c">buffer</a>, <a class="code" href="structbuffer.html">buffer</a>-&gt;<a class="code" href="structbuffer.html#a8060168e5fff32ee293aac8b27b3f954">off</a>, 0);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (n == -1)
                <span class="keywordflow">return</span> (-1);
        <span class="keywordflow">if</span> (n == 0)
                <span class="keywordflow">return</span> (0);
        <a class="code" href="buffer_8c.html#ae2df3dfe562240163aa056ab2a59e7de">buffer_drain</a>(<a class="code" href="structbuffer.html">buffer</a>, n);

        <span class="keywordflow">return</span> (n);
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 02:46:11 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
