<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/common/diff-simple.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/common/diff-simple.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;glib.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="index_8h_source.html">index/index.h</a>&quot;</code><br/>
<code>#include &quot;seafile-session.h&quot;</code><br/>
</div>
<p><a href="diff-simple_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDiffEntry.html">DiffEntry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDiffOptions.html">DiffOptions</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a8436a6626f11ceb18921279b4f4995dc">DIFF_TYPE_WORKTREE</a>&#160;&#160;&#160;'W' /* diff from index to worktree */</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a1dbad127a740e1a35a6e051c6366139e">DIFF_TYPE_INDEX</a>&#160;&#160;&#160;'I' /* diff from commit to index */</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#abd106f800596da115b74dd40a7f9e46f">DIFF_TYPE_COMMITS</a>&#160;&#160;&#160;'C' /* diff between two commits*/</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a8a5184ba68f5168383e7a1017e89e290">DIFF_STATUS_ADDED</a>&#160;&#160;&#160;'A'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a33f1598ea0372aa7bd1dcf4b36bad9e8">DIFF_STATUS_DELETED</a>&#160;&#160;&#160;'D'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a94791401bdf8fe513b0a744823436190">DIFF_STATUS_MODIFIED</a>&#160;&#160;&#160;'M'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#abcf4512ebeae34bfed839057e70a72c2">DIFF_STATUS_RENAMED</a>&#160;&#160;&#160;'R'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a8183f9366482a221164b57a98ce03014">DIFF_STATUS_UNMERGED</a>&#160;&#160;&#160;'U'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a36e1b9c5a30fee84055977065fd0265d">DIFF_STATUS_DIR_ADDED</a>&#160;&#160;&#160;'B'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a820629607c6c8a44530724c2c9bc4974">DIFF_STATUS_DIR_DELETED</a>&#160;&#160;&#160;'C'</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a7ebaae7e72a366dbc3aba360e5e9957c">DIFF_STATUS_DIR_RENAMED</a>&#160;&#160;&#160;'E'</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structDiffEntry.html">DiffEntry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a19c60a9c536c5efd20dab4369f9887b4">DiffEntry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a86edb29ae385bd7fd120afda96b1df3c">DiffFileCB</a> )(int n, const char *basedir, <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *files[], void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a2650f89c1502569d85e101b2ea417792">DiffDirCB</a> )(int n, const char *basedir, <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *dirs[], void *data, gboolean *recurse)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structDiffOptions.html">DiffOptions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a604c94807978f5c58abef1f735e0cf26">DiffOptions</a></td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <br/>
&#160;&#160;<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a45886c8466379a2ca3a120cc1f1d02d6">STATUS_UNMERGED_NONE</a>, 
<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a9692ad16efb3ef4275f499e0125daeac">STATUS_UNMERGED_BOTH_CHANGED</a>, 
<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a47519dabcf3638c67da1a1539322d70d">STATUS_UNMERGED_BOTH_ADDED</a>, 
<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a656f37e47c0a1a4ed0528687d8cdbf1e">STATUS_UNMERGED_I_REMOVED</a>, 
<br/>
&#160;&#160;<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a10f7295514e6b894a393824fba0bd709">STATUS_UNMERGED_OTHERS_REMOVED</a>, 
<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a751a2d5456e6b2b4311bd442f414367b">STATUS_UNMERGED_DFC_I_ADDED_FILE</a>, 
<a class="el" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a62c00c3e0c527f2fd158a3e0c867781f">STATUS_UNMERGED_DFC_OTHERS_ADDED_FILE</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structDiffEntry.html">DiffEntry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a5a9e3f70659801a181ca4ff6004bf021">diff_entry_new</a> (char <a class="el" href="fs-mgr_8c.html#a65cfc9e13d3352fd9099a0408cba715c">type</a>, char <a class="el" href="block-tx-utils_8h.html#a2aaa5f99cdedb08950d78469e9e64edc">status</a>, unsigned char *<a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>, const char *<a class="el" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#abb759117ec4b4aca623768424487f5da">diff_entry_free</a> (<a class="el" href="structDiffEntry.html">DiffEntry</a> *de)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a61fa5d287ecd1508b220a422b250d676">diff_index</a> (const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, struct <a class="el" href="structindex__state.html">index_state</a> *istate, <a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *root, GList **results)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a9e9cbe6847c88fc7bca7035f45a0a50e">diff_commits</a> (<a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *commit1, <a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *commit2, GList **results, gboolean fold_dir_diff)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a76134c9482b81d9ff5455eac2765a656">diff_commit_roots</a> (const char *store_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root1, const char *root2, GList **results, gboolean fold_dir_diff)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a8c800ee63c23c5ff78d838974f678e47">diff_merge</a> (<a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *merge, GList **results, gboolean fold_dir_diff)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#aaad6d753f728db61f274e7ce8ec70e97">diff_merge_roots</a> (const char *store_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *merged_root, const char *p1_root, const char *p2_root, GList **results, gboolean fold_dir_diff)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a3d936e2ea0a740cbdc9bbab7113b3742">diff_resolve_renames</a> (GList **diff_entries)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a8007e76befdeace050ccd548d21657f6">diff_resolve_empty_dirs</a> (GList **diff_entries)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a1e04d69761cc66544df3dc5577def9c1">diff_unmerged_state</a> (int mask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a2ff48f3041928cc4d2b432761d410c31">format_diff_results</a> (GList *results)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#a661dddff1df554c9c4da96ee30e44c8d">diff_results_to_description</a> (GList *results)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="diff-simple_8h.html#aad681f9b9d7dbc7586efaa4cd0b254e6">diff_trees</a> (int n, const char *roots[], <a class="el" href="structDiffOptions.html">DiffOptions</a> *opt)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8a5184ba68f5168383e7a1017e89e290"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_ADDED" ref="a8a5184ba68f5168383e7a1017e89e290" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a8a5184ba68f5168383e7a1017e89e290">DIFF_STATUS_ADDED</a>&#160;&#160;&#160;'A'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00014">14</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a33f1598ea0372aa7bd1dcf4b36bad9e8"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_DELETED" ref="a33f1598ea0372aa7bd1dcf4b36bad9e8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a33f1598ea0372aa7bd1dcf4b36bad9e8">DIFF_STATUS_DELETED</a>&#160;&#160;&#160;'D'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00015">15</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a36e1b9c5a30fee84055977065fd0265d"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_DIR_ADDED" ref="a36e1b9c5a30fee84055977065fd0265d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a36e1b9c5a30fee84055977065fd0265d">DIFF_STATUS_DIR_ADDED</a>&#160;&#160;&#160;'B'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00019">19</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a820629607c6c8a44530724c2c9bc4974"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_DIR_DELETED" ref="a820629607c6c8a44530724c2c9bc4974" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a820629607c6c8a44530724c2c9bc4974">DIFF_STATUS_DIR_DELETED</a>&#160;&#160;&#160;'C'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00020">20</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7ebaae7e72a366dbc3aba360e5e9957c"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_DIR_RENAMED" ref="a7ebaae7e72a366dbc3aba360e5e9957c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a7ebaae7e72a366dbc3aba360e5e9957c">DIFF_STATUS_DIR_RENAMED</a>&#160;&#160;&#160;'E'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00021">21</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a94791401bdf8fe513b0a744823436190"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_MODIFIED" ref="a94791401bdf8fe513b0a744823436190" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a94791401bdf8fe513b0a744823436190">DIFF_STATUS_MODIFIED</a>&#160;&#160;&#160;'M'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00016">16</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="abcf4512ebeae34bfed839057e70a72c2"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_RENAMED" ref="abcf4512ebeae34bfed839057e70a72c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#abcf4512ebeae34bfed839057e70a72c2">DIFF_STATUS_RENAMED</a>&#160;&#160;&#160;'R'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00017">17</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8183f9366482a221164b57a98ce03014"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_STATUS_UNMERGED" ref="a8183f9366482a221164b57a98ce03014" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a8183f9366482a221164b57a98ce03014">DIFF_STATUS_UNMERGED</a>&#160;&#160;&#160;'U'</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00018">18</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="abd106f800596da115b74dd40a7f9e46f"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_TYPE_COMMITS" ref="abd106f800596da115b74dd40a7f9e46f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#abd106f800596da115b74dd40a7f9e46f">DIFF_TYPE_COMMITS</a>&#160;&#160;&#160;'C' /* diff between two commits*/</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00012">12</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1dbad127a740e1a35a6e051c6366139e"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_TYPE_INDEX" ref="a1dbad127a740e1a35a6e051c6366139e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a1dbad127a740e1a35a6e051c6366139e">DIFF_TYPE_INDEX</a>&#160;&#160;&#160;'I' /* diff from commit to index */</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00011">11</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8436a6626f11ceb18921279b4f4995dc"></a><!-- doxytag: member="diff&#45;simple.h::DIFF_TYPE_WORKTREE" ref="a8436a6626f11ceb18921279b4f4995dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="diff-simple_8h.html#a8436a6626f11ceb18921279b4f4995dc">DIFF_TYPE_WORKTREE</a>&#160;&#160;&#160;'W' /* diff from index to worktree */</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00010">10</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a2650f89c1502569d85e101b2ea417792"></a><!-- doxytag: member="diff&#45;simple.h::DiffDirCB" ref="a2650f89c1502569d85e101b2ea417792" args=")(int n, const char *basedir, SeafDirent *dirs[], void *data, gboolean *recurse)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="diff-simple_8h.html#a2650f89c1502569d85e101b2ea417792">DiffDirCB</a>)(int n, const char *basedir, <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *dirs[], void *data, gboolean *recurse)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00112">112</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a19c60a9c536c5efd20dab4369f9887b4"></a><!-- doxytag: member="diff&#45;simple.h::DiffEntry" ref="a19c60a9c536c5efd20dab4369f9887b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structDiffEntry.html">DiffEntry</a>  <a class="el" href="structDiffEntry.html">DiffEntry</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a86edb29ae385bd7fd120afda96b1df3c"></a><!-- doxytag: member="diff&#45;simple.h::DiffFileCB" ref="a86edb29ae385bd7fd120afda96b1df3c" args=")(int n, const char *basedir, SeafDirent *files[], void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="diff-simple_8h.html#a86edb29ae385bd7fd120afda96b1df3c">DiffFileCB</a>)(int n, const char *basedir, <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *files[], void *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00107">107</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>

</div>
</div>
<a class="anchor" id="a604c94807978f5c58abef1f735e0cf26"></a><!-- doxytag: member="diff&#45;simple.h::DiffOptions" ref="a604c94807978f5c58abef1f735e0cf26" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structDiffOptions.html">DiffOptions</a>  <a class="el" href="structDiffOptions.html">DiffOptions</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04"></a><!-- doxytag: member="diff&#45;simple.h::@3" ref="abc6126af1d45847bc59afa0aa3216b04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a45886c8466379a2ca3a120cc1f1d02d6"></a><!-- doxytag: member="STATUS_UNMERGED_NONE" ref="abc6126af1d45847bc59afa0aa3216b04a45886c8466379a2ca3a120cc1f1d02d6" args="" -->STATUS_UNMERGED_NONE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a9692ad16efb3ef4275f499e0125daeac"></a><!-- doxytag: member="STATUS_UNMERGED_BOTH_CHANGED" ref="abc6126af1d45847bc59afa0aa3216b04a9692ad16efb3ef4275f499e0125daeac" args="" -->STATUS_UNMERGED_BOTH_CHANGED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a47519dabcf3638c67da1a1539322d70d"></a><!-- doxytag: member="STATUS_UNMERGED_BOTH_ADDED" ref="abc6126af1d45847bc59afa0aa3216b04a47519dabcf3638c67da1a1539322d70d" args="" -->STATUS_UNMERGED_BOTH_ADDED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a656f37e47c0a1a4ed0528687d8cdbf1e"></a><!-- doxytag: member="STATUS_UNMERGED_I_REMOVED" ref="abc6126af1d45847bc59afa0aa3216b04a656f37e47c0a1a4ed0528687d8cdbf1e" args="" -->STATUS_UNMERGED_I_REMOVED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a10f7295514e6b894a393824fba0bd709"></a><!-- doxytag: member="STATUS_UNMERGED_OTHERS_REMOVED" ref="abc6126af1d45847bc59afa0aa3216b04a10f7295514e6b894a393824fba0bd709" args="" -->STATUS_UNMERGED_OTHERS_REMOVED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a751a2d5456e6b2b4311bd442f414367b"></a><!-- doxytag: member="STATUS_UNMERGED_DFC_I_ADDED_FILE" ref="abc6126af1d45847bc59afa0aa3216b04a751a2d5456e6b2b4311bd442f414367b" args="" -->STATUS_UNMERGED_DFC_I_ADDED_FILE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abc6126af1d45847bc59afa0aa3216b04a62c00c3e0c527f2fd158a3e0c867781f"></a><!-- doxytag: member="STATUS_UNMERGED_DFC_OTHERS_ADDED_FILE" ref="abc6126af1d45847bc59afa0aa3216b04a62c00c3e0c527f2fd158a3e0c867781f" args="" -->STATUS_UNMERGED_DFC_OTHERS_ADDED_FILE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="diff-simple_8h_source.html#l00023">23</a> of file <a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>.</p>
<div class="fragment"><pre class="fragment">     {
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a45886c8466379a2ca3a120cc1f1d02d6">STATUS_UNMERGED_NONE</a>,
    <span class="comment">/* I and others modified the same file differently. */</span>
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a9692ad16efb3ef4275f499e0125daeac">STATUS_UNMERGED_BOTH_CHANGED</a>,
    <span class="comment">/* I and others created the same file with different contents. */</span>
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a47519dabcf3638c67da1a1539322d70d">STATUS_UNMERGED_BOTH_ADDED</a>,
    <span class="comment">/* I removed a file while others modified it. */</span>
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a656f37e47c0a1a4ed0528687d8cdbf1e">STATUS_UNMERGED_I_REMOVED</a>,
    <span class="comment">/* Others removed a file while I modified it. */</span>
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a10f7295514e6b894a393824fba0bd709">STATUS_UNMERGED_OTHERS_REMOVED</a>,
    <span class="comment">/* I replace a directory with a file while others modified files under the directory. */</span>
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a751a2d5456e6b2b4311bd442f414367b">STATUS_UNMERGED_DFC_I_ADDED_FILE</a>,
    <span class="comment">/* Others replace a directory with a file while I modified files under the directory. */</span>
    <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a62c00c3e0c527f2fd158a3e0c867781f">STATUS_UNMERGED_DFC_OTHERS_ADDED_FILE</a>,
};
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a76134c9482b81d9ff5455eac2765a656"></a><!-- doxytag: member="diff&#45;simple.h::diff_commit_roots" ref="a76134c9482b81d9ff5455eac2765a656" args="(const char *store_id, int version, const char *root1, const char *root2, GList **results, gboolean fold_dir_diff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#a76134c9482b81d9ff5455eac2765a656">diff_commit_roots</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>store_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>results</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>fold_dir_diff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00480">480</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structDiffOptions.html">DiffOptions</a> opt;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *roots[2];

    <a class="code" href="structDiffData.html">DiffData</a> data;
    memset (&amp;data, 0, <span class="keyword">sizeof</span>(data));
    data.<a class="code" href="structDiffData.html#a00d3e09b8e1b8b4a573a12328626c54f">results</a> = results;
    data.<a class="code" href="structDiffData.html#a3231eacdc9c97e16ad0c055ebd2ea2ce">fold_dir_diff</a> = fold_dir_diff;

    memset (&amp;opt, 0, <span class="keyword">sizeof</span>(opt));
    memcpy (opt.<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>, store_id, 36);
    opt.<a class="code" href="structDiffOptions.html#a2a919ea52308ada77775f78787df38f8">version</a> = <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>;
    opt.<a class="code" href="structDiffOptions.html#a879b904244a3b1cf5ca46b6951d068c3">file_cb</a> = twoway_diff_files;
    opt.<a class="code" href="structDiffOptions.html#ac522b82b0271d69292cdaa84cb545b2b">dir_cb</a> = twoway_diff_dirs;
    opt.<a class="code" href="structDiffOptions.html#aa922b39e312c25c075d5ed452d400b83">data</a> = &amp;data;

    roots[0] = root1;
    roots[1] = root2;

    <a class="code" href="diff-simple_8c.html#aad681f9b9d7dbc7586efaa4cd0b254e6">diff_trees</a> (2, roots, &amp;opt);
    <a class="code" href="diff-simple_8c.html#a3d936e2ea0a740cbdc9bbab7113b3742">diff_resolve_renames</a> (results);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e9cbe6847c88fc7bca7035f45a0a50e"></a><!-- doxytag: member="diff&#45;simple.h::diff_commits" ref="a9e9cbe6847c88fc7bca7035f45a0a50e" args="(SeafCommit *commit1, SeafCommit *commit2, GList **results, gboolean fold_dir_diff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#a9e9cbe6847c88fc7bca7035f45a0a50e">diff_commits</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *&#160;</td>
          <td class="paramname"><em>commit1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *&#160;</td>
          <td class="paramname"><em>commit2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>results</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>fold_dir_diff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00437">437</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo = NULL;
    <a class="code" href="structDiffOptions.html">DiffOptions</a> opt;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *roots[2];

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, commit1-&gt;<a class="code" href="struct__SeafCommit.html#af9c51057516029191941d47985df7f5f">repo_id</a>);
    <span class="keywordflow">if</span> (!repo) {
        seaf_warning (<span class="stringliteral">&quot;Failed to get repo %s.\n&quot;</span>, commit1-&gt;<a class="code" href="struct__SeafCommit.html#af9c51057516029191941d47985df7f5f">repo_id</a>);
        <span class="keywordflow">return</span> -1;
    }

    <a class="code" href="structDiffData.html">DiffData</a> data;
    memset (&amp;data, 0, <span class="keyword">sizeof</span>(data));
    data.<a class="code" href="structDiffData.html#a00d3e09b8e1b8b4a573a12328626c54f">results</a> = results;
    data.<a class="code" href="structDiffData.html#a3231eacdc9c97e16ad0c055ebd2ea2ce">fold_dir_diff</a> = fold_dir_diff;

    memset (&amp;opt, 0, <span class="keyword">sizeof</span>(opt));
<span class="preprocessor">#ifdef SEAFILE_SERVER</span>
<span class="preprocessor"></span>    memcpy (opt.<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a806d8d4c51581a0a06e7b675023178ae">store_id</a>, 36);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    memcpy (opt.<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, 36);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    opt.<a class="code" href="structDiffOptions.html#a2a919ea52308ada77775f78787df38f8">version</a> = repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a>;
    opt.<a class="code" href="structDiffOptions.html#a879b904244a3b1cf5ca46b6951d068c3">file_cb</a> = twoway_diff_files;
    opt.<a class="code" href="structDiffOptions.html#ac522b82b0271d69292cdaa84cb545b2b">dir_cb</a> = twoway_diff_dirs;
    opt.<a class="code" href="structDiffOptions.html#aa922b39e312c25c075d5ed452d400b83">data</a> = &amp;data;

<span class="preprocessor">#ifdef SEAFILE_SERVER</span>
<span class="preprocessor"></span>    <a class="code" href="fuse_2repo-mgr_8c.html#af6bedb063685823d91f2a335c6882e07">seaf_repo_unref</a> (repo);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    roots[0] = commit1-&gt;<a class="code" href="struct__SeafCommit.html#a2268a50b170dc23bfa0f5108a2b764e5">root_id</a>;
    roots[1] = commit2-&gt;<a class="code" href="struct__SeafCommit.html#a2268a50b170dc23bfa0f5108a2b764e5">root_id</a>;

    <a class="code" href="diff-simple_8c.html#aad681f9b9d7dbc7586efaa4cd0b254e6">diff_trees</a> (2, roots, &amp;opt);
    <a class="code" href="diff-simple_8c.html#a3d936e2ea0a740cbdc9bbab7113b3742">diff_resolve_renames</a> (results);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abb759117ec4b4aca623768424487f5da"></a><!-- doxytag: member="diff&#45;simple.h::diff_entry_free" ref="abb759117ec4b4aca623768424487f5da" args="(DiffEntry *de)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="diff-simple_8h.html#abb759117ec4b4aca623768424487f5da">diff_entry_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structDiffEntry.html">DiffEntry</a> *&#160;</td>
          <td class="paramname"><em>de</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00056">56</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_free (de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
    <span class="keywordflow">if</span> (de-&gt;<a class="code" href="structDiffEntry.html#acfe7cac599e8737146318883029c26e9">new_name</a>)
        g_free (de-&gt;<a class="code" href="structDiffEntry.html#acfe7cac599e8737146318883029c26e9">new_name</a>);

<span class="preprocessor">#ifdef SEAFILE_CLIENT</span>
<span class="preprocessor"></span>    g_free (de-&gt;modifier);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    g_free (de);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5a9e3f70659801a181ca4ff6004bf021"></a><!-- doxytag: member="diff&#45;simple.h::diff_entry_new" ref="a5a9e3f70659801a181ca4ff6004bf021" args="(char type, char status, unsigned char *sha1, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDiffEntry.html">DiffEntry</a>* <a class="el" href="diff-simple_8h.html#a5a9e3f70659801a181ca4ff6004bf021">diff_entry_new</a> </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>sha1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00011">11</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structDiffEntry.html">DiffEntry</a> *de = g_new0 (<a class="code" href="structDiffEntry.html">DiffEntry</a>, 1);

    de-&gt;<a class="code" href="structDiffEntry.html#a07ebfe57746e5fc5017603545ab04b47">type</a> = <a class="code" href="fs-mgr_8c.html#a65cfc9e13d3352fd9099a0408cba715c">type</a>;
    de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> = <a class="code" href="block-tx-utils_8h.html#a2aaa5f99cdedb08950d78469e9e64edc">status</a>;
    memcpy (de-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>, <a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>, 20);
    de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a> = g_strdup(<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);

    <span class="keywordflow">return</span> de;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a61fa5d287ecd1508b220a422b250d676"></a><!-- doxytag: member="diff&#45;simple.h::diff_index" ref="a61fa5d287ecd1508b220a422b250d676" args="(const char *repo_id, int version, struct index_state *istate, SeafDir *root, GList **results)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#a61fa5d287ecd1508b220a422b250d676">diff_index</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structindex__state.html">index_state</a> *&#160;</td>
          <td class="paramname"><em>istate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>results</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00142">142</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span><a class="code" href="structtree__desc.html">tree_desc</a> t;
    <span class="keyword">struct </span><a class="code" href="structunpack__trees__options.html">unpack_trees_options</a> opts;

    memset(&amp;opts, 0, <span class="keyword">sizeof</span>(opts));
    memcpy (opts.repo_id, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, 36);
    opts.version = <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>;
    opts.head_idx = 1;
    opts.index_only = 1;
    <span class="comment">/* Unmerged entries are handled in diff worktree. */</span>
    opts.skip_unmerged = 1;
    opts.merge = 1;
    opts.fn = oneway_diff;
    opts.unpack_data = results;
    opts.src_index = istate;
    opts.dst_index = NULL;

    <a class="code" href="seaf-tree-walk_8c.html#a7b310abaeb185b8918eb2a9fc843e097">fill_tree_descriptor</a>(<a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, &amp;t, root-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>);
    <span class="keywordtype">int</span> ret = <a class="code" href="unpack-trees_8c.html#a5bfe365644fb33537027e988fb891e08">unpack_trees</a>(1, &amp;t, &amp;opts);

    tree_desc_free (&amp;t);
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8c800ee63c23c5ff78d838974f678e47"></a><!-- doxytag: member="diff&#45;simple.h::diff_merge" ref="a8c800ee63c23c5ff78d838974f678e47" args="(SeafCommit *merge, GList **results, gboolean fold_dir_diff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#a8c800ee63c23c5ff78d838974f678e47">diff_merge</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *&#160;</td>
          <td class="paramname"><em>merge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>results</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>fold_dir_diff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00564">564</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo = NULL;
    <a class="code" href="structDiffOptions.html">DiffOptions</a> opt;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *roots[3];
    <a class="code" href="struct__SeafCommit.html">SeafCommit</a> *parent1, *parent2;

    g_return_val_if_fail (*results == NULL, -1);
    g_return_val_if_fail (merge-&gt;<a class="code" href="struct__SeafCommit.html#a24518f58c804153742e9976049da8512">parent_id</a> != NULL &amp;&amp;
                          merge-&gt;<a class="code" href="struct__SeafCommit.html#aad2ebe1498cc25f837554456cbcd31f5">second_parent_id</a> != NULL,
                          -1);

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, merge-&gt;<a class="code" href="struct__SeafCommit.html#af9c51057516029191941d47985df7f5f">repo_id</a>);
    <span class="keywordflow">if</span> (!repo) {
        seaf_warning (<span class="stringliteral">&quot;Failed to get repo %s.\n&quot;</span>, merge-&gt;<a class="code" href="struct__SeafCommit.html#af9c51057516029191941d47985df7f5f">repo_id</a>);
        <span class="keywordflow">return</span> -1;
    }

    parent1 = <a class="code" href="commit-mgr_8c.html#adaf4b74c4dba25ddaa746f4ff9221b3f">seaf_commit_manager_get_commit</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a62979f26f91fc5e54e0a670e8d69ef67">commit_mgr</a>,
                                              repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>,
                                              repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a>,
                                              merge-&gt;<a class="code" href="struct__SeafCommit.html#a24518f58c804153742e9976049da8512">parent_id</a>);
    <span class="keywordflow">if</span> (!parent1) {
        seaf_warning (<span class="stringliteral">&quot;failed to find commit %s.\n&quot;</span>, merge-&gt;<a class="code" href="struct__SeafCommit.html#a24518f58c804153742e9976049da8512">parent_id</a>);
        <span class="keywordflow">return</span> -1;
    }

    parent2 = <a class="code" href="commit-mgr_8c.html#adaf4b74c4dba25ddaa746f4ff9221b3f">seaf_commit_manager_get_commit</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a62979f26f91fc5e54e0a670e8d69ef67">commit_mgr</a>,
                                              repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>,
                                              repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a>,
                                              merge-&gt;<a class="code" href="struct__SeafCommit.html#aad2ebe1498cc25f837554456cbcd31f5">second_parent_id</a>);
    <span class="keywordflow">if</span> (!parent2) {
        seaf_warning (<span class="stringliteral">&quot;failed to find commit %s.\n&quot;</span>, merge-&gt;<a class="code" href="struct__SeafCommit.html#aad2ebe1498cc25f837554456cbcd31f5">second_parent_id</a>);
        <a class="code" href="commit-mgr_8c.html#a436a9092e9c5711820dc1a09234aac04">seaf_commit_unref</a> (parent1);
        <span class="keywordflow">return</span> -1;
    }

    <a class="code" href="structDiffData.html">DiffData</a> data;
    memset (&amp;data, 0, <span class="keyword">sizeof</span>(data));
    data.<a class="code" href="structDiffData.html#a00d3e09b8e1b8b4a573a12328626c54f">results</a> = results;
    data.<a class="code" href="structDiffData.html#a3231eacdc9c97e16ad0c055ebd2ea2ce">fold_dir_diff</a> = fold_dir_diff;

    memset (&amp;opt, 0, <span class="keyword">sizeof</span>(opt));
<span class="preprocessor">#ifdef SEAFILE_SERVER</span>
<span class="preprocessor"></span>    memcpy (opt.<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a806d8d4c51581a0a06e7b675023178ae">store_id</a>, 36);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    memcpy (opt.<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, 36);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    opt.<a class="code" href="structDiffOptions.html#a2a919ea52308ada77775f78787df38f8">version</a> = repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a>;
    opt.<a class="code" href="structDiffOptions.html#a879b904244a3b1cf5ca46b6951d068c3">file_cb</a> = threeway_diff_files;
    opt.<a class="code" href="structDiffOptions.html#ac522b82b0271d69292cdaa84cb545b2b">dir_cb</a> = threeway_diff_dirs;
    opt.<a class="code" href="structDiffOptions.html#aa922b39e312c25c075d5ed452d400b83">data</a> = &amp;data;

<span class="preprocessor">#ifdef SEAFILE_SERVER</span>
<span class="preprocessor"></span>    <a class="code" href="fuse_2repo-mgr_8c.html#af6bedb063685823d91f2a335c6882e07">seaf_repo_unref</a> (repo);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    roots[0] = merge-&gt;<a class="code" href="struct__SeafCommit.html#a2268a50b170dc23bfa0f5108a2b764e5">root_id</a>;
    roots[1] = parent1-&gt;<a class="code" href="struct__SeafCommit.html#a2268a50b170dc23bfa0f5108a2b764e5">root_id</a>;
    roots[2] = parent2-&gt;<a class="code" href="struct__SeafCommit.html#a2268a50b170dc23bfa0f5108a2b764e5">root_id</a>;

    <span class="keywordtype">int</span> ret = <a class="code" href="diff-simple_8c.html#aad681f9b9d7dbc7586efaa4cd0b254e6">diff_trees</a> (3, roots, &amp;opt);
    <a class="code" href="diff-simple_8c.html#a3d936e2ea0a740cbdc9bbab7113b3742">diff_resolve_renames</a> (results);

    <a class="code" href="commit-mgr_8c.html#a436a9092e9c5711820dc1a09234aac04">seaf_commit_unref</a> (parent1);
    <a class="code" href="commit-mgr_8c.html#a436a9092e9c5711820dc1a09234aac04">seaf_commit_unref</a> (parent2);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aaad6d753f728db61f274e7ce8ec70e97"></a><!-- doxytag: member="diff&#45;simple.h::diff_merge_roots" ref="aaad6d753f728db61f274e7ce8ec70e97" args="(const char *store_id, int version, const char *merged_root, const char *p1_root, const char *p2_root, GList **results, gboolean fold_dir_diff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#aaad6d753f728db61f274e7ce8ec70e97">diff_merge_roots</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>store_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>merged_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p1_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p2_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>results</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>fold_dir_diff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00635">635</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structDiffOptions.html">DiffOptions</a> opt;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *roots[3];

    g_return_val_if_fail (*results == NULL, -1);

    <a class="code" href="structDiffData.html">DiffData</a> data;
    memset (&amp;data, 0, <span class="keyword">sizeof</span>(data));
    data.<a class="code" href="structDiffData.html#a00d3e09b8e1b8b4a573a12328626c54f">results</a> = results;
    data.<a class="code" href="structDiffData.html#a3231eacdc9c97e16ad0c055ebd2ea2ce">fold_dir_diff</a> = fold_dir_diff;

    memset (&amp;opt, 0, <span class="keyword">sizeof</span>(opt));
    memcpy (opt.<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>, store_id, 36);
    opt.<a class="code" href="structDiffOptions.html#a2a919ea52308ada77775f78787df38f8">version</a> = <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>;
    opt.<a class="code" href="structDiffOptions.html#a879b904244a3b1cf5ca46b6951d068c3">file_cb</a> = threeway_diff_files;
    opt.<a class="code" href="structDiffOptions.html#ac522b82b0271d69292cdaa84cb545b2b">dir_cb</a> = threeway_diff_dirs;
    opt.<a class="code" href="structDiffOptions.html#aa922b39e312c25c075d5ed452d400b83">data</a> = &amp;data;

    roots[0] = merged_root;
    roots[1] = p1_root;
    roots[2] = p2_root;

    <a class="code" href="diff-simple_8c.html#aad681f9b9d7dbc7586efaa4cd0b254e6">diff_trees</a> (3, roots, &amp;opt);
    <a class="code" href="diff-simple_8c.html#a3d936e2ea0a740cbdc9bbab7113b3742">diff_resolve_renames</a> (results);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8007e76befdeace050ccd548d21657f6"></a><!-- doxytag: member="diff&#45;simple.h::diff_resolve_empty_dirs" ref="a8007e76befdeace050ccd548d21657f6" args="(GList **diff_entries)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="diff-simple_8h.html#a8007e76befdeace050ccd548d21657f6">diff_resolve_empty_dirs</a> </td>
          <td>(</td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>diff_entries</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00776">776</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *empty_dirs = NULL;
    GList *p, *dir, *file;
    <a class="code" href="structDiffEntry.html">DiffEntry</a> *de, *de_dir, *de_file;

    <span class="keywordflow">for</span> (p = *diff_entries; p != NULL; p = p-&gt;next) {
        de = p-&gt;data;
        <span class="keywordflow">if</span> (de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a36e1b9c5a30fee84055977065fd0265d">DIFF_STATUS_DIR_ADDED</a> ||
            de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a820629607c6c8a44530724c2c9bc4974">DIFF_STATUS_DIR_DELETED</a>)
            empty_dirs = g_list_prepend (empty_dirs, p);
    }

    <span class="keywordflow">for</span> (dir = empty_dirs; dir != NULL; dir = dir-&gt;next) {
        de_dir = ((GList *)dir-&gt;data)-&gt;data;
        <span class="keywordflow">for</span> (file = *diff_entries; file != NULL; file = file-&gt;next) {
            de_file = file-&gt;data;
            <span class="keywordflow">if</span> (is_redundant_empty_dir (de_dir, de_file)) {
                *diff_entries = g_list_delete_link (*diff_entries, dir-&gt;data);
                <span class="keywordflow">break</span>;
            }
        }
    }

    g_list_free (empty_dirs);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3d936e2ea0a740cbdc9bbab7113b3742"></a><!-- doxytag: member="diff&#45;simple.h::diff_resolve_renames" ref="a3d936e2ea0a740cbdc9bbab7113b3742" args="(GList **diff_entries)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="diff-simple_8h.html#a3d936e2ea0a740cbdc9bbab7113b3742">diff_resolve_renames</a> </td>
          <td>(</td>
          <td class="paramtype">GList **&#160;</td>
          <td class="paramname"><em>diff_entries</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00671">671</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GHashTable *deleted;
    GList *p;
    GList *added = NULL;
    <a class="code" href="structDiffEntry.html">DiffEntry</a> *de;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> empty_sha1[20];

    memset (empty_sha1, 0, 20);

    <span class="comment">/* Hash and equal functions for raw sha1. */</span>
    deleted = g_hash_table_new (<a class="code" href="seafile_2lib_2utils_8c.html#ac846d436ccbb4031fa7a8d76ceadad07">ccnet_sha1_hash</a>, <a class="code" href="seafile_2lib_2utils_8c.html#a75a7a2a1400f4cf5f6cd5ea988e705f4">ccnet_sha1_equal</a>);

    <span class="comment">/* Collect all &quot;deleted&quot; entries. */</span>
    <span class="keywordflow">for</span> (p = *diff_entries; p != NULL; p = p-&gt;next) {
        de = p-&gt;data;
        <span class="keywordflow">if</span> ((de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a33f1598ea0372aa7bd1dcf4b36bad9e8">DIFF_STATUS_DELETED</a> ||
             de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a820629607c6c8a44530724c2c9bc4974">DIFF_STATUS_DIR_DELETED</a>) &amp;&amp;
            memcmp (de-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>, empty_sha1, 20) != 0)
            g_hash_table_insert (deleted, de-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>, p);
    }

    <span class="comment">/* Collect all &quot;added&quot; entries into a separate list. */</span>
    <span class="keywordflow">for</span> (p = *diff_entries; p != NULL; p = p-&gt;next) {
        de = p-&gt;data;
        <span class="keywordflow">if</span> ((de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a8a5184ba68f5168383e7a1017e89e290">DIFF_STATUS_ADDED</a> ||
             de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a36e1b9c5a30fee84055977065fd0265d">DIFF_STATUS_DIR_ADDED</a>) &amp;&amp;
            memcmp (de-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>, empty_sha1, 20) != 0)
            added = g_list_prepend (added, p);
    }

    <span class="comment">/* For each &quot;added&quot; entry, if we find a &quot;deleted&quot; entry with</span>
<span class="comment">     * the same content, we find a rename pair.</span>
<span class="comment">     */</span>
    p = added;
    <span class="keywordflow">while</span> (p != NULL) {
        GList *p_add, *p_del;
        <a class="code" href="structDiffEntry.html">DiffEntry</a> *de_add, *de_del, *de_rename;
        <span class="keywordtype">int</span> rename_status;

        p_add = p-&gt;data;
        de_add = p_add-&gt;data;

        p_del = g_hash_table_lookup (deleted, de_add-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>);
        <span class="keywordflow">if</span> (p_del) {
            de_del = p_del-&gt;data;

            <span class="keywordflow">if</span> (de_add-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> == <a class="code" href="diff-simple_8h.html#a36e1b9c5a30fee84055977065fd0265d">DIFF_STATUS_DIR_ADDED</a>)
                rename_status = <a class="code" href="diff-simple_8h.html#a7ebaae7e72a366dbc3aba360e5e9957c">DIFF_STATUS_DIR_RENAMED</a>;
            <span class="keywordflow">else</span>
                rename_status = <a class="code" href="diff-simple_8h.html#abcf4512ebeae34bfed839057e70a72c2">DIFF_STATUS_RENAMED</a>;

            de_rename = <a class="code" href="diff-simple_8c.html#a5a9e3f70659801a181ca4ff6004bf021">diff_entry_new</a> (de_del-&gt;<a class="code" href="structDiffEntry.html#a07ebfe57746e5fc5017603545ab04b47">type</a>, rename_status, 
                                        de_del-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>, de_del-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            de_rename-&gt;<a class="code" href="structDiffEntry.html#acfe7cac599e8737146318883029c26e9">new_name</a> = g_strdup(de_add-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);

            *diff_entries = g_list_delete_link (*diff_entries, p_add);
            *diff_entries = g_list_delete_link (*diff_entries, p_del);
            *diff_entries = g_list_prepend (*diff_entries, de_rename);

            g_hash_table_remove (deleted, de_add-&gt;<a class="code" href="structDiffEntry.html#a3329ba035605e868d00fb3b773ae021d">sha1</a>);

            <a class="code" href="diff-simple_8c.html#abb759117ec4b4aca623768424487f5da">diff_entry_free</a> (de_add);
            <a class="code" href="diff-simple_8c.html#abb759117ec4b4aca623768424487f5da">diff_entry_free</a> (de_del);
        }

        p = g_list_delete_link (p, p);
    }

    g_hash_table_destroy (deleted);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a661dddff1df554c9c4da96ee30e44c8d"></a><!-- doxytag: member="diff&#45;simple.h::diff_results_to_description" ref="a661dddff1df554c9c4da96ee30e44c8d" args="(GList *results)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="diff-simple_8h.html#a661dddff1df554c9c4da96ee30e44c8d">diff_results_to_description</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>results</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00862">862</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *p;
    <a class="code" href="structDiffEntry.html">DiffEntry</a> *de;
    <span class="keywordtype">char</span> *new_file = NULL, *removed_file = NULL;
    <span class="keywordtype">char</span> *renamed_file = NULL, *modified_file = NULL;
    <span class="keywordtype">char</span> *new_dir = NULL, *removed_dir = NULL;
    <span class="keywordtype">int</span> n_new = 0, n_removed = 0, n_renamed = 0, n_modified = 0;
    <span class="keywordtype">int</span> n_new_dir = 0, n_removed_dir = 0;
    GString *desc;

    <span class="keywordflow">if</span> (results == NULL)
        <span class="keywordflow">return</span> NULL;

    <span class="keywordflow">for</span> (p = results; p != NULL; p = p-&gt;next) {
        de = p-&gt;data;
        <span class="keywordflow">switch</span> (de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a>) {
        <span class="keywordflow">case</span> <a class="code" href="diff-simple_8h.html#a8a5184ba68f5168383e7a1017e89e290">DIFF_STATUS_ADDED</a>:
            <span class="keywordflow">if</span> (n_new == 0)
                new_file = get_basename(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            n_new++;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="diff-simple_8h.html#a33f1598ea0372aa7bd1dcf4b36bad9e8">DIFF_STATUS_DELETED</a>:
            <span class="keywordflow">if</span> (n_removed == 0)
                removed_file = get_basename(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            n_removed++;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="diff-simple_8h.html#abcf4512ebeae34bfed839057e70a72c2">DIFF_STATUS_RENAMED</a>:
            <span class="keywordflow">if</span> (n_renamed == 0)
                renamed_file = get_basename(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            n_renamed++;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="diff-simple_8h.html#a94791401bdf8fe513b0a744823436190">DIFF_STATUS_MODIFIED</a>:
            <span class="keywordflow">if</span> (n_modified == 0)
                modified_file = get_basename(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            n_modified++;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="diff-simple_8h.html#a36e1b9c5a30fee84055977065fd0265d">DIFF_STATUS_DIR_ADDED</a>:
            <span class="keywordflow">if</span> (n_new_dir == 0)
                new_dir = get_basename(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            n_new_dir++;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="diff-simple_8h.html#a820629607c6c8a44530724c2c9bc4974">DIFF_STATUS_DIR_DELETED</a>:
            <span class="keywordflow">if</span> (n_removed_dir == 0)
                removed_dir = get_basename(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
            n_removed_dir++;
            <span class="keywordflow">break</span>;
        }
    }

    desc = g_string_new (<span class="stringliteral">&quot;&quot;</span>);

    <span class="keywordflow">if</span> (n_new == 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Added \&quot;%s\&quot;.\n&quot;</span>, new_file);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_new &gt; 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Added \&quot;%s\&quot; and %d more files.\n&quot;</span>,
                                new_file, n_new - 1);

    <span class="keywordflow">if</span> (n_removed == 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Deleted \&quot;%s\&quot;.\n&quot;</span>, removed_file);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_removed &gt; 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Deleted \&quot;%s\&quot; and %d more files.\n&quot;</span>,
                                removed_file, n_removed - 1);

    <span class="keywordflow">if</span> (n_renamed == 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Renamed \&quot;%s\&quot;.\n&quot;</span>, renamed_file);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_renamed &gt; 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Renamed \&quot;%s\&quot; and %d more files.\n&quot;</span>,
                                renamed_file, n_renamed - 1);

    <span class="keywordflow">if</span> (n_modified == 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Modified \&quot;%s\&quot;.\n&quot;</span>, modified_file);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_modified &gt; 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Modified \&quot;%s\&quot; and %d more files.\n&quot;</span>,
                                modified_file, n_modified - 1);

    <span class="keywordflow">if</span> (n_new_dir == 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Added directory \&quot;%s\&quot;.\n&quot;</span>, new_dir);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_new_dir &gt; 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Added \&quot;%s\&quot; and %d more directories.\n&quot;</span>,
                                new_dir, n_new_dir - 1);

    <span class="keywordflow">if</span> (n_removed_dir == 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Removed directory \&quot;%s\&quot;.\n&quot;</span>, removed_dir);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_removed_dir &gt; 1)
        g_string_append_printf (desc, <span class="stringliteral">&quot;Removed \&quot;%s\&quot; and %d more directories.\n&quot;</span>,
                                removed_dir, n_removed_dir - 1);

    <span class="keywordflow">return</span> g_string_free (desc, FALSE);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aad681f9b9d7dbc7586efaa4cd0b254e6"></a><!-- doxytag: member="diff&#45;simple.h::diff_trees" ref="aad681f9b9d7dbc7586efaa4cd0b254e6" args="(int n, const char *roots[], DiffOptions *opt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#aad681f9b9d7dbc7586efaa4cd0b254e6">diff_trees</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>roots</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDiffOptions.html">DiffOptions</a> *&#160;</td>
          <td class="paramname"><em>opt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00332">332</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDir.html">SeafDir</a> **trees, *root;
    <span class="keywordtype">int</span> i, ret;

    g_return_val_if_fail (n == 2 || n == 3, -1);

    trees = g_new0 (<a class="code" href="struct__SeafDir.html">SeafDir</a> *, n);
    <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i) {
        root = <a class="code" href="fs-mgr_8c.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>,
                                            opt-&gt;<a class="code" href="structDiffOptions.html#a2f9324e06d0355964eb248315056d65c">store_id</a>,
                                            opt-&gt;<a class="code" href="structDiffOptions.html#a2a919ea52308ada77775f78787df38f8">version</a>,
                                            roots[i]);
        <span class="keywordflow">if</span> (!root) {
            seaf_warning (<span class="stringliteral">&quot;Failed to find dir %s.\n&quot;</span>, roots[i]);
            g_free (trees);
            <span class="keywordflow">return</span> -1;
        }
        trees[i] = root;
    }

    ret = diff_trees_recursive (n, trees, <span class="stringliteral">&quot;&quot;</span>, opt);

    <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i)
        <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (trees[i]);
    g_free (trees);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1e04d69761cc66544df3dc5577def9c1"></a><!-- doxytag: member="diff&#45;simple.h::diff_unmerged_state" ref="a1e04d69761cc66544df3dc5577def9c1" args="(int mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="diff-simple_8h.html#a1e04d69761cc66544df3dc5577def9c1">diff_unmerged_state</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mask</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00803">803</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    mask &gt;&gt;= 1;
    <span class="keywordflow">switch</span> (mask) {
        <span class="keywordflow">case</span> 7:
            <span class="keywordflow">return</span> <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a9692ad16efb3ef4275f499e0125daeac">STATUS_UNMERGED_BOTH_CHANGED</a>;
        <span class="keywordflow">case</span> 3:
            <span class="keywordflow">return</span> <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a10f7295514e6b894a393824fba0bd709">STATUS_UNMERGED_OTHERS_REMOVED</a>;
        <span class="keywordflow">case</span> 5:
            <span class="keywordflow">return</span> <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a656f37e47c0a1a4ed0528687d8cdbf1e">STATUS_UNMERGED_I_REMOVED</a>;
        <span class="keywordflow">case</span> 6:
            <span class="keywordflow">return</span> <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a47519dabcf3638c67da1a1539322d70d">STATUS_UNMERGED_BOTH_ADDED</a>;
        <span class="keywordflow">case</span> 2:
            <span class="keywordflow">return</span> <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a751a2d5456e6b2b4311bd442f414367b">STATUS_UNMERGED_DFC_I_ADDED_FILE</a>;
        <span class="keywordflow">case</span> 4:
            <span class="keywordflow">return</span> <a class="code" href="diff-simple_8h.html#abc6126af1d45847bc59afa0aa3216b04a62c00c3e0c527f2fd158a3e0c867781f">STATUS_UNMERGED_DFC_OTHERS_ADDED_FILE</a>;
        <span class="keywordflow">default</span>:
            g_warning (<span class="stringliteral">&quot;Unexpected unmerged case\n&quot;</span>);
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2ff48f3041928cc4d2b432761d410c31"></a><!-- doxytag: member="diff&#45;simple.h::format_diff_results" ref="a2ff48f3041928cc4d2b432761d410c31" args="(GList *results)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="diff-simple_8h.html#a2ff48f3041928cc4d2b432761d410c31">format_diff_results</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>results</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="diff-simple_8c_source.html#l00826">826</a> of file <a class="el" href="diff-simple_8c_source.html">diff-simple.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ptr;
    GString *fmt_status;
    <a class="code" href="structDiffEntry.html">DiffEntry</a> *de;

    fmt_status = g_string_new(<span class="stringliteral">&quot;&quot;</span>);

    <span class="keywordflow">for</span> (ptr = results; ptr; ptr = ptr-&gt;next) {
        de = ptr-&gt;data;

        <span class="keywordflow">if</span> (de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a> != <a class="code" href="diff-simple_8h.html#abcf4512ebeae34bfed839057e70a72c2">DIFF_STATUS_RENAMED</a>)
            g_string_append_printf(fmt_status, <span class="stringliteral">&quot;%c %c %d %u %s\n&quot;</span>,
                                   de-&gt;<a class="code" href="structDiffEntry.html#a07ebfe57746e5fc5017603545ab04b47">type</a>, de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a>, de-&gt;<a class="code" href="structDiffEntry.html#ac104f9910f0da8c74fa0a5ad7a4827ad">unmerge_state</a>,
                                   (<span class="keywordtype">int</span>)strlen(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>), de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>);
        <span class="keywordflow">else</span>
            g_string_append_printf(fmt_status, <span class="stringliteral">&quot;%c %c %d %u %s %u %s\n&quot;</span>,
                                   de-&gt;<a class="code" href="structDiffEntry.html#a07ebfe57746e5fc5017603545ab04b47">type</a>, de-&gt;<a class="code" href="structDiffEntry.html#a93a8fc375b3837c75c9b79157ab98d0a">status</a>, de-&gt;<a class="code" href="structDiffEntry.html#ac104f9910f0da8c74fa0a5ad7a4827ad">unmerge_state</a>,
                                   (<span class="keywordtype">int</span>)strlen(de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>), de-&gt;<a class="code" href="structDiffEntry.html#a13d88a564e6d598e93f64f211a9c160c">name</a>,
                                   (<span class="keywordtype">int</span>)strlen(de-&gt;<a class="code" href="structDiffEntry.html#acfe7cac599e8737146318883029c26e9">new_name</a>), de-&gt;<a class="code" href="structDiffEntry.html#acfe7cac599e8737146318883029c26e9">new_name</a>);
    }

    <span class="keywordflow">return</span> g_string_free(fmt_status, FALSE);
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:19:05 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
