<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/common/fs-mgr.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">seafile/common/fs-mgr.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;glib.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="seafile-object_8h_source.html">seafile-object.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="obj-store_8h_source.html">obj-store.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cdc_8h_source.html">cdc/cdc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-crypt_8h_source.html">../common/seafile-crypt.h</a>&quot;</code><br/>
</div>
<p><a href="fs-mgr_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__SeafFSObject.html">_SeafFSObject</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__Seafile.html">_Seafile</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__SeafDirent.html">_SeafDirent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__SeafDir.html">_SeafDir</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlockList.html">BlockList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__SeafFSManager.html">_SeafFSManager</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a3d4b6159c34be37b1a578cc66a63bd19">CURRENT_DIR_OBJ_VERSION</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#abac8261f96e8e3dbd02d5e52cac66fc6">CURRENT_SEAFILE_OBJ_VERSION</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ae95c413b4d740d94ac0cc8becc46e61e">SEAF_DIR_NAME_LEN</a>&#160;&#160;&#160;256</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafFSManager.html">_SeafFSManager</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafFSObject.html">_SeafFSObject</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a364de0b7a1afe12c5265ddc3a950a892">SeafFSObject</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__Seafile.html">_Seafile</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafDir.html">_SeafDir</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafDirent.html">_SeafDirent</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafFSManagerPriv.html">_SeafFSManagerPriv</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a6783eee26f20d6501ac8eb3a6bc29da0">SeafFSManagerPriv</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef gboolean(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a42e22741d25d945bed7faabc732c7fe4">TraverseFSTreeCallback</a> )(<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *<a class="el" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, int <a class="el" href="fs-mgr_8c.html#a65cfc9e13d3352fd9099a0408cba715c">type</a>, void *user_data, gboolean *stop)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef gboolean(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a9bba616c7207dee55b973587fccb40be">TraverseFSPathCallback</a> )(<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *path, <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *dent, void *user_data, gboolean *stop)</td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6">SeafMetadataType</a> { <a class="el" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6aed7acde538c589d729d72cd6bbcdf72b">SEAF_METADATA_TYPE_INVALID</a>, 
<a class="el" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a46fc8ea4b8423113c7c59c7a2dc8cdf2">SEAF_METADATA_TYPE_FILE</a>, 
<a class="el" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6acb45e7822f0045abdcec47ea7dc1248d">SEAF_METADATA_TYPE_LINK</a>, 
<a class="el" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a7b28656556a225daa5cf2292ba075322">SEAF_METADATA_TYPE_DIR</a>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aaf788c4f305d5509b791f64615fa9112">seafile_ref</a> (<a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *seafile)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (<a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *seafile)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a6d5e7c9f24bc74592e3f83f624e79c8b">seafile_save</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *fs_mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, <a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *file)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ae49e883dd4aa920a40b870092677ae35">seaf_dir_new</a> (const char *id, GList *entries, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (<a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a6875a119da427bb1cd9796eee916b703">seaf_dir_from_data</a> (const char *dir_id, uint8_t *data, int len, gboolean is_json)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a63aaab4413dfa2eae60241305689a698">seaf_dir_to_data</a> (<a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *dir, int *len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a6335345f24b4ae73c65cf12e2b2d57b3">seaf_dir_save</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *fs_mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, <a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a07b91f8db9de0262970252a95f5e9f2f">seaf_dirent_new</a> (int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *<a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>, int <a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>, const char *<a class="el" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, gint64 <a class="el" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>, const char *modifier, gint64 <a class="el" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aef77f199fa9eccfe322f1ff978a9055a">seaf_dirent_free</a> (<a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *dent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a7e727c1c389bfe65ec011d0adcf8e567">seaf_dirent_dup</a> (<a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *dent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a9304a0c213bd34c4bf2a50a408e91c7a">seaf_metadata_type_from_data</a> (const char *<a class="el" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, uint8_t *data, int len, gboolean is_json)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#a364de0b7a1afe12c5265ddc3a950a892">SeafFSObject</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a63cf6fa9de3b33361dd2bbdc5c5ac95d">seaf_fs_object_from_data</a> (const char *<a class="el" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, uint8_t *data, int len, gboolean is_json)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ac3bcb5d0db17e8188189936b262609e6">seaf_fs_object_free</a> (<a class="el" href="fs-mgr_8h.html#a364de0b7a1afe12c5265ddc3a950a892">SeafFSObject</a> *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a4ac91596236cf21856f9cf12d0e33ffa">block_list_new</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a222764a7a6dc477fe04d6b5e267551cc">block_list_free</a> (<a class="el" href="structBlockList.html">BlockList</a> *bl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a8dda70e7563d2ae6a19e7407e67dc38e">block_list_insert</a> (<a class="el" href="structBlockList.html">BlockList</a> *bl, const char *<a class="el" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a4de2ed795d3ad88266f347a245c8bd5c">block_list_difference</a> (<a class="el" href="structBlockList.html">BlockList</a> *bl1, <a class="el" href="structBlockList.html">BlockList</a> *bl2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ad005159664b100b6ac12ee73d4dad7dd">seaf_fs_manager_new</a> (struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *<a class="el" href="server_2seafile-session_8h.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>, const char *seaf_dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a91dd774f96fb5cc505f423913ea730fe">seaf_fs_manager_init</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a36b814252ae47bd595a9282266ea1b56">seaf_fs_manager_checkout_file</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *file_id, const char *file_path, guint32 <a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>, guint64 <a class="el" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>, struct <a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *crypt, const char *in_repo_path, const char *conflict_head_id, gboolean force_conflict, gboolean *conflicted)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a562e73b605551b411fc8ccd333e26d36">seaf_fs_manager_index_file_blocks</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, GList *paths, GList *blockids, unsigned char <a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>[], gint64 <a class="el" href="fs-mgr_8c.html#a719775aaf4a8b8ffb6ce082b24375db0">file_size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#af41e85bce809b9f05ed5b20ac5eeb745">seaf_fs_manager_index_blocks</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *file_path, unsigned char <a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>[], gint64 *<a class="el" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>, <a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *crypt, gboolean write_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *file_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *dir_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a451e6d84cb6d10454d1f9b2b3d0205c5">seaf_fs_manager_get_seafdir_sorted</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *dir_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ac20db66dda33a3d54aba39534d8b8336">seaf_fs_manager_get_seafdir_sorted_by_path</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ab1cd5c89e6d5b47b828c3de9bff87d88">seaf_fs_manager_populate_blocklist</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, <a class="el" href="structBlockList.html">BlockList</a> *bl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a7bd544826845e7f5b917fdfd727d4806">seaf_fs_manager_traverse_tree</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, <a class="el" href="fs-mgr_8h.html#a42e22741d25d945bed7faabc732c7fe4">TraverseFSTreeCallback</a> callback, void *user_data, gboolean skip_errors)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a4fd132514ca9fb157d1b16a8e21bf749">seaf_fs_manager_traverse_path</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *dir_path, <a class="el" href="fs-mgr_8h.html#a9bba616c7207dee55b973587fccb40be">TraverseFSPathCallback</a> callback, void *user_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a9262b8849eabb4d72009ca1feb396c20">seaf_fs_manager_object_exists</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ac378976c82415b33c8fbdfb42d5ca83d">seaf_fs_manager_delete_object</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a0927ab6809d59562a0782cb80e410575">seaf_fs_manager_get_file_size</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *file_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a13be199dd5ff26f9255cd94744e8d48f">seaf_fs_manager_get_fs_size</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a7182f3f9fdba2447f48c1978deea35d5">seafile_write_chunk</a> (const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, <a class="el" href="cdc_8h.html#a47ee29834896ea0b2aa757f8233ab284">CDCDescriptor</a> *chunk, <a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *crypt, uint8_t *checksum, gboolean write_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a43c9fbd6978c6f9cbc71d41ec42b57da">seafile_check_write_chunk</a> (<a class="el" href="cdc_8h.html#a47ee29834896ea0b2aa757f8233ab284">CDCDescriptor</a> *chunk, uint8_t *<a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>, gboolean write_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a056e47c5aca021aae437a764b3bc7c29">calculate_chunk_size</a> (uint64_t total_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#afa141245d62ac11820ad120fef68d01e">seaf_fs_manager_count_fs_files</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a033b8831db7345eec0ff09216b63593d">seaf_fs_manager_get_seafdir_by_path</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a71dad49c71bdfe9223f66ad4379004d0">seaf_fs_manager_get_seafile_id_by_path</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a60a96b2445ab49d626baac6b16e75fe9">seaf_fs_manager_path_to_obj_id</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *path, guint32 *<a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a3fbd81f579b4a8594861cbc0595595ca">seaf_fs_manager_get_seafdir_id_by_path</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a17cc3f2cd49d1d31379938121b58fa69">seaf_fs_manager_get_dirent_by_path</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *root_id, const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aa0c330524a615b7550fc5ffe7a4da7f4">seaf_fs_manager_verify_seafdir</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *dir_id, gboolean verify_id, gboolean *io_error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#af6125641a9cc5a746f9716c2feadcfa8">seaf_fs_manager_verify_seafile</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *file_id, gboolean verify_id, gboolean *io_error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a70406a91027ed3add3d9026d8dad8a0c">seaf_fs_manager_verify_object</a> (<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *<a class="el" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, gboolean verify_id, gboolean *io_error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aed9f5302d562729d419a4ef8f60ffbd1">dir_version_from_repo_version</a> (int repo_version)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#a4e23e8e9b670107f776aab343fea5cf4">seafile_version_from_repo_version</a> (int repo_version)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#aa100826c1ee3596157d1df52d15c747f">seaf_fs_manager_calculate_seafile_id_json</a> (int repo_version, struct <a class="el" href="struct__CDCFileDescriptor.html">_CDCFileDescriptor</a> *cdc, guint8 *file_id_sha1)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs-mgr_8h.html#ac5bca675b55e4df0a33e4e87cdbf8996">__attribute__</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a3d4b6159c34be37b1a578cc66a63bd19"></a><!-- doxytag: member="fs&#45;mgr.h::CURRENT_DIR_OBJ_VERSION" ref="a3d4b6159c34be37b1a578cc66a63bd19" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="fs-mgr_8h.html#a3d4b6159c34be37b1a578cc66a63bd19">CURRENT_DIR_OBJ_VERSION</a>&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00015">15</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="abac8261f96e8e3dbd02d5e52cac66fc6"></a><!-- doxytag: member="fs&#45;mgr.h::CURRENT_SEAFILE_OBJ_VERSION" ref="abac8261f96e8e3dbd02d5e52cac66fc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="fs-mgr_8h.html#abac8261f96e8e3dbd02d5e52cac66fc6">CURRENT_SEAFILE_OBJ_VERSION</a>&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00016">16</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae95c413b4d740d94ac0cc8becc46e61e"></a><!-- doxytag: member="fs&#45;mgr.h::SEAF_DIR_NAME_LEN" ref="ae95c413b4d740d94ac0cc8becc46e61e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="fs-mgr_8h.html#ae95c413b4d740d94ac0cc8becc46e61e">SEAF_DIR_NAME_LEN</a>&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00058">58</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="aea68cf1e74ec408e068658770e95c59a"></a><!-- doxytag: member="fs&#45;mgr.h::SeafDir" ref="aea68cf1e74ec408e068658770e95c59a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafDir.html">_SeafDir</a> <a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00021">21</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a897d488d251dee3425557164e6c7ea7c"></a><!-- doxytag: member="fs&#45;mgr.h::SeafDirent" ref="a897d488d251dee3425557164e6c7ea7c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafDirent.html">_SeafDirent</a> <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00022">22</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac300709c9e02a7e0648849fdd269436b"></a><!-- doxytag: member="fs&#45;mgr.h::SeafFSManager" ref="ac300709c9e02a7e0648849fdd269436b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafFSManager.html">_SeafFSManager</a> <a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00018">18</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6783eee26f20d6501ac8eb3a6bc29da0"></a><!-- doxytag: member="fs&#45;mgr.h::SeafFSManagerPriv" ref="a6783eee26f20d6501ac8eb3a6bc29da0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafFSManagerPriv.html">_SeafFSManagerPriv</a> <a class="el" href="fs-mgr_8h.html#a6783eee26f20d6501ac8eb3a6bc29da0">SeafFSManagerPriv</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00151">151</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a364de0b7a1afe12c5265ddc3a950a892"></a><!-- doxytag: member="fs&#45;mgr.h::SeafFSObject" ref="a364de0b7a1afe12c5265ddc3a950a892" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafFSObject.html">_SeafFSObject</a> <a class="el" href="fs-mgr_8h.html#a364de0b7a1afe12c5265ddc3a950a892">SeafFSObject</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00019">19</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa717065fd2773cd641f5bd97d3474ce6"></a><!-- doxytag: member="fs&#45;mgr.h::Seafile" ref="aa717065fd2773cd641f5bd97d3474ce6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__Seafile.html">_Seafile</a> <a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00020">20</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9bba616c7207dee55b973587fccb40be"></a><!-- doxytag: member="fs&#45;mgr.h::TraverseFSPathCallback" ref="a9bba616c7207dee55b973587fccb40be" args=")(SeafFSManager *mgr, const char *path, SeafDirent *dent, void *user_data, gboolean *stop)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef gboolean(* <a class="el" href="fs-mgr_8h.html#a9bba616c7207dee55b973587fccb40be">TraverseFSPathCallback</a>)(<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *path, <a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *dent, void *user_data, gboolean *stop)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00263">263</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a42e22741d25d945bed7faabc732c7fe4"></a><!-- doxytag: member="fs&#45;mgr.h::TraverseFSTreeCallback" ref="a42e22741d25d945bed7faabc732c7fe4" args=")(SeafFSManager *mgr, const char *repo_id, int version, const char *obj_id, int type, void *user_data, gboolean *stop)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef gboolean(* <a class="el" href="fs-mgr_8h.html#a42e22741d25d945bed7faabc732c7fe4">TraverseFSTreeCallback</a>)(<a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *mgr, const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *<a class="el" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, int <a class="el" href="fs-mgr_8c.html#a65cfc9e13d3352fd9099a0408cba715c">type</a>, void *user_data, gboolean *stop)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00246">246</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="aa6063f3a25a4f2cdc44b9bb136ff00f6"></a><!-- doxytag: member="fs&#45;mgr.h::SeafMetadataType" ref="aa6063f3a25a4f2cdc44b9bb136ff00f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6">SeafMetadataType</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="aa6063f3a25a4f2cdc44b9bb136ff00f6aed7acde538c589d729d72cd6bbcdf72b"></a><!-- doxytag: member="SEAF_METADATA_TYPE_INVALID" ref="aa6063f3a25a4f2cdc44b9bb136ff00f6aed7acde538c589d729d72cd6bbcdf72b" args="" -->SEAF_METADATA_TYPE_INVALID</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aa6063f3a25a4f2cdc44b9bb136ff00f6a46fc8ea4b8423113c7c59c7a2dc8cdf2"></a><!-- doxytag: member="SEAF_METADATA_TYPE_FILE" ref="aa6063f3a25a4f2cdc44b9bb136ff00f6a46fc8ea4b8423113c7c59c7a2dc8cdf2" args="" -->SEAF_METADATA_TYPE_FILE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aa6063f3a25a4f2cdc44b9bb136ff00f6acb45e7822f0045abdcec47ea7dc1248d"></a><!-- doxytag: member="SEAF_METADATA_TYPE_LINK" ref="aa6063f3a25a4f2cdc44b9bb136ff00f6acb45e7822f0045abdcec47ea7dc1248d" args="" -->SEAF_METADATA_TYPE_LINK</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aa6063f3a25a4f2cdc44b9bb136ff00f6a7b28656556a225daa5cf2292ba075322"></a><!-- doxytag: member="SEAF_METADATA_TYPE_DIR" ref="aa6063f3a25a4f2cdc44b9bb136ff00f6a7b28656556a225daa5cf2292ba075322" args="" -->SEAF_METADATA_TYPE_DIR</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="fs-mgr_8h_source.html#l00024">24</a> of file <a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>.</p>
<div class="fragment"><pre class="fragment">             {
    <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6aed7acde538c589d729d72cd6bbcdf72b">SEAF_METADATA_TYPE_INVALID</a>,
    <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a46fc8ea4b8423113c7c59c7a2dc8cdf2">SEAF_METADATA_TYPE_FILE</a>,
    <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6acb45e7822f0045abdcec47ea7dc1248d">SEAF_METADATA_TYPE_LINK</a>,
    <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a7b28656556a225daa5cf2292ba075322">SEAF_METADATA_TYPE_DIR</a>,
} <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6">SeafMetadataType</a>;
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a4de2ed795d3ad88266f347a245c8bd5c"></a><!-- doxytag: member="fs&#45;mgr.h::block_list_difference" ref="a4de2ed795d3ad88266f347a245c8bd5c" args="(BlockList *bl1, BlockList *bl2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structBlockList.html">BlockList</a>* <a class="el" href="fs-mgr_8h.html#a4de2ed795d3ad88266f347a245c8bd5c">block_list_difference</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01817">1817</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structBlockList.html">BlockList</a> *bl;
    <span class="keywordtype">int</span> i;
    <span class="keywordtype">char</span> *<a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>;
    <span class="keywordtype">char</span> *key;

    bl = <a class="code" href="fs-mgr_8c.html#a4ac91596236cf21856f9cf12d0e33ffa">block_list_new</a> ();

    <span class="keywordflow">for</span> (i = 0; i &lt; bl1-&gt;<a class="code" href="structBlockList.html#a11da65abdf8aff4a0161c28ded3ccaad">block_ids</a>-&gt;len; ++i) {
        block_id = g_ptr_array_index (bl1-&gt;<a class="code" href="structBlockList.html#a11da65abdf8aff4a0161c28ded3ccaad">block_ids</a>, i);
        <span class="keywordflow">if</span> (g_hash_table_lookup (bl2-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a>, block_id) == NULL) {
            key = g_strdup(block_id);
            g_hash_table_replace (bl-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a>, key, key);
            g_ptr_array_add (bl-&gt;<a class="code" href="structBlockList.html#a11da65abdf8aff4a0161c28ded3ccaad">block_ids</a>, g_strdup(block_id));
            ++bl-&gt;<a class="code" href="structBlockList.html#a2ca09d61d434980fabd07ad6668ced3a">n_blocks</a>;
        }
    }

    <span class="keywordflow">return</span> bl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a222764a7a6dc477fe04d6b5e267551cc"></a><!-- doxytag: member="fs&#45;mgr.h::block_list_free" ref="a222764a7a6dc477fe04d6b5e267551cc" args="(BlockList *bl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#a222764a7a6dc477fe04d6b5e267551cc">block_list_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01796">1796</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a>)
        g_hash_table_destroy (bl-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a>);
    g_ptr_array_free (bl-&gt;<a class="code" href="structBlockList.html#a11da65abdf8aff4a0161c28ded3ccaad">block_ids</a>, TRUE);
    g_free (bl);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8dda70e7563d2ae6a19e7407e67dc38e"></a><!-- doxytag: member="fs&#45;mgr.h::block_list_insert" ref="a8dda70e7563d2ae6a19e7407e67dc38e" args="(BlockList *bl, const char *block_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#a8dda70e7563d2ae6a19e7407e67dc38e">block_list_insert</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>block_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01805">1805</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (g_hash_table_lookup (bl-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a>, <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>))
        <span class="keywordflow">return</span>;

    <span class="keywordtype">char</span> *key = g_strdup(<a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>);
    g_hash_table_replace (bl-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a>, key, key);
    g_ptr_array_add (bl-&gt;<a class="code" href="structBlockList.html#a11da65abdf8aff4a0161c28ded3ccaad">block_ids</a>, g_strdup(<a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>));
    ++bl-&gt;<a class="code" href="structBlockList.html#a2ca09d61d434980fabd07ad6668ced3a">n_blocks</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4ac91596236cf21856f9cf12d0e33ffa"></a><!-- doxytag: member="fs&#45;mgr.h::block_list_new" ref="a4ac91596236cf21856f9cf12d0e33ffa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structBlockList.html">BlockList</a>* <a class="el" href="fs-mgr_8h.html#a4ac91596236cf21856f9cf12d0e33ffa">block_list_new</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01785">1785</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structBlockList.html">BlockList</a> *bl = g_new0 (<a class="code" href="structBlockList.html">BlockList</a>, 1);

    bl-&gt;<a class="code" href="structBlockList.html#abdc4c8b9f3f75963c12a48fe1dd86bbf">block_hash</a> = g_hash_table_new_full (g_str_hash, g_str_equal, g_free, NULL);
    bl-&gt;<a class="code" href="structBlockList.html#a11da65abdf8aff4a0161c28ded3ccaad">block_ids</a> = g_ptr_array_new_with_free_func (g_free);

    <span class="keywordflow">return</span> bl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a056e47c5aca021aae437a764b3bc7c29"></a><!-- doxytag: member="fs&#45;mgr.h::calculate_chunk_size" ref="a056e47c5aca021aae437a764b3bc7c29" args="(uint64_t total_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="fs-mgr_8h.html#a056e47c5aca021aae437a764b3bc7c29">calculate_chunk_size</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>total_size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00474">474</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> uint64_t GiB = 1073741824;
    <span class="keyword">const</span> uint64_t MiB = 1048576;

    <span class="keywordflow">if</span> (total_size &gt;= (8 * GiB)) <span class="keywordflow">return</span> 8 * MiB;
    <span class="keywordflow">if</span> (total_size &gt;= (4 * GiB)) <span class="keywordflow">return</span> 4 * MiB;
    <span class="keywordflow">if</span> (total_size &gt;= (2 * GiB)) <span class="keywordflow">return</span> 2 * MiB;

    <span class="keywordflow">return</span> 1 * MiB;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aed9f5302d562729d419a4ef8f60ffbd1"></a><!-- doxytag: member="fs&#45;mgr.h::dir_version_from_repo_version" ref="aed9f5302d562729d419a4ef8f60ffbd1" args="(int repo_version)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#aed9f5302d562729d419a4ef8f60ffbd1">dir_version_from_repo_version</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02687">2687</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (repo_version == 0)
        <span class="keywordflow">return</span> 0;
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> <a class="code" href="fs-mgr_8h.html#a3d4b6159c34be37b1a578cc66a63bd19">CURRENT_DIR_OBJ_VERSION</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae04d3c4669cd7b0fc691cd2da6dc2de1"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dir_free" ref="ae04d3c4669cd7b0fc691cd2da6dc2de1" args="(SeafDir *dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01147">1147</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (dir == NULL)
        <span class="keywordflow">return</span>;

    GList *ptr = dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>;
    <span class="keywordflow">while</span> (ptr) {
        <a class="code" href="fs-mgr_8c.html#aef77f199fa9eccfe322f1ff978a9055a">seaf_dirent_free</a> ((<a class="code" href="struct__SeafDirent.html">SeafDirent</a> *)ptr-&gt;data);
        ptr = ptr-&gt;next;
    }

    g_list_free (dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>);
    g_free (dir-&gt;<a class="code" href="struct__SeafDir.html#a6ae67282e860c8ea36560a752971aa41">ondisk</a>);
    g_free(dir);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6875a119da427bb1cd9796eee916b703"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dir_from_data" ref="a6875a119da427bb1cd9796eee916b703" args="(const char *dir_id, uint8_t *data, int len, gboolean is_json)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a>* <a class="el" href="fs-mgr_8h.html#a6875a119da427bb1cd9796eee916b703">seaf_dir_from_data</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>is_json</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01404">1404</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (is_json)
        <span class="keywordflow">return</span> seaf_dir_from_json (dir_id, data, len);
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> seaf_dir_from_v0_data (dir_id, data, len);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae49e883dd4aa920a40b870092677ae35"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dir_new" ref="ae49e883dd4aa920a40b870092677ae35" args="(const char *id, GList *entries, int version)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a>* <a class="el" href="fs-mgr_8h.html#ae49e883dd4aa920a40b870092677ae35">seaf_dir_new</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>entries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01123">1123</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *dir;

    dir = g_new0(<a class="code" href="struct__SeafDir.html">SeafDir</a>, 1);

    dir-&gt;<a class="code" href="struct__SeafDir.html#adba9d62faa9401e343ed974f7c7ea335">version</a> = <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>;
    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != NULL) {
        memcpy(dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>, <span class="keywordtype">id</span>, 40);
        dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>[40] = <span class="charliteral">&#39;\0&#39;</span>;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> == 0) {
        compute_dir_id_v0 (dir, entries);
    }
    dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a> = entries;

    <span class="keywordflow">if</span> (dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a> != NULL)
        dir-&gt;<a class="code" href="struct__SeafDir.html#a6ae67282e860c8ea36560a752971aa41">ondisk</a> = <a class="code" href="fs-mgr_8c.html#a63aaab4413dfa2eae60241305689a698">seaf_dir_to_data</a> (dir, &amp;dir-&gt;<a class="code" href="struct__SeafDir.html#a0771f19921c948b8121ce9952f3c43d7">ondisk_size</a>);
    <span class="keywordflow">else</span>
        memcpy (dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40);

    <span class="keywordflow">return</span> dir;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6335345f24b4ae73c65cf12e2b2d57b3"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dir_save" ref="a6335345f24b4ae73c65cf12e2b2d57b3" args="(SeafFSManager *fs_mgr, const char *repo_id, int version, SeafDir *dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a6335345f24b4ae73c65cf12e2b2d57b3">seaf_dir_save</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>fs_mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01529">1529</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> ret = 0;

    <span class="comment">/* Don&#39;t need to save empty dir on disk. */</span>
    <span class="keywordflow">if</span> (memcmp (dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0)
        <span class="keywordflow">return</span> 0;

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a673d1262bbb4caf66816c89bde13b429">seaf_obj_store_write_obj</a> (fs_mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>,
                                  dir-&gt;<a class="code" href="struct__SeafDir.html#a6ae67282e860c8ea36560a752971aa41">ondisk</a>, dir-&gt;<a class="code" href="struct__SeafDir.html#a0771f19921c948b8121ce9952f3c43d7">ondisk_size</a>, FALSE) &lt; 0)
        ret = -1;

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a63aaab4413dfa2eae60241305689a698"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dir_to_data" ref="a63aaab4413dfa2eae60241305689a698" args="(SeafDir *dir, int *len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="fs-mgr_8h.html#a63aaab4413dfa2eae60241305689a698">seaf_dir_to_data</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a> *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01505">1505</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (dir-&gt;<a class="code" href="struct__SeafDir.html#adba9d62faa9401e343ed974f7c7ea335">version</a> &gt; 0) {
        guint8 *data;
        <span class="keywordtype">int</span> orig_len;
        guint8 *compressed;

        data = seaf_dir_to_json (dir, &amp;orig_len);
        <span class="keywordflow">if</span> (!data)
            <span class="keywordflow">return</span> NULL;

        <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#ace06e9888a8adf6cd341163d3f7f504f">seaf_compress</a> (data, orig_len, &amp;compressed, len) &lt; 0) {
            seaf_warning (<span class="stringliteral">&quot;Failed to compress dir object %s.\n&quot;</span>, dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>);
            g_free (data);
            <span class="keywordflow">return</span> NULL;
        }

        g_free (data);
        <span class="keywordflow">return</span> compressed;
    } <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> seaf_dir_to_v0_data (dir, len);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7e727c1c389bfe65ec011d0adcf8e567"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dirent_dup" ref="a7e727c1c389bfe65ec011d0adcf8e567" args="(SeafDirent *dent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a>* <a class="el" href="fs-mgr_8h.html#a7e727c1c389bfe65ec011d0adcf8e567">seaf_dirent_dup</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *&#160;</td>
          <td class="paramname"><em>dent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01199">1199</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *new_dent;

    new_dent = g_memdup (dent, <span class="keyword">sizeof</span>(<a class="code" href="struct__SeafDirent.html">SeafDirent</a>));
    new_dent-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a> = g_strdup(dent-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a>);
    new_dent-&gt;<a class="code" href="struct__SeafDirent.html#a3c4c6d87516341646347c48ef21cd5eb">modifier</a> = g_strdup(dent-&gt;<a class="code" href="struct__SeafDirent.html#a3c4c6d87516341646347c48ef21cd5eb">modifier</a>);

    <span class="keywordflow">return</span> new_dent;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aef77f199fa9eccfe322f1ff978a9055a"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dirent_free" ref="aef77f199fa9eccfe322f1ff978a9055a" args="(SeafDirent *dent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#aef77f199fa9eccfe322f1ff978a9055a">seaf_dirent_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a> *&#160;</td>
          <td class="paramname"><em>dent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01189">1189</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!dent)
        <span class="keywordflow">return</span>;
    g_free (dent-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a>);
    g_free (dent-&gt;<a class="code" href="struct__SeafDirent.html#a3c4c6d87516341646347c48ef21cd5eb">modifier</a>);
    g_free (dent);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a07b91f8db9de0262970252a95f5e9f2f"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_dirent_new" ref="a07b91f8db9de0262970252a95f5e9f2f" args="(int version, const char *sha1, int mode, const char *name, gint64 mtime, const char *modifier, gint64 size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a>* <a class="el" href="fs-mgr_8h.html#a07b91f8db9de0262970252a95f5e9f2f">seaf_dirent_new</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sha1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64&#160;</td>
          <td class="paramname"><em>mtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>modifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01164">1164</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *dent;

    dent = g_new0 (<a class="code" href="struct__SeafDirent.html">SeafDirent</a>, 1);
    dent-&gt;<a class="code" href="struct__SeafDirent.html#afc58a80e040b009230ce1d3d500e2f1f">version</a> = <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>;
    memcpy(dent-&gt;<a class="code" href="struct__SeafDirent.html#ae85b031142d8a9360ba9c2ab8961a451">id</a>, <a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>, 40);
    dent-&gt;<a class="code" href="struct__SeafDirent.html#ae85b031142d8a9360ba9c2ab8961a451">id</a>[40] = <span class="charliteral">&#39;\0&#39;</span>;
    dent-&gt;<a class="code" href="struct__SeafDirent.html#a823df197de2c76627746de18e9b6ce02">mode</a> = <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>;
    dent-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a> = g_strdup(<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);
    dent-&gt;<a class="code" href="struct__SeafDirent.html#a4f8f72eb4192f5f42ac52cc4c3fd0d87">name_len</a> = strlen(<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);

    <span class="keywordflow">if</span> (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0) {
        dent-&gt;<a class="code" href="struct__SeafDirent.html#a42acf83af54b1c20696b5f288bbdd681">mtime</a> = <a class="code" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>;
        <span class="keywordflow">if</span> (S_ISREG(<a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>)) {
            dent-&gt;<a class="code" href="struct__SeafDirent.html#a3c4c6d87516341646347c48ef21cd5eb">modifier</a> = g_strdup(modifier);
            dent-&gt;<a class="code" href="struct__SeafDirent.html#abf0e9b6fade594b7897cb9896d370961">size</a> = <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>;
        }
    }

    <span class="keywordflow">return</span> dent;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa100826c1ee3596157d1df52d15c747f"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_calculate_seafile_id_json" ref="aa100826c1ee3596157d1df52d15c747f" args="(int repo_version, struct _CDCFileDescriptor *cdc, guint8 *file_id_sha1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#aa100826c1ee3596157d1df52d15c747f">seaf_fs_manager_calculate_seafile_id_json</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="struct__CDCFileDescriptor.html">_CDCFileDescriptor</a> *&#160;</td>
          <td class="paramname"><em>cdc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint8 *&#160;</td>
          <td class="paramname"><em>file_id_sha1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00392">392</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    json_t *object, *block_id_array;

    <span class="keywordtype">object</span> = json_object ();

    <a class="code" href="seafile_2lib_2utils_8c.html#abfac2ec06b36f64de2f110f093e6dfc0">json_object_set_int_member</a> (<span class="keywordtype">object</span>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a46fc8ea4b8423113c7c59c7a2dc8cdf2">SEAF_METADATA_TYPE_FILE</a>);
    <a class="code" href="seafile_2lib_2utils_8c.html#abfac2ec06b36f64de2f110f093e6dfc0">json_object_set_int_member</a> (<span class="keywordtype">object</span>, <span class="stringliteral">&quot;version&quot;</span>,
                                <a class="code" href="fs-mgr_8c.html#a4e23e8e9b670107f776aab343fea5cf4">seafile_version_from_repo_version</a>(repo_version));

    <a class="code" href="seafile_2lib_2utils_8c.html#abfac2ec06b36f64de2f110f093e6dfc0">json_object_set_int_member</a> (<span class="keywordtype">object</span>, <span class="stringliteral">&quot;size&quot;</span>, cdc-&gt;<a class="code" href="struct__CDCFileDescriptor.html#a271d633888aa24fd7cd4e5a8d5d767e6">file_size</a>);

    block_id_array = json_array ();
    <span class="keywordtype">int</span> i;
    uint8_t *ptr = cdc-&gt;<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>;
    <span class="keywordtype">char</span> <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>[41];
    <span class="keywordflow">for</span> (i = 0; i &lt; cdc-&gt;<a class="code" href="struct__CDCFileDescriptor.html#a9e5f8121be365c8a0e82363841cd5f62">block_nr</a>; ++i) {
        <a class="code" href="seafile_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (ptr, block_id, 20);
        json_array_append_new (block_id_array, json_string(block_id));
        ptr += 20;
    }
    json_object_set_new (<span class="keywordtype">object</span>, <span class="stringliteral">&quot;block_ids&quot;</span>, block_id_array);

    <span class="keywordtype">char</span> *data = json_dumps (<span class="keywordtype">object</span>, JSON_SORT_KEYS);
    <span class="keywordtype">int</span> ondisk_size = strlen(data);

    <span class="comment">/* The seafile object id is sha1 hash of the json object. */</span>
    <a class="code" href="seafile_2lib_2utils_8c.html#a63f0195a708d600ce96f867747afb8e4">calculate_sha1</a> (file_id_sha1, data, ondisk_size);

    json_decref (<span class="keywordtype">object</span>);
    free (data);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a36b814252ae47bd595a9282266ea1b56"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_checkout_file" ref="a36b814252ae47bd595a9282266ea1b56" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *file_id, const char *file_path, guint32 mode, guint64 mtime, struct SeafileCrypt *crypt, const char *in_repo_path, const char *conflict_head_id, gboolean force_conflict, gboolean *conflicted)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a36b814252ae47bd595a9282266ea1b56">seaf_fs_manager_checkout_file</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint32&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint64&#160;</td>
          <td class="paramname"><em>mtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *&#160;</td>
          <td class="paramname"><em>crypt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>in_repo_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>conflict_head_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>force_conflict</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean *&#160;</td>
          <td class="paramname"><em>conflicted</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00226">226</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__Seafile.html">Seafile</a> *seafile;
    <span class="keywordtype">char</span> *blk_id;
    <span class="keywordtype">int</span> wfd;
    <span class="keywordtype">int</span> i;
    <span class="keywordtype">char</span> *tmp_path;
    <span class="keywordtype">char</span> *conflict_path;

    *conflicted = FALSE;

    seafile = <a class="code" href="fs-mgr_8c.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, file_id);
    <span class="keywordflow">if</span> (!seafile) {
        g_warning (<span class="stringliteral">&quot;File %s does not exist.\n&quot;</span>, file_id);
        <span class="keywordflow">return</span> -1;
    }

    tmp_path = g_strconcat (file_path, <a class="code" href="fs-mgr_8c.html#adbe27aa60a81459f3ba9d7b3ca8d0576">SEAF_TMP_EXT</a>, NULL);

    wfd = <a class="code" href="seafile_2lib_2utils_8c.html#a822971bc55edc699449c6f6f2e03225e">seaf_util_create</a> (tmp_path, O_WRONLY | O_TRUNC | O_CREAT | O_BINARY,
                            <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a> &amp; ~S_IFMT);
    <span class="keywordflow">if</span> (wfd &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Failed to open file %s for checkout: %s.\n&quot;</span>,
                   tmp_path, strerror(errno));
        <span class="keywordflow">goto</span> bad;
    }

    <span class="keywordflow">for</span> (i = 0; i &lt; seafile-&gt;<a class="code" href="struct__Seafile.html#af2d5c5e5bb56d38122dead42128b9c20">n_blocks</a>; ++i) {
        blk_id = seafile-&gt;<a class="code" href="struct__Seafile.html#aacaedff2674132faf3d522ba8df6e268">blk_sha1s</a>[i];
        <span class="keywordflow">if</span> (checkout_block (<a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, blk_id, wfd, crypt) &lt; 0)
            <span class="keywordflow">goto</span> bad;
    }

    close (wfd);
    wfd = -1;

    <span class="keywordflow">if</span> (force_conflict || <a class="code" href="seafile_2lib_2utils_8c.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> (tmp_path, file_path) &lt; 0) {
        *conflicted = TRUE;

        <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>);
        <span class="keywordflow">if</span> (!repo)
            <span class="keywordflow">goto</span> bad;

        conflict_path = <a class="code" href="vc-common_8c.html#a9a081e79625cf7f3e64489c1bf4a07d6">gen_conflict_path</a> (file_path, repo-&gt;<a class="code" href="struct__SeafRepo.html#aaeff5900edfc0f7bcb9c97592b70d247">email</a>, (gint64)time(NULL));

        seaf_warning (<span class="stringliteral">&quot;Cannot update %s, creating conflict file %s.\n&quot;</span>,
                      file_path, conflict_path);

        <span class="comment">/* First try to rename the local version to a conflict file,</span>
<span class="comment">         * this will preserve the version from the server.</span>
<span class="comment">         * If this fails, fall back to checking out the server version</span>
<span class="comment">         * to the conflict file.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> (file_path, conflict_path) == 0) {
            <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> (tmp_path, file_path) &lt; 0) {
                g_free (conflict_path);
                <span class="keywordflow">goto</span> bad;
            }
        } <span class="keywordflow">else</span> {
            g_free (conflict_path);
            conflict_path = <a class="code" href="vc-common_8c.html#a706a37ea730b1d7a6ce9f56b1981a265">gen_conflict_path_wrapper</a> (<a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                                       conflict_head_id, in_repo_path,
                                                       file_path);
            <span class="keywordflow">if</span> (!conflict_path)
                <span class="keywordflow">goto</span> bad;

            <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> (tmp_path, conflict_path) &lt; 0) {
                g_free (conflict_path);
                <span class="keywordflow">goto</span> bad;
            }
        }

        g_free (conflict_path);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a> &gt; 0) {
        <span class="comment">/* !force_conflict &amp;&amp; ccnet_rename() == 0</span>
<span class="comment">         * Set the checked out file mtime to what it has to be.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#abc8dd3d83f54a07998aea73c4071d818">seaf_set_file_time</a> (file_path, <a class="code" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>) &lt; 0) {
            seaf_warning (<span class="stringliteral">&quot;Failed to set mtime for %s.\n&quot;</span>, file_path);
        }
    }

    g_free (tmp_path);
    <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (seafile);
    <span class="keywordflow">return</span> 0;

bad:
    <span class="keywordflow">if</span> (wfd &gt;= 0)
        close (wfd);
    <span class="comment">/* Remove the tmp file if it still exists, in case that rename fails. */</span>
    <a class="code" href="seafile_2lib_2utils_8c.html#a26f091009701c5a9d1886b9d6ceb9c8e">seaf_util_unlink</a> (tmp_path);
    g_free (tmp_path);
    <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (seafile);
    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afa141245d62ac11820ad120fef68d01e"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_count_fs_files" ref="afa141245d62ac11820ad120fef68d01e" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#afa141245d62ac11820ad120fef68d01e">seaf_fs_manager_count_fs_files</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02178">2178</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
     <span class="keywordflow">if</span> (strcmp (root_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>) == 0)
        <span class="keywordflow">return</span> 0;
     <span class="keywordflow">return</span> count_dir_files (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac378976c82415b33c8fbdfb42d5ca83d"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_delete_object" ref="ac378976c82415b33c8fbdfb42d5ca83d" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#ac378976c82415b33c8fbdfb42d5ca83d">seaf_fs_manager_delete_object</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02061">2061</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="obj-store_8c.html#a6a52cc8396499b225486967b6a25719d">seaf_obj_store_delete_obj</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, <span class="keywordtype">id</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a17cc3f2cd49d1d31379938121b58fa69"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_dirent_by_path" ref="a17cc3f2cd49d1d31379938121b58fa69" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#a897d488d251dee3425557164e6c7ea7c">SeafDirent</a>* <a class="el" href="fs-mgr_8h.html#a17cc3f2cd49d1d31379938121b58fa69">seaf_fs_manager_get_dirent_by_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02376">2376</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *dent = NULL;
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *dir = NULL;
    <span class="keywordtype">char</span> *parent_dir = NULL;
    <span class="keywordtype">char</span> *file_name = NULL;

    parent_dir  = g_path_get_dirname(path);
    file_name = g_path_get_basename(path);

    <span class="keywordflow">if</span> (strcmp (parent_dir, <span class="stringliteral">&quot;.&quot;</span>) == 0)
        dir = <a class="code" href="fs-mgr_8c.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id);
    <span class="keywordflow">else</span>
        dir = <a class="code" href="fs-mgr_8c.html#a033b8831db7345eec0ff09216b63593d">seaf_fs_manager_get_seafdir_by_path</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                                   root_id, parent_dir, error);

    <span class="keywordflow">if</span> (!dir) {
        seaf_warning (<span class="stringliteral">&quot;dir %s doesn&#39;t exist in repo %.8s.\n&quot;</span>, parent_dir, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>);
        <span class="keywordflow">goto</span> out;
    }

    GList *p;
    <span class="keywordflow">for</span> (p = dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>; p; p = p-&gt;next) {
        <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *d = p-&gt;data;
        <span class="keywordflow">if</span> (strcmp (d-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a>, file_name) == 0) {
            dent = <a class="code" href="fs-mgr_8c.html#a7e727c1c389bfe65ec011d0adcf8e567">seaf_dirent_dup</a>(d);
            <span class="keywordflow">break</span>;
        }
    }

out:
    <span class="keywordflow">if</span> (dir)
        <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (dir);
    g_free (parent_dir);
    g_free (file_name);

    <span class="keywordflow">return</span> dent;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0927ab6809d59562a0782cb80e410575"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_file_size" ref="a0927ab6809d59562a0782cb80e410575" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *file_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="fs-mgr_8h.html#a0927ab6809d59562a0782cb80e410575">seaf_fs_manager_get_file_size</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02070">2070</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__Seafile.html">Seafile</a> *file;
    gint64 <a class="code" href="fs-mgr_8c.html#a719775aaf4a8b8ffb6ce082b24375db0">file_size</a>;

    file = <a class="code" href="fs-mgr_8c.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, file_id);
    <span class="keywordflow">if</span> (!file) {
        seaf_warning (<span class="stringliteral">&quot;Couldn&#39;t get file %s\n&quot;</span>, file_id);
        <span class="keywordflow">return</span> -1;
    }

    file_size = file-&gt;<a class="code" href="struct__Seafile.html#ad288a0f3ee7d304f110e681495c7f9f5">file_size</a>;

    <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (file);
    <span class="keywordflow">return</span> <a class="code" href="fs-mgr_8c.html#a719775aaf4a8b8ffb6ce082b24375db0">file_size</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a13be199dd5ff26f9255cd94744e8d48f"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_fs_size" ref="a13be199dd5ff26f9255cd94744e8d48f" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="fs-mgr_8h.html#a13be199dd5ff26f9255cd94744e8d48f">seaf_fs_manager_get_fs_size</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02135">2135</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
     <span class="keywordflow">if</span> (strcmp (root_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>) == 0)
        <span class="keywordflow">return</span> 0;
     <span class="keywordflow">return</span> get_dir_size (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a08103ffc3a5cd19b70167404c39ce3e4"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafdir" ref="a08103ffc3a5cd19b70167404c39ce3e4" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *dir_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a>* <a class="el" href="fs-mgr_8h.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01548">1548</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">void</span> *data;
    <span class="keywordtype">int</span> len;
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *dir;

    <span class="comment">/* TODO: add hash cache */</span>

    <span class="keywordflow">if</span> (memcmp (dir_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0) {
        dir = g_new0 (<a class="code" href="struct__SeafDir.html">SeafDir</a>, 1);
        memset (dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>, <span class="charliteral">&#39;0&#39;</span>, 40);
        <span class="keywordflow">return</span> dir;
    }

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a6e93a0214f9cb8a7fc837a2bc3a3c529">seaf_obj_store_read_obj</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                 dir_id, &amp;data, &amp;len) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[fs mgr] Failed to read dir %s.\n&quot;</span>, dir_id);
        <span class="keywordflow">return</span> NULL;
    }

    dir = <a class="code" href="fs-mgr_8c.html#a6875a119da427bb1cd9796eee916b703">seaf_dir_from_data</a> (dir_id, data, len, (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0));
    g_free (data);

    <span class="keywordflow">return</span> dir;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a033b8831db7345eec0ff09216b63593d"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafdir_by_path" ref="a033b8831db7345eec0ff09216b63593d" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a>* <a class="el" href="fs-mgr_8h.html#a033b8831db7345eec0ff09216b63593d">seaf_fs_manager_get_seafdir_by_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02189">2189</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *dir;
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *dent;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *dir_id = root_id;
    <span class="keywordtype">char</span> *<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, *saveptr;
    <span class="keywordtype">char</span> *tmp_path = g_strdup(path);

    dir = <a class="code" href="fs-mgr_8c.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, dir_id);
    <span class="keywordflow">if</span> (!dir) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#ab9c0234d4bd812fc73802b44a436fd55">SEAF_ERR_DIR_MISSING</a>, <span class="stringliteral">&quot;directory is missing&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    name = strtok_r (tmp_path, <span class="stringliteral">&quot;/&quot;</span>, &amp;saveptr);
    <span class="keywordflow">while</span> (name != NULL) {
        GList *l;
        <span class="keywordflow">for</span> (l = dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>; l != NULL; l = l-&gt;next) {
            dent = l-&gt;data;

            <span class="keywordflow">if</span> (strcmp(dent-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a>, name) == 0 &amp;&amp; S_ISDIR(dent-&gt;<a class="code" href="struct__SeafDirent.html#a823df197de2c76627746de18e9b6ce02">mode</a>)) {
                dir_id = dent-&gt;<a class="code" href="struct__SeafDirent.html#ae85b031142d8a9360ba9c2ab8961a451">id</a>;
                <span class="keywordflow">break</span>;
            }
        }

        <span class="keywordflow">if</span> (!l) {
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#aabbb62a1d7a32a24a7d227ad7cc46535">SEAF_ERR_PATH_NO_EXIST</a>,
                         <span class="stringliteral">&quot;Path does not exists %s&quot;</span>, path);
            <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (dir);
            dir = NULL;
            <span class="keywordflow">break</span>;
        }

        <a class="code" href="struct__SeafDir.html">SeafDir</a> *prev = dir;
        dir = <a class="code" href="fs-mgr_8c.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, dir_id);
        <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (prev);

        <span class="keywordflow">if</span> (!dir) {
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#ab9c0234d4bd812fc73802b44a436fd55">SEAF_ERR_DIR_MISSING</a>,
                         <span class="stringliteral">&quot;directory is missing&quot;</span>);
            <span class="keywordflow">break</span>;
        }

        name = strtok_r (NULL, <span class="stringliteral">&quot;/&quot;</span>, &amp;saveptr);
    }

    g_free (tmp_path);
    <span class="keywordflow">return</span> dir;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3fbd81f579b4a8594861cbc0595595ca"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafdir_id_by_path" ref="a3fbd81f579b4a8594861cbc0595595ca" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="fs-mgr_8h.html#a3fbd81f579b4a8594861cbc0595595ca">seaf_fs_manager_get_seafdir_id_by_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02351">2351</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    guint32 <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a> = 0;
    <span class="keywordtype">char</span> *dir_id;

    dir_id = <a class="code" href="fs-mgr_8c.html#a60a96b2445ab49d626baac6b16e75fe9">seaf_fs_manager_path_to_obj_id</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                             root_id, path, &amp;mode, error);

    <span class="keywordflow">if</span> (!dir_id)
        <span class="keywordflow">return</span> NULL;

    <span class="keywordflow">if</span> (dir_id &amp;&amp; !S_ISDIR(mode)) {
        g_free (dir_id);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> dir_id;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a451e6d84cb6d10454d1f9b2b3d0205c5"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafdir_sorted" ref="a451e6d84cb6d10454d1f9b2b3d0205c5" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *dir_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a>* <a class="el" href="fs-mgr_8h.html#a451e6d84cb6d10454d1f9b2b3d0205c5">seaf_fs_manager_get_seafdir_sorted</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01609">1609</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *dir = <a class="code" href="fs-mgr_8c.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a>(mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, dir_id);

    <span class="keywordflow">if</span> (!dir)
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* Only some very old dir objects are not sorted. */</span>
    <span class="keywordflow">if</span> (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0)
        <span class="keywordflow">return</span> dir;

    <span class="keywordflow">if</span> (!is_dirents_sorted (dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>))
        dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a> = g_list_sort (dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>, compare_dirents);

    <span class="keywordflow">return</span> dir;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac20db66dda33a3d54aba39534d8b8336"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafdir_sorted_by_path" ref="ac20db66dda33a3d54aba39534d8b8336" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aea68cf1e74ec408e068658770e95c59a">SeafDir</a>* <a class="el" href="fs-mgr_8h.html#ac20db66dda33a3d54aba39534d8b8336">seaf_fs_manager_get_seafdir_sorted_by_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01630">1630</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *dir = <a class="code" href="fs-mgr_8c.html#a033b8831db7345eec0ff09216b63593d">seaf_fs_manager_get_seafdir_by_path</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>,
                                                        <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id,
                                                        path, NULL);

    <span class="keywordflow">if</span> (!dir)
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* Only some very old dir objects are not sorted. */</span>
    <span class="keywordflow">if</span> (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0)
        <span class="keywordflow">return</span> dir;

    <span class="keywordflow">if</span> (!is_dirents_sorted (dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>))
        dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a> = g_list_sort (dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>, compare_dirents);

    <span class="keywordflow">return</span> dir;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a029c16e2ecdf6eafd96edb2ee4e6beac"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafile" ref="a029c16e2ecdf6eafd96edb2ee4e6beac" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *file_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a>* <a class="el" href="fs-mgr_8h.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00951">951</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">void</span> *data;
    <span class="keywordtype">int</span> len;
    <a class="code" href="struct__Seafile.html">Seafile</a> *seafile;

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    seafile = g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#a8716d11f26edecd7fdaacb5acd6850a4">priv</a>-&gt;seafile_cache, file_id);
    <span class="keywordflow">if</span> (seafile) {
        <a class="code" href="fs-mgr_8c.html#aaf788c4f305d5509b791f64615fa9112">seafile_ref</a> (seafile);
        <span class="keywordflow">return</span> seafile;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">if</span> (memcmp (file_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0) {
        seafile = g_new0 (<a class="code" href="struct__Seafile.html">Seafile</a>, 1);
        memset (seafile-&gt;<a class="code" href="struct__Seafile.html#a0a00826f3515746edeb7a9654efd06c7">file_id</a>, <span class="charliteral">&#39;0&#39;</span>, 40);
        seafile-&gt;<a class="code" href="struct__Seafile.html#a77b792205ee77f58b95c1da1aecce1a4">ref_count</a> = 1;
        <span class="keywordflow">return</span> seafile;
    }

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a6e93a0214f9cb8a7fc837a2bc3a3c529">seaf_obj_store_read_obj</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                 file_id, &amp;data, &amp;len) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[fs mgr] Failed to read file %s.\n&quot;</span>, file_id);
        <span class="keywordflow">return</span> NULL;
    }

    seafile = seafile_from_data (file_id, data, len, (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0));
    g_free (data);

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    <span class="comment">/*</span>
<span class="comment">     * Add to cache. Also increase ref count.</span>
<span class="comment">     */</span>
    <a class="code" href="fs-mgr_8c.html#aaf788c4f305d5509b791f64615fa9112">seafile_ref</a> (seafile);
    g_hash_table_insert (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#a8716d11f26edecd7fdaacb5acd6850a4">priv</a>-&gt;seafile_cache, g_strdup(file_id), seafile);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">return</span> seafile;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71dad49c71bdfe9223f66ad4379004d0"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_get_seafile_id_by_path" ref="a71dad49c71bdfe9223f66ad4379004d0" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="fs-mgr_8h.html#a71dad49c71bdfe9223f66ad4379004d0">seaf_fs_manager_get_seafile_id_by_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02326">2326</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    guint32 <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>;
    <span class="keywordtype">char</span> *file_id;

    file_id = <a class="code" href="fs-mgr_8c.html#a60a96b2445ab49d626baac6b16e75fe9">seaf_fs_manager_path_to_obj_id</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                              root_id, path, &amp;mode, error);

    <span class="keywordflow">if</span> (!file_id)
        <span class="keywordflow">return</span> NULL;

    <span class="keywordflow">if</span> (file_id &amp;&amp; S_ISDIR(mode)) {
        g_free (file_id);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> file_id;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af41e85bce809b9f05ed5b20ac5eeb745"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_index_blocks" ref="af41e85bce809b9f05ed5b20ac5eeb745" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *file_path, unsigned char sha1[], gint64 *size, SeafileCrypt *crypt, gboolean write_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#af41e85bce809b9f05ed5b20ac5eeb745">seaf_fs_manager_index_blocks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>sha1</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64 *&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *&#160;</td>
          <td class="paramname"><em>crypt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>write_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00590">590</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> sb;
    <a class="code" href="struct__CDCFileDescriptor.html">CDCFileDescriptor</a> cdc;

    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a> (file_path, &amp;sb) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Bad file %s: %s.\n&quot;</span>, file_path, strerror(errno));
        <span class="keywordflow">return</span> -1;
    }

    g_return_val_if_fail (S_ISREG(sb.st_mode), -1);

    <span class="keywordflow">if</span> (sb.st_size == 0) {
        <span class="comment">/* handle empty file. */</span>
        memset (<a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>, 0, 20);
        create_cdc_for_empty_file (&amp;cdc);
    } <span class="keywordflow">else</span> {
        memset (&amp;cdc, 0, <span class="keyword">sizeof</span>(cdc));
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#a1aa5b89184d542ad96548d7a311c44e1">block_sz</a> = <a class="code" href="fs-mgr_8c.html#a056e47c5aca021aae437a764b3bc7c29">calculate_chunk_size</a> (sb.st_size);
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#a756f439fffd667631f76a28a1d379c5d">block_min_sz</a> = cdc.<a class="code" href="struct__CDCFileDescriptor.html#a1aa5b89184d542ad96548d7a311c44e1">block_sz</a> &gt;&gt; 2;
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#aa4fc3655afc5a6658c151b4a2231aa5c">block_max_sz</a> = cdc.<a class="code" href="struct__CDCFileDescriptor.html#a1aa5b89184d542ad96548d7a311c44e1">block_sz</a> &lt;&lt; 2;
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#accd5f7e587ad3e5139a7b8be3788affa">write_block</a> = <a class="code" href="fs-mgr_8c.html#a7182f3f9fdba2447f48c1978deea35d5">seafile_write_chunk</a>;
        memcpy (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a505629afabb9dfd0691a164d1ba5faf8">repo_id</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, 36);
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#adea86cb937fd22a2e93a2a53b9e9873b">version</a> = <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>;
        <span class="keywordflow">if</span> (<a class="code" href="cdc_8c.html#ab0a7b062dc6ce4e3f4963c6cad019e8e">filename_chunk_cdc</a> (file_path, &amp;cdc, crypt, write_data) &lt; 0) {
            g_warning (<span class="stringliteral">&quot;Failed to chunk file with CDC.\n&quot;</span>);
            <span class="keywordflow">return</span> -1;
        }

        <span class="keywordflow">if</span> (write_data &amp;&amp; write_seafile (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, &amp;cdc, <a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>) &lt; 0) {
            g_warning (<span class="stringliteral">&quot;Failed to write seafile for %s.\n&quot;</span>, file_path);
            <span class="keywordflow">return</span> -1;
        }
    }

    *<a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a> = (gint64)sb.st_size;

    if (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>)
        free (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a562e73b605551b411fc8ccd333e26d36"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_index_file_blocks" ref="a562e73b605551b411fc8ccd333e26d36" args="(SeafFSManager *mgr, const char *repo_id, int version, GList *paths, GList *blockids, unsigned char sha1[], gint64 file_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a562e73b605551b411fc8ccd333e26d36">seaf_fs_manager_index_file_blocks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>paths</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>blockids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>sha1</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64&#160;</td>
          <td class="paramname"><em>file_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check in blocks and create seafile/symlink object. Returns sha1 id for the seafile/symlink object in  parameter. </p>

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00733">733</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> ret = 0;
    <a class="code" href="struct__CDCFileDescriptor.html">CDCFileDescriptor</a> cdc;

    <span class="keywordflow">if</span> (!paths) {
        <span class="comment">/* handle empty file. */</span>
        memset (<a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>, 0, 20);
        create_cdc_for_empty_file (&amp;cdc);
    } <span class="keywordflow">else</span> {
        <span class="keywordtype">int</span> block_nr = g_list_length (paths);

        <span class="keywordflow">if</span> (init_file_cdc (&amp;cdc, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, block_nr, <a class="code" href="fs-mgr_8c.html#a719775aaf4a8b8ffb6ce082b24375db0">file_size</a>) &lt; 0) {
            ret = -1;
            <span class="keywordflow">goto</span> out;
        }

        <span class="keywordflow">if</span> (check_and_write_file_blocks (&amp;cdc, paths, blockids) &lt; 0) {
            seaf_warning (<span class="stringliteral">&quot;Failed to check and write file blocks.\n&quot;</span>);
            ret = -1;
            <span class="keywordflow">goto</span> out;
        }

        <span class="keywordflow">if</span> (write_seafile (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, &amp;cdc, <a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>) &lt; 0) {
            seaf_warning (<span class="stringliteral">&quot;Failed to write seafile.\n&quot;</span>);
            ret = -1;
            <span class="keywordflow">goto</span> out;
        }
    }

out:
    <span class="keywordflow">if</span> (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>)
        free (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a91dd774f96fb5cc505f423913ea730fe"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_init" ref="a91dd774f96fb5cc505f423913ea730fe" args="(SeafFSManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a91dd774f96fb5cc505f423913ea730fe">seaf_fs_manager_init</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00089">89</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef SEAFILE_SERVER</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef FULL_FEATURE</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a2a3f1a84562cb4856e94b556888e3617">seaf_obj_store_init</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, TRUE, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7321aeb5c752d434ccb1b94bec6c9624">ev_mgr</a>) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[fs mgr] Failed to init fs object store.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a2a3f1a84562cb4856e94b556888e3617">seaf_obj_store_init</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, FALSE, NULL) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[fs mgr] Failed to init fs object store.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a2a3f1a84562cb4856e94b556888e3617">seaf_obj_store_init</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, TRUE, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7321aeb5c752d434ccb1b94bec6c9624">ev_mgr</a>) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[fs mgr] Failed to init fs object store.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad005159664b100b6ac12ee73d4dad7dd"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_new" ref="ad005159664b100b6ac12ee73d4dad7dd" args="(struct _SeafileSession *seaf, const char *seaf_dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a>* <a class="el" href="fs-mgr_8h.html#ad005159664b100b6ac12ee73d4dad7dd">seaf_fs_manager_new</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *&#160;</td>
          <td class="paramname"><em>seaf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>seaf_dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9262b8849eabb4d72009ca1feb396c20"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_object_exists" ref="a9262b8849eabb4d72009ca1feb396c20" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="fs-mgr_8h.html#a9262b8849eabb4d72009ca1feb396c20">seaf_fs_manager_object_exists</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02048">2048</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">/* Empty file and dir always exists. */</span>
    <span class="keywordflow">if</span> (memcmp (<span class="keywordtype">id</span>, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0)
        <span class="keywordflow">return</span> TRUE;

    <span class="keywordflow">return</span> <a class="code" href="obj-store_8c.html#abebb46e47ff4c76a309686613bd17ec1">seaf_obj_store_obj_exists</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, <span class="keywordtype">id</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a60a96b2445ab49d626baac6b16e75fe9"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_path_to_obj_id" ref="a60a96b2445ab49d626baac6b16e75fe9" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *path, guint32 *mode, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="fs-mgr_8h.html#a60a96b2445ab49d626baac6b16e75fe9">seaf_fs_manager_path_to_obj_id</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint32 *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02246">2246</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *copy = g_strdup (path);
    <span class="keywordtype">int</span> off = strlen(copy) - 1;
    <span class="keywordtype">char</span> *slash, *<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>;
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *base_dir = NULL;
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *dent;
    GList *p;
    <span class="keywordtype">char</span> *<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a> = NULL;

    <span class="keywordflow">while</span> (off &gt;= 0 &amp;&amp; copy[off] == <span class="charliteral">&#39;/&#39;</span>)
        copy[off--] = 0;

    <span class="keywordflow">if</span> (strlen(copy) == 0) {
        <span class="comment">/* the path is root &quot;/&quot; */</span>
        <span class="keywordflow">if</span> (<a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>) {
            *<a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a> = S_IFDIR;
        }
        obj_id = g_strdup(root_id);
        <span class="keywordflow">goto</span> out;
    }

    slash = strrchr (copy, <span class="charliteral">&#39;/&#39;</span>);
    <span class="keywordflow">if</span> (!slash) {
        base_dir = <a class="code" href="fs-mgr_8c.html#a08103ffc3a5cd19b70167404c39ce3e4">seaf_fs_manager_get_seafdir</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id);
        <span class="keywordflow">if</span> (!base_dir) {
            g_warning (<span class="stringliteral">&quot;Failed to find root dir %s.\n&quot;</span>, root_id);
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, <span class="stringliteral">&quot; &quot;</span>);
            <span class="keywordflow">goto</span> out;
        }
        name = copy;
    } <span class="keywordflow">else</span> {
        *slash = 0;
        name = slash + 1;
        GError *tmp_error = NULL;
        base_dir = <a class="code" href="fs-mgr_8c.html#a033b8831db7345eec0ff09216b63593d">seaf_fs_manager_get_seafdir_by_path</a> (mgr,
                                                        <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>,
                                                        <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                                        root_id,
                                                        copy,
                                                        &amp;tmp_error);
        <span class="keywordflow">if</span> (tmp_error &amp;&amp;
            !g_error_matches(tmp_error,
                             <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>,
                             <a class="code" href="seafile-error_8h.html#aabbb62a1d7a32a24a7d227ad7cc46535">SEAF_ERR_PATH_NO_EXIST</a>)) {
            g_warning (<span class="stringliteral">&quot;Failed to get dir for %s.\n&quot;</span>, copy);
            g_propagate_error (error, tmp_error);
            <span class="keywordflow">goto</span> out;
        }

        <span class="comment">/* The path doesn&#39;t exist in this commit. */</span>
        <span class="keywordflow">if</span> (!base_dir)
            <span class="keywordflow">goto</span> out;
    }

    <span class="keywordflow">for</span> (p = base_dir-&gt;<a class="code" href="struct__SeafDir.html#ae45d2a99b493e8a080e910d2fd580df4">entries</a>; p != NULL; p = p-&gt;next) {
        dent = p-&gt;data;
        <span class="keywordflow">if</span> (strcmp (dent-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a>, name) == 0) {
            obj_id = g_strdup (dent-&gt;<a class="code" href="struct__SeafDirent.html#ae85b031142d8a9360ba9c2ab8961a451">id</a>);
            <span class="keywordflow">if</span> (<a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>) {
                *<a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a> = dent-&gt;<a class="code" href="struct__SeafDirent.html#a823df197de2c76627746de18e9b6ce02">mode</a>;
            }
            <span class="keywordflow">break</span>;
        }
    }

out:
    <span class="keywordflow">if</span> (base_dir)
        <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (base_dir);
    g_free (copy);
    <span class="keywordflow">return</span> <a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1cd5c89e6d5b47b828c3de9bff87d88"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_populate_blocklist" ref="ab1cd5c89e6d5b47b828c3de9bff87d88" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, BlockList *bl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#ab1cd5c89e6d5b47b828c3de9bff87d88">seaf_fs_manager_populate_blocklist</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02036">2036</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="fs-mgr_8c.html#a7bd544826845e7f5b917fdfd727d4806">seaf_fs_manager_traverse_tree</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id,
                                          fill_blocklist,
                                          bl, FALSE);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4fd132514ca9fb157d1b16a8e21bf749"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_traverse_path" ref="a4fd132514ca9fb157d1b16a8e21bf749" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, const char *dir_path, TraverseFSPathCallback callback, void *user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a4fd132514ca9fb157d1b16a8e21bf749">seaf_fs_manager_traverse_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#a9bba616c7207dee55b973587fccb40be">TraverseFSPathCallback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01984">1984</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *dent;
    <span class="keywordtype">int</span> ret = 0;

    dent = <a class="code" href="fs-mgr_8c.html#a17cc3f2cd49d1d31379938121b58fa69">seaf_fs_manager_get_dirent_by_path</a> (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                               root_id, dir_path, NULL);
    <span class="keywordflow">if</span> (!dent) {
        seaf_warning (<span class="stringliteral">&quot;Failed to get dirent for %.8s:%s.\n&quot;</span>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, dir_path);
        <span class="keywordflow">return</span> -1;
    }

    ret = traverse_dir_path (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, dir_path, dent,
                             callback, user_data);

    <a class="code" href="fs-mgr_8c.html#aef77f199fa9eccfe322f1ff978a9055a">seaf_dirent_free</a> (dent);
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7bd544826845e7f5b917fdfd727d4806"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_traverse_tree" ref="a7bd544826845e7f5b917fdfd727d4806" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *root_id, TraverseFSTreeCallback callback, void *user_data, gboolean skip_errors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a7bd544826845e7f5b917fdfd727d4806">seaf_fs_manager_traverse_tree</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>root_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#a42e22741d25d945bed7faabc732c7fe4">TraverseFSTreeCallback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>skip_errors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01916">1916</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (strcmp (root_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>) == 0) {
        <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">return</span> traverse_dir (mgr, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, root_id, callback, user_data, skip_errors);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a70406a91027ed3add3d9026d8dad8a0c"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_verify_object" ref="a70406a91027ed3add3d9026d8dad8a0c" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *obj_id, gboolean verify_id, gboolean *io_error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="fs-mgr_8h.html#a70406a91027ed3add3d9026d8dad8a0c">seaf_fs_manager_verify_object</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>obj_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>verify_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean *&#160;</td>
          <td class="paramname"><em>io_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02655">2655</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">void</span> *data;
    <span class="keywordtype">int</span> len;
    gboolean ret = TRUE;

    <span class="keywordflow">if</span> (memcmp (<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0) {
        <span class="keywordflow">return</span> TRUE;
    }

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a6e93a0214f9cb8a7fc837a2bc3a3c529">seaf_obj_store_read_obj</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                 <a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, &amp;data, &amp;len) &lt; 0) {
        seaf_warning (<span class="stringliteral">&quot;[fs mgr] Failed to read object %s.\n&quot;</span>, <a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>);
        *io_error = TRUE;
        <span class="keywordflow">return</span> FALSE;
    }

    <span class="keywordflow">if</span> (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> == 0)
        ret = verify_fs_object_v0 (<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, data, len, verify_id);
    <span class="keywordflow">else</span>
        ret = verify_fs_object_json (<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, data, len);

    g_free (data);
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0c330524a615b7550fc5ffe7a4da7f4"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_verify_seafdir" ref="aa0c330524a615b7550fc5ffe7a4da7f4" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *dir_id, gboolean verify_id, gboolean *io_error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="fs-mgr_8h.html#aa0c330524a615b7550fc5ffe7a4da7f4">seaf_fs_manager_verify_seafdir</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>verify_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean *&#160;</td>
          <td class="paramname"><em>io_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02526">2526</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">void</span> *data;
    <span class="keywordtype">int</span> len;

    <span class="keywordflow">if</span> (memcmp (dir_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0) {
        <span class="keywordflow">return</span> TRUE;
    }

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a6e93a0214f9cb8a7fc837a2bc3a3c529">seaf_obj_store_read_obj</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                 dir_id, &amp;data, &amp;len) &lt; 0) {
        seaf_warning (<span class="stringliteral">&quot;[fs mgr] Failed to read dir %s.\n&quot;</span>, dir_id);
        *io_error = TRUE;
        <span class="keywordflow">return</span> FALSE;
    }

    gboolean ret = verify_seafdir (dir_id, data, len, verify_id, (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0));
    g_free (data);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af6125641a9cc5a746f9716c2feadcfa8"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_manager_verify_seafile" ref="af6125641a9cc5a746f9716c2feadcfa8" args="(SeafFSManager *mgr, const char *repo_id, int version, const char *file_id, gboolean verify_id, gboolean *io_error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="fs-mgr_8h.html#af6125641a9cc5a746f9716c2feadcfa8">seaf_fs_manager_verify_seafile</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>verify_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean *&#160;</td>
          <td class="paramname"><em>io_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02603">2603</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">void</span> *data;
    <span class="keywordtype">int</span> len;

    <span class="keywordflow">if</span> (memcmp (file_id, <a class="code" href="seafile_2common_2common_8h.html#aaa0130adfcd2ec28ea4cf85337ace2da">EMPTY_SHA1</a>, 40) == 0) {
        <span class="keywordflow">return</span> TRUE;
    }

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a6e93a0214f9cb8a7fc837a2bc3a3c529">seaf_obj_store_read_obj</a> (mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                 file_id, &amp;data, &amp;len) &lt; 0) {
        seaf_warning (<span class="stringliteral">&quot;[fs mgr] Failed to read file %s.\n&quot;</span>, file_id);
        *io_error = TRUE;
        <span class="keywordflow">return</span> FALSE;
    }

    gboolean ret = verify_seafile (file_id, data, len, verify_id, (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0));
    g_free (data);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3bcb5d0db17e8188189936b262609e6"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_object_free" ref="ac3bcb5d0db17e8188189936b262609e6" args="(SeafFSObject *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#ac3bcb5d0db17e8188189936b262609e6">seaf_fs_object_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#a364de0b7a1afe12c5265ddc3a950a892">SeafFSObject</a> *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01773">1773</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!obj)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="struct__SeafFSObject.html#a543bf65364e20384d39b82dbb9f41361">type</a> == <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a46fc8ea4b8423113c7c59c7a2dc8cdf2">SEAF_METADATA_TYPE_FILE</a>)
        <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> ((<a class="code" href="struct__Seafile.html">Seafile</a> *)obj);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="struct__SeafFSObject.html#a543bf65364e20384d39b82dbb9f41361">type</a> == <a class="code" href="fs-mgr_8h.html#aa6063f3a25a4f2cdc44b9bb136ff00f6a7b28656556a225daa5cf2292ba075322">SEAF_METADATA_TYPE_DIR</a>)
        <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> ((<a class="code" href="struct__SeafDir.html">SeafDir</a> *)obj);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a63cf6fa9de3b33361dd2bbdc5c5ac95d"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_fs_object_from_data" ref="a63cf6fa9de3b33361dd2bbdc5c5ac95d" args="(const char *obj_id, uint8_t *data, int len, gboolean is_json)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs-mgr_8h.html#a364de0b7a1afe12c5265ddc3a950a892">SeafFSObject</a>* <a class="el" href="fs-mgr_8h.html#a63cf6fa9de3b33361dd2bbdc5c5ac95d">seaf_fs_object_from_data</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>obj_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>is_json</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01762">1762</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (is_json)
        <span class="keywordflow">return</span> <a class="code" href="fs-mgr_8c.html#ac58f859abeba94b69e2db803dc5a6cdc">fs_object_from_json</a> (<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, data, len);
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> <a class="code" href="fs-mgr_8c.html#abdb855f48cf2fba567cd455dd484c697">fs_object_from_v0_data</a> (<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, data, len);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9304a0c213bd34c4bf2a50a408e91c7a"></a><!-- doxytag: member="fs&#45;mgr.h::seaf_metadata_type_from_data" ref="a9304a0c213bd34c4bf2a50a408e91c7a" args="(const char *obj_id, uint8_t *data, int len, gboolean is_json)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a9304a0c213bd34c4bf2a50a408e91c7a">seaf_metadata_type_from_data</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>obj_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>is_json</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01695">1695</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (is_json)
        <span class="keywordflow">return</span> parse_metadata_type_json (<a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>, data, len);
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> parse_metadata_type_v0 (data, len);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a43c9fbd6978c6f9cbc71d41ec42b57da"></a><!-- doxytag: member="fs&#45;mgr.h::seafile_check_write_chunk" ref="a43c9fbd6978c6f9cbc71d41ec42b57da" args="(CDCDescriptor *chunk, uint8_t *sha1, gboolean write_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a43c9fbd6978c6f9cbc71d41ec42b57da">seafile_check_write_chunk</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cdc_8h.html#a47ee29834896ea0b2aa757f8233ab284">CDCDescriptor</a> *&#160;</td>
          <td class="paramname"><em>chunk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>sha1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>write_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aaf788c4f305d5509b791f64615fa9112"></a><!-- doxytag: member="fs&#45;mgr.h::seafile_ref" ref="aaf788c4f305d5509b791f64615fa9112" args="(Seafile *seafile)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#aaf788c4f305d5509b791f64615fa9112">seafile_ref</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *&#160;</td>
          <td class="paramname"><em>seafile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00777">777</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    ++seafile-&gt;<a class="code" href="struct__Seafile.html#a77b792205ee77f58b95c1da1aecce1a4">ref_count</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6d5e7c9f24bc74592e3f83f624e79c8b"></a><!-- doxytag: member="fs&#45;mgr.h::seafile_save" ref="a6d5e7c9f24bc74592e3f83f624e79c8b" args="(SeafFSManager *fs_mgr, const char *repo_id, int version, Seafile *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a6d5e7c9f24bc74592e3f83f624e79c8b">seafile_save</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#ac300709c9e02a7e0648849fdd269436b">SeafFSManager</a> *&#160;</td>
          <td class="paramname"><em>fs_mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l01070">1070</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    guint8 *data;
    <span class="keywordtype">int</span> len;
    <span class="keywordtype">int</span> ret = 0;

    data = seafile_to_data (file, &amp;len);
    <span class="keywordflow">if</span> (!data)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">if</span> (<a class="code" href="obj-store_8c.html#a673d1262bbb4caf66816c89bde13b429">seaf_obj_store_write_obj</a> (fs_mgr-&gt;<a class="code" href="struct__SeafFSManager.html#aff81d27b12d5aaefe129f39071d33386">obj_store</a>, <a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, file-&gt;<a class="code" href="struct__Seafile.html#a0a00826f3515746edeb7a9654efd06c7">file_id</a>,
                                  data, len, FALSE) &lt; 0)
        ret = -1;

    g_free (data);
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0a491c647769cf7bd09d5092ab84b85a"></a><!-- doxytag: member="fs&#45;mgr.h::seafile_unref" ref="a0a491c647769cf7bd09d5092ab84b85a" args="(Seafile *seafile)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="fs-mgr_8h.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs-mgr_8h.html#aa717065fd2773cd641f5bd97d3474ce6">Seafile</a> *&#160;</td>
          <td class="paramname"><em>seafile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00797">797</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!seafile)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (--seafile-&gt;<a class="code" href="struct__Seafile.html#a77b792205ee77f58b95c1da1aecce1a4">ref_count</a> &lt;= 0)
        seafile_free (seafile);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4e23e8e9b670107f776aab343fea5cf4"></a><!-- doxytag: member="fs&#45;mgr.h::seafile_version_from_repo_version" ref="a4e23e8e9b670107f776aab343fea5cf4" args="(int repo_version)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a4e23e8e9b670107f776aab343fea5cf4">seafile_version_from_repo_version</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l02696">2696</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (repo_version == 0)
        <span class="keywordflow">return</span> 0;
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> <a class="code" href="fs-mgr_8h.html#abac8261f96e8e3dbd02d5e52cac66fc6">CURRENT_SEAFILE_OBJ_VERSION</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7182f3f9fdba2447f48c1978deea35d5"></a><!-- doxytag: member="fs&#45;mgr.h::seafile_write_chunk" ref="a7182f3f9fdba2447f48c1978deea35d5" args="(const char *repo_id, int version, CDCDescriptor *chunk, SeafileCrypt *crypt, uint8_t *checksum, gboolean write_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="fs-mgr_8h.html#a7182f3f9fdba2447f48c1978deea35d5">seafile_write_chunk</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cdc_8h.html#a47ee29834896ea0b2aa757f8233ab284">CDCDescriptor</a> *&#160;</td>
          <td class="paramname"><em>chunk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *&#160;</td>
          <td class="paramname"><em>crypt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>checksum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>write_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00537">537</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    SHA_CTX ctx;
    <span class="keywordtype">int</span> ret = 0;

    <span class="comment">/* Encrypt before write to disk if needed, and we don&#39;t encrypt</span>
<span class="comment">     * empty files. */</span>
    <span class="keywordflow">if</span> (crypt != NULL &amp;&amp; chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a9cea4d09da83359c291721805e8d151c">len</a>) {
        <span class="keywordtype">char</span> *encrypted_buf = NULL;         <span class="comment">/* encrypted output */</span>
        <span class="keywordtype">int</span> enc_len = -1;                <span class="comment">/* encrypted length */</span>

        ret = <a class="code" href="seafile-crypt_8c.html#a153a2146ed90b98ccdb91da4bc343016">seafile_encrypt</a> (&amp;encrypted_buf, <span class="comment">/* output */</span>
                               &amp;enc_len,      <span class="comment">/* output len */</span>
                               chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a72f38243a32595c469d0fb4da1ef477d">block_buf</a>, <span class="comment">/* input */</span>
                               chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a9cea4d09da83359c291721805e8d151c">len</a>,       <span class="comment">/* input len */</span>
                               crypt);
        <span class="keywordflow">if</span> (ret != 0) {
            g_warning (<span class="stringliteral">&quot;Error: failed to encrypt block\n&quot;</span>);
            <span class="keywordflow">return</span> -1;
        }

        SHA1_Init (&amp;ctx);
        SHA1_Update (&amp;ctx, encrypted_buf, enc_len);
        SHA1_Final (checksum, &amp;ctx);

        <span class="keywordflow">if</span> (write_data)
            ret = do_write_chunk (<a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, checksum, encrypted_buf, enc_len);
        g_free (encrypted_buf);
    } <span class="keywordflow">else</span> {
        <span class="comment">/* not a encrypted repo, go ahead */</span>
        SHA1_Init (&amp;ctx);
        SHA1_Update (&amp;ctx, chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a72f38243a32595c469d0fb4da1ef477d">block_buf</a>, chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a9cea4d09da83359c291721805e8d151c">len</a>);
        SHA1_Final (checksum, &amp;ctx);

        <span class="keywordflow">if</span> (write_data)
            ret = do_write_chunk (<a class="code" href="structunpack__trees__options.html#a7270e145ba04fb2e7ba054a3af66d98c">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, checksum, chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a72f38243a32595c469d0fb4da1ef477d">block_buf</a>, chunk-&gt;<a class="code" href="struct__CDCDescriptor.html#a9cea4d09da83359c291721805e8d151c">len</a>);
    }

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ac5bca675b55e4df0a33e4e87cdbf8996"></a><!-- doxytag: member="fs&#45;mgr.h::__attribute__" ref="ac5bca675b55e4df0a33e4e87cdbf8996" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcache__entry.html">cache_entry</a> <a class="el" href="struct____attribute____.html">__attribute__</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fs-mgr_8c_source.html#l00052">52</a> of file <a class="el" href="fs-mgr_8c_source.html">fs-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">                             {
    guint32 <a class="code" href="fs-mgr_8c.html#a65cfc9e13d3352fd9099a0408cba715c">type</a>;
    <span class="keywordtype">char</span>    dirents[0];
} <a class="code" href="fs-mgr_8h.html#ac5bca675b55e4df0a33e4e87cdbf8996">__attribute__</a>((gcc_struct, __packed__)) SeafdirOndisk;
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:19:05 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
