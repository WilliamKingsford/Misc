<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/lib/utils.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/lib/utils.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;config.h&gt;</code><br/>
<code>#include &quot;common.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile_2lib_2utils_8h_source.html">utils.h</a>&quot;</code><br/>
<code>#include &lt;arpa/inet.h&gt;</code><br/>
<code>#include &lt;pwd.h&gt;</code><br/>
<code>#include &lt;uuid/uuid.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;dirent.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;limits.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;openssl/sha.h&gt;</code><br/>
<code>#include &lt;openssl/hmac.h&gt;</code><br/>
<code>#include &lt;openssl/evp.h&gt;</code><br/>
<code>#include &lt;openssl/bio.h&gt;</code><br/>
<code>#include &lt;openssl/buffer.h&gt;</code><br/>
<code>#include &lt;glib.h&gt;</code><br/>
<code>#include &lt;glib/gstdio.h&gt;</code><br/>
<code>#include &lt;searpc-utils.h&gt;</code><br/>
<code>#include &lt;jansson.h&gt;</code><br/>
<code>#include &lt;utime.h&gt;</code><br/>
<code>#include &lt;zlib.h&gt;</code><br/>
<code>#include &lt;openssl/aes.h&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for utils.c:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c__incl.png" border="0" usemap="#seafile_2lib_2utils_8c" alt=""/></div>
<map name="seafile_2lib_2utils_8c" id="seafile_2lib_2utils_8c">
<area shape="rect" id="node7" href="seafile_2lib_2utils_8h.html" title="utils.h" alt="" coords="540,83,596,112"/></map>
</div>
</div>
<p><a href="seafile_2lib_2utils_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a244ef028bfd8730f240e09cfaf6f73dd">ENC_SUCCESS</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a22b00c5a64444ba20bedd53f9b0354e4">ENC_FAILURE</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a27737608bf6ac33327c4d471c0840d80">DEC_SUCCESS</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aa5ae267b99893212a3323291959f8427">DEC_FAILURE</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a>&#160;&#160;&#160;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aebf2e2423a52e20d6b54555bb48e2ab6">ENCRYPT_BLK_SIZE</a>&#160;&#160;&#160;<a class="el" href="ccnet_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a2c14e30b8edd80c33d5aca8e59eae234">STAT_STRUCT</a>&#160;&#160;&#160;struct stat</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ac79f8734f2028b939fb79cbff7cbc473">STAT_FUNC</a>&#160;&#160;&#160;stat</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a>&#160;&#160;&#160;16384</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#acdce1d46efd09e8485a2f682b388ebc0">inet_pton</a> (int af, const char *src, void *dst)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct timeval&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ac0aa6c70f613ad3344b5f1f917b6b68a">timeval_from_msec</a> (uint64_t milliseconds)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (const unsigned char *rawdata, char *hex_str, int n_bytes)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a130e83c1ad29d78ef1a5b6baef1754d5">hex_to_rawdata</a> (const char *hex_str, unsigned char *rawdata, int n_bytes)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a3592ee26a3c344698705b0956a8308a2">ccnet_strlcpy</a> (char *dest, const char *src, size_t <a class="el" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a8972f29db121d2c77a167b5ad4942d94">checkdir</a> (const char *dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ace0bdb78b60b2d088517a3e03a448e8b">checkdir_with_mkdir</a> (const char *dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a332e0543b63f5b18d4fa81eaf09922fc">objstore_mkdir</a> (const char *base)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ac8e393e1fd0d1d9d0057ebd24a561c1b">objstore_get_path</a> (char *path, const char *base, const char *<a class="el" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a> (const char *path, <a class="el" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> *st)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a09f0677ad28b98b7a85bcda57f71e7c8">seaf_fstat</a> (int fd, <a class="el" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> *st)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#abc8dd3d83f54a07998aea73c4071d818">seaf_set_file_time</a> (const char *path, guint64 <a class="el" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a26f091009701c5a9d1886b9d6ceb9c8e">seaf_util_unlink</a> (const char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#abab8a37cf996c1cf68c1cc8f6dfc757c">seaf_util_rmdir</a> (const char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a51aa6c51cc437a2766ca666660289bce">seaf_util_mkdir</a> (const char *path, mode_t <a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ad154e736c3751fe880395dff55fab739">seaf_util_open</a> (const char *path, int <a class="el" href="index_8h.html#a1cbb17ede73ea044a04a129bf4d86976">flags</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a822971bc55edc699449c6f6f2e03225e">seaf_util_create</a> (const char *path, int <a class="el" href="index_8h.html#a1cbb17ede73ea044a04a129bf4d86976">flags</a>, mode_t <a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> (const char *oldpath, const char *newpath)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a1c2448a989efb1ce953a90f3db3c8042">seaf_util_exists</a> (const char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a05f0eae648599d413d03103758473e30">readn</a> (int fd, void *vptr, size_t n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a6a9988632dc9e05f10a71688fd280cc9">writen</a> (int fd, const void *vptr, size_t n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ab1b7fca428ce9530309624d9bdd822e6">recvn</a> (int fd, void *vptr, size_t n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aa324f32349cf5a256d5bd7802ab87e84">sendn</a> (int fd, const void *vptr, size_t n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a8e7da7ad650a6da09c1f679479335ed1">copy_fd</a> (int ifd, int ofd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a9f585ff92128cbf174ef4b3a9b429d08">copy_file</a> (const char *dst, const char *src, int <a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ad52e8a09737b9afc6375f8cee7336d7d">ccnet_expand_path</a> (const char *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a63f0195a708d600ce96f867747afb8e4">calculate_sha1</a> (unsigned char *<a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>, const char *msg, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ac846d436ccbb4031fa7a8d76ceadad07">ccnet_sha1_hash</a> (const void *v)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a75a7a2a1400f4cf5f6cd5ea988e705f4">ccnet_sha1_equal</a> (const void *v1, const void *v2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#af64020f0be33abde6a2a076ff9808809">gen_uuid</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ab141c69bb8e435339193ac2062007c7c">gen_uuid_inplace</a> (char *buf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a48ecdc72b727191abafbbf2ec1f70ace">is_uuid_valid</a> (const char *uuid_str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ac488386314994c1d379a02d1ffd10993">strsplit_by_space</a> (char *string, int *length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a4fff2ff146c8734a7dd56989631e451e">strsplit_by_char</a> (char *string, int *length, char c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ab11a77475b1b6258fd066c9e7413dd3e">strjoin_n</a> (const char *seperator, int argc, char **argv)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a09a30b5d69ebee42a4f001cdf857d83a">is_ipaddr_valid</a> (const char *ip)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a3e3be562436695c4865957e2790b1da8">parse_key_value_pairs</a> (char *string, <a class="el" href="ccnet_2lib_2utils_8h.html#a4bc6467da0bdec670824a164c007e1a8">KeyValueFunc</a> func, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a2d7d7513a3e6fb072e6ce9b630097634">parse_key_value_pairs2</a> (char *string, <a class="el" href="ccnet_2lib_2utils_8h.html#ab8819219965036f1df6aad17bd9503c7">KeyValueFunc2</a> func, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gchar *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aae72852955df5bdfc8bb72a36a0f8808">ccnet_key_file_get_string</a> (GKeyFile *keyf, const char *category, const char *key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a38f449c218477960cf9dc2136453db10">string_list_is_exists</a> (GList *str_list, const char *string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aefe1dabfce05643fed7d83c2bb4c615c">string_list_append</a> (GList *str_list, const char *string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ab7295a8677eade8b86c15b06715dc902">string_list_append_sorted</a> (GList *str_list, const char *string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a6eb8b0fccfe316157ddb5a47d9cd3a71">string_list_remove</a> (GList *str_list, const char *string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#af85d9a3e4ab846a6eedfb509508367f2">string_list_free</a> (GList *str_list)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a76260b41a1602f1e082ece20aa258135">string_list_join</a> (GList *str_list, GString *str, const char *seperator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a45ff8617e4273dddf37bccc992d9d505">string_list_parse</a> (const char *list_in_str, const char *seperator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#afbee5493f93a3ddbed45c38d2682683d">string_list_parse_sorted</a> (const char *list_in_str, const char *seperator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a4bed2c887b506e8e25c0b9f1725f4684">string_list_sorted_is_equal</a> (GList *list1, GList *list2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#acc99dd2106bfcedb4fef8a2f1ecd1b8a">ncopy_string_array</a> (char **orig, int n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a4934aa80d54625fa9d2505f13117f4a0">nfree_string_array</a> (char **array, int n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a6a676d54675053cd9d9afefabd10a454">get_current_time</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a81c34fab7ffe2584f17e2e7bd528910a">ccnet_encrypt</a> (char **data_out, int *out_len, const char *data_in, const int in_len, const char *code, const int code_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#aa5c0dca9c780e258efa1cdbf50f8666c">ccnet_decrypt</a> (char **data_out, int *out_len, const char *data_in, const int in_len, const char *code, const int code_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a927b2cab4b163cb58c078fb4158f6f82">ccnet_locale_to_utf8</a> (const gchar *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ad05e32bdab25b5e5ba3f36a640b30cc8">ccnet_locale_from_utf8</a> (const gchar *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a5241dfe016bb295dddd19c1f8b6f62d4">ccnet_object_type_from_id</a> (const char *object_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a1efc86d468a02c24e0709818044d296d">ccnet_calc_directory_size</a> (const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a50be04624e628ad19aa88d9fc0fd5a28">json_object_get_string_member</a> (json_t *object, const char *key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#af3fcfc36aa8248b0c8932e5c3e51f3fc">json_object_has_member</a> (json_t *object, const char *key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a36802b9b311cdc4cd847b79c4ddd5903">json_object_get_int_member</a> (json_t *object, const char *key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#a178267416f18a24c6d717db8ad91c471">json_object_set_string_member</a> (json_t *object, const char *key, const char *value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#abfac2ec06b36f64de2f110f093e6dfc0">json_object_set_int_member</a> (json_t *object, const char *key, gint64 value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ae476843508927222a51125ac1c7fec2b">clean_utf8_data</a> (char *data, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ace06e9888a8adf6cd341163d3f7f504f">seaf_compress</a> (guint8 *input, int inlen, guint8 **output, int *outlen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="seafile_2lib_2utils_8c.html#ac7d9f3eae8999794ca0f59cab62c486e">seaf_decompress</a> (guint8 *input, int inlen, guint8 **output, int *outlen)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a5394435edf20efdffac70b5c362ade81"></a><!-- doxytag: member="utils.c::BLK_SIZE" ref="a5394435edf20efdffac70b5c362ade81" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a>&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01556">1556</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa5ae267b99893212a3323291959f8427"></a><!-- doxytag: member="utils.c::DEC_FAILURE" ref="aa5ae267b99893212a3323291959f8427" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#aa5ae267b99893212a3323291959f8427">DEC_FAILURE</a>&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01549">1549</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="a27737608bf6ac33327c4d471c0840d80"></a><!-- doxytag: member="utils.c::DEC_SUCCESS" ref="a27737608bf6ac33327c4d471c0840d80" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#a27737608bf6ac33327c4d471c0840d80">DEC_SUCCESS</a>&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01548">1548</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="a22b00c5a64444ba20bedd53f9b0354e4"></a><!-- doxytag: member="utils.c::ENC_FAILURE" ref="a22b00c5a64444ba20bedd53f9b0354e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#a22b00c5a64444ba20bedd53f9b0354e4">ENC_FAILURE</a>&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01547">1547</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="a244ef028bfd8730f240e09cfaf6f73dd"></a><!-- doxytag: member="utils.c::ENC_SUCCESS" ref="a244ef028bfd8730f240e09cfaf6f73dd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#a244ef028bfd8730f240e09cfaf6f73dd">ENC_SUCCESS</a>&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01546">1546</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="aebf2e2423a52e20d6b54555bb48e2ab6"></a><!-- doxytag: member="utils.c::ENCRYPT_BLK_SIZE" ref="aebf2e2423a52e20d6b54555bb48e2ab6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#aebf2e2423a52e20d6b54555bb48e2ab6">ENCRYPT_BLK_SIZE</a>&#160;&#160;&#160;<a class="el" href="ccnet_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01557">1557</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac79f8734f2028b939fb79cbff7cbc473"></a><!-- doxytag: member="utils.c::STAT_FUNC" ref="ac79f8734f2028b939fb79cbff7cbc473" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#ac79f8734f2028b939fb79cbff7cbc473">STAT_FUNC</a>&#160;&#160;&#160;stat</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02221">2221</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2c14e30b8edd80c33d5aca8e59eae234"></a><!-- doxytag: member="utils.c::STAT_STRUCT" ref="a2c14e30b8edd80c33d5aca8e59eae234" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="ccnet_2lib_2utils_8c.html#a2c14e30b8edd80c33d5aca8e59eae234">STAT_STRUCT</a>&#160;&#160;&#160;struct stat</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02220">2220</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<a class="anchor" id="aee79ea870e3b3807cae3db5655993a7e"></a><!-- doxytag: member="utils.c::ZLIB_BUF_SIZE" ref="aee79ea870e3b3807cae3db5655993a7e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a>&#160;&#160;&#160;16384</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02372">2372</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a63f0195a708d600ce96f867747afb8e4"></a><!-- doxytag: member="utils.c::calculate_sha1" ref="a63f0195a708d600ce96f867747afb8e4" args="(unsigned char *sha1, const char *msg, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a675c60346da3d826cd6d6fecd87e8e8b">calculate_sha1</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>sha1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00980">980</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    SHA_CTX c;

    <span class="keywordflow">if</span> (len &lt; 0)
        len = strlen(msg);

    SHA1_Init(&amp;c);
    SHA1_Update(&amp;c, msg, len);    
        SHA1_Final(<a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>, &amp;c);
    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a63f0195a708d600ce96f867747afb8e4_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a63f0195a708d600ce96f867747afb8e4_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a63f0195a708d600ce96f867747afb8e4_icgraph" id="seafile_2lib_2utils_8c_a63f0195a708d600ce96f867747afb8e4_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#aa100826c1ee3596157d1df52d15c747f" title="seaf_fs_manager_calculate_seafile_id_json" alt="" coords="163,5,437,35"/><area shape="rect" id="node11" href="ccnet_2lib_2rsa_8h.html#a2dc34dfeb44d28869737d39916797283" title="id_from_pubkey" alt="" coords="243,59,357,88"/><area shape="rect" id="node5" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf" title="compare_file_content" alt="" coords="485,5,632,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="680,5,779,35"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="827,5,1029,35"/><area shape="rect" id="node13" href="ccnet-init_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="533,59,584,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1efc86d468a02c24e0709818044d296d"></a><!-- doxytag: member="utils.c::ccnet_calc_directory_size" ref="a1efc86d468a02c24e0709818044d296d" args="(const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="ccnet_2lib_2utils_8h.html#a1efc86d468a02c24e0709818044d296d">ccnet_calc_directory_size</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02269">2269</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> calc_recursively (path, error);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a1efc86d468a02c24e0709818044d296d_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a1efc86d468a02c24e0709818044d296d_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a1efc86d468a02c24e0709818044d296d_icgraph" id="seafile_2lib_2utils_8c_a1efc86d468a02c24e0709818044d296d_icgraph">
<area shape="rect" id="node3" href="seafile_2common_2rpc-service_8c.html#a3ce8469d9e4cf781199dd75d73a1dc3b" title="seafile_calc_dir_size" alt="" coords="228,5,369,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa5c0dca9c780e258efa1cdbf50f8666c"></a><!-- doxytag: member="utils.c::ccnet_decrypt" ref="aa5c0dca9c780e258efa1cdbf50f8666c" args="(char **data_out, int *out_len, const char *data_in, const int in_len, const char *code, const int code_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#aa5c0dca9c780e258efa1cdbf50f8666c">ccnet_decrypt</a> </td>
          <td>(</td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>data_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>data_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>in_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>code_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01676">1676</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    *data_out = NULL;
    *out_len = -1;

    <span class="comment">/* Check validation. Because padding is always used, in_len must</span>
<span class="comment">     * be a multiple of BLK_SIZE */</span>
    <span class="keywordflow">if</span> ( data_in == NULL || in_len &lt;= 0 || in_len % <a class="code" href="seafile_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a> != 0 ||
         code == NULL || code_len &lt;= 0) {

        g_warning (<span class="stringliteral">&quot;Invalid param(s).\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    EVP_CIPHER_CTX ctx;
    <span class="keywordtype">int</span> ret, <a class="code" href="block-tx-utils_8h.html#acb7060b2ddf9e95be5ca9fd29e252770">key_len</a>;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> key[16], iv[16];

   
    <span class="comment">/* Generate the derived key. We use AES 128 bits key,</span>
<span class="comment">       Electroic-Code-Book cipher mode, and SHA1 as the message digest</span>
<span class="comment">       when generating the key. IV is not used in ecb mode,</span>
<span class="comment">       actually. */</span>
    key_len  = EVP_BytesToKey (EVP_aes_128_ecb(), <span class="comment">/* cipher mode */</span>
                               EVP_sha1(),        <span class="comment">/* message digest */</span>
                               NULL,              <span class="comment">/* salt */</span>
                               (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)code, <span class="comment">/* passwd */</span>
                               code_len,
                               3,   <span class="comment">/* iteration times */</span>
                               key, <span class="comment">/* the derived key */</span>
                               iv); <span class="comment">/* IV, initial vector */</span>

    <span class="comment">/* The key should be 16 bytes long for our 128 bit key. */</span>
    <span class="keywordflow">if</span> (key_len != 16) {
        g_warning (<span class="stringliteral">&quot;failed to init EVP_CIPHER_CTX.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }


    <span class="comment">/* Prepare CTX for decryption. */</span>
    EVP_CIPHER_CTX_init (&amp;ctx);

    ret = EVP_DecryptInit_ex (&amp;ctx,
                              EVP_aes_128_ecb(), <span class="comment">/* cipher mode */</span>
                              NULL, <span class="comment">/* engine, NULL for default */</span>
                              key,  <span class="comment">/* derived key */</span>
                              iv);  <span class="comment">/* initial vector */</span>

    <span class="keywordflow">if</span> (ret == <a class="code" href="seafile_2lib_2utils_8c.html#aa5ae267b99893212a3323291959f8427">DEC_FAILURE</a>)
        <span class="keywordflow">return</span> -1;

    <span class="comment">/* Allocating output buffer. */</span>
    
    *data_out = (<span class="keywordtype">char</span> *)g_malloc (in_len);

    <span class="keywordflow">if</span> (*data_out == NULL) {
        g_warning (<span class="stringliteral">&quot;failed to allocate the output buffer.\n&quot;</span>);
        <span class="keywordflow">goto</span> dec_error;
    }                

    <span class="keywordtype">int</span> update_len, final_len;

    <span class="comment">/* Do the decryption. */</span>
    ret = EVP_DecryptUpdate (&amp;ctx,
                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)*data_out,
                             &amp;update_len,
                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)data_in,
                             in_len);

    <span class="keywordflow">if</span> (ret == <a class="code" href="seafile_2lib_2utils_8c.html#aa5ae267b99893212a3323291959f8427">DEC_FAILURE</a>)
        <span class="keywordflow">goto</span> dec_error;


    <span class="comment">/* Finish the possible partial block. */</span>
    ret = EVP_DecryptFinal_ex (&amp;ctx,
                               (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)*data_out + update_len,
                               &amp;final_len);

    *out_len = update_len + final_len;

    <span class="comment">/* out_len should be smaller than in_len. */</span>
    <span class="keywordflow">if</span> (ret == <a class="code" href="seafile_2lib_2utils_8c.html#aa5ae267b99893212a3323291959f8427">DEC_FAILURE</a> || *out_len &gt; in_len)
        <span class="keywordflow">goto</span> dec_error;

    EVP_CIPHER_CTX_cleanup (&amp;ctx);
    
    <span class="keywordflow">return</span> 0;

dec_error:

    EVP_CIPHER_CTX_cleanup (&amp;ctx);

    *out_len = -1;
    <span class="keywordflow">if</span> (*data_out != NULL)
        g_free (*data_out);

    *data_out = NULL;

    <span class="keywordflow">return</span> -1;
    
}
</pre></div>
</div>
</div>
<a class="anchor" id="a81c34fab7ffe2584f17e2e7bd528910a"></a><!-- doxytag: member="utils.c::ccnet_encrypt" ref="a81c34fab7ffe2584f17e2e7bd528910a" args="(char **data_out, int *out_len, const char *data_in, const int in_len, const char *code, const int code_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a81c34fab7ffe2584f17e2e7bd528910a">ccnet_encrypt</a> </td>
          <td>(</td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>data_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>data_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>in_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>code_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01561">1561</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    *data_out = NULL;
    *out_len = -1;

    <span class="comment">/* check validation */</span>
    <span class="keywordflow">if</span> ( data_in == NULL || in_len &lt;= 0 ||
         code == NULL || code_len &lt;= 0) {

        g_warning (<span class="stringliteral">&quot;Invalid params.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    EVP_CIPHER_CTX ctx;
    <span class="keywordtype">int</span> ret, <a class="code" href="block-tx-utils_8h.html#acb7060b2ddf9e95be5ca9fd29e252770">key_len</a>;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> key[16], iv[16];
    <span class="keywordtype">int</span> blks;                   

    
    <span class="comment">/* Generate the derived key. We use AES 128 bits key,</span>
<span class="comment">       Electroic-Code-Book cipher mode, and SHA1 as the message digest</span>
<span class="comment">       when generating the key. IV is not used in ecb mode,</span>
<span class="comment">       actually. */</span>
    key_len  = EVP_BytesToKey (EVP_aes_128_ecb(), <span class="comment">/* cipher mode */</span>
                               EVP_sha1(),        <span class="comment">/* message digest */</span>
                               NULL,              <span class="comment">/* salt */</span>
                               (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)code, <span class="comment">/* passwd */</span>
                               code_len,
                               3,   <span class="comment">/* iteration times */</span>
                               key, <span class="comment">/* the derived key */</span>
                               iv); <span class="comment">/* IV, initial vector */</span>

    <span class="comment">/* The key should be 16 bytes long for our 128 bit key. */</span>
    <span class="keywordflow">if</span> (key_len != 16) {
        g_warning (<span class="stringliteral">&quot;failed to init EVP_CIPHER_CTX.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* Prepare CTX for encryption. */</span>
    EVP_CIPHER_CTX_init (&amp;ctx);

    ret = EVP_EncryptInit_ex (&amp;ctx,
                              EVP_aes_128_ecb(), <span class="comment">/* cipher mode */</span>
                              NULL, <span class="comment">/* engine, NULL for default */</span>
                              key,  <span class="comment">/* derived key */</span>
                              iv);  <span class="comment">/* initial vector */</span>

    <span class="keywordflow">if</span> (ret == <a class="code" href="seafile_2lib_2utils_8c.html#a22b00c5a64444ba20bedd53f9b0354e4">ENC_FAILURE</a>)
        <span class="keywordflow">return</span> -1;

    <span class="comment">/* Allocating output buffer. */</span>
    
    <span class="comment">/*</span>
<span class="comment">      For EVP symmetric encryption, padding is always used __even if__</span>
<span class="comment">      data size is a multiple of block size, in which case the padding</span>
<span class="comment">      length is the block size. so we have the following:</span>
<span class="comment">    */</span>
    
    blks = (in_len / <a class="code" href="seafile_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a>) + 1;

    *data_out = (<span class="keywordtype">char</span> *)g_malloc (blks * <a class="code" href="seafile_2lib_2utils_8c.html#a5394435edf20efdffac70b5c362ade81">BLK_SIZE</a>);

    <span class="keywordflow">if</span> (*data_out == NULL) {
        g_warning (<span class="stringliteral">&quot;failed to allocate the output buffer.\n&quot;</span>);
        <span class="keywordflow">goto</span> enc_error;
    }                

    <span class="keywordtype">int</span> update_len, final_len;

    <span class="comment">/* Do the encryption. */</span>
    ret = EVP_EncryptUpdate (&amp;ctx,
                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)*data_out,
                             &amp;update_len,
                             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)data_in,
                             in_len);

    <span class="keywordflow">if</span> (ret == <a class="code" href="seafile_2lib_2utils_8c.html#a22b00c5a64444ba20bedd53f9b0354e4">ENC_FAILURE</a>)
        <span class="keywordflow">goto</span> enc_error;


    <span class="comment">/* Finish the possible partial block. */</span>
    ret = EVP_EncryptFinal_ex (&amp;ctx,
                               (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)*data_out + update_len,
                               &amp;final_len);

    *out_len = update_len + final_len;

    <span class="comment">/* out_len should be equal to the allocated buffer size. */</span>
    <span class="keywordflow">if</span> (ret == <a class="code" href="seafile_2lib_2utils_8c.html#a22b00c5a64444ba20bedd53f9b0354e4">ENC_FAILURE</a> || *out_len != (blks * BLK_SIZE))
        <span class="keywordflow">goto</span> enc_error;
    
    EVP_CIPHER_CTX_cleanup (&amp;ctx);

    <span class="keywordflow">return</span> 0;

enc_error:

    EVP_CIPHER_CTX_cleanup (&amp;ctx);

    *out_len = -1;

    <span class="keywordflow">if</span> (*data_out != NULL)
        g_free (*data_out);

    *data_out = NULL;

    <span class="keywordflow">return</span> -1;   
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad52e8a09737b9afc6375f8cee7336d7d"></a><!-- doxytag: member="utils.c::ccnet_expand_path" ref="ad52e8a09737b9afc6375f8cee7336d7d" args="(const char *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ccnet_2lib_2utils_8h.html#ad52e8a09737b9afc6375f8cee7336d7d">ccnet_expand_path</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00869">869</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">char</span> new_path[<a class="code" href="seafile_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a> + 1];
    <span class="keywordtype">char</span> *p = new_path;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *q = src;

    memset(new_path, 0, <span class="keyword">sizeof</span>(new_path));
    <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;~&#39;</span>) {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *home = g_get_home_dir();
        memcpy(new_path, home, strlen(home));
        p += strlen(new_path);
        q++;
    }
    memcpy(p, q, strlen(q));

    <span class="comment">/* delete the charactor &#39;\&#39; or &#39;/&#39; at the end of the path</span>
<span class="comment">     * because the function stat faied to deal with directory names</span>
<span class="comment">     * with &#39;\&#39; or &#39;/&#39; in the end */</span>
    p = new_path + strlen(new_path) - 1;
    <span class="keywordflow">while</span>(*p == <span class="charliteral">&#39;\\&#39;</span> || *p == <span class="charliteral">&#39;/&#39;</span>) *p-- = <span class="charliteral">&#39;\0&#39;</span>;

    <span class="keywordflow">return</span> strdup (new_path);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *next_in, *ntoken;
    <span class="keywordtype">char</span> new_path[<a class="code" href="seafile_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a> + 1];
    <span class="keywordtype">char</span> *next_out;
    <span class="keywordtype">int</span> len;

   <span class="comment">/* special cases */</span>
    <span class="keywordflow">if</span> (!src || *src == <span class="charliteral">&#39;\0&#39;</span>)
        <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">if</span> (strlen(src) &gt; <a class="code" href="seafile_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>)
        <span class="keywordflow">return</span> NULL;

    next_in = src;
    next_out = new_path;
    *next_out = <span class="charliteral">&#39;\0&#39;</span>;

    <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;~&#39;</span>) {
        <span class="comment">/* handle src start with &#39;~&#39; or &#39;~&lt;user&gt;&#39; like &#39;~plt&#39; */</span>
        <span class="keyword">struct </span>passwd *pw = NULL;

        <span class="keywordflow">for</span> ( ; *next_in != <span class="charliteral">&#39;/&#39;</span> &amp;&amp; *next_in != <span class="charliteral">&#39;\0&#39;</span>; next_in++) ;
        
        len = next_in - src;
        <span class="keywordflow">if</span> (len == 1) {
            pw = getpwuid (geteuid());
        } <span class="keywordflow">else</span> {
            <span class="comment">/* copy &#39;~&lt;user&gt;&#39; to new_path */</span>
            memcpy (new_path, src, len);
            new_path[len] = <span class="charliteral">&#39;\0&#39;</span>;
            pw = getpwnam (new_path + 1);
        }
        <span class="keywordflow">if</span> (pw == NULL)
            <span class="keywordflow">return</span> NULL;
       
        len = strlen (pw-&gt;pw_dir);
        memcpy (new_path, pw-&gt;pw_dir, len);
        next_out = new_path + len;
        *next_out = <span class="charliteral">&#39;\0&#39;</span>;

        <span class="keywordflow">if</span> (*next_in == <span class="charliteral">&#39;\0&#39;</span>)
            <span class="keywordflow">return</span> strdup (new_path);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src != <span class="charliteral">&#39;/&#39;</span>) {
        getcwd (new_path, <a class="code" href="seafile_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>);
        <span class="keywordflow">for</span> ( ; *next_out; next_out++) ; <span class="comment">/* to &#39;\0&#39; */</span>
    }
    
    <span class="keywordflow">while</span> (*next_in != <span class="charliteral">&#39;\0&#39;</span>) {
        <span class="comment">/* move ntoken to the next not &#39;/&#39; char  */</span>
        <span class="keywordflow">for</span> (ntoken = next_in; *ntoken == <span class="charliteral">&#39;/&#39;</span>; ntoken++) ;

        <span class="keywordflow">for</span> (next_in = ntoken; *next_in != <span class="charliteral">&#39;/&#39;</span> 
                 &amp;&amp; *next_in != <span class="charliteral">&#39;\0&#39;</span>; next_in++) ;
 
        len = next_in - ntoken;

        <span class="keywordflow">if</span> (len == 0) {
            <span class="comment">/* the path ends with &#39;/&#39;, keep it */</span>
            *next_out++ = <span class="charliteral">&#39;/&#39;</span>;
            *next_out = <span class="charliteral">&#39;\0&#39;</span>;
            <span class="keywordflow">break</span>;
        }

        <span class="keywordflow">if</span> (len == 2 &amp;&amp; ntoken[0] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; ntoken[1] == <span class="charliteral">&#39;.&#39;</span>) 
        {
            <span class="comment">/* &#39;..&#39; */</span>
            <span class="keywordflow">for</span> (; next_out &gt; new_path &amp;&amp; *next_out != <span class="charliteral">&#39;/&#39;</span>; next_out--)
                ;
            *next_out = <span class="charliteral">&#39;\0&#39;</span>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntoken[0] != <span class="charliteral">&#39;.&#39;</span> || len != 1) {
            <span class="comment">/* not &#39;.&#39; */</span>
            *next_out++ = <span class="charliteral">&#39;/&#39;</span>;
            memcpy (next_out, ntoken, len);
            next_out += len;
            *next_out = <span class="charliteral">&#39;\0&#39;</span>;
        }
    }

    <span class="comment">/* the final special case */</span>
    <span class="keywordflow">if</span> (new_path[0] == <span class="charliteral">&#39;\0&#39;</span>) {
        new_path[0] = <span class="charliteral">&#39;/&#39;</span>;
        new_path[1] = <span class="charliteral">&#39;\0&#39;</span>;
    }
    <span class="keywordflow">return</span> strdup (new_path);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ad52e8a09737b9afc6375f8cee7336d7d_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ad52e8a09737b9afc6375f8cee7336d7d_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ad52e8a09737b9afc6375f8cee7336d7d_icgraph" id="seafile_2lib_2utils_8c_ad52e8a09737b9afc6375f8cee7336d7d_icgraph">
<area shape="rect" id="node3" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="659,47,709,77"/><area shape="rect" id="node5" href="session_8c.html#a2ded42c6195336219f9093d89a2f5ed5" title="ccnet_session_load_config" alt="" coords="189,47,368,77"/><area shape="rect" id="node10" href="ccnet-server_8c.html#a4bc39cfec6e5bdca15a1cfb25c94664a" title="test_ccnet_config" alt="" coords="621,101,747,130"/><area shape="rect" id="node15" href="seafile_2common_2log_8h.html#a942562973108e7e543260d82e7e0fb87" title="seafile_log_init" alt="" coords="225,205,332,234"/><area shape="rect" id="node19" href="ccnet_2net_2common_2log_8h.html#ab65b9e97ea189adabae376668b69e5ab" title="ccnet_log_init" alt="" coords="444,101,545,130"/><area shape="rect" id="node23" href="daemon_2seafile-session_8h.html#a3eea8fbb412edb5ff72027285edb7c72" title="seafile_session_new" alt="" coords="208,258,349,287"/><area shape="rect" id="node7" href="session_8h.html#aa0bbc7572963f31cc6086df26b4ab2b4" title="ccnet_session_prepare" alt="" coords="417,47,572,77"/><area shape="rect" id="node12" href="ccnet-server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="795,101,845,130"/><area shape="rect" id="node17" href="seafile-controller_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="469,205,520,234"/><area shape="rect" id="node25" href="seaf-daemon_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="469,258,520,287"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aae72852955df5bdfc8bb72a36a0f8808"></a><!-- doxytag: member="utils.c::ccnet_key_file_get_string" ref="aae72852955df5bdfc8bb72a36a0f8808" args="(GKeyFile *keyf, const char *category, const char *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gchar* <a class="el" href="ccnet_2lib_2utils_8h.html#aae72852955df5bdfc8bb72a36a0f8808">ccnet_key_file_get_string</a> </td>
          <td>(</td>
          <td class="paramtype">GKeyFile *&#160;</td>
          <td class="paramname"><em>keyf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>category</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>handle the empty string problem. </p>

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01281">1281</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    gchar *v;

    <span class="keywordflow">if</span> (!g_key_file_has_key (keyf, category, key, NULL))
        <span class="keywordflow">return</span> NULL;

    v = g_key_file_get_string (keyf, category, key, NULL);
    <span class="keywordflow">if</span> (v != NULL &amp;&amp; v[0] == <span class="charliteral">&#39;\0&#39;</span>) {
        g_free(v);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> v;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_aae72852955df5bdfc8bb72a36a0f8808_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_aae72852955df5bdfc8bb72a36a0f8808_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_aae72852955df5bdfc8bb72a36a0f8808_icgraph" id="seafile_2lib_2utils_8c_aae72852955df5bdfc8bb72a36a0f8808_icgraph">
<area shape="rect" id="node3" href="session_8c.html#a2ded42c6195336219f9093d89a2f5ed5" title="ccnet_session_load_config" alt="" coords="224,32,403,61"/><area shape="rect" id="node5" href="session_8h.html#aa0bbc7572963f31cc6086df26b4ab2b4" title="ccnet_session_prepare" alt="" coords="452,32,607,61"/><area shape="rect" id="node7" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="693,5,744,35"/><area shape="rect" id="node9" href="ccnet-server_8c.html#a4bc39cfec6e5bdca15a1cfb25c94664a" title="test_ccnet_config" alt="" coords="656,59,781,88"/><area shape="rect" id="node11" href="ccnet-server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="829,59,880,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad05e32bdab25b5e5ba3f36a640b30cc8"></a><!-- doxytag: member="utils.c::ccnet_locale_from_utf8" ref="ad05e32bdab25b5e5ba3f36a640b30cc8" args="(const gchar *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ccnet_2lib_2utils_8h.html#ad05e32bdab25b5e5ba3f36a640b30cc8">ccnet_locale_from_utf8</a> </td>
          <td>(</td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01809">1809</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!src)
        <span class="keywordflow">return</span> NULL;

    gsize bytes_read = 0;
    gsize bytes_written = 0;
    GError *error = NULL;
    gchar *dst = NULL;

    dst = g_locale_from_utf8
        (src,                   <span class="comment">/* locale specific string */</span>
         strlen(src),           <span class="comment">/* len of src */</span>
         &amp;bytes_read,           <span class="comment">/* length processed */</span>
         &amp;bytes_written,        <span class="comment">/* output length */</span>
         &amp;error);

    <span class="keywordflow">if</span> (error) {
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> dst;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a927b2cab4b163cb58c078fb4158f6f82"></a><!-- doxytag: member="utils.c::ccnet_locale_to_utf8" ref="a927b2cab4b163cb58c078fb4158f6f82" args="(const gchar *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ccnet_2lib_2utils_8h.html#a927b2cab4b163cb58c078fb4158f6f82">ccnet_locale_to_utf8</a> </td>
          <td>(</td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01784">1784</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!src)
        <span class="keywordflow">return</span> NULL;

    gsize bytes_read = 0;
    gsize bytes_written = 0;
    GError *error = NULL;
    gchar *dst = NULL;

    dst = g_locale_to_utf8
        (src,                   <span class="comment">/* locale specific string */</span>
         strlen(src),           <span class="comment">/* len of src */</span>
         &amp;bytes_read,           <span class="comment">/* length processed */</span>
         &amp;bytes_written,        <span class="comment">/* output length */</span>
         &amp;error);

    <span class="keywordflow">if</span> (error) {
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> dst;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5241dfe016bb295dddd19c1f8b6f62d4"></a><!-- doxytag: member="utils.c::ccnet_object_type_from_id" ref="a5241dfe016bb295dddd19c1f8b6f62d4" args="(const char *object_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ccnet_2lib_2utils_8h.html#a5241dfe016bb295dddd19c1f8b6f62d4">ccnet_object_type_from_id</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>object_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02191">2191</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *ptr;

    <span class="keywordflow">if</span> ( !(ptr = strchr(object_id, <span class="charliteral">&#39;/&#39;</span>)) )
        <span class="keywordflow">return</span> NULL;

    <span class="keywordflow">return</span> g_strndup(object_id, ptr - object_id);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a5241dfe016bb295dddd19c1f8b6f62d4_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a5241dfe016bb295dddd19c1f8b6f62d4_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a5241dfe016bb295dddd19c1f8b6f62d4_icgraph" id="seafile_2lib_2utils_8c_a5241dfe016bb295dddd19c1f8b6f62d4_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#a6f0fddbdd082aff7f69921a40c2e1be1" title="ccnet_peer_from_string" alt="" coords="256,5,413,35"/><area shape="rect" id="node5" href="net_2common_2peer_8h.html#a6240ef74cbff8b8cf338231bb20e2af9" title="ccnet_peer_update_from_string" alt="" coords="233,59,436,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a75a7a2a1400f4cf5f6cd5ea988e705f4"></a><!-- doxytag: member="utils.c::ccnet_sha1_equal" ref="a75a7a2a1400f4cf5f6cd5ea988e705f4" args="(const void *v1, const void *v2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a75a7a2a1400f4cf5f6cd5ea988e705f4">ccnet_sha1_equal</a> </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01008">1008</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p1 = v1;
    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p2 = v2;
    <span class="keywordtype">int</span> i;

    <span class="keywordflow">for</span> (i = 0; i &lt; 20; i++)
        <span class="keywordflow">if</span> (p1[i] != p2[i])
            <span class="keywordflow">return</span> 0;
    
    <span class="keywordflow">return</span> 1;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a75a7a2a1400f4cf5f6cd5ea988e705f4_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a75a7a2a1400f4cf5f6cd5ea988e705f4_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a75a7a2a1400f4cf5f6cd5ea988e705f4_icgraph" id="seafile_2lib_2utils_8c_a75a7a2a1400f4cf5f6cd5ea988e705f4_icgraph">
<area shape="rect" id="node3" href="diff-simple_8h.html#a3d936e2ea0a740cbdc9bbab7113b3742" title="diff_resolve_renames" alt="" coords="181,85,328,115"/><area shape="rect" id="node5" href="diff-simple_8h.html#a9e9cbe6847c88fc7bca7035f45a0a50e" title="diff_commits" alt="" coords="392,5,488,35"/><area shape="rect" id="node9" href="diff-simple_8h.html#a76134c9482b81d9ff5455eac2765a656" title="diff_commit_roots" alt="" coords="377,112,503,141"/><area shape="rect" id="node13" href="diff-simple_8h.html#a8c800ee63c23c5ff78d838974f678e47" title="diff_merge" alt="" coords="399,59,481,88"/><area shape="rect" id="node16" href="diff-simple_8h.html#aaad6d753f728db61f274e7ce8ec70e97" title="diff_merge_roots" alt="" coords="381,165,499,195"/><area shape="rect" id="node7" href="repo-op_8c.html#ab69fe2104c734bb5d32b025e3f444736" title="seaf_repo_diff" alt="" coords="601,32,705,61"/><area shape="rect" id="node11" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="552,112,755,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac846d436ccbb4031fa7a8d76ceadad07"></a><!-- doxytag: member="utils.c::ccnet_sha1_hash" ref="ac846d436ccbb4031fa7a8d76ceadad07" args="(const void *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="ccnet_2lib_2utils_8h.html#ac7b2f63c70899294f90c31e2213124a5">ccnet_sha1_hash</a> </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00994">994</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">/* 31 bit hash function */</span>
    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = v;
    uint32_t h = 0;
    <span class="keywordtype">int</span> i;

    <span class="keywordflow">for</span> (i = 0; i &lt; 20; i++)
        h = (h &lt;&lt; 5) - h + p[i];

    <span class="keywordflow">return</span> h;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ac846d436ccbb4031fa7a8d76ceadad07_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ac846d436ccbb4031fa7a8d76ceadad07_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ac846d436ccbb4031fa7a8d76ceadad07_icgraph" id="seafile_2lib_2utils_8c_ac846d436ccbb4031fa7a8d76ceadad07_icgraph">
<area shape="rect" id="node3" href="diff-simple_8h.html#a3d936e2ea0a740cbdc9bbab7113b3742" title="diff_resolve_renames" alt="" coords="179,85,325,115"/><area shape="rect" id="node5" href="diff-simple_8h.html#a9e9cbe6847c88fc7bca7035f45a0a50e" title="diff_commits" alt="" coords="389,5,485,35"/><area shape="rect" id="node9" href="diff-simple_8h.html#a76134c9482b81d9ff5455eac2765a656" title="diff_commit_roots" alt="" coords="375,112,500,141"/><area shape="rect" id="node13" href="diff-simple_8h.html#a8c800ee63c23c5ff78d838974f678e47" title="diff_merge" alt="" coords="396,59,479,88"/><area shape="rect" id="node16" href="diff-simple_8h.html#aaad6d753f728db61f274e7ce8ec70e97" title="diff_merge_roots" alt="" coords="379,165,496,195"/><area shape="rect" id="node7" href="repo-op_8c.html#ab69fe2104c734bb5d32b025e3f444736" title="seaf_repo_diff" alt="" coords="599,32,703,61"/><area shape="rect" id="node11" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="549,112,752,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3592ee26a3c344698705b0956a8308a2"></a><!-- doxytag: member="utils.c::ccnet_strlcpy" ref="a3592ee26a3c344698705b0956a8308a2" args="(char *dest, const char *src, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="ccnet_2lib_2utils_8h.html#a3d589cfe89ac99c0557894fafe909892">ccnet_strlcpy</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00112">112</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">size_t</span> ret = strlen(src);

    <span class="keywordflow">if</span> (<a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>) {
        <span class="keywordtype">size_t</span> len = (ret &gt;= <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>) ? <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a> - 1 : ret;
        memcpy(dest, src, len);
        dest[len] = <span class="charliteral">&#39;\0&#39;</span>;
    }
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8972f29db121d2c77a167b5ad4942d94"></a><!-- doxytag: member="utils.c::checkdir" ref="a8972f29db121d2c77a167b5ad4942d94" args="(const char *dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a8972f29db121d2c77a167b5ad4942d94">checkdir</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00126">126</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> st;

<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="comment">/* remove trailing &#39;\\&#39; */</span>
    <span class="keywordtype">char</span> *path = g_strdup(dir);
    <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span> *)path + strlen(path) - 1;
    <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39;\\&#39;</span> || *p == <span class="charliteral">&#39;/&#39;</span>) *p-- = <span class="charliteral">&#39;\0&#39;</span>;
    <span class="keywordflow">if</span> ((<a class="code" href="seafile_2lib_2utils_8c.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a>(dir, &amp;st) &lt; 0) || !S_ISDIR(st.st_mode)) {
        g_free (path);
        <span class="keywordflow">return</span> -1;
    }
    g_free (path);
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ((<a class="code" href="seafile_2lib_2utils_8c.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a>(dir, &amp;st) &lt; 0) || !S_ISDIR(st.st_mode))
        <span class="keywordflow">return</span> -1;
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a8972f29db121d2c77a167b5ad4942d94_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a8972f29db121d2c77a167b5ad4942d94_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a8972f29db121d2c77a167b5ad4942d94_icgraph" id="seafile_2lib_2utils_8c_a8972f29db121d2c77a167b5ad4942d94_icgraph">
<area shape="rect" id="node3" href="session_8c.html#a2ded42c6195336219f9093d89a2f5ed5" title="ccnet_session_load_config" alt="" coords="125,32,304,61"/><area shape="rect" id="node5" href="session_8h.html#aa0bbc7572963f31cc6086df26b4ab2b4" title="ccnet_session_prepare" alt="" coords="353,32,508,61"/><area shape="rect" id="node7" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="595,5,645,35"/><area shape="rect" id="node9" href="ccnet-server_8c.html#a4bc39cfec6e5bdca15a1cfb25c94664a" title="test_ccnet_config" alt="" coords="557,59,683,88"/><area shape="rect" id="node11" href="ccnet-server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="731,59,781,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ace0bdb78b60b2d088517a3e03a448e8b"></a><!-- doxytag: member="utils.c::checkdir_with_mkdir" ref="ace0bdb78b60b2d088517a3e03a448e8b" args="(const char *dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#ac76d93d4c338c30fe27f11e3dbe59c2d">checkdir_with_mkdir</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00149">149</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">int</span> ret;
    <span class="keywordtype">char</span> *path = g_strdup(dir);
    <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span> *)path + strlen(path) - 1;
    <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39;\\&#39;</span> || *p == <span class="charliteral">&#39;/&#39;</span>) *p-- = <span class="charliteral">&#39;\0&#39;</span>;
    ret = g_mkdir_with_parents(path, 0755);
    g_free (path);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> g_mkdir_with_parents(dir, 0755);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ace0bdb78b60b2d088517a3e03a448e8b_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ace0bdb78b60b2d088517a3e03a448e8b_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ace0bdb78b60b2d088517a3e03a448e8b_icgraph" id="seafile_2lib_2utils_8c_ace0bdb78b60b2d088517a3e03a448e8b_icgraph">
<area shape="rect" id="node3" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="520,5,571,35"/><area shape="rect" id="node5" href="peer-mgr_8c.html#a8e97cdfdfddc1e174d37fc788e8bdd49" title="ccnet_peer_manager_load_peerdb" alt="" coords="196,49,415,79"/><area shape="rect" id="node7" href="session_8h.html#aa0bbc7572963f31cc6086df26b4ab2b4" title="ccnet_session_prepare" alt="" coords="228,103,383,132"/><area shape="rect" id="node14" href="server_2repo-mgr_8h.html#a8dab773e289d1148e7afec7c8614278a" title="seaf_repo_manager_init" alt="" coords="225,156,385,185"/><area shape="rect" id="node25" href="daemon_2seafile-session_8h.html#a3eea8fbb412edb5ff72027285edb7c72" title="seafile_session_new" alt="" coords="475,256,616,285"/><area shape="rect" id="node28" href="ccnet_2lib_2utils_8h.html#a332e0543b63f5b18d4fa81eaf09922fc" title="objstore_mkdir" alt="" coords="252,260,359,289"/><area shape="rect" id="node10" href="ccnet-server_8c.html#a4bc39cfec6e5bdca15a1cfb25c94664a" title="test_ccnet_config" alt="" coords="483,72,608,101"/><area shape="rect" id="node12" href="ccnet-server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="675,72,725,101"/><area shape="rect" id="node16" href="daemon_2seafile-session_8h.html#abe136340477380edec6a5deba0ff8e1a" title="seafile_session_prepare" alt="" coords="464,203,627,232"/><area shape="rect" id="node20" href="server_2seafile-session_8h.html#a5dbc4cb373997a756130cfe875b86ce6" title="seafile_session_init" alt="" coords="477,149,613,179"/><area shape="rect" id="node18" href="seaf-daemon_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="675,229,725,259"/><area shape="rect" id="node23" href="seaf-fuse_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="675,149,725,179"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae476843508927222a51125ac1c7fec2b"></a><!-- doxytag: member="utils.c::clean_utf8_data" ref="ae476843508927222a51125ac1c7fec2b" args="(char *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="seafile_2lib_2utils_8h.html#ae476843508927222a51125ac1c7fec2b">clean_utf8_data</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02348">2348</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> *s, *e;
    <span class="keywordtype">char</span> *p;
    gboolean is_valid;

    s = data;
    p = data;

    <span class="keywordflow">while</span> ((s - data) != len) {
        is_valid = g_utf8_validate (s, len - (s - data), &amp;e);
        <span class="keywordflow">if</span> (is_valid)
            <span class="keywordflow">break</span>;

        <span class="keywordflow">if</span> (s != e)
            p += (e - s);
        *p = <span class="charliteral">&#39;?&#39;</span>;
        ++p;
        s = e + 1;
    }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ae476843508927222a51125ac1c7fec2b_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ae476843508927222a51125ac1c7fec2b_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ae476843508927222a51125ac1c7fec2b_icgraph" id="seafile_2lib_2utils_8c_ae476843508927222a51125ac1c7fec2b_icgraph">
<area shape="rect" id="node3" href="commit-mgr_8h.html#a0196928fedb5cb3f688894863dfc1f53" title="seaf_commit_from_data" alt="" coords="168,5,331,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8e7da7ad650a6da09c1f679479335ed1"></a><!-- doxytag: member="utils.c::copy_fd" ref="a8e7da7ad650a6da09c1f679479335ed1" args="(int ifd, int ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a8e7da7ad650a6da09c1f679479335ed1">copy_fd</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ifd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ofd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00825">825</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">while</span> (1) {
        <span class="keywordtype">char</span> <a class="code" href="structbuffer.html">buffer</a>[8192];
        ssize_t len = <a class="code" href="seafile_2lib_2utils_8c.html#a05f0eae648599d413d03103758473e30">readn</a> (ifd, buffer, <span class="keyword">sizeof</span>(buffer));
        <span class="keywordflow">if</span> (!len)
            <span class="keywordflow">break</span>;
        <span class="keywordflow">if</span> (len &lt; 0) {
            close (ifd);
            <span class="keywordflow">return</span> -1;
        }
        <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#a6a9988632dc9e05f10a71688fd280cc9">writen</a> (ofd, buffer, len) &lt; 0) {
            close (ofd);
            <span class="keywordflow">return</span> -1;
        }
    }
    close(ifd);
    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a8e7da7ad650a6da09c1f679479335ed1_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a8e7da7ad650a6da09c1f679479335ed1_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a8e7da7ad650a6da09c1f679479335ed1_icgraph" id="seafile_2lib_2utils_8c_a8e7da7ad650a6da09c1f679479335ed1_icgraph">
<area shape="rect" id="node3" href="ccnet_2lib_2utils_8h.html#a9f585ff92128cbf174ef4b3a9b429d08" title="copy_file" alt="" coords="123,5,197,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9f585ff92128cbf174ef4b3a9b429d08"></a><!-- doxytag: member="utils.c::copy_file" ref="a9f585ff92128cbf174ef4b3a9b429d08" args="(const char *dst, const char *src, int mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a9f585ff92128cbf174ef4b3a9b429d08">copy_file</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00845">845</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> fdi, fdo, <a class="code" href="block-tx-utils_8h.html#a2aaa5f99cdedb08950d78469e9e64edc">status</a>;

    <span class="keywordflow">if</span> ((fdi = g_open (src, O_RDONLY | O_BINARY, 0)) &lt; 0)
        <span class="keywordflow">return</span> fdi;

    fdo = g_open (dst, O_WRONLY | O_CREAT | O_EXCL | O_BINARY, <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>);
    <span class="keywordflow">if</span> (fdo &lt; 0 &amp;&amp; errno == EEXIST) {
        close (fdi);
        <span class="keywordflow">return</span> 0;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fdo &lt; 0){
        close (fdi);
        <span class="keywordflow">return</span> -1;
    }

    status = <a class="code" href="seafile_2lib_2utils_8c.html#a8e7da7ad650a6da09c1f679479335ed1">copy_fd</a> (fdi, fdo);
    <span class="keywordflow">if</span> (close (fdo) != 0)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">return</span> <a class="code" href="block-tx-utils_8h.html#a2aaa5f99cdedb08950d78469e9e64edc">status</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af64020f0be33abde6a2a076ff9808809"></a><!-- doxytag: member="utils.c::gen_uuid" ref="af64020f0be33abde6a2a076ff9808809" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ccnet_2lib_2utils_8h.html#af64020f0be33abde6a2a076ff9808809">gen_uuid</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01023">1023</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *uuid_str = g_malloc (37);
    uuid_t uuid;

    uuid_generate (uuid);
    uuid_unparse_lower (uuid, uuid_str);

    <span class="keywordflow">return</span> uuid_str;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_af64020f0be33abde6a2a076ff9808809_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_af64020f0be33abde6a2a076ff9808809_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_af64020f0be33abde6a2a076ff9808809_icgraph" id="seafile_2lib_2utils_8c_af64020f0be33abde6a2a076ff9808809_icgraph">
<area shape="rect" id="node3" href="daemon_2repo-mgr_8h.html#ab599ba29e40bdb918ac78060d1165c2d" title="seaf_repo_manager_create_new_repo" alt="" coords="137,5,380,35"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8h.html#afebb8831a3f9be12c5612c5707118d3b" title="seaf_repo_manager_generate_tmp_token" alt="" coords="128,59,389,88"/><area shape="rect" id="node7" href="share-info_8h.html#a758b18fa15a2447301c183163e9b66df" title="seaf_share_info_new" alt="" coords="187,112,331,141"/><area shape="rect" id="node11" href="copy-mgr_8h.html#ae731d17024807023ab2689f9ffca5e99" title="seaf_copy_manager_add_task" alt="" coords="160,165,357,195"/><area shape="rect" id="node17" href="listen-mgr_8h.html#a1bab146578319d15c8a24e74593f1245" title="seaf_listen_manager_generate_token" alt="" coords="140,219,377,248"/><area shape="rect" id="node19" href="virtual-repo_8c.html#a9a8dcda29ee6cd28d92c1897ad12f268" title="seaf_repo_manager_create_virtual_repo" alt="" coords="132,272,385,301"/><area shape="rect" id="node9" href="share-info_8h.html#a03ddc76ea7aafe0dd11489579cbb384e" title="seaf_share_info_from_json" alt="" coords="448,112,627,141"/><area shape="rect" id="node13" href="repo-op_8c.html#a88f5fdc80a71e558b5508387eafbb6de" title="seaf_repo_manager_copy_file" alt="" coords="440,165,635,195"/><area shape="rect" id="node15" href="repo-op_8c.html#ac11bd852cc7cc4f30e40123b7bae901e" title="seaf_repo_manager_move_file" alt="" coords="439,219,636,248"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab141c69bb8e435339193ac2062007c7c"></a><!-- doxytag: member="utils.c::gen_uuid_inplace" ref="ab141c69bb8e435339193ac2062007c7c" args="(char *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#ab141c69bb8e435339193ac2062007c7c">gen_uuid_inplace</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01034">1034</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    uuid_t uuid;

    uuid_generate (uuid);
    uuid_unparse_lower (uuid, buf);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6a676d54675053cd9d9afefabd10a454"></a><!-- doxytag: member="utils.c::get_current_time" ref="a6a676d54675053cd9d9afefabd10a454" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="ccnet_2lib_2utils_8h.html#a6a676d54675053cd9d9afefabd10a454">get_current_time</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01468">1468</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GTimeVal tv;
    gint64 t;

    g_get_current_time (&amp;tv);
    t = tv.tv_sec * (gint64)1000000 + tv.tv_usec;
    <span class="keywordflow">return</span> t;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a6a676d54675053cd9d9afefabd10a454_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a6a676d54675053cd9d9afefabd10a454_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a6a676d54675053cd9d9afefabd10a454_icgraph" id="seafile_2lib_2utils_8c_a6a676d54675053cd9d9afefabd10a454_icgraph">
<area shape="rect" id="node3" href="org-mgr_8h.html#a89846be9f97b47dc48d78843fd91cc00" title="ccnet_org_manager_create_org" alt="" coords="189,5,392,35"/><area shape="rect" id="node5" href="user-mgr_8h.html#ad4eaeff41e5c24da6a49177840e533c1" title="ccnet_user_manager_add_emailuser" alt="" coords="173,59,408,88"/><area shape="rect" id="node7" href="share-info_8h.html#a758b18fa15a2447301c183163e9b66df" title="seaf_share_info_new" alt="" coords="219,112,363,141"/><area shape="rect" id="node9" href="share-info_8h.html#a03ddc76ea7aafe0dd11489579cbb384e" title="seaf_share_info_from_json" alt="" coords="456,112,635,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a130e83c1ad29d78ef1a5b6baef1754d5"></a><!-- doxytag: member="utils.c::hex_to_rawdata" ref="a130e83c1ad29d78ef1a5b6baef1754d5" args="(const char *hex_str, unsigned char *rawdata, int n_bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a130e83c1ad29d78ef1a5b6baef1754d5">hex_to_rawdata</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hex_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>rawdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00098">98</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span> (i = 0; i &lt; n_bytes; i++) {
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val = (hexval(hex_str[0]) &lt;&lt; 4) | hexval(hex_str[1]);
        <span class="keywordflow">if</span> (val &amp; ~0xff)
            <span class="keywordflow">return</span> -1;
        *rawdata++ = val;
        hex_str += 2;
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a130e83c1ad29d78ef1a5b6baef1754d5_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a130e83c1ad29d78ef1a5b6baef1754d5_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a130e83c1ad29d78ef1a5b6baef1754d5_icgraph" id="seafile_2lib_2utils_8c_a130e83c1ad29d78ef1a5b6baef1754d5_icgraph">
<area shape="rect" id="node3" href="diff-simple_8c.html#a2e22075ff8e2cf56f7fed2864e412d58" title="diff_entry_new_from_dirent" alt="" coords="179,112,357,141"/><area shape="rect" id="node5" href="seaf-tree-walk_8h.html#a7d985aeab97fb8c4c5fecaede41fcc29" title="traverse_trees" alt="" coords="216,165,320,195"/><area shape="rect" id="node23" href="seafile-crypt_8h.html#af0dc7b06b352baa5469b21beec40f73a" title="seafile_decrypt_repo_enc_key" alt="" coords="169,272,367,301"/><area shape="rect" id="node33" href="seafile-crypt_8h.html#ae088f5ba8cee3dc96073da2bd1d1f65f" title="seafile_update_random_key" alt="" coords="176,379,360,408"/><area shape="rect" id="node35" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="219,325,317,355"/><area shape="rect" id="node38" href="vc-utils_8h.html#a40a8e3a1dc14697c58656246b3fa9ca0" title="commit_trees_cb" alt="" coords="207,219,329,248"/><area shape="rect" id="node7" href="unpack-trees_8h.html#a1a4c235391bb5c3b6448a70e627a5101" title="unpack_trees" alt="" coords="489,59,588,88"/><area shape="rect" id="node9" href="diff-simple_8h.html#a61fa5d287ecd1508b220a422b250d676" title="diff_index" alt="" coords="765,5,843,35"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="709,59,899,88"/><area shape="rect" id="node11" href="status_8h.html#a5aaef0b3a73d20b9f422c9d39f0a2325" title="wt_status_collect_changes_index" alt="" coords="947,5,1165,35"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a461e72948bba5928329e269ad395e293" title="seaf_repo_is_worktree_changed" alt="" coords="1215,5,1423,35"/><area shape="rect" id="node17" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="997,59,1115,88"/><area shape="rect" id="node21" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="987,112,1125,141"/><area shape="rect" id="node19" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="1257,59,1380,88"/><area shape="rect" id="node25" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="436,219,641,248"/><area shape="rect" id="node27" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="437,379,640,408"/><area shape="rect" id="node29" href="daemon_2repo-mgr_8h.html#a683d25df06076d282da2f7ae01e05a49" title="seaf_repo_manager_set_repo_passwd" alt="" coords="416,272,661,301"/><area shape="rect" id="node31" href="passwd-mgr_8h.html#a423fa6bdd74869a9d46a706ecd7790da" title="seaf_passwd_manager_set_passwd" alt="" coords="423,325,655,355"/><area shape="rect" id="node40" href="merge-recursive_8h.html#a5ece2c4c0b1acc045660424d1fb74f36" title="write_tree_from_memory" alt="" coords="456,112,621,141"/><area shape="rect" id="node45" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="456,165,621,195"/><area shape="rect" id="node42" href="merge-recursive_8h.html#ac5c545b083f8e950f4e13cb31b4a74d1" title="merge_recursive" alt="" coords="745,112,863,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acdce1d46efd09e8485a2f682b388ebc0"></a><!-- doxytag: member="utils.c::inet_pton" ref="acdce1d46efd09e8485a2f682b388ebc0" args="(int af, const char *src, void *dst)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8c.html#acdce1d46efd09e8485a2f682b388ebc0">inet_pton</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>af</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a09a30b5d69ebee42a4f001cdf857d83a"></a><!-- doxytag: member="utils.c::is_ipaddr_valid" ref="a09a30b5d69ebee42a4f001cdf857d83a" args="(const char *ip)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="ccnet_2lib_2utils_8h.html#add6d17882e0d7270ec07dd51151f2b9a">is_ipaddr_valid</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ip</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01203">1203</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[<span class="keyword">sizeof</span>(<span class="keyword">struct </span>in6_addr)];

    <span class="keywordflow">if</span> (evutil_inet_pton(AF_INET, ip, buf) == 1)
        <span class="keywordflow">return</span> TRUE;

    <span class="keywordflow">if</span> (evutil_inet_pton(AF_INET6, ip, buf) == 1)
        <span class="keywordflow">return</span> TRUE;
    
    <span class="keywordflow">return</span> FALSE;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a48ecdc72b727191abafbbf2ec1f70ace"></a><!-- doxytag: member="utils.c::is_uuid_valid" ref="a48ecdc72b727191abafbbf2ec1f70ace" args="(const char *uuid_str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="ccnet_2lib_2utils_8h.html#a48ecdc72b727191abafbbf2ec1f70ace">is_uuid_valid</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uuid_str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01043">1043</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    uuid_t uuid;

    <span class="keywordflow">if</span> (uuid_parse (uuid_str, uuid) &lt; 0)
        <span class="keywordflow">return</span> FALSE;
    <span class="keywordflow">return</span> TRUE;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a48ecdc72b727191abafbbf2ec1f70ace_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a48ecdc72b727191abafbbf2ec1f70ace_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a48ecdc72b727191abafbbf2ec1f70ace_icgraph" id="seafile_2lib_2utils_8c_a48ecdc72b727191abafbbf2ec1f70ace_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#acd2313411e6837feaa74fa6185524c7c" title="seafile_branch_gets" alt="" coords="207,5,345,35"/><area shape="rect" id="node5" href="seafile_2common_2rpc-service_8c.html#a37949d30db3977c8fbb573881173987b" title="seafile_get_repo" alt="" coords="217,59,335,88"/><area shape="rect" id="node7" href="seafile_2common_2rpc-service_8c.html#a5594de7f321b08c515c465bc44e25c60" title="seafile_get_commit_list" alt="" coords="197,112,355,141"/><area shape="rect" id="node11" href="seafile_2common_2rpc-service_8c.html#a3743ba1324330f8ef0cb9a5c33a52e92" title="seafile_destroy_repo" alt="" coords="205,165,347,195"/><area shape="rect" id="node13" href="server_2repo-mgr_8h.html#a35ce9f51287bbd5f961c261516c1c5f0" title="is_repo_id_valid" alt="" coords="219,219,333,248"/><area shape="rect" id="node15" href="server_2repo-mgr_8h.html#ad9feaba8f2f873b6685560fd86f4c40d" title="seaf_repo_manager_create_enc_repo" alt="" coords="157,272,395,301"/><area shape="rect" id="node17" href="repo-perm_8c.html#adcbb183301f879ab82eea84aaf8d88b6" title="seaf_repo_manager_list_dir_with_perm" alt="" coords="152,325,400,355"/><area shape="rect" id="node9" href="rpc-deprecated_8c.html#a374cf49b787fef8fc91266c87cc15375" title="seafile_get_commit_list_pub" alt="" coords="448,112,635,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a36802b9b311cdc4cd847b79c4ddd5903"></a><!-- doxytag: member="utils.c::json_object_get_int_member" ref="a36802b9b311cdc4cd847b79c4ddd5903" args="(json_t *object, const char *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="seafile_2lib_2utils_8h.html#a36802b9b311cdc4cd847b79c4ddd5903">json_object_get_int_member</a> </td>
          <td>(</td>
          <td class="paramtype">json_t *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02329">2329</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    json_t *integer = json_object_get (<span class="keywordtype">object</span>, key);
    <span class="keywordflow">return</span> json_integer_value (integer);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a36802b9b311cdc4cd847b79c4ddd5903_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a36802b9b311cdc4cd847b79c4ddd5903_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a36802b9b311cdc4cd847b79c4ddd5903_icgraph" id="seafile_2lib_2utils_8c_a36802b9b311cdc4cd847b79c4ddd5903_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8c.html#ac58f859abeba94b69e2db803dc5a6cdc" title="fs_object_from_json" alt="" coords="263,5,401,35"/><area shape="rect" id="node7" href="share-info_8h.html#a03ddc76ea7aafe0dd11489579cbb384e" title="seaf_share_info_from_json" alt="" coords="243,59,421,88"/><area shape="rect" id="node5" href="fs-mgr_8h.html#a63cf6fa9de3b33361dd2bbdc5c5ac95d" title="seaf_fs_object_from_data" alt="" coords="471,5,641,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a50be04624e628ad19aa88d9fc0fd5a28"></a><!-- doxytag: member="utils.c::json_object_get_string_member" ref="a50be04624e628ad19aa88d9fc0fd5a28" args="(json_t *object, const char *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="seafile_2lib_2utils_8h.html#a50be04624e628ad19aa88d9fc0fd5a28">json_object_get_string_member</a> </td>
          <td>(</td>
          <td class="paramtype">json_t *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02314">2314</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    json_t *<span class="keywordtype">string</span> = json_object_get (<span class="keywordtype">object</span>, key);
    <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>)
        <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">return</span> json_string_value (<span class="keywordtype">string</span>);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a50be04624e628ad19aa88d9fc0fd5a28_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a50be04624e628ad19aa88d9fc0fd5a28_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a50be04624e628ad19aa88d9fc0fd5a28_icgraph" id="seafile_2lib_2utils_8c_a50be04624e628ad19aa88d9fc0fd5a28_icgraph">
<area shape="rect" id="node3" href="share-info_8h.html#a03ddc76ea7aafe0dd11489579cbb384e" title="seaf_share_info_from_json" alt="" coords="261,5,440,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af3fcfc36aa8248b0c8932e5c3e51f3fc"></a><!-- doxytag: member="utils.c::json_object_has_member" ref="af3fcfc36aa8248b0c8932e5c3e51f3fc" args="(json_t *object, const char *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="seafile_2lib_2utils_8h.html#af3fcfc36aa8248b0c8932e5c3e51f3fc">json_object_has_member</a> </td>
          <td>(</td>
          <td class="paramtype">json_t *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02323">2323</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (json_object_get (<span class="keywordtype">object</span>, key) != NULL);
}
</pre></div>
</div>
</div>
<a class="anchor" id="abfac2ec06b36f64de2f110f093e6dfc0"></a><!-- doxytag: member="utils.c::json_object_set_int_member" ref="abfac2ec06b36f64de2f110f093e6dfc0" args="(json_t *object, const char *key, gint64 value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="seafile_2lib_2utils_8h.html#abfac2ec06b36f64de2f110f093e6dfc0">json_object_set_int_member</a> </td>
          <td>(</td>
          <td class="paramtype">json_t *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02342">2342</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    json_object_set_new (<span class="keywordtype">object</span>, key, json_integer (value));
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_abfac2ec06b36f64de2f110f093e6dfc0_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_abfac2ec06b36f64de2f110f093e6dfc0_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_abfac2ec06b36f64de2f110f093e6dfc0_icgraph" id="seafile_2lib_2utils_8c_abfac2ec06b36f64de2f110f093e6dfc0_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#aa100826c1ee3596157d1df52d15c747f" title="seaf_fs_manager_calculate_seafile_id_json" alt="" coords="243,5,517,35"/><area shape="rect" id="node5" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf" title="compare_file_content" alt="" coords="565,5,712,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="760,5,859,35"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="907,5,1109,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a178267416f18a24c6d717db8ad91c471"></a><!-- doxytag: member="utils.c::json_object_set_string_member" ref="a178267416f18a24c6d717db8ad91c471" args="(json_t *object, const char *key, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="seafile_2lib_2utils_8h.html#a178267416f18a24c6d717db8ad91c471">json_object_set_string_member</a> </td>
          <td>(</td>
          <td class="paramtype">json_t *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02336">2336</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    json_object_set_new (<span class="keywordtype">object</span>, key, json_string (value));
}
</pre></div>
</div>
</div>
<a class="anchor" id="acc99dd2106bfcedb4fef8a2f1ecd1b8a"></a><!-- doxytag: member="utils.c::ncopy_string_array" ref="acc99dd2106bfcedb4fef8a2f1ecd1b8a" args="(char **orig, int n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** <a class="el" href="ccnet_2lib_2utils_8h.html#acc99dd2106bfcedb4fef8a2f1ecd1b8a">ncopy_string_array</a> </td>
          <td>(</td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01447">1447</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> **ret = g_malloc (<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *) * n);
    <span class="keywordtype">int</span> i = 0;

    <span class="keywordflow">for</span> (; i &lt; n; i++)
        ret[i] = g_strdup(orig[i]);
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4934aa80d54625fa9d2505f13117f4a0"></a><!-- doxytag: member="utils.c::nfree_string_array" ref="a4934aa80d54625fa9d2505f13117f4a0" args="(char **array, int n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#a4934aa80d54625fa9d2505f13117f4a0">nfree_string_array</a> </td>
          <td>(</td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01458">1458</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> i = 0;

    <span class="keywordflow">for</span> (; i &lt; n; i++)
        g_free (array[i]);
    g_free (array);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac8e393e1fd0d1d9d0057ebd24a561c1b"></a><!-- doxytag: member="utils.c::objstore_get_path" ref="ac8e393e1fd0d1d9d0057ebd24a561c1b" args="(char *path, const char *base, const char *obj_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#ac8e393e1fd0d1d9d0057ebd24a561c1b">objstore_get_path</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>obj_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00192">192</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> len;

    len = strlen(base);
    memcpy(path, base, len);
    path[len] = G_DIR_SEPARATOR;
    path[len+1] = <a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>[0];
    path[len+2] = <a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>[1];
    path[len+3] = G_DIR_SEPARATOR;
    strcpy(path+len+4, <a class="code" href="http-server_8c.html#acdc8b2e33d61c23557d7e7563f00ef6f">obj_id</a>+2);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a332e0543b63f5b18d4fa81eaf09922fc"></a><!-- doxytag: member="utils.c::objstore_mkdir" ref="a332e0543b63f5b18d4fa81eaf09922fc" args="(const char *base)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="ccnet_2lib_2utils_8h.html#a332e0543b63f5b18d4fa81eaf09922fc">objstore_mkdir</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>base</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Make directory with 256 sub-directories from '00' to 'ff'. `base` and subdir will be created if they are not existing. </p>

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00165">165</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> ret;
    <span class="keywordtype">int</span> i, j, len;
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> hex[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;
    <span class="keywordtype">char</span> subdir[<a class="code" href="seafile_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>];

    <span class="keywordflow">if</span> ( (ret = <a class="code" href="seafile_2lib_2utils_8c.html#ace0bdb78b60b2d088517a3e03a448e8b">checkdir_with_mkdir</a>(base)) &lt; 0)
        <span class="keywordflow">return</span> ret;

    len = strlen(base);
    memcpy(subdir, base, len);
    subdir[len] = G_DIR_SEPARATOR;
    subdir[len+3] = <span class="charliteral">&#39;\0&#39;</span>;

    <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
        subdir[len+1] = hex[i];
        <span class="keywordflow">for</span> (j = 0; j &lt; 16; j++) {
            subdir[len+2] = hex[j];
            <span class="keywordflow">if</span> ( (ret = <a class="code" href="seafile_2lib_2utils_8c.html#ace0bdb78b60b2d088517a3e03a448e8b">checkdir_with_mkdir</a>(subdir)) &lt; 0)
                <span class="keywordflow">return</span> ret;
        }
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3e3be562436695c4865957e2790b1da8"></a><!-- doxytag: member="utils.c::parse_key_value_pairs" ref="a3e3be562436695c4865957e2790b1da8" args="(char *string, KeyValueFunc func, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#a3e3be562436695c4865957e2790b1da8">parse_key_value_pairs</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ccnet_2lib_2utils_8h.html#a4bc6467da0bdec670824a164c007e1a8">KeyValueFunc</a>&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01216">1216</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *line = string, *next, *space;
    <span class="keywordtype">char</span> *key, *value;

    <span class="keywordflow">while</span> (*line) {
        <span class="comment">/* handle empty line */</span>
        <span class="keywordflow">if</span> (*line == <span class="charliteral">&#39;\n&#39;</span>) {
            ++line;
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">for</span> (next = line; *next != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; *next; ++next) ;
        *next = <span class="charliteral">&#39;\0&#39;</span>;
        
        <span class="keywordflow">for</span> (space = line; space &lt; next &amp;&amp; *space != <span class="charliteral">&#39; &#39;</span>; ++space) ;
        <span class="keywordflow">if</span> (*space != <span class="charliteral">&#39; &#39;</span>) {
            g_warning (<span class="stringliteral">&quot;Bad key value format: %s\n&quot;</span>, line);
            <span class="keywordflow">return</span>;
        }
        *space = <span class="charliteral">&#39;\0&#39;</span>;
        key = line;
        value = space + 1;
        
        func (data, key, value);

        line = next + 1;
    }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a3e3be562436695c4865957e2790b1da8_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a3e3be562436695c4865957e2790b1da8_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a3e3be562436695c4865957e2790b1da8_icgraph" id="seafile_2lib_2utils_8c_a3e3be562436695c4865957e2790b1da8_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#a6f0fddbdd082aff7f69921a40c2e1be1" title="ccnet_peer_from_string" alt="" coords="232,5,389,35"/><area shape="rect" id="node5" href="net_2common_2peer_8h.html#a6240ef74cbff8b8cf338231bb20e2af9" title="ccnet_peer_update_from_string" alt="" coords="209,59,412,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2d7d7513a3e6fb072e6ce9b630097634"></a><!-- doxytag: member="utils.c::parse_key_value_pairs2" ref="a2d7d7513a3e6fb072e6ce9b630097634" args="(char *string, KeyValueFunc2 func, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#a2d7d7513a3e6fb072e6ce9b630097634">parse_key_value_pairs2</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ccnet_2lib_2utils_8h.html#ab8819219965036f1df6aad17bd9503c7">KeyValueFunc2</a>&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01246">1246</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *line = string, *next, *space;
    <span class="keywordtype">char</span> *key, *value;

    <span class="keywordflow">while</span> (*line) {
        <span class="comment">/* handle empty line */</span>
        <span class="keywordflow">if</span> (*line == <span class="charliteral">&#39;\n&#39;</span>) {
            ++line;
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">for</span> (next = line; *next != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; *next; ++next) ;
        *next = <span class="charliteral">&#39;\0&#39;</span>;
        
        <span class="keywordflow">for</span> (space = line; space &lt; next &amp;&amp; *space != <span class="charliteral">&#39; &#39;</span>; ++space) ;
        <span class="keywordflow">if</span> (*space != <span class="charliteral">&#39; &#39;</span>) {
            g_warning (<span class="stringliteral">&quot;Bad key value format: %s\n&quot;</span>, line);
            <span class="keywordflow">return</span>;
        }
        *space = <span class="charliteral">&#39;\0&#39;</span>;
        key = line;
        value = space + 1;
        
        <span class="keywordflow">if</span> (func(data, key, value) == FALSE)
            <span class="keywordflow">break</span>;

        line = next + 1;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae947b53110fc0132e83445d76ddded09"></a><!-- doxytag: member="utils.c::rawdata_to_hex" ref="ae947b53110fc0132e83445d76ddded09" args="(const unsigned char *rawdata, char *hex_str, int n_bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>rawdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>hex_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00073">73</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> hex[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;
    <span class="keywordtype">int</span> i;

    <span class="keywordflow">for</span> (i = 0; i &lt; n_bytes; i++) {
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val = *rawdata++;
        *hex_str++ = hex[val &gt;&gt; 4];
        *hex_str++ = hex[val &amp; 0xf];
    }
    *hex_str = <span class="charliteral">&#39;\0&#39;</span>;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ae947b53110fc0132e83445d76ddded09_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ae947b53110fc0132e83445d76ddded09_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ae947b53110fc0132e83445d76ddded09_icgraph" id="seafile_2lib_2utils_8c_ae947b53110fc0132e83445d76ddded09_icgraph">
<area shape="rect" id="node3" href="block-mgr_8h.html#a0ec54657788d1f88bf71de748e255117" title="seaf_block_manager_verify_block" alt="" coords="196,5,415,35"/><area shape="rect" id="node5" href="fs-mgr_8h.html#aa100826c1ee3596157d1df52d15c747f" title="seaf_fs_manager_calculate_seafile_id_json" alt="" coords="168,109,443,139"/><area shape="rect" id="node7" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf" title="compare_file_content" alt="" coords="549,109,696,139"/><area shape="rect" id="node11" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="973,84,1176,113"/><area shape="rect" id="node13" href="seafile-crypt_8h.html#ae58dda89366c1a52a611cee06b487f89" title="seafile_generate_random_key" alt="" coords="208,267,403,296"/><area shape="rect" id="node17" href="seafile-crypt_8h.html#a4f67d65d3f21019477c1a0d8d7ec2477" title="seafile_generate_magic" alt="" coords="227,213,384,243"/><area shape="rect" id="node20" href="seafile-crypt_8h.html#a9ada7f42f1f31b91dabdc5edde6b73f9" title="seafile_verify_repo_passwd" alt="" coords="215,320,396,349"/><area shape="rect" id="node34" href="seafile-crypt_8h.html#ae088f5ba8cee3dc96073da2bd1d1f65f" title="seafile_update_random_key" alt="" coords="213,373,397,403"/><area shape="rect" id="node36" href="merge-recursive_8h.html#a5ece2c4c0b1acc045660424d1fb74f36" title="write_tree_from_memory" alt="" coords="540,429,705,459"/><area shape="rect" id="node40" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="520,536,725,565"/><area shape="rect" id="node43" href="vc-utils_8h.html#a40a8e3a1dc14697c58656246b3fa9ca0" title="commit_trees_cb" alt="" coords="244,477,367,507"/><area shape="rect" id="node50" href="vc-utils_8h.html#a7564d102761a05b137c2b06fa5e1f004" title="fill_seafile_blocks" alt="" coords="243,581,368,611"/><area shape="rect" id="node54" href="passwd-mgr_8h.html#a5323232760f993b4dec1007878840f4e" title="seaf_passwd_manager_get_decrypt_key" alt="" coords="176,635,435,664"/><area shape="rect" id="node56" href="repo-op_8c.html#a3128bd2930667427a22976b6a2b85743" title="seaf_repo_manager_post_file" alt="" coords="209,688,401,717"/><area shape="rect" id="node58" href="repo-op_8c.html#ae7346d14d7ad21fef1537bf44b50273e" title="seaf_repo_manager_post_multi_files" alt="" coords="188,741,423,771"/><area shape="rect" id="node60" href="repo-op_8c.html#a0d6750947e09a7c4f4eb2146147e9db1" title="seaf_repo_manager_post_file_blocks" alt="" coords="187,795,424,824"/><area shape="rect" id="node62" href="repo-op_8c.html#a46c094895964e060809372262c9b9923" title="seaf_repo_manager_put_file" alt="" coords="213,848,397,877"/><area shape="rect" id="node64" href="repo-op_8c.html#aad15cfaf3210b47e9f59a481073aafbc" title="seaf_repo_manager_put_file_blocks" alt="" coords="191,901,420,931"/><area shape="rect" id="node66" href="test-cdc_8c.html#aebdecdd203848c5fb276ddec1afc0e4e" title="test_chunks" alt="" coords="259,1008,352,1037"/><area shape="rect" id="node70" href="test-cdc_8c.html#ad995eab326a2bf9742eafc8d5ef5d97a" title="test_write_chunk" alt="" coords="245,955,365,984"/><area shape="rect" id="node73" href="test-index_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="280,1061,331,1091"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="815,109,913,139"/><area shape="rect" id="node15" href="server_2repo-mgr_8h.html#a3706de93ba77e5068dba6a1dd073a0fd" title="seaf_repo_manager_create_new_repo" alt="" coords="501,163,744,192"/><area shape="rect" id="node22" href="clone-mgr_8h.html#a6b3ef937f8308db69c87bb650cb42fe9" title="seaf_clone_manager_add_task" alt="" coords="521,216,724,245"/><area shape="rect" id="node26" href="clone-mgr_8h.html#ab6b5a2b4f13b382b9c7034131fa92783" title="seaf_clone_manager_add_download_task" alt="" coords="491,269,755,299"/><area shape="rect" id="node30" href="passwd-mgr_8h.html#a423fa6bdd74869a9d46a706ecd7790da" title="seaf_passwd_manager_set_passwd" alt="" coords="507,323,739,352"/><area shape="rect" id="node32" href="virtual-repo_8c.html#a9a8dcda29ee6cd28d92c1897ad12f268" title="seaf_repo_manager_create_virtual_repo" alt="" coords="496,376,749,405"/><area shape="rect" id="node24" href="seafile-rpc_8h.html#aca75772f76f8eafb2b08a023cd476f65" title="seafile_clone" alt="" coords="815,216,913,245"/><area shape="rect" id="node28" href="seafile-rpc_8h.html#a704ca859f1a1f7044c27b27982658672" title="seafile_download" alt="" coords="803,269,925,299"/><area shape="rect" id="node38" href="merge-recursive_8h.html#ac5c545b083f8e950f4e13cb31b4a74d1" title="merge_recursive" alt="" coords="805,429,923,459"/><area shape="rect" id="node47" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="540,483,705,512"/><area shape="rect" id="node52" href="vc-utils_8h.html#a679a356f1eff6a4f953fe26f3f841f93" title="collect_new_blocks_from_index" alt="" coords="520,589,725,619"/><area shape="rect" id="node68" href="test-cdc_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="597,981,648,1011"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a05f0eae648599d413d03103758473e30"></a><!-- doxytag: member="utils.c::readn" ref="a05f0eae648599d413d03103758473e30" args="(int fd, void *vptr, size_t n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t <a class="el" href="ccnet_2lib_2utils_8h.html#a05f0eae648599d413d03103758473e30">readn</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>vptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00721">721</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span>  nleft;
        ssize_t nread;
        <span class="keywordtype">char</span>    *ptr;

        ptr = vptr;
        nleft = n;
        <span class="keywordflow">while</span> (nleft &gt; 0) {
                <span class="keywordflow">if</span> ( (nread = read(fd, ptr, nleft)) &lt; 0) {
                        <span class="keywordflow">if</span> (errno == EINTR)
                                nread = 0;              <span class="comment">/* and call read() again */</span>
                        <span class="keywordflow">else</span>
                                <span class="keywordflow">return</span>(-1);
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nread == 0)
                        <span class="keywordflow">break</span>;                          <span class="comment">/* EOF */</span>

                nleft -= nread;
                ptr   += nread;
        }
        <span class="keywordflow">return</span>(n - nleft);              <span class="comment">/* return &gt;= 0 */</span>
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a05f0eae648599d413d03103758473e30_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a05f0eae648599d413d03103758473e30_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a05f0eae648599d413d03103758473e30_icgraph" id="seafile_2lib_2utils_8c_a05f0eae648599d413d03103758473e30_icgraph">
<area shape="rect" id="node3" href="lib_2packet-io_8h.html#a2d67684cc5079a33d6655166af77f752" title="ccnet_packet_io_read_packet" alt="" coords="109,152,304,181"/><area shape="rect" id="node5" href="cdc_8h.html#aea90546a415cda3ed727f7a549b59dc8" title="file_chunk_cdc" alt="" coords="152,205,261,235"/><area shape="rect" id="node25" href="index_8h.html#a37ae9831253a5201f6d773a14e1da9ac" title="index_fd" alt="" coords="609,272,679,301"/><area shape="rect" id="node56" href="ccnet_2lib_2utils_8h.html#a8e7da7ad650a6da09c1f679479335ed1" title="copy_fd" alt="" coords="173,309,240,339"/><area shape="rect" id="node60" href="test-seafile-fmt_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="181,363,232,392"/><area shape="rect" id="node7" href="cdc_8h.html#a1d1403a9a25e88c792d4d3d67ac0334a" title="filename_chunk_cdc" alt="" coords="352,179,493,208"/><area shape="rect" id="node9" href="fs-mgr_8h.html#af41e85bce809b9f05ed5b20ac5eeb745" title="seaf_fs_manager_index_blocks" alt="" coords="541,85,747,115"/><area shape="rect" id="node17" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf" title="compare_file_content" alt="" coords="571,165,717,195"/><area shape="rect" id="node23" href="test-cdc_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="619,219,669,248"/><area shape="rect" id="node11" href="repo-op_8c.html#a3128bd2930667427a22976b6a2b85743" title="seaf_repo_manager_post_file" alt="" coords="816,112,1008,141"/><area shape="rect" id="node13" href="repo-op_8c.html#ae7346d14d7ad21fef1537bf44b50273e" title="seaf_repo_manager_post_multi_files" alt="" coords="795,5,1029,35"/><area shape="rect" id="node15" href="repo-op_8c.html#a46c094895964e060809372262c9b9923" title="seaf_repo_manager_put_file" alt="" coords="820,59,1004,88"/><area shape="rect" id="node19" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="863,165,961,195"/><area shape="rect" id="node21" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="1081,165,1284,195"/><area shape="rect" id="node27" href="index_8h.html#a35caece3e3575d32521f820a8f0a24a7" title="index_path" alt="" coords="869,352,955,381"/><area shape="rect" id="node48" href="vc-utils_8h.html#ab93fff6b962d6fd7482c95d17c8bf6eb" title="update_index" alt="" coords="863,272,961,301"/><area shape="rect" id="node29" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="1080,325,1285,355"/><area shape="rect" id="node31" href="daemon_2repo-mgr_8h.html#a461e72948bba5928329e269ad395e293" title="seaf_repo_is_worktree_changed" alt="" coords="1079,483,1287,512"/><area shape="rect" id="node33" href="daemon_2repo-mgr_8h.html#a79db93d798035e3e07f48c2ad32d87f1" title="seaf_repo_is_index_unmerged" alt="" coords="1084,536,1281,565"/><area shape="rect" id="node39" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="1100,379,1265,408"/><area shape="rect" id="node41" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="1088,272,1277,301"/><area shape="rect" id="node44" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="1336,352,1475,381"/><area shape="rect" id="node35" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="1347,431,1464,460"/><area shape="rect" id="node37" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="1523,431,1645,460"/><area shape="rect" id="node50" href="index_8h.html#a2988327a0a98dd3e8868b4b902d310bf" title="add_to_index" alt="" coords="1133,219,1232,248"/><area shape="rect" id="node58" href="ccnet_2lib_2utils_8h.html#a9f585ff92128cbf174ef4b3a9b429d08" title="copy_file" alt="" coords="385,309,460,339"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab1b7fca428ce9530309624d9bdd822e6"></a><!-- doxytag: member="utils.c::recvn" ref="ab1b7fca428ce9530309624d9bdd822e6" args="(int fd, void *vptr, size_t n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t <a class="el" href="ccnet_2lib_2utils_8h.html#a94142a37553a5232b714c3e1b4d91d92">recvn</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>vptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00769">769</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span>  nleft;
        ssize_t nread;
        <span class="keywordtype">char</span>    *ptr;

        ptr = vptr;
        nleft = n;
        <span class="keywordflow">while</span> (nleft &gt; 0) {
<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( (nread = read(fd, ptr, nleft)) &lt; 0)
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( (nread = recv(fd, ptr, nleft, 0)) &lt; 0)
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        {
                        <span class="keywordflow">if</span> (errno == EINTR)
                                nread = 0;              <span class="comment">/* and call read() again */</span>
                        <span class="keywordflow">else</span>
                                <span class="keywordflow">return</span>(-1);
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nread == 0)
                        <span class="keywordflow">break</span>;                          <span class="comment">/* EOF */</span>

                nleft -= nread;
                ptr   += nread;
        }
        <span class="keywordflow">return</span>(n - nleft);              <span class="comment">/* return &gt;= 0 */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ace06e9888a8adf6cd341163d3f7f504f"></a><!-- doxytag: member="utils.c::seaf_compress" ref="ace06e9888a8adf6cd341163d3f7f504f" args="(guint8 *input, int inlen, guint8 **output, int *outlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#ace06e9888a8adf6cd341163d3f7f504f">seaf_compress</a> </td>
          <td>(</td>
          <td class="paramtype">guint8 *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint8 **&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>outlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02375">2375</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> ret;
    <span class="keywordtype">unsigned</span> have;
    z_stream strm;
    guint8 out[<a class="code" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a>];
    GByteArray *barray;

    <span class="keywordflow">if</span> (inlen == 0)
        <span class="keywordflow">return</span> -1;

    <span class="comment">/* allocate deflate state */</span>
    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;
    strm.opaque = Z_NULL;
    ret = deflateInit(&amp;strm, Z_DEFAULT_COMPRESSION);
    <span class="keywordflow">if</span> (ret != Z_OK) {
        g_warning (<span class="stringliteral">&quot;deflateInit failed.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    strm.avail_in = inlen;
    strm.next_in = input;
    barray = g_byte_array_new ();

    <span class="keywordflow">do</span> {
        strm.avail_out = <a class="code" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a>;
        strm.next_out = out;
        ret = deflate(&amp;strm, Z_FINISH);    <span class="comment">/* no bad return value */</span>
        have = <a class="code" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a> - strm.avail_out;
        g_byte_array_append (barray, out, have);
    } <span class="keywordflow">while</span> (ret != Z_STREAM_END);

    *outlen = barray-&gt;len;
    *output = g_byte_array_free (barray, FALSE);

    <span class="comment">/* clean up and return */</span>
    (void)deflateEnd(&amp;strm);
    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ace06e9888a8adf6cd341163d3f7f504f_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ace06e9888a8adf6cd341163d3f7f504f_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ace06e9888a8adf6cd341163d3f7f504f_icgraph" id="seafile_2lib_2utils_8c_ace06e9888a8adf6cd341163d3f7f504f_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#a63aaab4413dfa2eae60241305689a698" title="seaf_dir_to_data" alt="" coords="167,59,284,88"/><area shape="rect" id="node5" href="fs-mgr_8h.html#ae49e883dd4aa920a40b870092677ae35" title="seaf_dir_new" alt="" coords="333,59,432,88"/><area shape="rect" id="node7" href="vc-utils_8h.html#a40a8e3a1dc14697c58656246b3fa9ca0" title="commit_trees_cb" alt="" coords="480,59,603,88"/><area shape="rect" id="node9" href="merge-recursive_8h.html#a5ece2c4c0b1acc045660424d1fb74f36" title="write_tree_from_memory" alt="" coords="671,5,836,35"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="651,59,856,88"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="671,112,836,141"/><area shape="rect" id="node11" href="merge-recursive_8h.html#ac5c545b083f8e950f4e13cb31b4a74d1" title="merge_recursive" alt="" coords="905,5,1023,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac7d9f3eae8999794ca0f59cab62c486e"></a><!-- doxytag: member="utils.c::seaf_decompress" ref="ac7d9f3eae8999794ca0f59cab62c486e" args="(guint8 *input, int inlen, guint8 **output, int *outlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#ac7d9f3eae8999794ca0f59cab62c486e">seaf_decompress</a> </td>
          <td>(</td>
          <td class="paramtype">guint8 *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint8 **&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>outlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l02417">2417</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> ret;
    <span class="keywordtype">unsigned</span> have;
    z_stream strm;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> out[<a class="code" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a>];
    GByteArray *barray;

    <span class="keywordflow">if</span> (inlen == 0) {
        g_warning (<span class="stringliteral">&quot;Empty input for zlib, invalid.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* allocate inflate state */</span>
    strm.zalloc = Z_NULL;
    strm.zfree = Z_NULL;
    strm.opaque = Z_NULL;
    strm.avail_in = 0;
    strm.next_in = Z_NULL;
    ret = inflateInit(&amp;strm);
    <span class="keywordflow">if</span> (ret != Z_OK) {
        g_warning (<span class="stringliteral">&quot;inflateInit failed.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    strm.avail_in = inlen;
    strm.next_in = input;
    barray = g_byte_array_new ();

    <span class="keywordflow">do</span> {
        strm.avail_out = <a class="code" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a>;
        strm.next_out = out;
        ret = inflate(&amp;strm, Z_NO_FLUSH);
        <span class="keywordflow">switch</span> (ret) {
        <span class="keywordflow">case</span> Z_NEED_DICT:
            ret = Z_DATA_ERROR;     <span class="comment">/* and fall through */</span>
        <span class="keywordflow">case</span> Z_DATA_ERROR:
        <span class="keywordflow">case</span> Z_MEM_ERROR:
            g_warning (<span class="stringliteral">&quot;Failed to inflate.\n&quot;</span>);
            <span class="keywordflow">goto</span> out;
        }
        have = <a class="code" href="seafile_2lib_2utils_8c.html#aee79ea870e3b3807cae3db5655993a7e">ZLIB_BUF_SIZE</a> - strm.avail_out;
        g_byte_array_append (barray, out, have);
    } <span class="keywordflow">while</span> (ret != Z_STREAM_END);

out:
    <span class="comment">/* clean up and return */</span>
    (void)inflateEnd(&amp;strm);

    <span class="keywordflow">if</span> (ret == Z_STREAM_END) {
        *outlen = barray-&gt;len;
        *output = g_byte_array_free (barray, FALSE);
        <span class="keywordflow">return</span> 0;
    } <span class="keywordflow">else</span> {
        g_byte_array_free (barray, TRUE);
        <span class="keywordflow">return</span> -1;
    }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ac7d9f3eae8999794ca0f59cab62c486e_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ac7d9f3eae8999794ca0f59cab62c486e_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ac7d9f3eae8999794ca0f59cab62c486e_icgraph" id="seafile_2lib_2utils_8c_ac7d9f3eae8999794ca0f59cab62c486e_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8c.html#ac58f859abeba94b69e2db803dc5a6cdc" title="fs_object_from_json" alt="" coords="179,5,317,35"/><area shape="rect" id="node5" href="fs-mgr_8h.html#a63cf6fa9de3b33361dd2bbdc5c5ac95d" title="seaf_fs_object_from_data" alt="" coords="367,5,537,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a09f0677ad28b98b7a85bcda57f71e7c8"></a><!-- doxytag: member="utils.c::seaf_fstat" ref="a09f0677ad28b98b7a85bcda57f71e7c8" args="(int fd, SeafStat *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#a09f0677ad28b98b7a85bcda57f71e7c8">seaf_fstat</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> *&#160;</td>
          <td class="paramname"><em>st</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00420">420</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (_fstat64 (fd, st) &lt; 0)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">if</span> (get_utc_file_time_fd (fd, &amp;st-&gt;st_mtime, &amp;st-&gt;st_ctime) &lt; 0)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> fstat (fd, st);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a09f0677ad28b98b7a85bcda57f71e7c8_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a09f0677ad28b98b7a85bcda57f71e7c8_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a09f0677ad28b98b7a85bcda57f71e7c8_icgraph" id="seafile_2lib_2utils_8c_a09f0677ad28b98b7a85bcda57f71e7c8_icgraph">
<area shape="rect" id="node3" href="cdc_8h.html#aea90546a415cda3ed727f7a549b59dc8" title="file_chunk_cdc" alt="" coords="133,217,243,247"/><area shape="rect" id="node23" href="index_8h.html#a34634123a8512d58dda6621a79080e56" title="read_index_from" alt="" coords="303,455,420,484"/><area shape="rect" id="node45" href="index_8h.html#aec9458995edf7bf9c6389908ab3366f5" title="write_index" alt="" coords="144,323,232,352"/><area shape="rect" id="node5" href="cdc_8h.html#a1d1403a9a25e88c792d4d3d67ac0334a" title="filename_chunk_cdc" alt="" coords="291,139,432,168"/><area shape="rect" id="node7" href="fs-mgr_8h.html#af41e85bce809b9f05ed5b20ac5eeb745" title="seaf_fs_manager_index_blocks" alt="" coords="483,59,688,88"/><area shape="rect" id="node15" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf" title="compare_file_content" alt="" coords="512,165,659,195"/><area shape="rect" id="node21" href="test-cdc_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="560,112,611,141"/><area shape="rect" id="node9" href="repo-op_8c.html#a3128bd2930667427a22976b6a2b85743" title="seaf_repo_manager_post_file" alt="" coords="760,5,952,35"/><area shape="rect" id="node11" href="repo-op_8c.html#ae7346d14d7ad21fef1537bf44b50273e" title="seaf_repo_manager_post_multi_files" alt="" coords="739,59,973,88"/><area shape="rect" id="node13" href="repo-op_8c.html#a46c094895964e060809372262c9b9923" title="seaf_repo_manager_put_file" alt="" coords="764,112,948,141"/><area shape="rect" id="node17" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="807,165,905,195"/><area shape="rect" id="node19" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="1021,217,1224,247"/><area shape="rect" id="node25" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="483,429,688,459"/><area shape="rect" id="node27" href="daemon_2repo-mgr_8h.html#a461e72948bba5928329e269ad395e293" title="seaf_repo_is_worktree_changed" alt="" coords="481,533,689,563"/><area shape="rect" id="node29" href="daemon_2repo-mgr_8h.html#a79db93d798035e3e07f48c2ad32d87f1" title="seaf_repo_is_index_unmerged" alt="" coords="487,640,684,669"/><area shape="rect" id="node35" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="503,323,668,352"/><area shape="rect" id="node37" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="491,376,680,405"/><area shape="rect" id="node43" href="test-index_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="560,587,611,616"/><area shape="rect" id="node31" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="797,587,915,616"/><area shape="rect" id="node33" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="1061,587,1184,616"/><area shape="rect" id="node40" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="787,376,925,405"/><area shape="rect" id="node47" href="vc-utils_8h.html#ab93fff6b962d6fd7482c95d17c8bf6eb" title="update_index" alt="" coords="312,323,411,352"/><area shape="rect" id="node49" href="index_8h.html#a2988327a0a98dd3e8868b4b902d310bf" title="add_to_index" alt="" coords="536,269,635,299"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abc8dd3d83f54a07998aea73c4071d818"></a><!-- doxytag: member="utils.c::seaf_set_file_time" ref="abc8dd3d83f54a07998aea73c4071d818" args="(const char *path, guint64 mtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#abc8dd3d83f54a07998aea73c4071d818">seaf_set_file_time</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">guint64&#160;</td>
          <td class="paramname"><em>mtime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00457">457</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>    <span class="keyword">struct </span>stat st;
    <span class="keyword">struct </span>utimbuf times;

    <span class="keywordflow">if</span> (stat (path, &amp;st) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Failed to stat %s: %s.\n&quot;</span>, path, strerror(errno));
        <span class="keywordflow">return</span> -1;
    }

    times.actime = st.st_atime;
    times.modtime = (time_t)<a class="code" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>;

    <span class="keywordflow">return</span> utime (path, &amp;times);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath = win32_long_path (path);
    <span class="keywordtype">int</span> ret = 0;

    <span class="keywordflow">if</span> (set_utc_file_time (path, wpath, <a class="code" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>) &lt; 0)
        ret = -1;

    g_free (wpath);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_abc8dd3d83f54a07998aea73c4071d818_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_abc8dd3d83f54a07998aea73c4071d818_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_abc8dd3d83f54a07998aea73c4071d818_icgraph" id="seafile_2lib_2utils_8c_abc8dd3d83f54a07998aea73c4071d818_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#a36b814252ae47bd595a9282266ea1b56" title="seaf_fs_manager_checkout_file" alt="" coords="183,7,388,36"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8c.html#a181f66e1d3900771c37883e97fea7fba" title="checkout_empty_dir" alt="" coords="437,59,576,88"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="457,5,556,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="624,32,827,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab46893ad4a68049bcd80eac8dcc2e299"></a><!-- doxytag: member="utils.c::seaf_stat" ref="ab46893ad4a68049bcd80eac8dcc2e299" args="(const char *path, SeafStat *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> *&#160;</td>
          <td class="paramname"><em>st</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00384">384</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath = win32_long_path (path);
    WIN32_FILE_ATTRIBUTE_DATA attrs;
    <span class="keywordtype">int</span> ret = 0;

    <span class="keywordflow">if</span> (!GetFileAttributesExW (wpath, GetFileExInfoStandard, &amp;attrs)) {
        ret = -1;
        windows_error_to_errno (GetLastError());
        <span class="keywordflow">goto</span> out;
    }

    memset (st, 0, <span class="keyword">sizeof</span>(<a class="code" href="seafile_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a>));

    <span class="keywordflow">if</span> (attrs.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY)
        st-&gt;st_mode = (S_IFDIR | S_IRWXU);
    <span class="keywordflow">else</span>
        st-&gt;st_mode = (S_IFREG | S_IRUSR | S_IWUSR);

    st-&gt;st_atime = file_time_to_unix_time (&amp;attrs.ftLastAccessTime);
    st-&gt;st_ctime = file_time_to_unix_time (&amp;attrs.ftCreationTime);
    st-&gt;st_mtime = file_time_to_unix_time (&amp;attrs.ftLastWriteTime);

    st-&gt;st_size = ((((__int64)attrs.nFileSizeHigh)&lt;&lt;32) + attrs.nFileSizeLow);

out:
    g_free (wpath);

    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> stat (path, st);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ab46893ad4a68049bcd80eac8dcc2e299_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ab46893ad4a68049bcd80eac8dcc2e299_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ab46893ad4a68049bcd80eac8dcc2e299_icgraph" id="seafile_2lib_2utils_8c_ab46893ad4a68049bcd80eac8dcc2e299_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#af41e85bce809b9f05ed5b20ac5eeb745" title="seaf_fs_manager_index_blocks" alt="" coords="131,59,336,88"/><area shape="rect" id="node11" href="unpack-trees_8h.html#afc1a414641a3c7c31083a389fcfc5ec6" title="oneway_merge" alt="" coords="179,112,288,141"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#ad1200d69d8e6219885da4e85af15dca2" title="seaf_repo_check_worktree" alt="" coords="144,165,323,195"/><area shape="rect" id="node19" href="daemon_2repo-mgr_8h.html#a461e72948bba5928329e269ad395e293" title="seaf_repo_is_worktree_changed" alt="" coords="671,244,879,273"/><area shape="rect" id="node21" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="453,427,552,456"/><area shape="rect" id="node25" href="daemon_2repo-mgr_8c.html#a181f66e1d3900771c37883e97fea7fba" title="checkout_empty_dir" alt="" coords="164,477,303,507"/><area shape="rect" id="node28" href="daemon_2repo-mgr_8h.html#abdf6d76830c08b16b49d76e2f34037a5" title="seaf_repo_load_ignore_files" alt="" coords="143,373,324,403"/><area shape="rect" id="node33" href="status_8h.html#aedde1fa2f15b7c6a05b14c2dcc04f6be" title="wt_status_collect_changes_worktree" alt="" coords="384,269,621,299"/><area shape="rect" id="node36" href="daemon_2repo-mgr_8h.html#a32907bbaf9e2790699ddb7aaa97a3052" title="seaf_repo_check_ignore_file" alt="" coords="140,320,327,349"/><area shape="rect" id="node40" href="vc-utils_8h.html#a4642df9b122253404e9618cedd3d7e18" title="seaf_remove_empty_dir" alt="" coords="153,581,313,611"/><area shape="rect" id="node42" href="vc-utils_8h.html#afe4721091f815b2382d2cc8b30e97cf0" title="delete_path" alt="" coords="459,531,547,560"/><area shape="rect" id="node46" href="ccnet_2lib_2utils_8h.html#a8972f29db121d2c77a167b5ad4942d94" title="checkdir" alt="" coords="199,635,268,664"/><area shape="rect" id="node5" href="repo-op_8c.html#a3128bd2930667427a22976b6a2b85743" title="seaf_repo_manager_post_file" alt="" coords="407,5,599,35"/><area shape="rect" id="node7" href="repo-op_8c.html#ae7346d14d7ad21fef1537bf44b50273e" title="seaf_repo_manager_post_multi_files" alt="" coords="385,59,620,88"/><area shape="rect" id="node9" href="repo-op_8c.html#a46c094895964e060809372262c9b9923" title="seaf_repo_manager_put_file" alt="" coords="411,112,595,141"/><area shape="rect" id="node15" href="sync-mgr_8h.html#aeea02ab15ddf4c48dd3227f30b791f37" title="seaf_sync_manager_add_sync_task" alt="" coords="385,165,620,195"/><area shape="rect" id="node17" href="seafile-rpc_8h.html#a69a68f15746004a2a844c35c7d305b22" title="seafile_sync" alt="" coords="728,165,821,195"/><area shape="rect" id="node23" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="673,453,876,483"/><area shape="rect" id="node30" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="400,373,605,403"/><area shape="rect" id="node48" href="session_8c.html#a2ded42c6195336219f9093d89a2f5ed5" title="ccnet_session_load_config" alt="" coords="413,635,592,664"/><area shape="rect" id="node50" href="session_8h.html#aa0bbc7572963f31cc6086df26b4ab2b4" title="ccnet_session_prepare" alt="" coords="697,635,852,664"/><area shape="rect" id="node52" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="965,608,1016,637"/><area shape="rect" id="node54" href="ccnet-server_8c.html#a4bc39cfec6e5bdca15a1cfb25c94664a" title="test_ccnet_config" alt="" coords="928,661,1053,691"/><area shape="rect" id="node56" href="ccnet-server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1101,661,1152,691"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a822971bc55edc699449c6f6f2e03225e"></a><!-- doxytag: member="utils.c::seaf_util_create" ref="a822971bc55edc699449c6f6f2e03225e" args="(const char *path, int flags, mode_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#a822971bc55edc699449c6f6f2e03225e">seaf_util_create</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00579">579</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath;
    DWORD access = 0;
    HANDLE handle;
    <span class="keywordtype">int</span> fd;

    access |= GENERIC_READ;
    <span class="keywordflow">if</span> (<a class="code" href="index_8h.html#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; (O_WRONLY | O_RDWR))
        access |= GENERIC_WRITE;

    wpath = win32_long_path (path);

    handle = CreateFileW (wpath,
                          access,
                          FILE_SHARE_DELETE | FILE_SHARE_READ | FILE_SHARE_WRITE,
                          NULL,
                          CREATE_ALWAYS,
                          0,
                          NULL);
    <span class="keywordflow">if</span> (handle == INVALID_HANDLE_VALUE) {
        errno = windows_error_to_errno (GetLastError());
        g_free (wpath);
        <span class="keywordflow">return</span> -1;
    }

    fd = _open_osfhandle ((intptr_t)handle, 0);

    g_free (wpath);
    <span class="keywordflow">return</span> fd;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> open (path, <a class="code" href="index_8h.html#a1cbb17ede73ea044a04a129bf4d86976">flags</a>, <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a822971bc55edc699449c6f6f2e03225e_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a822971bc55edc699449c6f6f2e03225e_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a822971bc55edc699449c6f6f2e03225e_icgraph" id="seafile_2lib_2utils_8c_a822971bc55edc699449c6f6f2e03225e_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#a36b814252ae47bd595a9282266ea1b56" title="seaf_fs_manager_checkout_file" alt="" coords="169,32,375,61"/><area shape="rect" id="node9" href="vc-utils_8h.html#ab93fff6b962d6fd7482c95d17c8bf6eb" title="update_index" alt="" coords="223,137,321,167"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="477,5,576,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="677,32,880,61"/><area shape="rect" id="node11" href="index_8h.html#a2988327a0a98dd3e8868b4b902d310bf" title="add_to_index" alt="" coords="477,109,576,139"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="424,163,629,192"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="444,216,609,245"/><area shape="rect" id="node17" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="432,269,621,299"/><area shape="rect" id="node19" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="720,243,837,272"/><area shape="rect" id="node23" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="709,296,848,325"/><area shape="rect" id="node21" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="928,243,1051,272"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1c2448a989efb1ce953a90f3db3c8042"></a><!-- doxytag: member="utils.c::seaf_util_exists" ref="a1c2448a989efb1ce953a90f3db3c8042" args="(const char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="seafile_2lib_2utils_8h.html#a1c2448a989efb1ce953a90f3db3c8042">seaf_util_exists</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00637">637</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath = win32_long_path (path);
    DWORD attrs;
    gboolean ret;

    attrs = GetFileAttributesW (wpath);
    ret = (attrs != INVALID_FILE_ATTRIBUTES);

    g_free (wpath);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> (access (path, F_OK) == 0);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a1c2448a989efb1ce953a90f3db3c8042_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a1c2448a989efb1ce953a90f3db3c8042_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a1c2448a989efb1ce953a90f3db3c8042_icgraph" id="seafile_2lib_2utils_8c_a1c2448a989efb1ce953a90f3db3c8042_icgraph">
<area shape="rect" id="node3" href="daemon_2repo-mgr_8c.html#a181f66e1d3900771c37883e97fea7fba" title="checkout_empty_dir" alt="" coords="168,5,307,35"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="355,5,557,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a51aa6c51cc437a2766ca666660289bce"></a><!-- doxytag: member="utils.c::seaf_util_mkdir" ref="a51aa6c51cc437a2766ca666660289bce" args="(const char *path, mode_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#a51aa6c51cc437a2766ca666660289bce">seaf_util_mkdir</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00523">523</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath = win32_long_path (path);
    <span class="keywordtype">int</span> ret = 0;

    <span class="keywordflow">if</span> (!CreateDirectoryW (wpath, NULL)) {
        ret = -1;
        errno = windows_error_to_errno (GetLastError());
    }

    g_free (wpath);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> mkdir (path, <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a51aa6c51cc437a2766ca666660289bce_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a51aa6c51cc437a2766ca666660289bce_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a51aa6c51cc437a2766ca666660289bce_icgraph" id="seafile_2lib_2utils_8c_a51aa6c51cc437a2766ca666660289bce_icgraph">
<area shape="rect" id="node3" href="daemon_2repo-mgr_8c.html#a181f66e1d3900771c37883e97fea7fba" title="checkout_empty_dir" alt="" coords="165,5,304,35"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="352,5,555,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad154e736c3751fe880395dff55fab739"></a><!-- doxytag: member="utils.c::seaf_util_open" ref="ad154e736c3751fe880395dff55fab739" args="(const char *path, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#ad154e736c3751fe880395dff55fab739">seaf_util_open</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00542">542</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath;
    DWORD access = 0;
    HANDLE handle;
    <span class="keywordtype">int</span> fd;

    access |= GENERIC_READ;
    <span class="keywordflow">if</span> (<a class="code" href="index_8h.html#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; (O_WRONLY | O_RDWR))
        access |= GENERIC_WRITE;

    wpath = win32_long_path (path);

    handle = CreateFileW (wpath,
                          access,
                          FILE_SHARE_DELETE | FILE_SHARE_READ | FILE_SHARE_WRITE,
                          NULL,
                          OPEN_EXISTING,
                          0,
                          NULL);
    <span class="keywordflow">if</span> (handle == INVALID_HANDLE_VALUE) {
        errno = windows_error_to_errno (GetLastError());
        g_free (wpath);
        <span class="keywordflow">return</span> -1;
    }

    fd = _open_osfhandle ((intptr_t)handle, 0);

    g_free (wpath);
    <span class="keywordflow">return</span> fd;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> open (path, <a class="code" href="index_8h.html#a1cbb17ede73ea044a04a129bf4d86976">flags</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ad154e736c3751fe880395dff55fab739_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ad154e736c3751fe880395dff55fab739_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ad154e736c3751fe880395dff55fab739_icgraph" id="seafile_2lib_2utils_8c_ad154e736c3751fe880395dff55fab739_icgraph">
<area shape="rect" id="node3" href="cdc_8h.html#a1d1403a9a25e88c792d4d3d67ac0334a" title="filename_chunk_cdc" alt="" coords="160,139,301,168"/><area shape="rect" id="node21" href="index_8h.html#a34634123a8512d58dda6621a79080e56" title="read_index_from" alt="" coords="172,453,289,483"/><area shape="rect" id="node43" href="index_8h.html#a35caece3e3575d32521f820a8f0a24a7" title="index_path" alt="" coords="188,373,273,403"/><area shape="rect" id="node5" href="fs-mgr_8h.html#af41e85bce809b9f05ed5b20ac5eeb745" title="seaf_fs_manager_index_blocks" alt="" coords="352,59,557,88"/><area shape="rect" id="node13" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf" title="compare_file_content" alt="" coords="381,165,528,195"/><area shape="rect" id="node19" href="test-cdc_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="429,112,480,141"/><area shape="rect" id="node7" href="repo-op_8c.html#a3128bd2930667427a22976b6a2b85743" title="seaf_repo_manager_post_file" alt="" coords="629,5,821,35"/><area shape="rect" id="node9" href="repo-op_8c.html#ae7346d14d7ad21fef1537bf44b50273e" title="seaf_repo_manager_post_multi_files" alt="" coords="608,59,843,88"/><area shape="rect" id="node11" href="repo-op_8c.html#a46c094895964e060809372262c9b9923" title="seaf_repo_manager_put_file" alt="" coords="633,112,817,141"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="676,165,775,195"/><area shape="rect" id="node17" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="891,217,1093,247"/><area shape="rect" id="node23" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="352,533,557,563"/><area shape="rect" id="node25" href="daemon_2repo-mgr_8h.html#a461e72948bba5928329e269ad395e293" title="seaf_repo_is_worktree_changed" alt="" coords="351,320,559,349"/><area shape="rect" id="node27" href="daemon_2repo-mgr_8h.html#a79db93d798035e3e07f48c2ad32d87f1" title="seaf_repo_is_index_unmerged" alt="" coords="356,427,553,456"/><area shape="rect" id="node33" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="372,480,537,509"/><area shape="rect" id="node35" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="360,373,549,403"/><area shape="rect" id="node41" href="test-index_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="429,637,480,667"/><area shape="rect" id="node29" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="667,400,784,429"/><area shape="rect" id="node31" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="931,400,1053,429"/><area shape="rect" id="node38" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="656,308,795,337"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a46307856992913eeb741c8203cfc93c2"></a><!-- doxytag: member="utils.c::seaf_util_rename" ref="a46307856992913eeb741c8203cfc93c2" args="(const char *oldpath, const char *newpath)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>oldpath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>newpath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00616">616</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *oldpathw = win32_long_path (oldpath);
    <span class="keywordtype">wchar_t</span> *newpathw = win32_long_path (newpath);
    <span class="keywordtype">int</span> ret = 0;

    <span class="keywordflow">if</span> (!MoveFileExW (oldpathw, newpathw, MOVEFILE_REPLACE_EXISTING)) {
        ret = -1;
        errno = windows_error_to_errno (GetLastError());
    }

    g_free (oldpathw);
    g_free (newpathw);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> rename (oldpath, newpath);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a46307856992913eeb741c8203cfc93c2_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a46307856992913eeb741c8203cfc93c2_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a46307856992913eeb741c8203cfc93c2_icgraph" id="seafile_2lib_2utils_8c_a46307856992913eeb741c8203cfc93c2_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#a36b814252ae47bd595a9282266ea1b56" title="seaf_fs_manager_checkout_file" alt="" coords="177,32,383,61"/><area shape="rect" id="node9" href="vc-utils_8h.html#ab93fff6b962d6fd7482c95d17c8bf6eb" title="update_index" alt="" coords="231,137,329,167"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="485,5,584,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="685,32,888,61"/><area shape="rect" id="node11" href="index_8h.html#a2988327a0a98dd3e8868b4b902d310bf" title="add_to_index" alt="" coords="485,109,584,139"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="432,163,637,192"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8h.html#ab6d5318b3a1cc6f86733ff71b16815a8" title="seaf_repo_index_commit" alt="" coords="452,216,617,245"/><area shape="rect" id="node17" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="440,269,629,299"/><area shape="rect" id="node19" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="728,243,845,272"/><area shape="rect" id="node23" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="717,296,856,325"/><area shape="rect" id="node21" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="936,243,1059,272"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abab8a37cf996c1cf68c1cc8f6dfc757c"></a><!-- doxytag: member="utils.c::seaf_util_rmdir" ref="abab8a37cf996c1cf68c1cc8f6dfc757c" args="(const char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#abab8a37cf996c1cf68c1cc8f6dfc757c">seaf_util_rmdir</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00504">504</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath = win32_long_path (path);
    <span class="keywordtype">int</span> ret = 0;

    <span class="keywordflow">if</span> (!RemoveDirectoryW (wpath)) {
        ret = -1;
        errno = windows_error_to_errno (GetLastError());
    }

    g_free (wpath);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> rmdir (path);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_abab8a37cf996c1cf68c1cc8f6dfc757c_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_abab8a37cf996c1cf68c1cc8f6dfc757c_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_abab8a37cf996c1cf68c1cc8f6dfc757c_icgraph" id="seafile_2lib_2utils_8c_abab8a37cf996c1cf68c1cc8f6dfc757c_icgraph">
<area shape="rect" id="node3" href="vc-utils_8h.html#a4642df9b122253404e9618cedd3d7e18" title="seaf_remove_empty_dir" alt="" coords="161,5,321,35"/><area shape="rect" id="node5" href="vc-utils_8h.html#afe4721091f815b2382d2cc8b30e97cf0" title="delete_path" alt="" coords="372,5,460,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="509,5,712,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a26f091009701c5a9d1886b9d6ceb9c8e"></a><!-- doxytag: member="utils.c::seaf_util_unlink" ref="a26f091009701c5a9d1886b9d6ceb9c8e" args="(const char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile_2lib_2utils_8h.html#a26f091009701c5a9d1886b9d6ceb9c8e">seaf_util_unlink</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00485">485</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> *wpath = win32_long_path (path);
    <span class="keywordtype">int</span> ret = 0;

    <span class="keywordflow">if</span> (!DeleteFileW (wpath)) {
        ret = -1;
        errno = windows_error_to_errno (GetLastError());
    }

    g_free (wpath);
    <span class="keywordflow">return</span> ret;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unlink (path);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a26f091009701c5a9d1886b9d6ceb9c8e_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a26f091009701c5a9d1886b9d6ceb9c8e_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a26f091009701c5a9d1886b9d6ceb9c8e_icgraph" id="seafile_2lib_2utils_8c_a26f091009701c5a9d1886b9d6ceb9c8e_icgraph">
<area shape="rect" id="node3" href="fs-mgr_8h.html#a36b814252ae47bd595a9282266ea1b56" title="seaf_fs_manager_checkout_file" alt="" coords="195,323,400,352"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8h.html#a77e557bb1fedd648a109ab5d9bff5ef4" title="seaf_repo_index_worktree_files" alt="" coords="195,112,400,141"/><area shape="rect" id="node11" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="228,165,367,195"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a008f145440cf3620f7883d1fe109f69c" title="seaf_repo_manager_remove_repo_ondisk" alt="" coords="167,59,428,88"/><area shape="rect" id="node27" href="vc-utils_8h.html#a4642df9b122253404e9618cedd3d7e18" title="seaf_remove_empty_dir" alt="" coords="217,219,377,248"/><area shape="rect" id="node29" href="vc-utils_8h.html#afe4721091f815b2382d2cc8b30e97cf0" title="delete_path" alt="" coords="565,269,653,299"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="560,323,659,352"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="789,296,992,325"/><area shape="rect" id="node15" href="clone-mgr_8h.html#a6b3ef937f8308db69c87bb650cb42fe9" title="seaf_clone_manager_add_task" alt="" coords="508,112,711,141"/><area shape="rect" id="node19" href="clone-mgr_8h.html#ab6b5a2b4f13b382b9c7034131fa92783" title="seaf_clone_manager_add_download_task" alt="" coords="477,5,741,35"/><area shape="rect" id="node23" href="server_2gc_2repo-mgr_8h.html#afdce2de6ee36dcf6b6264ac35fb17f7a" title="seaf_repo_manager_del_repo" alt="" coords="513,59,705,88"/><area shape="rect" id="node17" href="seafile-rpc_8h.html#aca75772f76f8eafb2b08a023cd476f65" title="seafile_clone" alt="" coords="841,112,940,141"/><area shape="rect" id="node21" href="seafile-rpc_8h.html#a704ca859f1a1f7044c27b27982658672" title="seafile_download" alt="" coords="829,5,952,35"/><area shape="rect" id="node25" href="seafile_2common_2rpc-service_8c.html#a3743ba1324330f8ef0cb9a5c33a52e92" title="seafile_destroy_repo" alt="" coords="820,59,961,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa324f32349cf5a256d5bd7802ab87e84"></a><!-- doxytag: member="utils.c::sendn" ref="aa324f32349cf5a256d5bd7802ab87e84" args="(int fd, const void *vptr, size_t n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t <a class="el" href="ccnet_2lib_2utils_8h.html#a30d2fd3f3e5797b240223f700294a517">sendn</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>vptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00798">798</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span>          nleft;
        ssize_t         nwritten;
        <span class="keyword">const</span> <span class="keywordtype">char</span>      *ptr;

        ptr = vptr;
        nleft = n;
        <span class="keywordflow">while</span> (nleft &gt; 0) {
<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( (nwritten = write(fd, ptr, nleft)) &lt;= 0)
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( (nwritten = send(fd, ptr, nleft, 0)) &lt;= 0)
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        {
                        <span class="keywordflow">if</span> (nwritten &lt; 0 &amp;&amp; errno == EINTR)
                                nwritten = 0;           <span class="comment">/* and call write() again */</span>
                        <span class="keywordflow">else</span>
                                <span class="keywordflow">return</span>(-1);                     <span class="comment">/* error */</span>
                }

                nleft -= nwritten;
                ptr   += nwritten;
        }
        <span class="keywordflow">return</span>(n);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_aa324f32349cf5a256d5bd7802ab87e84_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_aa324f32349cf5a256d5bd7802ab87e84_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_aa324f32349cf5a256d5bd7802ab87e84_icgraph" id="seafile_2lib_2utils_8c_aa324f32349cf5a256d5bd7802ab87e84_icgraph">
<area shape="rect" id="node3" href="block-tx-utils_8h.html#a704ad4fc28aa790c24e9891f75ec4a69" title="send_encrypted_data_frame_begin" alt="" coords="112,5,336,35"/><area shape="rect" id="node5" href="block-tx-utils_8h.html#a1e10866a0e3b693d203bcd73e4cb4036" title="send_encrypted_data" alt="" coords="151,59,297,88"/><area shape="rect" id="node7" href="block-tx-utils_8h.html#af96b54337c19861a5a3c42f537144dfa" title="send_encrypted_data_frame_end" alt="" coords="117,112,331,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aefe1dabfce05643fed7d83c2bb4c615c"></a><!-- doxytag: member="utils.c::string_list_append" ref="aefe1dabfce05643fed7d83c2bb4c615c" args="(GList *str_list, const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="ccnet_2lib_2utils_8h.html#aefe1dabfce05643fed7d83c2bb4c615c">string_list_append</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>str_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>string_list_append: : : a C string (can't be NULL</p>
<p>Append  to  if it is in the list.</p>
<p>returns: the new start of the list </p>

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01329">1329</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_return_val_if_fail (<span class="keywordtype">string</span> != NULL, str_list);

    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#a38f449c218477960cf9dc2136453db10">string_list_is_exists</a>(str_list, <span class="keywordtype">string</span>))
        <span class="keywordflow">return</span> str_list;

    str_list = g_list_append (str_list, g_strdup(<span class="keywordtype">string</span>));
    <span class="keywordflow">return</span> str_list;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab7295a8677eade8b86c15b06715dc902"></a><!-- doxytag: member="utils.c::string_list_append_sorted" ref="ab7295a8677eade8b86c15b06715dc902" args="(GList *str_list, const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="ccnet_2lib_2utils_8h.html#ab7295a8677eade8b86c15b06715dc902">string_list_append_sorted</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>str_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01341">1341</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_return_val_if_fail (<span class="keywordtype">string</span> != NULL, str_list);

    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#a38f449c218477960cf9dc2136453db10">string_list_is_exists</a>(str_list, <span class="keywordtype">string</span>))
        <span class="keywordflow">return</span> str_list;

    str_list = g_list_insert_sorted_with_data (str_list, g_strdup(<span class="keywordtype">string</span>),
                                 (GCompareDataFunc)g_strcmp0, NULL);
    <span class="keywordflow">return</span> str_list;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ab7295a8677eade8b86c15b06715dc902_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ab7295a8677eade8b86c15b06715dc902_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ab7295a8677eade8b86c15b06715dc902_icgraph" id="seafile_2lib_2utils_8c_ab7295a8677eade8b86c15b06715dc902_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#ad31e74349bf1266508141d82085e4d12" title="ccnet_peer_add_role" alt="" coords="225,59,367,88"/><area shape="rect" id="node5" href="peer-mgr_8h.html#ae0f8dbb08303ad06bbf050e379362646" title="ccnet_peer_manager_add_role" alt="" coords="417,59,615,88"/><area shape="rect" id="node7" href="peer-mgr_8c.html#a4ec0c5a67782351e692c89ce67ba6ab7" title="ccnet_peer_manager_on_peer_resolved" alt="" coords="665,5,916,35"/><area shape="rect" id="node9" href="rpc-service_8h.html#a44af2aa4d4369165cb11e8ca9269050d" title="ccnet_rpc_add_client" alt="" coords="719,59,863,88"/><area shape="rect" id="node15" href="rpc-service_8h.html#acf6a0dc27d4be68920e03a17d21adcc6" title="ccnet_rpc_add_role" alt="" coords="724,112,857,141"/><area shape="rect" id="node11" href="rpc-service_8h.html#a9b85de0fc2f785edf5666f0935c886cc" title="ccnet_start_rpc" alt="" coords="965,85,1077,115"/><area shape="rect" id="node13" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1125,85,1176,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af85d9a3e4ab846a6eedfb509508367f2"></a><!-- doxytag: member="utils.c::string_list_free" ref="af85d9a3e4ab846a6eedfb509508367f2" args="(GList *str_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#af85d9a3e4ab846a6eedfb509508367f2">string_list_free</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>str_list</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01372">1372</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ptr = str_list;

    <span class="keywordflow">while</span> (ptr) {
        g_free (ptr-&gt;data);
        ptr = ptr-&gt;next;
    }

    g_list_free (str_list);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_af85d9a3e4ab846a6eedfb509508367f2_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_af85d9a3e4ab846a6eedfb509508367f2_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_af85d9a3e4ab846a6eedfb509508367f2_icgraph" id="seafile_2lib_2utils_8c_af85d9a3e4ab846a6eedfb509508367f2_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#a4e3d812b4dd80e30606f1346b726bd43" title="ccnet_peer_set_roles" alt="" coords="240,5,387,35"/><area shape="rect" id="node5" href="net_2common_2peer_8h.html#a5b55c1f14dab84485ee8892bbd572df0" title="ccnet_peer_set_myroles" alt="" coords="232,59,395,88"/><area shape="rect" id="node7" href="unpack-trees_8h.html#a795a271a95b2bc0ef892ee87f48a0c62" title="get_unpack_trees_error_msgs" alt="" coords="215,112,412,141"/><area shape="rect" id="node17" href="fuse_2repo-mgr_8c.html#aa692b1e331cad063425d676afe1ae121" title="seaf_repo_manager_get_repo_list" alt="" coords="205,165,421,195"/><area shape="rect" id="node19" href="server_2repo-mgr_8h.html#a7cf33a85dd9c77b44a83d6c8ed300948" title="seaf_repo_manager_get_repos_by_owner" alt="" coords="183,219,444,248"/><area shape="rect" id="node21" href="server_2repo-mgr_8h.html#a512a79980f7d3698e591cf87aeccd314" title="seaf_repo_manager_del_repo" alt="" coords="217,272,409,301"/><area shape="rect" id="node23" href="server_2repo-mgr_8h.html#aa30a874076b81b802de8763e30433c97" title="seaf_repo_manager_get_orphan_repo_list" alt="" coords="183,325,444,355"/><area shape="rect" id="node25" href="server_2repo-mgr_8h.html#a6a2b07102342d3acc5722e059635aacb" title="seaf_repo_manager_get_repo_ids_by_owner" alt="" coords="173,379,453,408"/><area shape="rect" id="node27" href="quota-mgr_8h.html#a12e60fee869eff11295588d7565ea677" title="seaf_quota_manager_get_user_share_usage" alt="" coords="516,403,796,432"/><area shape="rect" id="node32" href="repo-op_8c.html#ae7346d14d7ad21fef1537bf44b50273e" title="seaf_repo_manager_post_multi_files" alt="" coords="539,493,773,523"/><area shape="rect" id="node34" href="repo-op_8c.html#a0d6750947e09a7c4f4eb2146147e9db1" title="seaf_repo_manager_post_file_blocks" alt="" coords="195,533,432,563"/><area shape="rect" id="node36" href="repo-op_8c.html#aad15cfaf3210b47e9f59a481073aafbc" title="seaf_repo_manager_put_file_blocks" alt="" coords="199,587,428,616"/><area shape="rect" id="node38" href="repo-op_8c.html#afa299e57b701699e37969cc2e674290e" title="seaf_repo_manager_list_file_revisions" alt="" coords="192,664,435,693"/><area shape="rect" id="node41" href="share-mgr_8h.html#a98762551896e2359a8aab1f36cbe580c" title="seaf_share_manager_list_shared_to" alt="" coords="199,717,428,747"/><area shape="rect" id="node43" href="virtual-repo_8c.html#a89c9b19ae91ea15fe9aa684c5509d4ec" title="seaf_repo_manager_get_virtual_repos_by_owner" alt="" coords="161,771,465,800"/><area shape="rect" id="node45" href="virtual-repo_8c.html#a30755ff2c01595d4927715310beaee04" title="seaf_repo_manager_merge_virtual_repo" alt="" coords="187,824,440,853"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8h.html#a7923c5fb7b957a121f1b2616a8d66745" title="seaf_repo_checkout_commit" alt="" coords="561,112,751,141"/><area shape="rect" id="node11" href="merge_8c.html#a65b859e991bbf3718673fa75b0251c85" title="merge_branches" alt="" coords="899,85,1016,115"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8h.html#ab553f7b1a5290e99821753acf9e87c86" title="seaf_repo_checkout" alt="" coords="888,139,1027,168"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a25b9a6f8f5199db34dcb95789a80eba4" title="seaf_repo_merge" alt="" coords="1117,85,1240,115"/><area shape="rect" id="node29" href="quota-mgr_8h.html#ae10caa81f529a80e3729b9a050666302" title="seaf_quota_manager_check_quota" alt="" coords="845,403,1069,432"/><area shape="rect" id="node47" href="repo-op_8c.html#a3128bd2930667427a22976b6a2b85743" title="seaf_repo_manager_post_file" alt="" coords="560,560,752,589"/><area shape="rect" id="node50" href="repo-op_8c.html#ad6564c23b0e50d8a34dd425432b80db4" title="seaf_repo_manager_del_file" alt="" coords="564,613,748,643"/><area shape="rect" id="node52" href="repo-op_8c.html#ac11bd852cc7cc4f30e40123b7bae901e" title="seaf_repo_manager_move_file" alt="" coords="859,639,1056,668"/><area shape="rect" id="node54" href="repo-op_8c.html#a88f5fdc80a71e558b5508387eafbb6de" title="seaf_repo_manager_copy_file" alt="" coords="559,717,753,747"/><area shape="rect" id="node57" href="repo-op_8c.html#aa870306d94f3e7b16e66229040590138" title="seaf_repo_manager_post_dir" alt="" coords="561,771,751,800"/><area shape="rect" id="node59" href="repo-op_8c.html#a2e0e32263ad7bbeaa4ab13a62135c46a" title="seaf_repo_manager_post_empty_file" alt="" coords="539,824,773,853"/><area shape="rect" id="node61" href="repo-op_8c.html#ae68e4b6427bb239b697e515c8617cbfb" title="seaf_repo_manager_rename_file" alt="" coords="551,877,761,907"/><area shape="rect" id="node63" href="repo-op_8c.html#a46c094895964e060809372262c9b9923" title="seaf_repo_manager_put_file" alt="" coords="564,931,748,960"/><area shape="rect" id="node65" href="repo-op_8c.html#a352b05f8d991d13b5d5e1f0ee1b7616c" title="seaf_repo_manager_revert_file" alt="" coords="556,984,756,1013"/><area shape="rect" id="node67" href="repo-op_8c.html#abf48f3efee4705f32fa8f3a95098921e" title="seaf_repo_manager_revert_dir" alt="" coords="557,1037,755,1067"/><area shape="rect" id="node69" href="repo-op_8c.html#a75071fddf41a1371d4f89be8d2b59b88" title="seaf_repo_manager_revert_on_server" alt="" coords="536,1091,776,1120"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a38f449c218477960cf9dc2136453db10"></a><!-- doxytag: member="utils.c::string_list_is_exists" ref="a38f449c218477960cf9dc2136453db10" args="(GList *str_list, const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="ccnet_2lib_2utils_8h.html#a38f449c218477960cf9dc2136453db10">string_list_is_exists</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>str_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>string_list_is_exists: : : a C string or NULL</p>
<p>Check whether  is in .</p>
<p>returns: TRUE if  is in str_list, FALSE otherwise </p>

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01309">1309</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ptr;
    <span class="keywordflow">for</span> (ptr = str_list; ptr; ptr = ptr-&gt;next) {
        <span class="keywordflow">if</span> (g_strcmp0(<span class="keywordtype">string</span>, ptr-&gt;data) == 0)
            <span class="keywordflow">return</span> TRUE;
    }
    <span class="keywordflow">return</span> FALSE;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a38f449c218477960cf9dc2136453db10_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a38f449c218477960cf9dc2136453db10_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a38f449c218477960cf9dc2136453db10_icgraph" id="seafile_2lib_2utils_8c_a38f449c218477960cf9dc2136453db10_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#afd53f329ae2eaa8d97c17f0b0f05735e" title="ccnet_peer_remove_role" alt="" coords="196,5,359,35"/><area shape="rect" id="node13" href="net_2common_2peer_8h.html#a84988645072903a2f6652a94306eafe8" title="ccnet_peer_has_role" alt="" coords="207,219,348,248"/><area shape="rect" id="node35" href="net_2common_2peer_8h.html#ac6ad0d36cd5780cb713568de3194dec1" title="ccnet_peer_has_my_role" alt="" coords="195,112,360,141"/><area shape="rect" id="node37" href="ccnet_2lib_2utils_8h.html#aefe1dabfce05643fed7d83c2bb4c615c" title="string_list_append" alt="" coords="215,165,340,195"/><area shape="rect" id="node39" href="ccnet_2lib_2utils_8h.html#ab7295a8677eade8b86c15b06715dc902" title="string_list_append_sorted" alt="" coords="192,59,363,88"/><area shape="rect" id="node5" href="peer-mgr_8h.html#af5c419e61b25896730c6917f9a5953e1" title="ccnet_peer_manager_remove_role" alt="" coords="411,5,632,35"/><area shape="rect" id="node7" href="rpc-service_8h.html#aae094018c7dc9ba17fa4d53eda81ee0c" title="ccnet_rpc_remove_role" alt="" coords="735,5,892,35"/><area shape="rect" id="node9" href="rpc-service_8h.html#a9b85de0fc2f785edf5666f0935c886cc" title="ccnet_start_rpc" alt="" coords="1336,111,1448,140"/><area shape="rect" id="node11" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1536,164,1587,193"/><area shape="rect" id="node15" href="net_2common_2peer_8h.html#ad31e74349bf1266508141d82085e4d12" title="ccnet_peer_add_role" alt="" coords="451,111,592,140"/><area shape="rect" id="node27" href="peer-mgr_8h.html#a87a934e7d80c810921d96263fb98d0d0" title="ccnet_peer_manager_get_peers_with_role" alt="" coords="680,219,947,248"/><area shape="rect" id="node17" href="peer-mgr_8h.html#ae0f8dbb08303ad06bbf050e379362646" title="ccnet_peer_manager_add_role" alt="" coords="715,111,912,140"/><area shape="rect" id="node19" href="peer-mgr_8c.html#a4ec0c5a67782351e692c89ce67ba6ab7" title="ccnet_peer_manager_on_peer_resolved" alt="" coords="996,164,1247,193"/><area shape="rect" id="node21" href="rpc-service_8h.html#a44af2aa4d4369165cb11e8ca9269050d" title="ccnet_rpc_add_client" alt="" coords="1049,111,1193,140"/><area shape="rect" id="node24" href="rpc-service_8h.html#acf6a0dc27d4be68920e03a17d21adcc6" title="ccnet_rpc_add_role" alt="" coords="1055,57,1188,87"/><area shape="rect" id="node29" href="cluster-mgr_8h.html#ae63d566f917cf270c8a696fffddd21bb" title="ccnet_cluster_manager_start" alt="" coords="1297,216,1487,245"/><area shape="rect" id="node32" href="rpc-service_8h.html#aa70930864c6919ed08029516bf07cad8" title="ccnet_rpc_get_peers_by_role" alt="" coords="1025,217,1217,247"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a76260b41a1602f1e082ece20aa258135"></a><!-- doxytag: member="utils.c::string_list_join" ref="a76260b41a1602f1e082ece20aa258135" args="(GList *str_list, GString *str, const char *seperator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="ccnet_2lib_2utils_8h.html#a5800cf387e8c70ad58e70cae752c854c">string_list_join</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>str_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GString *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>seperator</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01386">1386</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ptr;
    <span class="keywordflow">if</span> (!str_list)
        <span class="keywordflow">return</span>;

    ptr = str_list;
    g_string_append (str, ptr-&gt;data);

    <span class="keywordflow">for</span> (ptr = ptr-&gt;next; ptr; ptr = ptr-&gt;next) {
        g_string_append (str, seperator);
        g_string_append (str, (<span class="keywordtype">char</span> *)ptr-&gt;data);
    }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a76260b41a1602f1e082ece20aa258135_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a76260b41a1602f1e082ece20aa258135_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a76260b41a1602f1e082ece20aa258135_icgraph" id="seafile_2lib_2utils_8c_a76260b41a1602f1e082ece20aa258135_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#aedf959a6feb39cb537b28526c1a42093" title="ccnet_peer_get_roles_str" alt="" coords="169,5,337,35"/><area shape="rect" id="node5" href="net_2common_2peer_8h.html#ab7b94ee16b0cb24c16fac9db10a649d2" title="ccnet_peer_get_myroles_str" alt="" coords="160,59,347,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a45ff8617e4273dddf37bccc992d9d505"></a><!-- doxytag: member="utils.c::string_list_parse" ref="a45ff8617e4273dddf37bccc992d9d505" args="(const char *list_in_str, const char *seperator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="ccnet_2lib_2utils_8h.html#a45ff8617e4273dddf37bccc992d9d505">string_list_parse</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>list_in_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>seperator</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01402">1402</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!list_in_str)
        <span class="keywordflow">return</span> NULL;

    GList *list = NULL;
    <span class="keywordtype">char</span> **array = g_strsplit (list_in_str, seperator, 0);
    <span class="keywordtype">char</span> **ptr;

    <span class="keywordflow">for</span> (ptr = array; *ptr; ptr++) {
        list = g_list_prepend (list, g_strdup(*ptr));
    }
    list = g_list_reverse (list);
    
    g_strfreev (array);
    <span class="keywordflow">return</span> list;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a45ff8617e4273dddf37bccc992d9d505_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a45ff8617e4273dddf37bccc992d9d505_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a45ff8617e4273dddf37bccc992d9d505_icgraph" id="seafile_2lib_2utils_8c_a45ff8617e4273dddf37bccc992d9d505_icgraph">
<area shape="rect" id="node3" href="libccnet__utils_8h.html#af17085c95818a30cd8510c1f14bf1edf" title="ccnet_util_string_list_parse_sorted" alt="" coords="172,5,393,35"/><area shape="rect" id="node5" href="ccnet_2lib_2utils_8h.html#afbee5493f93a3ddbed45c38d2682683d" title="string_list_parse_sorted" alt="" coords="203,59,363,88"/><area shape="rect" id="node7" href="net_2common_2peer_8h.html#a4e3d812b4dd80e30606f1346b726bd43" title="ccnet_peer_set_roles" alt="" coords="452,32,599,61"/><area shape="rect" id="node9" href="net_2common_2peer_8h.html#a5b55c1f14dab84485ee8892bbd572df0" title="ccnet_peer_set_myroles" alt="" coords="444,85,607,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afbee5493f93a3ddbed45c38d2682683d"></a><!-- doxytag: member="utils.c::string_list_parse_sorted" ref="afbee5493f93a3ddbed45c38d2682683d" args="(const char *list_in_str, const char *seperator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="ccnet_2lib_2utils_8h.html#afbee5493f93a3ddbed45c38d2682683d">string_list_parse_sorted</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>list_in_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>seperator</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01421">1421</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *list = <a class="code" href="seafile_2lib_2utils_8c.html#a45ff8617e4273dddf37bccc992d9d505">string_list_parse</a> (list_in_str, seperator);

    <span class="keywordflow">return</span> g_list_sort (list, (GCompareFunc)g_strcmp0);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_afbee5493f93a3ddbed45c38d2682683d_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_afbee5493f93a3ddbed45c38d2682683d_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_afbee5493f93a3ddbed45c38d2682683d_icgraph" id="seafile_2lib_2utils_8c_afbee5493f93a3ddbed45c38d2682683d_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#a4e3d812b4dd80e30606f1346b726bd43" title="ccnet_peer_set_roles" alt="" coords="223,5,369,35"/><area shape="rect" id="node5" href="net_2common_2peer_8h.html#a5b55c1f14dab84485ee8892bbd572df0" title="ccnet_peer_set_myroles" alt="" coords="215,59,377,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6eb8b0fccfe316157ddb5a47d9cd3a71"></a><!-- doxytag: member="utils.c::string_list_remove" ref="a6eb8b0fccfe316157ddb5a47d9cd3a71" args="(GList *str_list, const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="ccnet_2lib_2utils_8h.html#a6eb8b0fccfe316157ddb5a47d9cd3a71">string_list_remove</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>str_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>string</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01355">1355</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_return_val_if_fail (<span class="keywordtype">string</span> != NULL, str_list);

    GList *ptr;

    <span class="keywordflow">for</span> (ptr = str_list; ptr; ptr = ptr-&gt;next) {
        <span class="keywordflow">if</span> (strcmp((<span class="keywordtype">char</span> *)ptr-&gt;data, <span class="keywordtype">string</span>) == 0) {
            g_free (ptr-&gt;data);
            <span class="keywordflow">return</span> g_list_delete_link (str_list, ptr);
        }
    }
    <span class="keywordflow">return</span> str_list;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a6eb8b0fccfe316157ddb5a47d9cd3a71_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a6eb8b0fccfe316157ddb5a47d9cd3a71_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a6eb8b0fccfe316157ddb5a47d9cd3a71_icgraph" id="seafile_2lib_2utils_8c_a6eb8b0fccfe316157ddb5a47d9cd3a71_icgraph">
<area shape="rect" id="node3" href="net_2common_2peer_8h.html#afd53f329ae2eaa8d97c17f0b0f05735e" title="ccnet_peer_remove_role" alt="" coords="183,5,345,35"/><area shape="rect" id="node5" href="peer-mgr_8h.html#af5c419e61b25896730c6917f9a5953e1" title="ccnet_peer_manager_remove_role" alt="" coords="395,5,616,35"/><area shape="rect" id="node7" href="rpc-service_8h.html#aae094018c7dc9ba17fa4d53eda81ee0c" title="ccnet_rpc_remove_role" alt="" coords="664,5,821,35"/><area shape="rect" id="node9" href="rpc-service_8h.html#a9b85de0fc2f785edf5666f0935c886cc" title="ccnet_start_rpc" alt="" coords="869,5,981,35"/><area shape="rect" id="node11" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1029,5,1080,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4bed2c887b506e8e25c0b9f1725f4684"></a><!-- doxytag: member="utils.c::string_list_sorted_is_equal" ref="a4bed2c887b506e8e25c0b9f1725f4684" args="(GList *list1, GList *list2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="ccnet_2lib_2utils_8h.html#a4bed2c887b506e8e25c0b9f1725f4684">string_list_sorted_is_equal</a> </td>
          <td>(</td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>list1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>list2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01429">1429</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ptr1 = list1, *ptr2 = list2;

    <span class="keywordflow">while</span> (ptr1 &amp;&amp; ptr2) {
        <span class="keywordflow">if</span> (g_strcmp0(ptr1-&gt;data, ptr2-&gt;data) != 0)
            <span class="keywordflow">break</span>;

        ptr1 = ptr1-&gt;next;
        ptr2 = ptr2-&gt;next;
    }

    <span class="keywordflow">if</span> (!ptr1 &amp;&amp; !ptr2)
        <span class="keywordflow">return</span> TRUE;
    <span class="keywordflow">return</span> FALSE;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab11a77475b1b6258fd066c9e7413dd3e"></a><!-- doxytag: member="utils.c::strjoin_n" ref="ab11a77475b1b6258fd066c9e7413dd3e" args="(const char *seperator, int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="ccnet_2lib_2utils_8h.html#ab11a77475b1b6258fd066c9e7413dd3e">strjoin_n</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>seperator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01182">1182</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GString *buf;
    <span class="keywordtype">int</span> i;
    <span class="keywordtype">char</span> *str;

    <span class="keywordflow">if</span> (argc == 0)
        <span class="keywordflow">return</span> NULL;
    
    buf = g_string_new (argv[0]);
    <span class="keywordflow">for</span> (i = 1; i &lt; argc; ++i) {
        g_string_append (buf, seperator);
        g_string_append (buf, argv[i]);
    }

    str = buf-&gt;str;
    g_string_free (buf, FALSE);
    <span class="keywordflow">return</span> str;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4fff2ff146c8734a7dd56989631e451e"></a><!-- doxytag: member="utils.c::strsplit_by_char" ref="a4fff2ff146c8734a7dd56989631e451e" args="(char *string, int *length, char c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** <a class="el" href="ccnet_2lib_2utils_8h.html#a4fff2ff146c8734a7dd56989631e451e">strsplit_by_char</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01136">1136</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *remainder, *s;
    <span class="keywordtype">int</span> <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a> = 8, num = 0, done = 0;
    <span class="keywordtype">char</span> **array;
    
    <span class="keywordflow">if</span> (<span class="keywordtype">string</span> == NULL || <span class="keywordtype">string</span>[0] == <span class="charliteral">&#39;\0&#39;</span>) {
        *length = 0;
        <span class="keywordflow">return</span> NULL;
    }

    array = malloc (<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *) * size);
    <span class="keywordflow">if</span> (array == NULL) {
      <span class="keywordflow">return</span> NULL;
    }
    
    remainder = string;
    <span class="keywordflow">while</span> (!done) {
        <span class="keywordflow">for</span> (s = remainder; *s != c &amp;&amp; *s != <span class="charliteral">&#39;\0&#39;</span>; ++s) ;

        <span class="keywordflow">if</span> (*s == <span class="charliteral">&#39;\0&#39;</span>)
            done = 1;
        <span class="keywordflow">else</span>
            *s = <span class="charliteral">&#39;\0&#39;</span>;

        array[num++] = remainder;
        <span class="keywordflow">if</span> (!done &amp;&amp; num == size) {
            size &lt;&lt;= 1;
            <span class="keywordtype">char</span>** tmp = realloc (array, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *) * size);
            <span class="keywordflow">if</span> (tmp == NULL) {
              free(array);
              <span class="keywordflow">return</span> NULL;
            }
            array = tmp;
        }

        remainder = s + 1;
    }
    
    <span class="keywordflow">if</span> (length != NULL) {
      *length = num;
    }

    <span class="keywordflow">return</span> array;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac488386314994c1d379a02d1ffd10993"></a><!-- doxytag: member="utils.c::strsplit_by_space" ref="ac488386314994c1d379a02d1ffd10993" args="(char *string, int *length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** <a class="el" href="ccnet_2lib_2utils_8h.html#ac488386314994c1d379a02d1ffd10993">strsplit_by_space</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l01088">1088</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *remainder, *s;
    <span class="keywordtype">int</span> <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a> = 8, num = 0, done = 0;
    <span class="keywordtype">char</span> **array;
    
    <span class="keywordflow">if</span> (<span class="keywordtype">string</span> == NULL || <span class="keywordtype">string</span>[0] == <span class="charliteral">&#39;\0&#39;</span>) {
        <span class="keywordflow">if</span> (length != NULL) {
          *length = 0;
        }
        <span class="keywordflow">return</span> NULL;
    }

    array = malloc (<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *) * size);
    <span class="keywordflow">if</span> (array == NULL) {
      <span class="keywordflow">return</span> NULL;
    }
    
    remainder = string;
    <span class="keywordflow">while</span> (!done) {
        <span class="keywordflow">for</span> (s = remainder; *s != <span class="charliteral">&#39; &#39;</span> &amp;&amp; *s != <span class="charliteral">&#39;\0&#39;</span>; ++s) ;

        <span class="keywordflow">if</span> (*s == <span class="charliteral">&#39;\0&#39;</span>)
            done = 1;
        <span class="keywordflow">else</span>
            *s = <span class="charliteral">&#39;\0&#39;</span>;

        array[num++] = remainder;
        <span class="keywordflow">if</span> (!done &amp;&amp; num == size) {
            size &lt;&lt;= 1;
            <span class="keywordtype">char</span>** tmp = realloc (array, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *) * size);
            <span class="keywordflow">if</span> (tmp == NULL) {
              free(array);
              <span class="keywordflow">return</span> NULL;
            }
            array = tmp;
        }

        remainder = s + 1;
    }
    
    <span class="keywordflow">if</span> (length != NULL) {
      *length = num;
    }

    <span class="keywordflow">return</span> array;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac0aa6c70f613ad3344b5f1f917b6b68a"></a><!-- doxytag: member="utils.c::timeval_from_msec" ref="ac0aa6c70f613ad3344b5f1f917b6b68a" args="(uint64_t milliseconds)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval <a class="el" href="ccnet_2lib_2utils_8h.html#ac0aa6c70f613ad3344b5f1f917b6b68a">timeval_from_msec</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>milliseconds</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00063">63</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>timeval ret;
    <span class="keyword">const</span> uint64_t microseconds = milliseconds * 1000;
    ret.tv_sec  = microseconds / 1000000;
    ret.tv_usec = microseconds % 1000000;
    <span class="keywordflow">return</span> ret;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_ac0aa6c70f613ad3344b5f1f917b6b68a_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_ac0aa6c70f613ad3344b5f1f917b6b68a_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_ac0aa6c70f613ad3344b5f1f917b6b68a_icgraph" id="seafile_2lib_2utils_8c_ac0aa6c70f613ad3344b5f1f917b6b68a_icgraph">
<area shape="rect" id="node3" href="timer_8c.html#a53f0bc44beb27249f5865c8d4a17abe6" title="ccnet_timer_new" alt="" coords="191,371,311,400"/><area shape="rect" id="node5" href="connect-mgr_8c.html#a0299b24dd94df7deaf1b1f044ba9f8ab" title="ccnet_conn_listen_init" alt="" coords="419,5,568,35"/><area shape="rect" id="node7" href="connect-mgr_8h.html#acf152de8620568a9e1a5bc5967647f5e" title="ccnet_conn_manager_start" alt="" coords="675,56,853,85"/><area shape="rect" id="node11" href="session_8h.html#a0e11c0052346a24c24cc913c066f7b3e" title="ccnet_session_start" alt="" coords="1141,108,1280,137"/><area shape="rect" id="node16" href="peer-mgr_8h.html#a3cf7ef30ba42ea273d8053276d19b19c" title="ccnet_peer_manager_start" alt="" coords="909,160,1085,189"/><area shape="rect" id="node20" href="mq-mgr_8h.html#a134878f616f816e9215d9227279047ee" title="seaf_mq_manager_start" alt="" coords="412,211,575,240"/><area shape="rect" id="node26" href="clone-mgr_8h.html#af1cec3356abdd2c8a92e8edc7ae79269" title="seaf_clone_manager_start" alt="" coords="407,264,580,293"/><area shape="rect" id="node28" href="http-tx-mgr_8h.html#af7268908c8fb9bdafab495f92ea07f86" title="http_tx_manager_start" alt="" coords="417,317,569,347"/><area shape="rect" id="node30" href="server_2repo-mgr_8c.html#a8f91693d20dfa77546527064cb1097e3" title="seaf_repo_manager_new" alt="" coords="411,371,576,400"/><area shape="rect" id="node32" href="sync-mgr_8h.html#a6b94a19a3cc3b20b29af0ae1e42abe4b" title="seaf_sync_manager_start" alt="" coords="408,424,579,453"/><area shape="rect" id="node34" href="transfer-mgr_8h.html#a624e73788448eb5afc0041fbb4db38c9" title="seaf_transfer_manager_start" alt="" coords="400,477,587,507"/><area shape="rect" id="node36" href="listen-mgr_8h.html#aa48e5c7e64f4ced1aefab2ae4aadb9bc" title="seaf_listen_manager_start" alt="" coords="407,531,580,560"/><area shape="rect" id="node40" href="passwd-mgr_8h.html#a92e852d808e7e8d74801f8c875d12e0a" title="seaf_passwd_manager_start" alt="" coords="399,584,588,613"/><area shape="rect" id="node43" href="size-sched_8h.html#a3589ff389112b9fc50d7b8181c602c25" title="size_scheduler_start" alt="" coords="423,637,564,667"/><area shape="rect" id="node46" href="virtual-repo_8c.html#a9545839eb2c54af7e7e2e3948647f47c" title="seaf_repo_manager_init_merge_scheduler" alt="" coords="360,744,627,773"/><area shape="rect" id="node50" href="web-accesstoken-mgr_8h.html#afba69ea37c995b2b0435ecced759c315" title="seaf_web_at_manager_start" alt="" coords="400,691,587,720"/><area shape="rect" id="node9" href="session_8h.html#ac444b67d9abd4a5d33d51f1c7aa8e500" title="ccnet_session_start_network" alt="" coords="901,56,1093,85"/><area shape="rect" id="node13" href="server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1328,108,1379,137"/><area shape="rect" id="node22" href="server_2seafile-session_8h.html#afb1838a556e838aea9515780411cf284" title="seafile_session_start" alt="" coords="692,212,836,241"/><area shape="rect" id="node24" href="seaf-daemon_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="972,213,1023,243"/><area shape="rect" id="node38" href="server_2seafile-session_8c.html#afb1838a556e838aea9515780411cf284" title="seafile_session_start" alt="" coords="692,611,836,640"/><area shape="rect" id="node48" href="server_2repo-mgr_8c.html#a8dab773e289d1148e7afec7c8614278a" title="seaf_repo_manager_init" alt="" coords="684,744,844,773"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6a9988632dc9e05f10a71688fd280cc9"></a><!-- doxytag: member="utils.c::writen" ref="a6a9988632dc9e05f10a71688fd280cc9" args="(int fd, const void *vptr, size_t n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t <a class="el" href="ccnet_2lib_2utils_8h.html#a6a9988632dc9e05f10a71688fd280cc9">writen</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>vptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="seafile_2lib_2utils_8c_source.html#l00745">745</a> of file <a class="el" href="seafile_2lib_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">size_t</span>          nleft;
        ssize_t         nwritten;
        <span class="keyword">const</span> <span class="keywordtype">char</span>      *ptr;

        ptr = vptr;
        nleft = n;
        <span class="keywordflow">while</span> (nleft &gt; 0) {
                <span class="keywordflow">if</span> ( (nwritten = write(fd, ptr, nleft)) &lt;= 0) {
                        <span class="keywordflow">if</span> (nwritten &lt; 0 &amp;&amp; errno == EINTR)
                                nwritten = 0;           <span class="comment">/* and call write() again */</span>
                        <span class="keywordflow">else</span>
                                <span class="keywordflow">return</span>(-1);                     <span class="comment">/* error */</span>
                }

                nleft -= nwritten;
                ptr   += nwritten;
        }
        <span class="keywordflow">return</span>(n);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="seafile_2lib_2utils_8c_a6a9988632dc9e05f10a71688fd280cc9_icgraph.png" border="0" usemap="#seafile_2lib_2utils_8c_a6a9988632dc9e05f10a71688fd280cc9_icgraph" alt=""/></div>
<map name="seafile_2lib_2utils_8c_a6a9988632dc9e05f10a71688fd280cc9_icgraph" id="seafile_2lib_2utils_8c_a6a9988632dc9e05f10a71688fd280cc9_icgraph">
<area shape="rect" id="node3" href="lib_2packet-io_8h.html#a4d8c332ceb771ba04d287d3663175ce2" title="ccnet_packet_send" alt="" coords="113,32,247,61"/><area shape="rect" id="node13" href="ccnet_2lib_2utils_8h.html#a8e7da7ad650a6da09c1f679479335ed1" title="copy_fd" alt="" coords="147,85,213,115"/><area shape="rect" id="node5" href="lib_2packet-io_8h.html#ae2377103dcd3d686ece66c456c21a6bb" title="ccnet_packet_finish_send" alt="" coords="296,32,469,61"/><area shape="rect" id="node7" href="ccnet-client_8c.html#a739e644c7d22796b265b8ac0c25e18b1" title="ccnet_client_send_request" alt="" coords="519,32,695,61"/><area shape="rect" id="node9" href="net_2common_2processor_8h.html#ac354e19db989f98be49e2559b7def26f" title="ccnet_processor_send_request" alt="" coords="749,5,952,35"/><area shape="rect" id="node11" href="net_2common_2processor_8h.html#a715833e353a1aa175c21dd2af48e10de" title="ccnet_processor_send_request_l" alt="" coords="744,59,957,88"/><area shape="rect" id="node15" href="ccnet_2lib_2utils_8h.html#a9f585ff92128cbf174ef4b3a9b429d08" title="copy_file" alt="" coords="345,85,420,115"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:55:50 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
