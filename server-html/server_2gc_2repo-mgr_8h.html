<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/server/gc/repo-mgr.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/server/gc/repo-mgr.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="seafile-object_8h_source.html">seafile-object.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="commit-mgr_8h_source.html">commit-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="branch-mgr_8h_source.html">branch-mgr.h</a>&quot;</code><br/>
</div>
<p><a href="server_2gc_2repo-mgr_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__SeafRepo.html">_SeafRepo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__SeafRepoManager.html">_SeafRepoManager</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a2d6340e4ada61e93d58c0411fa6fcfe5">REPO_AUTO_SYNC</a>&#160;&#160;&#160;&quot;auto-sync&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a502b8f6b8ad6882683294f590b302cc0">REPO_AUTO_FETCH</a>&#160;&#160;&#160;&quot;auto-fetch&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ade9494be6db68ada29c0b9812da1f762">REPO_AUTO_UPLOAD</a>&#160;&#160;&#160;&quot;auto-upload&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ae570b1e2acc8cfd7c3433f974674cfa9">REPO_AUTO_MERGE</a>&#160;&#160;&#160;&quot;auto-merge&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ac5d086060283109eedf8bb27d3e7965c">REPO_AUTO_COMMIT</a>&#160;&#160;&#160;&quot;auto-commit&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a88e179c17ec642b434e82bb40403a6ba">REPO_RELAY_ID</a>&#160;&#160;&#160;&quot;relay-id&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a4dc57106ac24f4cf008c10b85ae1e384">REPO_NET_BROWSABLE</a>&#160;&#160;&#160;&quot;net-browsable&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ae717be3f43ee1abacd91e3703906d518">REPO_DOUBLE_SYNC</a>&#160;&#160;&#160;&quot;double-sync&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#af63040384723b88eb87e261c8ebb298b">REPO_REMOTE_HEAD</a>&#160;&#160;&#160;&quot;remote-head&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a913fa2a61a58336164c1d2538e12f60e">REPO_ENCRYPTED</a>&#160;&#160;&#160;0x1</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafRepo.html">_SeafRepo</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a40426440d590ec0161993d5850b3ec47">SeafVirtRepo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafRepoManager.html">_SeafRepoManager</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__SeafRepoManagerPriv.html">_SeafRepoManagerPriv</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a4c34a185eca37d07c53358b27bd439f2">SeafRepoManagerPriv</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a35ce9f51287bbd5f961c261516c1c5f0">is_repo_id_valid</a> (const char *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a63ab9fe4694e3d967376c911cbe2c655">seaf_repo_new</a> (const char *id, const char *<a class="el" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, const char *desc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ad0a65514ad80789ff244b20c66460b96">seaf_repo_free</a> (<a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ab8f60cbbd6c35ee55ea72acbbd3a1608">seaf_repo_ref</a> (<a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#af6bedb063685823d91f2a335c6882e07">seaf_repo_unref</a> (<a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a39a9a41ffdfc324f3c935251d9e14d51">seaf_repo_to_commit</a> (<a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo, <a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *commit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a9c8ead9892374c87ece888d76e810197">seaf_repo_from_commit</a> (<a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo, <a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *commit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a66a6ccfc59462f4c59fd322c693c3d5a">seaf_virtual_repo_info_free</a> (<a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a> *vinfo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a640edf431de146c19d5ac2cff6321397">seaf_repo_manager_new</a> (struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *<a class="el" href="server_2seafile-session_8h.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a8dab773e289d1148e7afec7c8614278a">seaf_repo_manager_init</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a2e049cfa3d0546aaf51e7f6792e1467d">seaf_repo_manager_start</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a2c0a60c4eefbb0b4bc68bf871856f32d">seaf_repo_manager_add_repo</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, <a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#afdce2de6ee36dcf6b6264ac35fb17f7a">seaf_repo_manager_del_repo</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, <a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *repo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *manager, const gchar *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a11cc1a4ecd45778ea5a10af0cb72b347">seaf_repo_manager_get_repo_ex</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *manager, const gchar *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a4b2497e6cdde50c4ce3cb642370e06eb">seaf_repo_manager_repo_exists</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *manager, const gchar *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a2272730e6465361e0e715fa029ace947">seaf_repo_manager_get_repo_list</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, int start, int limit, gboolean *error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a928ca86df93e60744ca6edacb33a386f">seaf_repo_manager_get_repo_id_list</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ac78c13c68a1a9d1d025e45f4e51193ac">seaf_repo_manager_set_repo_history_limit</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id, int days)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a0f63ca499435a0d01f03c8c3a2d86c44">seaf_repo_manager_get_repo_history_limit</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#aeeda6cf1cb41515388afd8a10c6297e1">seaf_repo_manager_set_repo_valid_since</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id, gint64 timestamp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#aa8aafa2da81a00419443a068fe98958b">seaf_repo_manager_get_repo_valid_since</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a774e0a8ea59c07c94dc8014612b3f948">seaf_repo_manager_get_repo_truncate_time</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a316db228b35dde3dc88ae9dab9ec9c22">seaf_repo_manager_get_virtual_repo_info</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a0e2fecd8fae5355455342e43f6588967">seaf_repo_manager_get_virtual_repo_ids_by_origin</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *origin_repo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#ae45351706ea0868c8e6c9bad500e1785">seaf_repo_manager_list_garbage_repos</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_2gc_2repo-mgr_8h.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> (<a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *mgr, const char *repo_id)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac5d086060283109eedf8bb27d3e7965c"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_AUTO_COMMIT" ref="ac5d086060283109eedf8bb27d3e7965c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#ac5d086060283109eedf8bb27d3e7965c">REPO_AUTO_COMMIT</a>&#160;&#160;&#160;&quot;auto-commit&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00016">16</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a502b8f6b8ad6882683294f590b302cc0"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_AUTO_FETCH" ref="a502b8f6b8ad6882683294f590b302cc0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#a502b8f6b8ad6882683294f590b302cc0">REPO_AUTO_FETCH</a>&#160;&#160;&#160;&quot;auto-fetch&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00013">13</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae570b1e2acc8cfd7c3433f974674cfa9"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_AUTO_MERGE" ref="ae570b1e2acc8cfd7c3433f974674cfa9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#ae570b1e2acc8cfd7c3433f974674cfa9">REPO_AUTO_MERGE</a>&#160;&#160;&#160;&quot;auto-merge&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00015">15</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2d6340e4ada61e93d58c0411fa6fcfe5"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_AUTO_SYNC" ref="a2d6340e4ada61e93d58c0411fa6fcfe5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#a2d6340e4ada61e93d58c0411fa6fcfe5">REPO_AUTO_SYNC</a>&#160;&#160;&#160;&quot;auto-sync&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00012">12</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ade9494be6db68ada29c0b9812da1f762"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_AUTO_UPLOAD" ref="ade9494be6db68ada29c0b9812da1f762" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#ade9494be6db68ada29c0b9812da1f762">REPO_AUTO_UPLOAD</a>&#160;&#160;&#160;&quot;auto-upload&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00014">14</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae717be3f43ee1abacd91e3703906d518"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_DOUBLE_SYNC" ref="ae717be3f43ee1abacd91e3703906d518" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#ae717be3f43ee1abacd91e3703906d518">REPO_DOUBLE_SYNC</a>&#160;&#160;&#160;&quot;double-sync&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00019">19</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a913fa2a61a58336164c1d2538e12f60e"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_ENCRYPTED" ref="a913fa2a61a58336164c1d2538e12f60e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#a913fa2a61a58336164c1d2538e12f60e">REPO_ENCRYPTED</a>&#160;&#160;&#160;0x1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00021">21</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4dc57106ac24f4cf008c10b85ae1e384"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_NET_BROWSABLE" ref="a4dc57106ac24f4cf008c10b85ae1e384" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#a4dc57106ac24f4cf008c10b85ae1e384">REPO_NET_BROWSABLE</a>&#160;&#160;&#160;&quot;net-browsable&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00018">18</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a88e179c17ec642b434e82bb40403a6ba"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_RELAY_ID" ref="a88e179c17ec642b434e82bb40403a6ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#a88e179c17ec642b434e82bb40403a6ba">REPO_RELAY_ID</a>&#160;&#160;&#160;&quot;relay-id&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00017">17</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="af63040384723b88eb87e261c8ebb298b"></a><!-- doxytag: member="repo&#45;mgr.h::REPO_REMOTE_HEAD" ref="af63040384723b88eb87e261c8ebb298b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="server_2repo-mgr_8h.html#af63040384723b88eb87e261c8ebb298b">REPO_REMOTE_HEAD</a>&#160;&#160;&#160;&quot;remote-head&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00020">20</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a3e8b6c8c2a077518a17c75c6ace3ae1c"></a><!-- doxytag: member="repo&#45;mgr.h::SeafRepo" ref="a3e8b6c8c2a077518a17c75c6ace3ae1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafRepo.html">_SeafRepo</a> <a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00024">24</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="af5833aac28a20ee1e1217fc33b9c3a54"></a><!-- doxytag: member="repo&#45;mgr.h::SeafRepoManager" ref="af5833aac28a20ee1e1217fc33b9c3a54" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafRepoManager.html">_SeafRepoManager</a> <a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00085">85</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4c34a185eca37d07c53358b27bd439f2"></a><!-- doxytag: member="repo&#45;mgr.h::SeafRepoManagerPriv" ref="a4c34a185eca37d07c53358b27bd439f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__SeafRepoManagerPriv.html">_SeafRepoManagerPriv</a> <a class="el" href="daemon_2repo-mgr_8h.html#a4c34a185eca37d07c53358b27bd439f2">SeafRepoManagerPriv</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8h_source.html#l00086">86</a> of file <a class="el" href="server_2gc_2repo-mgr_8h_source.html">repo-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a40426440d590ec0161993d5850b3ec47"></a><!-- doxytag: member="repo&#45;mgr.h::SeafVirtRepo" ref="a40426440d590ec0161993d5850b3ec47" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a>  <a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a35ce9f51287bbd5f961c261516c1c5f0"></a><!-- doxytag: member="repo&#45;mgr.h::is_repo_id_valid" ref="a35ce9f51287bbd5f961c261516c1c5f0" args="(const char *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="server_2repo-mgr_8h.html#a35ce9f51287bbd5f961c261516c1c5f0">is_repo_id_valid</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l00527">527</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>)
        <span class="keywordflow">return</span> FALSE;

    <span class="keywordflow">return</span> <a class="code" href="seafile_2lib_2utils_8c.html#a48ecdc72b727191abafbbf2ec1f70ace">is_uuid_valid</a> (<span class="keywordtype">id</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad0a65514ad80789ff244b20c66460b96"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_free" ref="ad0a65514ad80789ff244b20c66460b96" args="(SeafRepo *repo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="server_2repo-mgr_8h.html#ad0a65514ad80789ff244b20c66460b96">seaf_repo_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l00607">607</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a>) <a class="code" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653">seaf_branch_unref</a> (repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a>);

    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a>);
    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#a2bcd0258d3e8deb15a45aa8403c9156d">desc</a>);
    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#a4d7c42c5644eb9dbfd24bf43adb9316c">category</a>);
    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#a4342ff79933f9cbdbbd34114e5a26df3">worktree</a>);
    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#a5ec79fa4b78423415fc5f31b90fa5bd1">relay_id</a>);
    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#aaeff5900edfc0f7bcb9c97592b70d247">email</a>);
    g_free (repo-&gt;<a class="code" href="struct__SeafRepo.html#a0ce3b61cb31e78ffea429615379b3eb4">token</a>);
    g_free (repo);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9c8ead9892374c87ece888d76e810197"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_from_commit" ref="a9c8ead9892374c87ece888d76e810197" args="(SeafRepo *repo, SeafCommit *commit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="server_2repo-mgr_8h.html#a9c8ead9892374c87ece888d76e810197">seaf_repo_from_commit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *&#160;</td>
          <td class="paramname"><em>commit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l00663">663</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a> = g_strdup (commit-&gt;<a class="code" href="struct__SeafCommit.html#aacd7b88f8a3e72446cd7352396eaa09e">repo_name</a>);
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a2bcd0258d3e8deb15a45aa8403c9156d">desc</a> = g_strdup (commit-&gt;<a class="code" href="struct__SeafCommit.html#aa3d8e868c630cfbecbcb9158c4bbe2e4">repo_desc</a>);
    repo-&gt;<a class="code" href="struct__SeafRepo.html#ab50d0e015838fe83d735ba2d6cb40804">encrypted</a> = commit-&gt;<a class="code" href="struct__SeafCommit.html#a906e77d2a658f4337437ff8694a4bfc0">encrypted</a>;
    <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__SeafRepo.html#ab50d0e015838fe83d735ba2d6cb40804">encrypted</a>) {
        repo-&gt;<a class="code" href="struct__SeafRepo.html#af4cb7f672489dceb52cbd47da097ebf8">enc_version</a> = commit-&gt;<a class="code" href="struct__SeafCommit.html#a52953918e881ce013cd741deff721a70">enc_version</a>;
        <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__SeafRepo.html#af4cb7f672489dceb52cbd47da097ebf8">enc_version</a> == 1)
            memcpy (repo-&gt;<a class="code" href="struct__SeafRepo.html#ab067d494e7ac35fb57f0a3c448e816d2">magic</a>, commit-&gt;<a class="code" href="struct__SeafCommit.html#a8e7caa10438ce42d7d39f57090768a9e">magic</a>, 32);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__SeafRepo.html#af4cb7f672489dceb52cbd47da097ebf8">enc_version</a> == 2) {
            memcpy (repo-&gt;<a class="code" href="struct__SeafRepo.html#ab067d494e7ac35fb57f0a3c448e816d2">magic</a>, commit-&gt;<a class="code" href="struct__SeafCommit.html#a8e7caa10438ce42d7d39f57090768a9e">magic</a>, 64);
            memcpy (repo-&gt;<a class="code" href="struct__SeafRepo.html#a83e0a2366ba320396f2deb6faa167b84">random_key</a>, commit-&gt;<a class="code" href="struct__SeafCommit.html#ab1d44814bc44472105aef8761656e3d7">random_key</a>, 96);
        }
    }
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a4710aaee11c7887df402fffa7ca6c54f">no_local_history</a> = commit-&gt;<a class="code" href="struct__SeafCommit.html#a383ea4a4b94417c7d9e9827d60420d64">no_local_history</a>;
    repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a> = commit-&gt;<a class="code" href="struct__SeafCommit.html#abc83f168ce2b43fa864522bf0ea26d6d">version</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2c0a60c4eefbb0b4bc68bf871856f32d"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_add_repo" ref="a2c0a60c4eefbb0b4bc68bf871856f32d" args="(SeafRepoManager *mgr, SeafRepo *repo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#a2c0a60c4eefbb0b4bc68bf871856f32d">seaf_repo_manager_add_repo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l04002">4002</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> sql[256];
    sqlite3 *db = manager-&gt;priv-&gt;db;

    pthread_mutex_lock (&amp;manager-&gt;priv-&gt;db_lock);

    snprintf (sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;REPLACE INTO Repo VALUES (&#39;%s&#39;);&quot;</span>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>);
    <a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (db, sql);

    pthread_mutex_unlock (&amp;manager-&gt;priv-&gt;db_lock);

    <span class="comment">/* There may be a &quot;deletion record&quot; for this repo when it was deleted</span>
<span class="comment">     * last time.</span>
<span class="comment">     */</span>
    <a class="code" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> (manager, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>);

    repo-&gt;<a class="code" href="struct__SeafRepo.html#a9bae0acc12e2e63b0686027f7399e034">manager</a> = manager;

    <span class="keywordflow">if</span> (pthread_rwlock_wrlock (&amp;manager-&gt;priv-&gt;lock) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[repo mgr] failed to lock repo cache.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    g_hash_table_insert (manager-&gt;priv-&gt;repo_hash, g_strdup(repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>), repo);

    pthread_rwlock_unlock (&amp;manager-&gt;priv-&gt;lock);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afdce2de6ee36dcf6b6264ac35fb17f7a"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_del_repo" ref="afdce2de6ee36dcf6b6264ac35fb17f7a" args="(SeafRepoManager *mgr, SeafRepo *repo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#a512a79980f7d3698e591cf87aeccd314">seaf_repo_manager_del_repo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l04184">4184</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c">seaf_repo_manager_remove_repo_ondisk</a> (mgr, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>,
                                          (repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a> &gt; 0) ? TRUE : FALSE);

    <span class="keywordflow">if</span> (pthread_rwlock_wrlock (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[repo mgr] failed to lock repo cache.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    g_hash_table_remove (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2f794f66ac8c2ae2d902a881cf505a80">repo_hash</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>);

    pthread_rwlock_unlock (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>);

    <a class="code" href="daemon_2repo-mgr_8c.html#ad0a65514ad80789ff244b20c66460b96">seaf_repo_free</a> (repo);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af0276c036723560e3e8b9aa5529133d6"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo" ref="af0276c036723560e3e8b9aa5529133d6" args="(SeafRepoManager *manager, const gchar *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a>* <a class="el" href="server_2repo-mgr_8h.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l04208">4208</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *res;

    <span class="keywordflow">if</span> (pthread_rwlock_rdlock (&amp;manager-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[repo mgr] failed to lock repo cache.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    res = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2f794f66ac8c2ae2d902a881cf505a80">repo_hash</a>, <span class="keywordtype">id</span>);

    pthread_rwlock_unlock (&amp;manager-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>);

    <span class="keywordflow">if</span> (res &amp;&amp; !res-&gt;<a class="code" href="struct__SeafRepo.html#a1316126e566b3b2c1d444c9a9511b2ff">delete_pending</a>)
        <span class="keywordflow">return</span> res;

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a11cc1a4ecd45778ea5a10af0cb72b347"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo_ex" ref="a11cc1a4ecd45778ea5a10af0cb72b347" args="(SeafRepoManager *manager, const gchar *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a>* <a class="el" href="server_2repo-mgr_8h.html#a11cc1a4ecd45778ea5a10af0cb72b347">seaf_repo_manager_get_repo_ex</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00249">249</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> len = strlen(<span class="keywordtype">id</span>);
    gboolean db_err = FALSE, exists;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *ret = NULL;

    <span class="keywordflow">if</span> (len &gt;= 37)
        <span class="keywordflow">return</span> NULL;

    exists = repo_exists_in_db_ex (manager-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, <span class="keywordtype">id</span>, &amp;db_err);

    <span class="keywordflow">if</span> (db_err) {
        ret = <a class="code" href="daemon_2repo-mgr_8c.html#a63ab9fe4694e3d967376c911cbe2c655">seaf_repo_new</a>(<span class="keywordtype">id</span>, NULL, NULL);
        ret-&gt;<a class="code" href="struct__SeafRepo.html#a30acbbe15ec4e36a8b3bb31581c333e5">is_corrupted</a> = TRUE;
        <span class="keywordflow">return</span> ret;
    }

    <span class="keywordflow">if</span> (exists) {
        ret = load_repo (manager, <span class="keywordtype">id</span>, TRUE);
        <span class="keywordflow">return</span> ret;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0f63ca499435a0d01f03c8c3a2d86c44"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo_history_limit" ref="a0f63ca499435a0d01f03c8c3a2d86c44" args="(SeafRepoManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#a0f63ca499435a0d01f03c8c3a2d86c44">seaf_repo_manager_get_repo_history_limit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00471">471</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structSeafVirtRepo.html">SeafVirtRepo</a> *vinfo;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *r_repo_id = repo_id;
    <span class="keywordtype">char</span> sql[256];
    <span class="keywordtype">int</span> per_repo_days = -1;

    vinfo = <a class="code" href="server_2gc_2repo-mgr_8c.html#a316db228b35dde3dc88ae9dab9ec9c22">seaf_repo_manager_get_virtual_repo_info</a> (mgr, repo_id);
    <span class="keywordflow">if</span> (vinfo)
        r_repo_id = vinfo-&gt;<a class="code" href="structSeafVirtRepo.html#a23bc0205036c7a0c807c4f89145794b1">origin_repo_id</a>;

    snprintf (sql, <span class="keyword">sizeof</span>(sql),
              <span class="stringliteral">&quot;SELECT days FROM RepoHistoryLimit WHERE repo_id=&#39;%s&#39;&quot;</span>,
              r_repo_id);
    <a class="code" href="server_2gc_2repo-mgr_8c.html#a66a6ccfc59462f4c59fd322c693c3d5a">seaf_virtual_repo_info_free</a> (vinfo);

    <span class="comment">/* We don&#39;t use seaf_db_get_int() because we need to differ DB error</span>
<span class="comment">     * from not exist.</span>
<span class="comment">     * We can&#39;t just return global config value if DB error occured,</span>
<span class="comment">     * since the global value may be smaller than per repo one.</span>
<span class="comment">     * This can lead to data lose in GC.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a2b045ec7501c5141b95a01ba752947d4">seaf_db_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, sql,
                                      get_limit, &amp;per_repo_days) &lt; 0) {
        seaf_warning (<span class="stringliteral">&quot;DB error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* If per repo value is not set, return the global one. */</span>
    <span class="keywordflow">if</span> (per_repo_days &lt; 0)
        <span class="keywordflow">return</span> mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ad1d597138a7b676e94cd273a4a446776">keep_history_days</a>;

    <span class="keywordflow">return</span> per_repo_days;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a928ca86df93e60744ca6edacb33a386f"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo_id_list" ref="a928ca86df93e60744ca6edacb33a386f" args="(SeafRepoManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="server_2repo-mgr_8h.html#a928ca86df93e60744ca6edacb33a386f">seaf_repo_manager_get_repo_id_list</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fuse_2repo-mgr_8c_source.html#l00350">350</a> of file <a class="el" href="fuse_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ret = NULL;
    <span class="keywordtype">char</span> sql[256];

    snprintf (sql, 256, <span class="stringliteral">&quot;SELECT repo_id FROM Repo&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a2b045ec7501c5141b95a01ba752947d4">seaf_db_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, sql, 
                                      collect_repo_id, &amp;ret) &lt; 0)
        <span class="keywordflow">return</span> NULL;

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2272730e6465361e0e715fa029ace947"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo_list" ref="a2272730e6465361e0e715fa029ace947" args="(SeafRepoManager *mgr, int start, int limit, gboolean *error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="server_2repo-mgr_8h.html#aa692b1e331cad063425d676afe1ae121">seaf_repo_manager_get_repo_list</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean *&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00378">378</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> sql[256];
    GList *id_list = NULL, *ptr;
    GList *ret = NULL;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;

    *error = FALSE;

    <span class="keywordflow">if</span> (start == -1 &amp;&amp; limit == -1)
        snprintf (sql, 256, <span class="stringliteral">&quot;SELECT repo_id FROM Repo&quot;</span>);
    <span class="keywordflow">else</span>
        snprintf (sql, 256, <span class="stringliteral">&quot;SELECT repo_id FROM Repo LIMIT %d, %d&quot;</span>, start, limit);

    <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a2b045ec7501c5141b95a01ba752947d4">seaf_db_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, sql, 
                                      collect_repo_id, &amp;id_list) &lt; 0)
        <span class="keywordflow">goto</span> error;

    <span class="keywordflow">for</span> (ptr = id_list; ptr; ptr = ptr-&gt;next) {
        <span class="keywordtype">char</span> *repo_id = ptr-&gt;data;
        repo = <a class="code" href="server_2gc_2repo-mgr_8c.html#a11cc1a4ecd45778ea5a10af0cb72b347">seaf_repo_manager_get_repo_ex</a> (mgr, repo_id);
        <span class="keywordflow">if</span> (repo)
            ret = g_list_prepend (ret, repo);
    }

    <a class="code" href="seafile_2lib_2utils_8c.html#af85d9a3e4ab846a6eedfb509508367f2">string_list_free</a> (id_list);
    <span class="keywordflow">return</span> ret;

error:
    *error = TRUE;
    <a class="code" href="seafile_2lib_2utils_8c.html#af85d9a3e4ab846a6eedfb509508367f2">string_list_free</a> (id_list);
    <span class="keywordflow">for</span> (ptr = ret; ptr; ptr = ptr-&gt;next) {
        repo = ptr-&gt;data;
        <a class="code" href="fuse_2repo-mgr_8c.html#af6bedb063685823d91f2a335c6882e07">seaf_repo_unref</a> (repo);
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a774e0a8ea59c07c94dc8014612b3f948"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo_truncate_time" ref="a774e0a8ea59c07c94dc8014612b3f948" args="(SeafRepoManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="server_2repo-mgr_8h.html#a774e0a8ea59c07c94dc8014612b3f948">seaf_repo_manager_get_repo_truncate_time</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00557">557</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> days;
    gint64 timestamp;

    days = <a class="code" href="server_2gc_2repo-mgr_8c.html#a0f63ca499435a0d01f03c8c3a2d86c44">seaf_repo_manager_get_repo_history_limit</a> (mgr, repo_id);
    timestamp = <a class="code" href="server_2gc_2repo-mgr_8c.html#aa8aafa2da81a00419443a068fe98958b">seaf_repo_manager_get_repo_valid_since</a> (mgr, repo_id);

    gint64 now = (gint64)time(NULL);
    <span class="keywordflow">if</span> (days &gt; 0)
        <span class="keywordflow">return</span> MAX (now - days * 24 * 3600, timestamp);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (days &lt; 0)
        <span class="keywordflow">return</span> timestamp;
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa8aafa2da81a00419443a068fe98958b"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_repo_valid_since" ref="aa8aafa2da81a00419443a068fe98958b" args="(SeafRepoManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="server_2repo-mgr_8h.html#aa8aafa2da81a00419443a068fe98958b">seaf_repo_manager_get_repo_valid_since</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00544">544</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> sql[256];

    snprintf (sql, <span class="keyword">sizeof</span>(sql),
              <span class="stringliteral">&quot;SELECT timestamp FROM RepoValidSince WHERE repo_id=&#39;%s&#39;&quot;</span>,
              repo_id);
    <span class="comment">/* Also return -1 if DB error. */</span>
    <span class="keywordflow">return</span> <a class="code" href="seaf-db_8c.html#a401edd7e7937648d96ffb06486097020">seaf_db_get_int64</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, sql);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0e2fecd8fae5355455342e43f6588967"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_virtual_repo_ids_by_origin" ref="a0e2fecd8fae5355455342e43f6588967" args="(SeafRepoManager *mgr, const char *origin_repo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="virtual-repo_8c.html#a0e2fecd8fae5355455342e43f6588967">seaf_repo_manager_get_virtual_repo_ids_by_origin</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>origin_repo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00632">632</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ret = NULL;
    <span class="keywordtype">char</span> sql[256];

    snprintf (sql, 256,
              <span class="stringliteral">&quot;SELECT repo_id FROM VirtualRepo WHERE origin_repo=&#39;%s&#39;&quot;</span>,
              origin_repo);
    <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a2b045ec7501c5141b95a01ba752947d4">seaf_db_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, sql, 
                                      collect_virtual_repo_ids, &amp;ret) &lt; 0) {
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> g_list_reverse (ret);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a316db228b35dde3dc88ae9dab9ec9c22"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_get_virtual_repo_info" ref="a316db228b35dde3dc88ae9dab9ec9c22" args="(SeafRepoManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a>* <a class="el" href="virtual-repo_8c.html#a316db228b35dde3dc88ae9dab9ec9c22">seaf_repo_manager_get_virtual_repo_info</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00596">596</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> sql[256];
    <a class="code" href="structSeafVirtRepo.html">SeafVirtRepo</a> *vinfo = NULL;

    snprintf (sql, 256,
              <span class="stringliteral">&quot;SELECT origin_repo, path, base_commit FROM VirtualRepo &quot;</span>
              <span class="stringliteral">&quot;WHERE repo_id = &#39;%s&#39;&quot;</span>, repo_id);
    <a class="code" href="seaf-db_8c.html#a2b045ec7501c5141b95a01ba752947d4">seaf_db_foreach_selected_row</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>, sql, load_virtual_info, &amp;vinfo);

    <span class="keywordflow">return</span> vinfo;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8dab773e289d1148e7afec7c8614278a"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_init" ref="a8dab773e289d1148e7afec7c8614278a" args="(SeafRepoManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#a8dab773e289d1148e7afec7c8614278a">seaf_repo_manager_init</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l03932">3932</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2utils_8c.html#ace0bdb78b60b2d088517a3e03a448e8b">checkdir_with_mkdir</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a24a8835becd3d59636e13e5cc0cfc365">index_dir</a>) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Index dir %s does not exist and is unable to create\n&quot;</span>,
                   mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a24a8835becd3d59636e13e5cc0cfc365">index_dir</a>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* Load all the repos into memory on the client side. */</span>
    load_repos (mgr, mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae45351706ea0868c8e6c9bad500e1785"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_list_garbage_repos" ref="ae45351706ea0868c8e6c9bad500e1785" args="(SeafRepoManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="server_2gc_2repo-mgr_8h.html#ae45351706ea0868c8e6c9bad500e1785">seaf_repo_manager_list_garbage_repos</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l04068">4068</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *repo_ids = NULL;

    pthread_mutex_lock (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2d296323690da59659d544a5064a7f86">db_lock</a>);

    <a class="code" href="seafile_2lib_2db_8c.html#a17cffec15ffa34446ad00f950eab6fe2">sqlite_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a564132cff6405324fa2a118c2368bbc0">db</a>,
                                 <span class="stringliteral">&quot;SELECT repo_id FROM GarbageRepos&quot;</span>,
                                 get_garbage_repo_id, &amp;repo_ids);
    pthread_mutex_unlock (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2d296323690da59659d544a5064a7f86">db_lock</a>);

    <span class="keywordflow">return</span> repo_ids;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a640edf431de146c19d5ac2cff6321397"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_new" ref="a640edf431de146c19d5ac2cff6321397" args="(struct _SeafileSession *seaf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a>* <a class="el" href="server_2repo-mgr_8h.html#a640edf431de146c19d5ac2cff6321397">seaf_repo_manager_new</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *&#160;</td>
          <td class="paramname"><em>seaf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l03899">3899</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepoManager.html">SeafRepoManager</a> *mgr = g_new0 (<a class="code" href="struct__SeafRepoManager.html">SeafRepoManager</a>, 1);

    mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a> = g_new0 (<a class="code" href="struct__SeafRepoManagerPriv.html">SeafRepoManagerPriv</a>, 1);
    mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a> = <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>;
    mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a24a8835becd3d59636e13e5cc0cfc365">index_dir</a> = g_build_path (<a class="code" href="vc-utils_8h.html#aa7da4cdc6796b13fca1a4b263488dfdd">PATH_SEPERATOR</a>, seaf-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>, <a class="code" href="daemon_2repo-mgr_8c.html#a823aa5bebe4b4b836619cae12751b8a5">INDEX_DIR</a>, NULL);

    pthread_mutex_init (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2d296323690da59659d544a5064a7f86">db_lock</a>, NULL);

    mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a838d8143e2728faf6cd40dcd4e6a2f3e">checkout_tasks_hash</a> = g_hash_table_new_full
        (g_str_hash, g_str_equal, g_free, g_free);

    ignore_patterns = g_new0 (GPatternSpec*, G_N_ELEMENTS(ignore_table));
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span> (i = 0; ignore_table[i] != NULL; i++) {
        ignore_patterns[i] = g_pattern_spec_new (ignore_table[i]);
    }

    office_temp_ignore_patterns[0] = g_pattern_spec_new(<span class="stringliteral">&quot;~$*&quot;</span>);
    <span class="comment">/* for files like ~WRL0001.tmp */</span>
    office_temp_ignore_patterns[1] = g_pattern_spec_new(<span class="stringliteral">&quot;~*.tmp&quot;</span>);
    office_temp_ignore_patterns[2] = g_pattern_spec_new(<span class="stringliteral">&quot;.~lock*#&quot;</span>);
    office_temp_ignore_patterns[3] = NULL;

    mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2f794f66ac8c2ae2d902a881cf505a80">repo_hash</a> = g_hash_table_new_full (g_str_hash, g_str_equal, g_free, NULL);

    pthread_rwlock_init (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>, NULL);

    <span class="keywordflow">return</span> mgr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7d2cf85f06fa2e7d459730f7494c1a65"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_remove_garbage_repo" ref="a7d2cf85f06fa2e7d459730f7494c1a65" args="(SeafRepoManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="server_2gc_2repo-mgr_8h.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l04083">4083</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> sql[256];

    pthread_mutex_lock (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2d296323690da59659d544a5064a7f86">db_lock</a>);

    snprintf (sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;DELETE FROM GarbageRepos WHERE repo_id=&#39;%s&#39;&quot;</span>,
              repo_id);
    <a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a564132cff6405324fa2a118c2368bbc0">db</a>, sql);

    pthread_mutex_unlock (&amp;mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2d296323690da59659d544a5064a7f86">db_lock</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b2497e6cdde50c4ce3cb642370e06eb"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_repo_exists" ref="a4b2497e6cdde50c4ce3cb642370e06eb" args="(SeafRepoManager *manager, const gchar *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="server_2repo-mgr_8h.html#a4b2497e6cdde50c4ce3cb642370e06eb">seaf_repo_manager_repo_exists</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l04228">4228</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *res;

    <span class="keywordflow">if</span> (pthread_rwlock_rdlock (&amp;manager-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;[repo mgr] failed to lock repo cache.\n&quot;</span>);
        <span class="keywordflow">return</span> FALSE;
    }

    res = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a2f794f66ac8c2ae2d902a881cf505a80">repo_hash</a>, <span class="keywordtype">id</span>);

    pthread_rwlock_unlock (&amp;manager-&gt;<a class="code" href="struct__SeafRepoManager.html#afeb589ad01ce0797c851f27b348c94ad">priv</a>-&gt;<a class="code" href="struct__SeafRepoManagerPriv.html#a04dfb93d633d71ac87e6f61174db0cc3">lock</a>);

    <span class="keywordflow">if</span> (res &amp;&amp; !res-&gt;<a class="code" href="struct__SeafRepo.html#a1316126e566b3b2c1d444c9a9511b2ff">delete_pending</a>)
        <span class="keywordflow">return</span> TRUE;
    
    <span class="keywordflow">return</span> FALSE;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac78c13c68a1a9d1d025e45f4e51193ac"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_set_repo_history_limit" ref="ac78c13c68a1a9d1d025e45f4e51193ac" args="(SeafRepoManager *mgr, const char *repo_id, int days)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#ac78c13c68a1a9d1d025e45f4e51193ac">seaf_repo_manager_set_repo_history_limit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>days</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00419">419</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structSeafVirtRepo.html">SeafVirtRepo</a> *vinfo;
    <a class="code" href="structSeafDB.html">SeafDB</a> *db = mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>;
    <span class="keywordtype">char</span> sql[256];

    vinfo = <a class="code" href="server_2gc_2repo-mgr_8c.html#a316db228b35dde3dc88ae9dab9ec9c22">seaf_repo_manager_get_virtual_repo_info</a> (mgr, repo_id);
    <span class="keywordflow">if</span> (vinfo) {
        <a class="code" href="server_2gc_2repo-mgr_8c.html#a66a6ccfc59462f4c59fd322c693c3d5a">seaf_virtual_repo_info_free</a> (vinfo);
        <span class="keywordflow">return</span> 0;
    }

    <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#ae183a9c45ec082962bdd361491b0a8cb">seaf_db_type</a>(db) == <a class="code" href="seaf-db_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da62ce2e8a052406ede3fcf39ec407ccf8">SEAF_DB_TYPE_PGSQL</a>) {
        gboolean err;
        snprintf(sql, <span class="keyword">sizeof</span>(sql),
                 <span class="stringliteral">&quot;SELECT repo_id FROM RepoHistoryLimit &quot;</span>
                 <span class="stringliteral">&quot;WHERE repo_id=&#39;%s&#39;&quot;</span>, repo_id);
        <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a6410cd243563343861ba3c6c16fc06a7">seaf_db_check_for_existence</a>(db, sql, &amp;err))
            snprintf(sql, <span class="keyword">sizeof</span>(sql),
                     <span class="stringliteral">&quot;UPDATE RepoHistoryLimit SET days=%d&quot;</span>
                     <span class="stringliteral">&quot;WHERE repo_id=&#39;%s&#39;&quot;</span>, days, repo_id);
        <span class="keywordflow">else</span>
            snprintf(sql, <span class="keyword">sizeof</span>(sql),
                     <span class="stringliteral">&quot;INSERT INTO RepoHistoryLimit VALUES &quot;</span>
                     <span class="stringliteral">&quot;(&#39;%s&#39;, %d)&quot;</span>, repo_id, days);
        <span class="keywordflow">if</span> (err)
            <span class="keywordflow">return</span> -1;
        <span class="keywordflow">return</span> <a class="code" href="seaf-db_8c.html#a07daa0cca6663aa1fde0faca4b77969d">seaf_db_query</a>(db, sql);
    } <span class="keywordflow">else</span> {
        snprintf (sql, <span class="keyword">sizeof</span>(sql),
                  <span class="stringliteral">&quot;REPLACE INTO RepoHistoryLimit VALUES (&#39;%s&#39;, %d)&quot;</span>,
                  repo_id, days);
        <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a07daa0cca6663aa1fde0faca4b77969d">seaf_db_query</a> (db, sql) &lt; 0)
            <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aeeda6cf1cb41515388afd8a10c6297e1"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_set_repo_valid_since" ref="aeeda6cf1cb41515388afd8a10c6297e1" args="(SeafRepoManager *mgr, const char *repo_id, gint64 timestamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#aeeda6cf1cb41515388afd8a10c6297e1">seaf_repo_manager_set_repo_valid_since</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64&#160;</td>
          <td class="paramname"><em>timestamp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00508">508</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structSeafDB.html">SeafDB</a> *db = mgr-&gt;<a class="code" href="struct__SeafRepoManager.html#a16f3c4659df75ed4fe76acba492f1865">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a840b013453371c1f53bb2eb3860b1b82">db</a>;
    <span class="keywordtype">char</span> sql[256];

    <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#ae183a9c45ec082962bdd361491b0a8cb">seaf_db_type</a>(db) == <a class="code" href="seaf-db_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da62ce2e8a052406ede3fcf39ec407ccf8">SEAF_DB_TYPE_PGSQL</a>) {
        gboolean err;
        snprintf(sql, <span class="keyword">sizeof</span>(sql),
                 <span class="stringliteral">&quot;SELECT repo_id FROM RepoValidSince WHERE &quot;</span>
                 <span class="stringliteral">&quot;repo_id=&#39;%s&#39;&quot;</span>, repo_id);
        <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a6410cd243563343861ba3c6c16fc06a7">seaf_db_check_for_existence</a>(db, sql, &amp;err))
            snprintf(sql, <span class="keyword">sizeof</span>(sql),
                     <span class="stringliteral">&quot;UPDATE RepoValidSince SET timestamp=%&quot;</span>G_GINT64_FORMAT
                     <span class="stringliteral">&quot; WHERE repo_id=&#39;%s&#39;&quot;</span>, timestamp, repo_id);
        <span class="keywordflow">else</span>
            snprintf(sql, <span class="keyword">sizeof</span>(sql),
                     <span class="stringliteral">&quot;INSERT INTO RepoValidSince VALUES &quot;</span>
                     <span class="stringliteral">&quot;(&#39;%s&#39;, %&quot;</span>G_GINT64_FORMAT<span class="stringliteral">&quot;)&quot;</span>, repo_id, timestamp);
        <span class="keywordflow">if</span> (err)
            <span class="keywordflow">return</span> -1;
        <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a07daa0cca6663aa1fde0faca4b77969d">seaf_db_query</a> (db, sql) &lt; 0)
            <span class="keywordflow">return</span> -1;
    } <span class="keywordflow">else</span> {
        snprintf (sql, <span class="keyword">sizeof</span>(sql),
                  <span class="stringliteral">&quot;REPLACE INTO RepoValidSince VALUES (&#39;%s&#39;, %&quot;</span>G_GINT64_FORMAT<span class="stringliteral">&quot;)&quot;</span>,
                  repo_id, timestamp);
        <span class="keywordflow">if</span> (<a class="code" href="seaf-db_8c.html#a07daa0cca6663aa1fde0faca4b77969d">seaf_db_query</a> (db, sql) &lt; 0)
            <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2e049cfa3d0546aaf51e7f6792e1467d"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_manager_start" ref="a2e049cfa3d0546aaf51e7f6792e1467d" args="(SeafRepoManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="server_2repo-mgr_8h.html#a2e049cfa3d0546aaf51e7f6792e1467d">seaf_repo_manager_start</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#af5833aac28a20ee1e1217fc33b9c3a54">SeafRepoManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l03968">3968</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    watch_repos (mgr);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a63ab9fe4694e3d967376c911cbe2c655"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_new" ref="a63ab9fe4694e3d967376c911cbe2c655" args="(const char *id, const char *name, const char *desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a>* <a class="el" href="server_2repo-mgr_8h.html#a63ab9fe4694e3d967376c911cbe2c655">seaf_repo_new</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l00536">536</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a>* repo;

    <span class="comment">/* valid check */</span>
  
    
    repo = g_new0 (<a class="code" href="struct__SeafRepo.html">SeafRepo</a>, 1);
    memcpy (repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, <span class="keywordtype">id</span>, 36);
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>[36] = <span class="charliteral">&#39;\0&#39;</span>;

    repo-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a> = g_strdup(<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a2bcd0258d3e8deb15a45aa8403c9156d">desc</a> = g_strdup(desc);

    repo-&gt;<a class="code" href="struct__SeafRepo.html#aeedd453a6f0cf0f3f8104bd2c04d0488">worktree_invalid</a> = TRUE;
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a179d8ca9672a5eeafcbf535d0ccee45d">auto_sync</a> = 1;
    repo-&gt;<a class="code" href="struct__SeafRepo.html#a575e562d38b7fc0adc79a6b24ea00ac1">net_browsable</a> = 0;
    pthread_mutex_init (&amp;repo-&gt;<a class="code" href="struct__SeafRepo.html#aaa93119bb8b7b6038e9feb3c3a78b0ab">lock</a>, NULL);

    <span class="keywordflow">return</span> repo;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab8f60cbbd6c35ee55ea72acbbd3a1608"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_ref" ref="ab8f60cbbd6c35ee55ea72acbbd3a1608" args="(SeafRepo *repo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="server_2repo-mgr_8h.html#ab8f60cbbd6c35ee55ea72acbbd3a1608">seaf_repo_ref</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fuse_2repo-mgr_8c_source.html#l00068">68</a> of file <a class="el" href="fuse_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_atomic_int_inc (&amp;repo-&gt;<a class="code" href="struct__SeafRepo.html#a73ff67300bff9e51d98f02e0729e569d">ref_cnt</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a39a9a41ffdfc324f3c935251d9e14d51"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_to_commit" ref="a39a9a41ffdfc324f3c935251d9e14d51" args="(SeafRepo *repo, SeafCommit *commit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="server_2repo-mgr_8h.html#a39a9a41ffdfc324f3c935251d9e14d51">seaf_repo_to_commit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="commit-mgr_8h.html#ab20cfcee12e164d94824e8be23c2c8ea">SeafCommit</a> *&#160;</td>
          <td class="paramname"><em>commit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="daemon_2repo-mgr_8c_source.html#l00682">682</a> of file <a class="el" href="daemon_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    commit-&gt;<a class="code" href="struct__SeafCommit.html#aacd7b88f8a3e72446cd7352396eaa09e">repo_name</a> = g_strdup (repo-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a>);
    commit-&gt;<a class="code" href="struct__SeafCommit.html#aa3d8e868c630cfbecbcb9158c4bbe2e4">repo_desc</a> = g_strdup (repo-&gt;<a class="code" href="struct__SeafRepo.html#a2bcd0258d3e8deb15a45aa8403c9156d">desc</a>);
    commit-&gt;<a class="code" href="struct__SeafCommit.html#a906e77d2a658f4337437ff8694a4bfc0">encrypted</a> = repo-&gt;<a class="code" href="struct__SeafRepo.html#ab50d0e015838fe83d735ba2d6cb40804">encrypted</a>;
    <span class="keywordflow">if</span> (commit-&gt;<a class="code" href="struct__SeafCommit.html#a906e77d2a658f4337437ff8694a4bfc0">encrypted</a>) {
        commit-&gt;<a class="code" href="struct__SeafCommit.html#a52953918e881ce013cd741deff721a70">enc_version</a> = repo-&gt;<a class="code" href="struct__SeafRepo.html#af4cb7f672489dceb52cbd47da097ebf8">enc_version</a>;
        <span class="keywordflow">if</span> (commit-&gt;<a class="code" href="struct__SeafCommit.html#a52953918e881ce013cd741deff721a70">enc_version</a> == 1)
            commit-&gt;<a class="code" href="struct__SeafCommit.html#a8e7caa10438ce42d7d39f57090768a9e">magic</a> = g_strdup (repo-&gt;<a class="code" href="struct__SeafRepo.html#ab067d494e7ac35fb57f0a3c448e816d2">magic</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (commit-&gt;<a class="code" href="struct__SeafCommit.html#a52953918e881ce013cd741deff721a70">enc_version</a> == 2) {
            commit-&gt;<a class="code" href="struct__SeafCommit.html#a8e7caa10438ce42d7d39f57090768a9e">magic</a> = g_strdup (repo-&gt;<a class="code" href="struct__SeafRepo.html#ab067d494e7ac35fb57f0a3c448e816d2">magic</a>);
            commit-&gt;<a class="code" href="struct__SeafCommit.html#ab1d44814bc44472105aef8761656e3d7">random_key</a> = g_strdup (repo-&gt;<a class="code" href="struct__SeafRepo.html#a83e0a2366ba320396f2deb6faa167b84">random_key</a>);
        }
    }
    commit-&gt;<a class="code" href="struct__SeafCommit.html#a383ea4a4b94417c7d9e9827d60420d64">no_local_history</a> = repo-&gt;<a class="code" href="struct__SeafRepo.html#a4710aaee11c7887df402fffa7ca6c54f">no_local_history</a>;
    commit-&gt;<a class="code" href="struct__SeafCommit.html#abc83f168ce2b43fa864522bf0ea26d6d">version</a> = repo-&gt;<a class="code" href="struct__SeafRepo.html#ab75d342176657e7504c5cddd5ca2c56a">version</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af6bedb063685823d91f2a335c6882e07"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_repo_unref" ref="af6bedb063685823d91f2a335c6882e07" args="(SeafRepo *repo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="server_2repo-mgr_8h.html#af6bedb063685823d91f2a335c6882e07">seaf_repo_unref</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2repo-mgr_8h.html#a3e8b6c8c2a077518a17c75c6ace3ae1c">SeafRepo</a> *&#160;</td>
          <td class="paramname"><em>repo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fuse_2repo-mgr_8c_source.html#l00074">74</a> of file <a class="el" href="fuse_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!repo)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (g_atomic_int_dec_and_test (&amp;repo-&gt;<a class="code" href="struct__SeafRepo.html#a73ff67300bff9e51d98f02e0729e569d">ref_cnt</a>))
        <a class="code" href="daemon_2repo-mgr_8c.html#ad0a65514ad80789ff244b20c66460b96">seaf_repo_free</a> (repo);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a66a6ccfc59462f4c59fd322c693c3d5a"></a><!-- doxytag: member="repo&#45;mgr.h::seaf_virtual_repo_info_free" ref="a66a6ccfc59462f4c59fd322c693c3d5a" args="(SeafVirtRepo *vinfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="virtual-repo_8c.html#a66a6ccfc59462f4c59fd322c693c3d5a">seaf_virtual_repo_info_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSeafVirtRepo.html">SeafVirtRepo</a> *&#160;</td>
          <td class="paramname"><em>vinfo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="server_2gc_2repo-mgr_8c_source.html#l00611">611</a> of file <a class="el" href="server_2gc_2repo-mgr_8c_source.html">repo-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!vinfo) <span class="keywordflow">return</span>;

    g_free (vinfo-&gt;<a class="code" href="structSeafVirtRepo.html#abd2d9ee29b9d78255cd52b8f7aa053ec">path</a>);
    g_free (vinfo);
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:19:06 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
