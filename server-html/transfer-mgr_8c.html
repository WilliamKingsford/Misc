<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/daemon/transfer-mgr.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/daemon/transfer-mgr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;common.h&quot;</code><br/>
<code>#include &quot;log.h&quot;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;limits.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="ccnet_8h_source.html">ccnet.h</a>&gt;</code><br/>
<code>#include &quot;utils.h&quot;</code><br/>
<code>#include &quot;db.h&quot;</code><br/>
<code>#include &lt;openssl/rand.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2seafile-session_8h_source.html">seafile-session.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="transfer-mgr_8h_source.html">transfer-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="commit-mgr_8h_source.html">commit-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="block-mgr_8h_source.html">block-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-error_8h_source.html">seafile-error.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vc-common_8h_source.html">vc-common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="merge_8h_source.html">merge.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sync-mgr_8h_source.html">sync-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="clone-mgr_8h_source.html">clone-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vc-utils_8h_source.html">vc-utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mq-mgr_8h_source.html">mq-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-config_8h_source.html">seafile-config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="check-tx-v2-proc_8h_source.html">processors/check-tx-v2-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="check-tx-v3-proc_8h_source.html">processors/check-tx-v3-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sendfs-proc_8h_source.html">processors/sendfs-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="getfs-proc_8h_source.html">processors/getfs-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="getcs-proc_8h_source.html">processors/getcs-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sendbranch-proc_8h_source.html">processors/sendbranch-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="getcommit-v2-proc_8h_source.html">processors/getcommit-v2-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="getcommit-v3-proc_8h_source.html">processors/getcommit-v3-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sendcommit-v3-proc_8h_source.html">processors/sendcommit-v3-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sendcommit-v3-new-proc_8h_source.html">processors/sendcommit-v3-new-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2processors_2checkbl-proc_8h_source.html">processors/checkbl-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="getcs-v2-proc_8h_source.html">processors/getcs-v2-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sendcommit-v4-proc_8h_source.html">processors/sendcommit-v4-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sendfs-v2-proc_8h_source.html">processors/sendfs-v2-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="getfs-v2-proc_8h_source.html">processors/getfs-v2-proc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="block-tx-client_8h_source.html">block-tx-client.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>&quot;</code><br/>
</div>
<p><a href="transfer-mgr_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDiffTreesData.html">DiffTreesData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLoadBLData.html">LoadBLData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDownloadFilesData.html">DownloadFilesData</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfba8a0ff30f6f8a39cdc72e0ed045762f7e">SEAFILE_DEBUG_TRANSFER</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a529594214418a26d6770d7e25a22200a">TRANSFER_DB</a>&#160;&#160;&#160;&quot;transfer.db&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#af66ade775b3232f46645be3b78ac46de">SCHEDULE_INTERVAL</a>&#160;&#160;&#160;1   /* 1s */</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a28d5f3ddf3a19390b17e3b2382cd6bab">MAX_QUEUED_BLOCKS</a>&#160;&#160;&#160;50</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>&#160;&#160;&#160;(1 &lt;&lt; 20)</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structDiffTreesData.html">DiffTreesData</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a864fdf66a180e9297f74d0a6b123e6d0">DiffTreesData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a546842e1e57436efff3636d1b0341c4f">LoadBLCB</a> )(<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structLoadBLData.html">LoadBLData</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a6fa7423556a6b93cb3bd267fb013b5a2">LoadBLData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structDownloadFilesData.html">DownloadFilesData</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#aa0f576da591c2d0e57aa197d0a79c35a">DownloadFilesData</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a0098cc10b37b69db93ebbfa7f4e3349c">task_state_to_str</a> (int state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a96cf9064a8fc0abfbaa59549fd45bfae">task_rt_state_to_str</a> (int rt_state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a14c6953965c8d47be9ca6bea93c9e0bf">task_error_str</a> (int task_errno)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a02a3fa3f098edcc60cd0bd1340fa80e9">transfer_task_get_rate</a> (<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *task)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#ae1ab298e05c15d5b64ec741eac2404b3">transfer_task_get_done_blocks</a> (<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *task)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#af268f694f35d04d51f38ab6bcb2b4d86">transition_state_to_error</a> (<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *task, int task_errno)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a3c99cd5104dac75aa73ed81fd1df2b9e">transfer_task_set_error</a> (<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *task, int error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#ae337827e1d8f663486c0fb3bab156610">transfer_task_set_netdown</a> (<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *task)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a451893cddac6898ab70008a69b8fceae">seaf_transfer_manager_new</a> (struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *<a class="el" href="server_2seafile-session_8h.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a624e73788448eb5afc0041fbb4db38c9">seaf_transfer_manager_start</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a7c1421651b69da119fab63e9f1d5bf55">seaf_transfer_manager_add_download</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager, const char *repo_id, int repo_version, const char *peer_id, const char *from_branch, const char *to_branch, const char *token, gboolean server_side_merge, const char *passwd, const char *worktree, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a084f2ccd845f2ff514aa3fd6a4a7b697">seaf_transfer_manager_add_upload</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager, const char *repo_id, int repo_version, const char *peer_id, const char *from_branch, const char *to_branch, const char *token, gboolean server_side_merge, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a98142e3db29c901beff0fc71bbba601e">seaf_transfer_manager_find_transfer_by_repo</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#ad58e56f4396d154be75bdb37bf4a53ae">seaf_transfer_manager_remove_task</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager, const char *tx_id, int task_type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#af834de917c22d13996383431bef032a0">seaf_transfer_manager_cancel_task</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager, const char *tx_id, int task_type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#ab45ac6ab5c091d45224f57b0aa1f6452">seaf_transfer_manager_get_upload_tasks</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#acb8e9fc3a0648f40f6018c7f25d5b36f">seaf_transfer_manager_get_download_tasks</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="transfer-mgr_8c.html#a760b69b5aa68dcb74c3020f091d1fc6c">seaf_transfer_manager_download_file_blocks</a> (<a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *manager, <a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *task, const char *file_id)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a05d1af42442c934b555896d3fe55c79e"></a><!-- doxytag: member="transfer&#45;mgr.c::DEBUG_FLAG" ref="a05d1af42442c934b555896d3fe55c79e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="user-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfba8a0ff30f6f8a39cdc72e0ed045762f7e">SEAFILE_DEBUG_TRANSFER</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00005">5</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac42c901b241f3189fb2451bfea993e1a"></a><!-- doxytag: member="transfer&#45;mgr.c::DEFAULT_BLOCK_SIZE" ref="ac42c901b241f3189fb2451bfea993e1a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="transfer-mgr_8c.html#ac42c901b241f3189fb2451bfea993e1a">DEFAULT_BLOCK_SIZE</a>&#160;&#160;&#160;(1 &lt;&lt; 20)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00057">57</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a28d5f3ddf3a19390b17e3b2382cd6bab"></a><!-- doxytag: member="transfer&#45;mgr.c::MAX_QUEUED_BLOCKS" ref="a28d5f3ddf3a19390b17e3b2382cd6bab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="transfer-mgr_8c.html#a28d5f3ddf3a19390b17e3b2382cd6bab">MAX_QUEUED_BLOCKS</a>&#160;&#160;&#160;50</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00055">55</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="af66ade775b3232f46645be3b78ac46de"></a><!-- doxytag: member="transfer&#45;mgr.c::SCHEDULE_INTERVAL" ref="af66ade775b3232f46645be3b78ac46de" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="virtual-repo_8c.html#af66ade775b3232f46645be3b78ac46de">SCHEDULE_INTERVAL</a>&#160;&#160;&#160;1   /* 1s */</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00054">54</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a529594214418a26d6770d7e25a22200a"></a><!-- doxytag: member="transfer&#45;mgr.c::TRANSFER_DB" ref="a529594214418a26d6770d7e25a22200a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="transfer-mgr_8c.html#a529594214418a26d6770d7e25a22200a">TRANSFER_DB</a>&#160;&#160;&#160;&quot;transfer.db&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00052">52</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a864fdf66a180e9297f74d0a6b123e6d0"></a><!-- doxytag: member="transfer&#45;mgr.c::DiffTreesData" ref="a864fdf66a180e9297f74d0a6b123e6d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structDiffTreesData.html">DiffTreesData</a>  <a class="el" href="structDiffTreesData.html">DiffTreesData</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa0f576da591c2d0e57aa197d0a79c35a"></a><!-- doxytag: member="transfer&#45;mgr.c::DownloadFilesData" ref="aa0f576da591c2d0e57aa197d0a79c35a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structDownloadFilesData.html">DownloadFilesData</a>  <a class="el" href="structDownloadFilesData.html">DownloadFilesData</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a546842e1e57436efff3636d1b0341c4f"></a><!-- doxytag: member="transfer&#45;mgr.c::LoadBLCB" ref="a546842e1e57436efff3636d1b0341c4f" args=")(TransferTask *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* <a class="el" href="transfer-mgr_8c.html#a546842e1e57436efff3636d1b0341c4f">LoadBLCB</a>)(<a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l01144">1144</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6fa7423556a6b93cb3bd267fb013b5a2"></a><!-- doxytag: member="transfer&#45;mgr.c::LoadBLData" ref="a6fa7423556a6b93cb3bd267fb013b5a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structLoadBLData.html">LoadBLData</a>  <a class="el" href="structLoadBLData.html">LoadBLData</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7c1421651b69da119fab63e9f1d5bf55"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_add_download" ref="a7c1421651b69da119fab63e9f1d5bf55" args="(SeafTransferManager *manager, const char *repo_id, int repo_version, const char *peer_id, const char *from_branch, const char *to_branch, const char *token, gboolean server_side_merge, const char *passwd, const char *worktree, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="transfer-mgr_8h.html#a7c1421651b69da119fab63e9f1d5bf55">seaf_transfer_manager_add_download</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>from_branch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>to_branch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>server_side_merge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00578">578</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__TransferTask.html">TransferTask</a> *task;

    <span class="keywordflow">if</span> (!repo_id || !from_branch || !to_branch || !token) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Empty argument(s)&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (is_duplicate_task (manager, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, <span class="stringliteral">&quot;Task is already in progress&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    clean_tasks_for_repo (manager, repo_id);

    task = seaf_transfer_task_new (manager, NULL, repo_id, peer_id,
                                   from_branch, to_branch, token,
                                   <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>);
    task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> = <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>;
    task-&gt;<a class="code" href="struct__TransferTask.html#a0e5952dd77a930029e2c12b808ad5fe4">repo_version</a> = repo_version;

    task-&gt;<a class="code" href="struct__TransferTask.html#ab3092ff84d739c89ae1211670ac73362">server_side_merge</a> = server_side_merge;

    <span class="comment">/* Mark task &quot;clone&quot; if it&#39;s a new repo. */</span>
    <span class="keywordflow">if</span> (!<a class="code" href="daemon_2repo-mgr_8c.html#a4b2497e6cdde50c4ce3cb642370e06eb">seaf_repo_manager_repo_exists</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id))
        task-&gt;<a class="code" href="struct__TransferTask.html#a4462883da6780feae2b41060e5b48456">is_clone</a> = TRUE;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#a4462883da6780feae2b41060e5b48456">is_clone</a>) {
        task-&gt;<a class="code" href="struct__TransferTask.html#a5d04ab09b9dd283c65cb78d1918164b2">passwd</a> = g_strdup(passwd);
        task-&gt;<a class="code" href="struct__TransferTask.html#a0a8e92f99b30194a9e2315f3b70b5c13">worktree</a> = g_strdup(worktree);
    }

    g_hash_table_insert (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a1c7de7270fc3d95c7df34cba0959c925">download_tasks</a>,
                         g_strdup(task-&gt;<a class="code" href="struct__TransferTask.html#a4de0996bdefbbba5fa9d89f9c452b16e">tx_id</a>),
                         task);

    <span class="keywordflow">return</span> g_strdup(task-&gt;<a class="code" href="struct__TransferTask.html#a4de0996bdefbbba5fa9d89f9c452b16e">tx_id</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a084f2ccd845f2ff514aa3fd6a4a7b697"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_add_upload" ref="a084f2ccd845f2ff514aa3fd6a4a7b697" args="(SeafTransferManager *manager, const char *repo_id, int repo_version, const char *peer_id, const char *from_branch, const char *to_branch, const char *token, gboolean server_side_merge, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="transfer-mgr_8h.html#a084f2ccd845f2ff514aa3fd6a4a7b697">seaf_transfer_manager_add_upload</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>from_branch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>to_branch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>server_side_merge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00628">628</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__TransferTask.html">TransferTask</a> *task;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;

    <span class="keywordflow">if</span> (!repo_id || !from_branch || !to_branch || !token) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Empty argument(s)&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
    <span class="keywordflow">if</span> (!repo) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Repo not found&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (is_duplicate_task (manager, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, <span class="stringliteral">&quot;Task is already in progress&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    clean_tasks_for_repo (manager, repo_id);

    task = seaf_transfer_task_new (manager, NULL, repo_id, peer_id,
                                   from_branch, to_branch, token,
                                   <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa800672fa26f828e725e4f6efe3dd7a67">TASK_TYPE_UPLOAD</a>);
    task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> = <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>;
    task-&gt;<a class="code" href="struct__TransferTask.html#a0e5952dd77a930029e2c12b808ad5fe4">repo_version</a> = repo_version;
    task-&gt;<a class="code" href="struct__TransferTask.html#ab3092ff84d739c89ae1211670ac73362">server_side_merge</a> = server_side_merge;

    g_hash_table_insert (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a12c3a28fb3a2802585dd1427aa83c8b5">upload_tasks</a>,
                         g_strdup(task-&gt;<a class="code" href="struct__TransferTask.html#a4de0996bdefbbba5fa9d89f9c452b16e">tx_id</a>),
                         task);

    <span class="keywordflow">return</span> g_strdup(task-&gt;<a class="code" href="struct__TransferTask.html#a4de0996bdefbbba5fa9d89f9c452b16e">tx_id</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af834de917c22d13996383431bef032a0"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_cancel_task" ref="af834de917c22d13996383431bef032a0" args="(SeafTransferManager *manager, const char *tx_id, int task_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="transfer-mgr_8h.html#af834de917c22d13996383431bef032a0">seaf_transfer_manager_cancel_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tx_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00753">753</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__TransferTask.html">TransferTask</a> *task = NULL;

    <span class="keywordflow">if</span> (task_type == <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>)
        task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a1c7de7270fc3d95c7df34cba0959c925">download_tasks</a>, tx_id);
    <span class="keywordflow">else</span>
        task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a12c3a28fb3a2802585dd1427aa83c8b5">upload_tasks</a>, tx_id);

    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> != <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>) {
        seaf_warning (<span class="stringliteral">&quot;Task cannot be canceled!\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }

    cancel_task (task);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a760b69b5aa68dcb74c3020f091d1fc6c"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_download_file_blocks" ref="a760b69b5aa68dcb74c3020f091d1fc6c" args="(SeafTransferManager *manager, TransferTask *task, const char *file_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="transfer-mgr_8h.html#a760b69b5aa68dcb74c3020f091d1fc6c">seaf_transfer_manager_download_file_blocks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00789">789</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__Seafile.html">Seafile</a> *file;

    file = <a class="code" href="fs-mgr_8c.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>,
                                        task-&gt;<a class="code" href="struct__TransferTask.html#adc5f8a15d03c66765d59b91e37e32746">repo_id</a>,
                                        task-&gt;<a class="code" href="struct__TransferTask.html#a0e5952dd77a930029e2c12b808ad5fe4">repo_version</a>,
                                        file_id);
    <span class="keywordflow">if</span> (!file) {
        seaf_warning (<span class="stringliteral">&quot;Failed to find seafile object %s in repo %.8s.\n&quot;</span>,
                      file_id, task-&gt;<a class="code" href="struct__TransferTask.html#adc5f8a15d03c66765d59b91e37e32746">repo_id</a>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> i;
    <span class="keywordtype">char</span> *<a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>;
    <span class="keywordflow">for</span> (i = 0; i &lt; file-&gt;<a class="code" href="struct__Seafile.html#af2d5c5e5bb56d38122dead42128b9c20">n_blocks</a>; ++i) {
        block_id = file-&gt;<a class="code" href="struct__Seafile.html#aacaedff2674132faf3d522ba8df6e268">blk_sha1s</a>[i];
        <span class="keywordflow">if</span> (!<a class="code" href="block-mgr_8c.html#acc8d899bbbf17d0db6d07c9eda67fd0c">seaf_block_manager_block_exists</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>,
                                              task-&gt;<a class="code" href="struct__TransferTask.html#adc5f8a15d03c66765d59b91e37e32746">repo_id</a>,
                                              task-&gt;<a class="code" href="struct__TransferTask.html#a0e5952dd77a930029e2c12b808ad5fe4">repo_version</a>,
                                              block_id))
            g_queue_push_tail (task-&gt;<a class="code" href="struct__TransferTask.html#a1617756a21ea8da9bbb6795347df9b9f">block_ids</a>, g_strdup(block_id));
    }

    <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (file);

    <a class="code" href="struct__BlockTxInfo.html">BlockTxInfo</a> *info = task-&gt;<a class="code" href="struct__TransferTask.html#ac4c6a9314d3fb534c927d1ef89dae337">tx_info</a>;
    <span class="keywordtype">int</span> rsp;

retry:
    <span class="keywordflow">if</span> (g_queue_get_length (task-&gt;<a class="code" href="struct__TransferTask.html#a1617756a21ea8da9bbb6795347df9b9f">block_ids</a>) == 0)
        <span class="keywordflow">return</span> <a class="code" href="transfer-mgr_8h.html#ac205be2172292384dd687b5471a87edda66f4cf8f7807f8038262d56bc42c61df">BLOCK_CLIENT_SUCCESS</a>;

    <a class="code" href="block-tx-client_8c.html#a3b498db84c3dbe3392253ddd283ac7f3">block_tx_client_run_command</a> (info, <a class="code" href="block-tx-client_8h.html#abc5c98fcc1211af2b80116dd6e0a035da69efcb91bbae78a1895b23642d85ce6e">BLOCK_CLIENT_CMD_TRANSFER</a>);

    <span class="comment">/* Wait until block download is done. */</span>
    <a class="code" href="seafile_2lib_2utils_8h.html#ab4c7c5fbaad73e7853c2818f1611bf42">piperead</a> (info-&gt;<a class="code" href="struct__BlockTxInfo.html#a385af5452c748c9a2387461440e0c422">done_pipe</a>[0], &amp;rsp, <span class="keyword">sizeof</span>(rsp));

    <span class="comment">/* The server closes the socket after 30 seconds without data,</span>
<span class="comment">     * so just retry if we encounter network error.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (rsp == <a class="code" href="transfer-mgr_8h.html#ac205be2172292384dd687b5471a87edda77daa389ab8b27e7dfb05e61b181c643">BLOCK_CLIENT_NET_ERROR</a>) {
        <a class="code" href="block-tx-client_8c.html#a3b498db84c3dbe3392253ddd283ac7f3">block_tx_client_run_command</a> (info, <a class="code" href="block-tx-client_8h.html#abc5c98fcc1211af2b80116dd6e0a035daacfc9210b87af8d0d9fa1ad47d11f7d3">BLOCK_CLIENT_CMD_RESTART</a>);

        <a class="code" href="seafile_2lib_2utils_8h.html#ab4c7c5fbaad73e7853c2818f1611bf42">piperead</a> (info-&gt;<a class="code" href="struct__BlockTxInfo.html#a385af5452c748c9a2387461440e0c422">done_pipe</a>[0], &amp;rsp, <span class="keyword">sizeof</span>(rsp));
        <span class="keywordflow">if</span> (rsp == <a class="code" href="transfer-mgr_8h.html#ac205be2172292384dd687b5471a87eddae82f0760241f8b8e6f36e78f281899ef">BLOCK_CLIENT_READY</a>)
            <span class="keywordflow">goto</span> retry;
    }

    <span class="keywordflow">while</span> ((block_id = g_queue_pop_head(task-&gt;<a class="code" href="struct__TransferTask.html#a1617756a21ea8da9bbb6795347df9b9f">block_ids</a>)) != NULL)
        g_free (block_id);

    <span class="keywordflow">return</span> rsp;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a98142e3db29c901beff0fc71bbba601e"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_find_transfer_by_repo" ref="a98142e3db29c901beff0fc71bbba601e" args="(SeafTransferManager *manager, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a>* <a class="el" href="transfer-mgr_8h.html#a98142e3db29c901beff0fc71bbba601e">seaf_transfer_manager_find_transfer_by_repo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00674">674</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GHashTableIter iter;
    gpointer key, value;
    <a class="code" href="struct__TransferTask.html">TransferTask</a> *task;

    g_hash_table_iter_init (&amp;iter, manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a1c7de7270fc3d95c7df34cba0959c925">download_tasks</a>);
    <span class="keywordflow">while</span> (g_hash_table_iter_next (&amp;iter, &amp;key, &amp;value)) {
        task = value;
        <span class="keywordflow">if</span> (strcmp(task-&gt;<a class="code" href="struct__TransferTask.html#adc5f8a15d03c66765d59b91e37e32746">repo_id</a>, repo_id) == 0 &amp;&amp;
            task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> != <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bcea407d72c040f282acb88e904361c217a2">TASK_STATE_FINISHED</a>)
            <span class="keywordflow">return</span> task;
    }

    g_hash_table_iter_init (&amp;iter, manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a12c3a28fb3a2802585dd1427aa83c8b5">upload_tasks</a>);
    <span class="keywordflow">while</span> (g_hash_table_iter_next (&amp;iter, &amp;key, &amp;value)) {
        task = value;
        <span class="keywordflow">if</span> (strcmp(task-&gt;<a class="code" href="struct__TransferTask.html#adc5f8a15d03c66765d59b91e37e32746">repo_id</a>, repo_id) == 0 &amp;&amp;
            task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> != <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bcea407d72c040f282acb88e904361c217a2">TASK_STATE_FINISHED</a>)
            <span class="keywordflow">return</span> task;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb8e9fc3a0648f40f6018c7f25d5b36f"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_get_download_tasks" ref="acb8e9fc3a0648f40f6018c7f25d5b36f" args="(SeafTransferManager *manager)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="transfer-mgr_8h.html#acb8e9fc3a0648f40f6018c7f25d5b36f">seaf_transfer_manager_get_download_tasks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00783">783</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> g_hash_table_get_values (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a1c7de7270fc3d95c7df34cba0959c925">download_tasks</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab45ac6ab5c091d45224f57b0aa1f6452"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_get_upload_tasks" ref="ab45ac6ab5c091d45224f57b0aa1f6452" args="(SeafTransferManager *manager)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="transfer-mgr_8h.html#ab45ac6ab5c091d45224f57b0aa1f6452">seaf_transfer_manager_get_upload_tasks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00777">777</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> g_hash_table_get_values (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a12c3a28fb3a2802585dd1427aa83c8b5">upload_tasks</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a451893cddac6898ab70008a69b8fceae"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_new" ref="a451893cddac6898ab70008a69b8fceae" args="(struct _SeafileSession *seaf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a>* <a class="el" href="transfer-mgr_8h.html#a451893cddac6898ab70008a69b8fceae">seaf_transfer_manager_new</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *&#160;</td>
          <td class="paramname"><em>seaf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00422">422</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafTransferManager.html">SeafTransferManager</a> *mgr = g_new0 (<a class="code" href="struct__SeafTransferManager.html">SeafTransferManager</a>, 1);

    mgr-&gt;<a class="code" href="struct__SeafTransferManager.html#a6bf9794fb2f726d6ab7d797874a346ca">seaf</a> = <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>;
    mgr-&gt;<a class="code" href="struct__SeafTransferManager.html#a1c7de7270fc3d95c7df34cba0959c925">download_tasks</a> = g_hash_table_new_full (g_str_hash, g_str_equal,
                                                 (GDestroyNotify) g_free,
                                                 (GDestroyNotify) seaf_transfer_task_free);
    mgr-&gt;<a class="code" href="struct__SeafTransferManager.html#a12c3a28fb3a2802585dd1427aa83c8b5">upload_tasks</a> = g_hash_table_new_full (g_str_hash, g_str_equal,
                                               (GDestroyNotify) g_free,
                                               (GDestroyNotify) seaf_transfer_task_free);

    <span class="keywordtype">char</span> *db_path = g_build_path (<a class="code" href="vc-utils_8h.html#aa7da4cdc6796b13fca1a4b263488dfdd">PATH_SEPERATOR</a>, seaf-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>, <a class="code" href="transfer-mgr_8c.html#a529594214418a26d6770d7e25a22200a">TRANSFER_DB</a>, NULL);
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#af6e9a0e79db923d4a7df37bc5588400a">sqlite_open_db</a> (db_path, &amp;mgr-&gt;<a class="code" href="struct__SeafTransferManager.html#a63927924e19615f35fb5483a48a2143f">db</a>) &lt; 0) {
        g_critical (<span class="stringliteral">&quot;[Transfer mgr] Failed to open transfer db\n&quot;</span>);
        g_free (db_path);
        g_free (mgr);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> mgr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad58e56f4396d154be75bdb37bf4a53ae"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_remove_task" ref="ad58e56f4396d154be75bdb37bf4a53ae" args="(SeafTransferManager *manager, const char *tx_id, int task_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="transfer-mgr_8h.html#ad58e56f4396d154be75bdb37bf4a53ae">seaf_transfer_manager_remove_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tx_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00712">712</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__TransferTask.html">TransferTask</a> *task = NULL;

    <span class="keywordflow">if</span> (task_type == <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>)
        task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a1c7de7270fc3d95c7df34cba0959c925">download_tasks</a>, tx_id);
    <span class="keywordflow">else</span>
        task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a12c3a28fb3a2802585dd1427aa83c8b5">upload_tasks</a>, tx_id);

    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#ab22f3346d8667c07d449772a83e860fd">runtime_state</a> != <a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300acaea6e8f567a83d7ddff12cade4af1d5">TASK_RT_STATE_FINISHED</a>) {
        seaf_warning (<span class="stringliteral">&quot;[tr-mgr] Try to remove running task!\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }

    remove_task (manager, task);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a624e73788448eb5afc0041fbb4db38c9"></a><!-- doxytag: member="transfer&#45;mgr.c::seaf_transfer_manager_start" ref="a624e73788448eb5afc0041fbb4db38c9" args="(SeafTransferManager *manager)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="transfer-mgr_8h.html#a624e73788448eb5afc0041fbb4db38c9">seaf_transfer_manager_start</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#a5ff32c776e49c5ab26a98ef214b5074a">SeafTransferManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00506">506</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> *sql;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneHeads &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, head TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (manager-&gt;<a class="code" href="struct__SeafTransferManager.html#a63927924e19615f35fb5483a48a2143f">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    register_processors (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ab2fe4d566fbe5b9cff50a9bef54cd931">session</a>);

    manager-&gt;<a class="code" href="struct__SeafTransferManager.html#acdbc04428ac240eb1027a22ac62ef30b">schedule_timer</a> = <a class="code" href="timer_8h.html#a68b6afb704a7f56b625ed78146691b7c">ccnet_timer_new</a> (schedule_task_pulse, manager,
                                               <a class="code" href="transfer-mgr_8c.html#af66ade775b3232f46645be3b78ac46de">SCHEDULE_INTERVAL</a> * 1000);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a14c6953965c8d47be9ca6bea93c9e0bf"></a><!-- doxytag: member="transfer&#45;mgr.c::task_error_str" ref="a14c6953965c8d47be9ca6bea93c9e0bf" args="(int task_errno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="transfer-mgr_8h.html#a14c6953965c8d47be9ca6bea93c9e0bf">task_error_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_errno</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00175">175</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> transfer_task_error_strs[task_errno];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a96cf9064a8fc0abfbaa59549fd45bfae"></a><!-- doxytag: member="transfer&#45;mgr.c::task_rt_state_to_str" ref="a96cf9064a8fc0abfbaa59549fd45bfae" args="(int rt_state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="transfer-mgr_8h.html#a96cf9064a8fc0abfbaa59549fd45bfae">task_rt_state_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rt_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00169">169</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> transfer_task_rt_state_str[rt_state];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0098cc10b37b69db93ebbfa7f4e3349c"></a><!-- doxytag: member="transfer&#45;mgr.c::task_state_to_str" ref="a0098cc10b37b69db93ebbfa7f4e3349c" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="transfer-mgr_8h.html#a0098cc10b37b69db93ebbfa7f4e3349c">task_state_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00163">163</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> transfer_task_state_str[state];
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae1ab298e05c15d5b64ec741eac2404b3"></a><!-- doxytag: member="transfer&#45;mgr.c::transfer_task_get_done_blocks" ref="ae1ab298e05c15d5b64ec741eac2404b3" args="(TransferTask *task)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="transfer-mgr_8h.html#ae1ab298e05c15d5b64ec741eac2404b3">transfer_task_get_done_blocks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00274">274</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#ab22f3346d8667c07d449772a83e860fd">runtime_state</a> != <a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300a6a546bd2f8de1f5a74956a45d58aba24">TASK_RT_STATE_DATA</a>)
        <span class="keywordflow">return</span> 0;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#a70203e978b76c28101f866f86794b182">protocol_version</a> &gt;= 7 &amp;&amp; task-&gt;<a class="code" href="struct__TransferTask.html#a5cb264f2074f78b92ac005633f412c24">type</a> == <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>)
        <span class="keywordflow">return</span> task-&gt;<a class="code" href="struct__TransferTask.html#a70063517880957e979f6f222bec67220">n_downloaded</a>;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#a70203e978b76c28101f866f86794b182">protocol_version</a> &gt;= 4) {
        <span class="keywordtype">int</span> n_left = g_queue_get_length (task-&gt;<a class="code" href="struct__TransferTask.html#a1617756a21ea8da9bbb6795347df9b9f">block_ids</a>);
        <span class="keywordflow">return</span> task-&gt;<a class="code" href="struct__TransferTask.html#a9baa45e64248034aa15eed4f2a57ff70">block_list</a>-&gt;<a class="code" href="structBlockList.html#a2ca09d61d434980fabd07ad6668ced3a">n_blocks</a> - n_left;
    }

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#a5cb264f2074f78b92ac005633f412c24">type</a> == <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa800672fa26f828e725e4f6efe3dd7a67">TASK_TYPE_UPLOAD</a>)
        <span class="keywordflow">return</span> task-&gt;<a class="code" href="struct__TransferTask.html#a18f81c0ae781b272104067d203f37e1d">n_uploaded</a>;
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> task-&gt;<a class="code" href="struct__TransferTask.html#a9baa45e64248034aa15eed4f2a57ff70">block_list</a>-&gt;<a class="code" href="structBlockList.html#a76325e5df08ad225178eb403f8812a69">n_valid_blocks</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a02a3fa3f098edcc60cd0bd1340fa80e9"></a><!-- doxytag: member="transfer&#45;mgr.c::transfer_task_get_rate" ref="a02a3fa3f098edcc60cd0bd1340fa80e9" args="(TransferTask *task)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="transfer-mgr_8h.html#a02a3fa3f098edcc60cd0bd1340fa80e9">transfer_task_get_rate</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00268">268</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> task-&gt;<a class="code" href="struct__TransferTask.html#af25039ef5e482429ae696c886a1c9734">last_tx_bytes</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c99cd5104dac75aa73ed81fd1df2b9e"></a><!-- doxytag: member="transfer&#45;mgr.c::transfer_task_set_error" ref="a3c99cd5104dac75aa73ed81fd1df2b9e" args="(TransferTask *task, int error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="transfer-mgr_8h.html#a3c99cd5104dac75aa73ed81fd1df2b9e">transfer_task_set_error</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00359">359</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="transfer-mgr_8c.html#af268f694f35d04d51f38ab6bcb2b4d86">transition_state_to_error</a> (task, error);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae337827e1d8f663486c0fb3bab156610"></a><!-- doxytag: member="transfer&#45;mgr.c::transfer_task_set_netdown" ref="ae337827e1d8f663486c0fb3bab156610" args="(TransferTask *task)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="transfer-mgr_8h.html#ae337827e1d8f663486c0fb3bab156610">transfer_task_set_netdown</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00365">365</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_return_if_fail (task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> == <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>);
    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__TransferTask.html#ab22f3346d8667c07d449772a83e860fd">runtime_state</a> == <a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300abee3bb533aa834941c0ef1820a0aeec7">TASK_RT_STATE_NETDOWN</a>)
        <span class="keywordflow">return</span>;
    transition_state (task, <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>, <a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300abee3bb533aa834941c0ef1820a0aeec7">TASK_RT_STATE_NETDOWN</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af268f694f35d04d51f38ab6bcb2b4d86"></a><!-- doxytag: member="transfer&#45;mgr.c::transition_state_to_error" ref="af268f694f35d04d51f38ab6bcb2b4d86" args="(TransferTask *task, int task_errno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="transfer-mgr_8h.html#af268f694f35d04d51f38ab6bcb2b4d86">transition_state_to_error</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transfer-mgr_8h.html#ac3aaa1ec5e8dc2ac42d8d2b87ee8fcca">TransferTask</a> *&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_errno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="transfer-mgr_8c_source.html#l00337">337</a> of file <a class="el" href="transfer-mgr_8c_source.html">transfer-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    g_return_if_fail (task_errno != 0);

    seaf_message (<span class="stringliteral">&quot;Transfer repo &#39;%.8s&#39;: (&#39;%s&#39;, &#39;%s&#39;) --&gt; (&#39;%s&#39;, &#39;%s&#39;): %s\n&quot;</span>,
                  task-&gt;<a class="code" href="struct__TransferTask.html#adc5f8a15d03c66765d59b91e37e32746">repo_id</a>,
                  <a class="code" href="transfer-mgr_8c.html#a0098cc10b37b69db93ebbfa7f4e3349c">task_state_to_str</a>(task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a>),
                  <a class="code" href="transfer-mgr_8c.html#a96cf9064a8fc0abfbaa59549fd45bfae">task_rt_state_to_str</a>(task-&gt;<a class="code" href="struct__TransferTask.html#ab22f3346d8667c07d449772a83e860fd">runtime_state</a>),
                  <a class="code" href="transfer-mgr_8c.html#a0098cc10b37b69db93ebbfa7f4e3349c">task_state_to_str</a>(<a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceaeef2d65ee28a06d4dad01ed46ab8c213">TASK_STATE_ERROR</a>),
                  <a class="code" href="transfer-mgr_8c.html#a96cf9064a8fc0abfbaa59549fd45bfae">task_rt_state_to_str</a>(<a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300acaea6e8f567a83d7ddff12cade4af1d5">TASK_RT_STATE_FINISHED</a>),
                  <a class="code" href="transfer-mgr_8c.html#a14c6953965c8d47be9ca6bea93c9e0bf">task_error_str</a>(task_errno));

    task-&gt;<a class="code" href="struct__TransferTask.html#a13bb5199500880d4c519fc1ac53312c7">last_runtime_state</a> = task-&gt;<a class="code" href="struct__TransferTask.html#ab22f3346d8667c07d449772a83e860fd">runtime_state</a>;

    task-&gt;<a class="code" href="struct__TransferTask.html#a1d4ba9aacf2e9930fb136b0092bf9531">state</a> = <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceaeef2d65ee28a06d4dad01ed46ab8c213">TASK_STATE_ERROR</a>;
    task-&gt;<a class="code" href="struct__TransferTask.html#ab22f3346d8667c07d449772a83e860fd">runtime_state</a> = <a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300acaea6e8f567a83d7ddff12cade4af1d5">TASK_RT_STATE_FINISHED</a>;
    task-&gt;<a class="code" href="struct__TransferTask.html#a9f76a7a029f2b7103127167a03be025e">error</a> = task_errno;

    emit_transfer_done_signal (task);
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:28:59 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
