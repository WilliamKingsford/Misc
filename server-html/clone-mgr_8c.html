<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/daemon/clone-mgr.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/daemon/clone-mgr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;common.h&quot;</code><br/>
<code>#include &lt;<a class="el" href="ccnet_8h_source.html">ccnet.h</a>&gt;</code><br/>
<code>#include &quot;log.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-error_8h_source.html">seafile-error.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2seafile-session_8h_source.html">seafile-session.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="index_8h_source.html">index/index.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="merge-recursive_8h_source.html">merge-recursive.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="unpack-trees_8h_source.html">unpack-trees.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vc-utils_8h_source.html">vc-utils.h</a>&quot;</code><br/>
<code>#include &quot;utils.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-config_8h_source.html">seafile-config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2processors_2checkff-proc_8h_source.html">processors/checkff-proc.h</a>&quot;</code><br/>
</div>
<p><a href="clone-mgr_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structIndexAux.html">IndexAux</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structMergeAux.html">MergeAux</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCompareAux.html">CompareAux</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfbaddde2b807762dde36d8143cb8d062bff">SEAFILE_DEBUG_SYNC</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a35f4ad46c9e15dc72ccb38574e0c62c6">CLONE_DB</a>&#160;&#160;&#160;&quot;clone.db&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a50841e5a1d701383bf3b5c0302545d9b">CHECK_CONNECT_INTERVAL</a>&#160;&#160;&#160;5 /* 5s */</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a371fa00197a050e76f04061d410b0097">clone_task_state_to_str</a> (int state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#ad97feb27f9f5e662efea51d3297b1376">clone_task_error_to_str</a> (int error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#af28bac46c2f7acc1fc6eef867db947e9">seaf_clone_manager_new</a> (<a class="el" href="daemon_2seafile-session_8h.html#a3412e7ea22f43083cdc07acffa80f859">SeafileSession</a> *<a class="el" href="ccnet-server_8c.html#af241ba8540cd17c31a02b56c2aaa126c">session</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#ad7860d1243e7f8ee8e9d3b8e6c032378">seaf_clone_manager_init</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#af1cec3356abdd2c8a92e8edc7ae79269">seaf_clone_manager_start</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#aaac97c14f78e703fd118de5bea1745e6">seaf_clone_manager_gen_default_worktree</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *worktree_parent, const char *repo_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a45fe95b1bbe19ee533a8f9e57884658e">seaf_clone_manager_check_worktree_path</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a06b26730e317a268b3127067ee545307">seaf_clone_manager_add_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *worktree_in, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#ab6b5a2b4f13b382b9c7034131fa92783">seaf_clone_manager_add_download_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *wt_parent, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a2849d011d1f918b3108c30495c98254b">seaf_clone_manager_cancel_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a131d57446fac0ffddf9dd4dbebe985ae">seaf_clone_manager_remove_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="clone-mgr_8h.html#a5feadb7226431f7237bdfee08ef1ef90">CloneTask</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#acb26f43fecfbf4f3b0c81ea6f7a6195f">seaf_clone_manager_get_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a6b295c7d97d0c650eb97ea7a9c7eb98f">seaf_clone_manager_get_tasks</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a50841e5a1d701383bf3b5c0302545d9b"></a><!-- doxytag: member="clone&#45;mgr.c::CHECK_CONNECT_INTERVAL" ref="a50841e5a1d701383bf3b5c0302545d9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="clone-mgr_8c.html#a50841e5a1d701383bf3b5c0302545d9b">CHECK_CONNECT_INTERVAL</a>&#160;&#160;&#160;5 /* 5s */</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00023">23</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a35f4ad46c9e15dc72ccb38574e0c62c6"></a><!-- doxytag: member="clone&#45;mgr.c::CLONE_DB" ref="a35f4ad46c9e15dc72ccb38574e0c62c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="clone-mgr_8c.html#a35f4ad46c9e15dc72ccb38574e0c62c6">CLONE_DB</a>&#160;&#160;&#160;&quot;clone.db&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00021">21</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a05d1af42442c934b555896d3fe55c79e"></a><!-- doxytag: member="clone&#45;mgr.c::DEBUG_FLAG" ref="a05d1af42442c934b555896d3fe55c79e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="user-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfbaddde2b807762dde36d8143cb8d062bff">SEAFILE_DEBUG_SYNC</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00007">7</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad97feb27f9f5e662efea51d3297b1376"></a><!-- doxytag: member="clone&#45;mgr.c::clone_task_error_to_str" ref="ad97feb27f9f5e662efea51d3297b1376" args="(int error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="clone-mgr_8h.html#ad97feb27f9f5e662efea51d3297b1376">clone_task_error_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>error</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00375">375</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (error &lt; 0 || error &gt;= <a class="code" href="clone-mgr_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea5cc2e23ea05f81fca6b7aea2ccb6f780">N_CLONE_ERRORS</a>)
        <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">return</span> error_str[error];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a371fa00197a050e76f04061d410b0097"></a><!-- doxytag: member="clone&#45;mgr.c::clone_task_state_to_str" ref="a371fa00197a050e76f04061d410b0097" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="clone-mgr_8h.html#a371fa00197a050e76f04061d410b0097">clone_task_state_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00367">367</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (state &lt; 0 || state &gt;= <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8acca394d0558d1cd602cc71c51d572725">N_CLONE_STATES</a>)
        <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">return</span> state_str[state];
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab6b5a2b4f13b382b9c7034131fa92783"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_add_download_task" ref="ab6b5a2b4f13b382b9c7034131fa92783" args="(SeafCloneManager *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *wt_parent, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="clone-mgr_8h.html#ab6b5a2b4f13b382b9c7034131fa92783">seaf_clone_manager_add_download_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>magic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enc_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>random_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>wt_parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>email</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>more_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01409">1409</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    <span class="keywordtype">char</span> *wt_tmp, *worktree;
    <span class="keywordtype">char</span> *ret;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip adding clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        !check_encryption_args (magic, enc_version, random_key, error))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* After a repo was unsynced, the sync task may still be blocked in the</span>
<span class="comment">     * network, so the repo is not actually deleted yet.</span>
<span class="comment">     * In this case just return an error to the user.</span>
<span class="comment">     */</span>
    <a class="code" href="struct__SyncInfo.html">SyncInfo</a> *sync_info = <a class="code" href="sync-mgr_8c.html#afb758dbde64ac4505ad259f95601d45e">seaf_sync_manager_get_sync_info</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a6b2a5e1e723955885f9fb27c5f064df4">sync_mgr</a>,
                                                           repo_id);
    <span class="keywordflow">if</span> (sync_info &amp;&amp; sync_info-&gt;<a class="code" href="struct__SyncInfo.html#ad0f77a2b8e799b3a0abc417fce88843a">in_sync</a>) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="keywordflow">if</span> (repo != NULL &amp;&amp; repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a> != NULL) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }   

    <span class="keywordflow">if</span> (is_duplicate_task (mgr, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, 
                     <span class="stringliteral">&quot;Task is already in progress&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        <a class="code" href="seafile-crypt_8c.html#a9ada7f42f1f31b91dabdc5edde6b73f9">seafile_verify_repo_passwd</a>(repo_id, passwd, magic, enc_version) &lt; 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Incorrect password&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    wt_tmp = g_build_filename (wt_parent, repo_name, NULL);

    worktree = make_worktree_for_download (mgr, wt_tmp, error);
    <span class="keywordflow">if</span> (!worktree) {
        g_free (wt_tmp);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">/* If a repo was unsynced and then downloaded again, there may be</span>
<span class="comment">     * a garbage record for this repo. We don&#39;t want the downloaded blocks</span>
<span class="comment">     * be removed by GC.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (repo_version &gt; 0)
        <a class="code" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="comment">/* Delete orphan information in the db in case the repo was corrupt. */</span>
    <span class="keywordflow">if</span> (!repo)
        <a class="code" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c">seaf_repo_manager_remove_repo_ondisk</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id, FALSE);

    ret = add_task_common (mgr, repo_id, repo_version,
                           peer_id, repo_name, token, passwd,
                           enc_version, random_key,
                           worktree, peer_addr, peer_port,
                           email, more_info, error);
    g_free (worktree);
    g_free (wt_tmp);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a06b26730e317a268b3127067ee545307"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_add_task" ref="a06b26730e317a268b3127067ee545307" args="(SeafCloneManager *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *worktree_in, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="clone-mgr_8h.html#a6b3ef937f8308db69c87bb650cb42fe9">seaf_clone_manager_add_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>magic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enc_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>random_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>email</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>more_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01291">1291</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    <span class="keywordtype">char</span> *worktree;
    <span class="keywordtype">char</span> *ret;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip adding clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        !check_encryption_args (magic, enc_version, random_key, error))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* After a repo was unsynced, the sync task may still be blocked in the</span>
<span class="comment">     * network, so the repo is not actually deleted yet.</span>
<span class="comment">     * In this case just return an error to the user.</span>
<span class="comment">     */</span>
    <a class="code" href="struct__SyncInfo.html">SyncInfo</a> *sync_info = <a class="code" href="sync-mgr_8c.html#afb758dbde64ac4505ad259f95601d45e">seaf_sync_manager_get_sync_info</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a6b2a5e1e723955885f9fb27c5f064df4">sync_mgr</a>,
                                                           repo_id);
    <span class="keywordflow">if</span> (sync_info &amp;&amp; sync_info-&gt;<a class="code" href="struct__SyncInfo.html#ad0f77a2b8e799b3a0abc417fce88843a">in_sync</a>) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="keywordflow">if</span> (repo != NULL &amp;&amp; repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a> != NULL) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }   

    <span class="keywordflow">if</span> (is_duplicate_task (mgr, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, 
                     <span class="stringliteral">&quot;Task is already in progress&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        <a class="code" href="seafile-crypt_8c.html#a9ada7f42f1f31b91dabdc5edde6b73f9">seafile_verify_repo_passwd</a>(repo_id, passwd, magic, enc_version) &lt; 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Incorrect password&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (!<a class="code" href="clone-mgr_8c.html#a45fe95b1bbe19ee533a8f9e57884658e">seaf_clone_manager_check_worktree_path</a> (mgr, worktree_in, error))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* Return error if worktree_in conflicts with another repo or</span>
<span class="comment">     * is not a directory.</span>
<span class="comment">     */</span>
    worktree = make_worktree (mgr, worktree_in, FALSE, error);
    <span class="keywordflow">if</span> (!worktree) {
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">/* If a repo was unsynced and then downloaded again, there may be</span>
<span class="comment">     * a garbage record for this repo. We don&#39;t want the downloaded blocks</span>
<span class="comment">     * be removed by GC.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (repo_version &gt; 0)
        <a class="code" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="comment">/* Delete orphan information in the db in case the repo was corrupt. */</span>
    <span class="keywordflow">if</span> (!repo)
        <a class="code" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c">seaf_repo_manager_remove_repo_ondisk</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id, FALSE);

    ret = add_task_common (mgr, repo_id, repo_version,
                           peer_id, repo_name, token, passwd,
                           enc_version, random_key,
                           worktree, peer_addr, peer_port,
                           email, more_info,
                           error);
    g_free (worktree);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2849d011d1f918b3108c30495c98254b"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_cancel_task" ref="a2849d011d1f918b3108c30495c98254b" args="(SeafCloneManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#a2849d011d1f918b3108c30495c98254b">seaf_clone_manager_cancel_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01503">1503</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__CloneTask.html">CloneTask</a> *task;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip canceling clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    task = g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);
    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">switch</span> (task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a>) {
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a15a782f2367c11ca3a9ee11a3f9c4eec">CLONE_STATE_INIT</a>:
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8afd7df49789f27957a882d91822b78eff">CLONE_STATE_CONNECT</a>:
        transition_state (task, <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a5b171455c76672ef5f3808bbc9267cc3">CLONE_STATE_CANCELED</a>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8ae67f39ebed40e85b2d90de1f3119edca">CLONE_STATE_FETCH</a>:
        <span class="keywordflow">if</span> (!task-&gt;<a class="code" href="struct__CloneTask.html#ae9ed3b204a7c4364ef44b16a7056ccd1">http_sync</a>)
            <a class="code" href="transfer-mgr_8c.html#af834de917c22d13996383431bef032a0">seaf_transfer_manager_cancel_task</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#aa04a8214ef989d1e5d68799dc19cbf22">transfer_mgr</a>,
                                               task-&gt;<a class="code" href="struct__CloneTask.html#a6ffe70c7ca5bbb71b617eecb53c0244f">tx_id</a>,
                                               <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>);
        <span class="keywordflow">else</span>
            <a class="code" href="http-tx-mgr_8c.html#a1333f1b023ba910df52c75f6ec51c41d">http_tx_manager_cancel_task</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a3be7b98d0f1cc49d0fad03c68e63da74">http_tx_mgr</a>,
                                         task-&gt;<a class="code" href="struct__CloneTask.html#ad7e57c9ed10d8e043c61b3382dc7c76a">repo_id</a>,
                                         <a class="code" href="http-tx-mgr_8h.html#a16af7b253440dadd46a80a4b9fddba4da429731c6953f215203cf1b17fe92ebb1">HTTP_TASK_TYPE_DOWNLOAD</a>);
        transition_state (task, <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a7c3d6e2ad24a7e0f2adf534a42b235bc">CLONE_STATE_CANCEL_PENDING</a>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8aae34ed29b33feeb3d64a3e5efe2d8ff0">CLONE_STATE_INDEX</a>:
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8ad8e45ae1a104379cb606fd2c05a7c6cd">CLONE_STATE_CHECKOUT</a>:
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a54946986c45281155e2e59421c8a8a77">CLONE_STATE_MERGE</a>:
        <span class="comment">/* We cannot cancel an in-progress checkout, just</span>
<span class="comment">         * wait until it finishes.</span>
<span class="comment">         */</span>
        transition_state (task, <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a7c3d6e2ad24a7e0f2adf534a42b235bc">CLONE_STATE_CANCEL_PENDING</a>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a7c3d6e2ad24a7e0f2adf534a42b235bc">CLONE_STATE_CANCEL_PENDING</a>:
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        seaf_warning (<span class="stringliteral">&quot;[Clone mgr] cannot cancel a not-running task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a45fe95b1bbe19ee533a8f9e57884658e"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_check_worktree_path" ref="a45fe95b1bbe19ee533a8f9e57884658e" args="(SeafCloneManager *mgr, const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="clone-mgr_8h.html#a45fe95b1bbe19ee533a8f9e57884658e">seaf_clone_manager_check_worktree_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01134">1134</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *repos, *ptr;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    GHashTableIter iter;
    gpointer key, value;
    <a class="code" href="struct__CloneTask.html">CloneTask</a> *task;

    <span class="keywordflow">if</span> (check_dir_inclusiveness (path, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>) != 0 ||
        <span class="comment">/* It&#39;s OK if path is included by the default worktree parent. */</span>
        check_dir_inclusiveness (path, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a1675cecb3e52d94845f2ae1b28fd011a">worktree_dir</a>) &lt; 0 ||
        check_dir_inclusiveness (path, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ab2fe4d566fbe5b9cff50a9bef54cd931">session</a>-&gt;<a class="code" href="struct__CcnetClient.html#a3cef20728e78352e5fe1819b692ed8e3">config_dir</a>) != 0) {
        seaf_warning (<span class="stringliteral">&quot;Worktree path conflicts with seafile system path.\n&quot;</span>);
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Worktree conflicts system path&quot;</span>);
        <span class="keywordflow">return</span> FALSE;
    }

    repos = <a class="code" href="daemon_2repo-mgr_8c.html#a5fe41fb7382995f3f335e408ba4ddb30">seaf_repo_manager_get_repo_list</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, -1, -1);
    <span class="keywordflow">for</span> (ptr = repos; ptr != NULL; ptr = ptr-&gt;next) {
        repo = ptr-&gt;data;
        <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__SeafRepo.html#a4342ff79933f9cbdbbd34114e5a26df3">worktree</a> != NULL &amp;&amp;
            check_dir_inclusiveness (path, repo-&gt;<a class="code" href="struct__SeafRepo.html#a4342ff79933f9cbdbbd34114e5a26df3">worktree</a>) != 0) {
            seaf_warning (<span class="stringliteral">&quot;Worktree path conflict with repo %s.\n&quot;</span>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a>);
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                         <span class="stringliteral">&quot;Worktree conflicts existing repo&quot;</span>);
            g_list_free (repos);
            <span class="keywordflow">return</span> FALSE;
        }
    }
    g_list_free (repos);

    g_hash_table_iter_init (&amp;iter, mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>);
    <span class="keywordflow">while</span> (g_hash_table_iter_next (&amp;iter, &amp;key, &amp;value)) {
        task = value;
        <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> == <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8af1c3a28143f803ec77f12421a745c80e">CLONE_STATE_DONE</a> ||
            task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> == <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8aed32a49a21c225e3aa62f83b837e2e33">CLONE_STATE_ERROR</a> ||
            task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> == <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a5b171455c76672ef5f3808bbc9267cc3">CLONE_STATE_CANCELED</a>)
            <span class="keywordflow">continue</span>;
        <span class="keywordflow">if</span> (check_dir_inclusiveness (path, task-&gt;<a class="code" href="struct__CloneTask.html#a1d415384ea992d92e436c07bfc72a69d">worktree</a>) != 0) {
            seaf_warning (<span class="stringliteral">&quot;Worktree path conflict with clone %.8s.\n&quot;</span>,
                          task-&gt;<a class="code" href="struct__CloneTask.html#ad7e57c9ed10d8e043c61b3382dc7c76a">repo_id</a>);
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                         <span class="stringliteral">&quot;Worktree conflicts existing repo&quot;</span>);
            <span class="keywordflow">return</span> FALSE;
        }
    }

    <span class="keywordflow">return</span> TRUE;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aaac97c14f78e703fd118de5bea1745e6"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_gen_default_worktree" ref="aaac97c14f78e703fd118de5bea1745e6" args="(SeafCloneManager *mgr, const char *worktree_parent, const char *repo_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="clone-mgr_8h.html#aaac97c14f78e703fd118de5bea1745e6">seaf_clone_manager_gen_default_worktree</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree_parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01061">1061</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *wt = g_build_filename (worktree_parent, repo_name, NULL);
    <span class="keywordtype">char</span> *worktree;

    worktree = make_worktree (mgr, wt, TRUE, NULL);
    <span class="keywordflow">if</span> (!worktree)
        <span class="keywordflow">return</span> wt;

    g_free (wt);
    <span class="keywordflow">return</span> worktree;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb26f43fecfbf4f3b0c81ea6f7a6195f"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_get_task" ref="acb26f43fecfbf4f3b0c81ea6f7a6195f" args="(SeafCloneManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="clone-mgr_8h.html#a5feadb7226431f7237bdfee08ef1ef90">CloneTask</a>* <a class="el" href="clone-mgr_8h.html#acb26f43fecfbf4f3b0c81ea6f7a6195f">seaf_clone_manager_get_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01586">1586</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (<a class="code" href="struct__CloneTask.html">CloneTask</a> *) g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6b295c7d97d0c650eb97ea7a9c7eb98f"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_get_tasks" ref="a6b295c7d97d0c650eb97ea7a9c7eb98f" args="(SeafCloneManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="clone-mgr_8h.html#a6b295c7d97d0c650eb97ea7a9c7eb98f">seaf_clone_manager_get_tasks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01593">1593</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> g_hash_table_get_values (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad7860d1243e7f8ee8e9d3b8e6c032378"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_init" ref="ad7860d1243e7f8ee8e9d3b8e6c032378" args="(SeafCloneManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#ad7860d1243e7f8ee8e9d3b8e6c032378">seaf_clone_manager_init</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00553">553</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> *sql;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneTasks &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, repo_name TEXT, &quot;</span>
        <span class="stringliteral">&quot;token TEXT, dest_id TEXT,&quot;</span>
        <span class="stringliteral">&quot;worktree_parent TEXT, passwd TEXT, &quot;</span>
        <span class="stringliteral">&quot;server_addr TEXT, server_port TEXT, email TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneTasksMoreInfo &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, more_info TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneEncInfo &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, enc_version INTEGER, random_key TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneVersionInfo &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, repo_version INTEGER);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneServerURL &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, server_url TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af28bac46c2f7acc1fc6eef867db947e9"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_new" ref="af28bac46c2f7acc1fc6eef867db947e9" args="(SeafileSession *session)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a>* <a class="el" href="clone-mgr_8h.html#ae861dc0d625b2072ab3a0641a2aa6797">seaf_clone_manager_new</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2seafile-session_8h.html#a3412e7ea22f43083cdc07acffa80f859">SeafileSession</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00383">383</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafCloneManager.html">SeafCloneManager</a> *mgr = g_new0 (<a class="code" href="struct__SeafCloneManager.html">SeafCloneManager</a>, 1);

    <span class="keywordtype">char</span> *db_path = g_build_path (<span class="stringliteral">&quot;/&quot;</span>, session-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>, <a class="code" href="clone-mgr_8c.html#a35f4ad46c9e15dc72ccb38574e0c62c6">CLONE_DB</a>, NULL);
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#af6e9a0e79db923d4a7df37bc5588400a">sqlite_open_db</a> (db_path, &amp;mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>) &lt; 0) {
        g_critical (<span class="stringliteral">&quot;[Clone mgr] Failed to open db\n&quot;</span>);
        g_free (db_path);
        g_free (mgr);
        <span class="keywordflow">return</span> NULL;
    }

    mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a3ffe52698a800372c82b6d19215d5b82">seaf</a> = <a class="code" href="cluster-mgr_8c.html#af241ba8540cd17c31a02b56c2aaa126c">session</a>;
    mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a> = g_hash_table_new_full (g_str_hash, g_str_equal,
                                        g_free, (GDestroyNotify)clone_task_free);
    <span class="keywordflow">return</span> mgr;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a131d57446fac0ffddf9dd4dbebe985ae"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_remove_task" ref="a131d57446fac0ffddf9dd4dbebe985ae" args="(SeafCloneManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#a131d57446fac0ffddf9dd4dbebe985ae">seaf_clone_manager_remove_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01552">1552</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__CloneTask.html">CloneTask</a> *task;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip removing clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    task = g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);
    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> != <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8af1c3a28143f803ec77f12421a745c80e">CLONE_STATE_DONE</a> &amp;&amp;
        task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> != <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8aed32a49a21c225e3aa62f83b837e2e33">CLONE_STATE_ERROR</a> &amp;&amp;
        task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> != <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a5b171455c76672ef5f3808bbc9267cc3">CLONE_STATE_CANCELED</a>) {
        seaf_warning (<span class="stringliteral">&quot;[Clone mgr] cannot remove running task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__CloneTask.html#a6ffe70c7ca5bbb71b617eecb53c0244f">tx_id</a>)
        <a class="code" href="transfer-mgr_8c.html#ad58e56f4396d154be75bdb37bf4a53ae">seaf_transfer_manager_remove_task</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#aa04a8214ef989d1e5d68799dc19cbf22">transfer_mgr</a>,
                                           task-&gt;<a class="code" href="struct__CloneTask.html#a6ffe70c7ca5bbb71b617eecb53c0244f">tx_id</a>,
                                           <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>);

    <span class="comment">/* On-disk task should have been removed. */</span>

    g_hash_table_remove (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1cec3356abdd2c8a92e8edc7ae79269"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_start" ref="af1cec3356abdd2c8a92e8edc7ae79269" args="(SeafCloneManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#af1cec3356abdd2c8a92e8edc7ae79269">seaf_clone_manager_start</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00614">614</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="include_2ccnet_2proc-factory_8h.html#aa8eba73e6627b33e2cb2d91fd0ea9922">ccnet_proc_factory_register_processor</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ab2fe4d566fbe5b9cff50a9bef54cd931">session</a>-&gt;<a class="code" href="struct__CcnetClient.html#a0323e7b06acd2088f195ca6b0688ed54">proc_factory</a>,
                                           <span class="stringliteral">&quot;seafile-checkff&quot;</span>,
                                           <a class="code" href="daemon_2processors_2checkff-proc_8h.html#a5fd38032a5f483b89c1c0a13b0477eff">SEAFILE_TYPE_CHECKFF_PROC</a>);

    mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ad242e9e88dab10ffea500f6155816836">check_timer</a> = <a class="code" href="timer_8h.html#a68b6afb704a7f56b625ed78146691b7c">ccnet_timer_new</a> (check_connect_pulse, mgr,
                                        <a class="code" href="clone-mgr_8c.html#a50841e5a1d701383bf3b5c0302545d9b">CHECK_CONNECT_INTERVAL</a> * 1000);

    <span class="keywordtype">char</span> *sql = <span class="stringliteral">&quot;SELECT * FROM CloneTasks&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a17cffec15ffa34446ad00f950eab6fe2">sqlite_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql, restart_task, mgr) &lt; 0)
        <span class="keywordflow">return</span> -1;

    g_signal_connect (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>, <span class="stringliteral">&quot;repo-fetched&quot;</span>,
                      (GCallback)on_repo_fetched, mgr);
    g_signal_connect (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>, <span class="stringliteral">&quot;repo-http-fetched&quot;</span>,
                      (GCallback)on_repo_http_fetched, mgr);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 02:46:12 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
