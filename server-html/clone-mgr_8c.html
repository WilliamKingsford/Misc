<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/daemon/clone-mgr.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/daemon/clone-mgr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;common.h&quot;</code><br/>
<code>#include &lt;<a class="el" href="ccnet_8h_source.html">ccnet.h</a>&gt;</code><br/>
<code>#include &quot;log.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-error_8h_source.html">seafile-error.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2seafile-session_8h_source.html">seafile-session.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="index_8h_source.html">index/index.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="merge-recursive_8h_source.html">merge-recursive.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="unpack-trees_8h_source.html">unpack-trees.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vc-utils_8h_source.html">vc-utils.h</a>&quot;</code><br/>
<code>#include &quot;utils.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-config_8h_source.html">seafile-config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2processors_2checkff-proc_8h_source.html">processors/checkff-proc.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for clone-mgr.c:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c__incl.png" border="0" usemap="#seafile_2daemon_2clone-mgr_8c" alt=""/></div>
<map name="seafile_2daemon_2clone-mgr_8c" id="seafile_2daemon_2clone-mgr_8c">
<area shape="rect" id="node5" href="ccnet_8h.html" title="ccnet.h" alt="" coords="1159,160,1223,189"/><area shape="rect" id="node65" href="seafile-error_8h.html" title="seafile&#45;error.h" alt="" coords="1773,83,1875,112"/><area shape="rect" id="node67" href="daemon_2seafile-session_8h.html" title="seafile&#45;session.h" alt="" coords="2545,160,2665,189"/><area shape="rect" id="node120" href="index_8h.html" title="index/index.h" alt="" coords="3344,237,3443,267"/><area shape="rect" id="node137" href="merge-recursive_8h.html" title="merge&#45;recursive.h" alt="" coords="1851,237,1976,267"/><area shape="rect" id="node142" href="unpack-trees_8h.html" title="unpack&#45;trees.h" alt="" coords="3249,160,3356,189"/><area shape="rect" id="node146" href="vc-utils_8h.html" title="vc&#45;utils.h" alt="" coords="3191,83,3265,112"/><area shape="rect" id="node153" href="seafile-config_8h.html" title="seafile&#45;config.h" alt="" coords="3340,83,3449,112"/><area shape="rect" id="node157" href="daemon_2processors_2checkff-proc_8h.html" title="processors/checkff&#45;proc.h" alt="" coords="37,237,211,267"/><area shape="rect" id="node7" href="option_8h.html" title="ccnet/option.h" alt="" coords="2227,237,2331,267"/><area shape="rect" id="node14" href="valid-check_8h.html" title="ccnet/valid&#45;check.h" alt="" coords="408,237,541,267"/><area shape="rect" id="node16" href="include_2ccnet_2peer_8h.html" title="ccnet/peer.h" alt="" coords="1460,315,1553,344"/><area shape="rect" id="node21" href="include_2ccnet_2message_8h.html" title="ccnet/message.h" alt="" coords="1212,315,1335,344"/><area shape="rect" id="node25" href="status-code_8h.html" title="ccnet/status&#45;code.h" alt="" coords="316,392,452,421"/><area shape="rect" id="node27" href="include_2ccnet_2processor_8h.html" title="ccnet/processor.h" alt="" coords="705,315,831,344"/><area shape="rect" id="node32" href="ccnet-session-base_8h.html" title="ccnet/ccnet&#45;session&#45;base.h" alt="" coords="905,315,1087,344"/><area shape="rect" id="node35" href="ccnet-client_8h.html" title="ccnet/ccnet&#45;client.h" alt="" coords="1205,237,1341,267"/><area shape="rect" id="node42" href="include_2ccnet_2proc-factory_8h.html" title="ccnet/proc&#45;factory.h" alt="" coords="821,237,960,267"/><area shape="rect" id="node46" href="sendcmd-proc_8h.html" title="ccnet/sendcmd&#45;proc.h" alt="" coords="235,237,384,267"/><area shape="rect" id="node50" href="mqclient-proc_8h.html" title="ccnet/mqclient&#45;proc.h" alt="" coords="1035,237,1181,267"/><area shape="rect" id="node55" href="invoke-service-proc_8h.html" title="ccnet/invoke&#45;service&#45;proc.h" alt="" coords="565,237,747,267"/><area shape="rect" id="node59" href="timer_8h.html" title="ccnet/timer.h" alt="" coords="1628,315,1727,344"/><area shape="rect" id="node70" href="cevent_8h.html" title="ccnet/cevent.h" alt="" coords="2191,315,2297,344"/><area shape="rect" id="node74" href="job-mgr_8h.html" title="ccnet/job&#45;mgr.h" alt="" coords="2405,237,2517,267"/><area shape="rect" id="node77" href="block-mgr_8h.html" title="block&#45;mgr.h" alt="" coords="1751,315,1841,344"/><area shape="rect" id="node81" href="fs-mgr_8h.html" title="fs&#45;mgr.h" alt="" coords="1979,315,2048,344"/><area shape="rect" id="node84" href="commit-mgr_8h.html" title="commit&#45;mgr.h" alt="" coords="2591,469,2692,499"/><area shape="rect" id="node88" href="branch-mgr_8h.html" title="branch&#45;mgr.h" alt="" coords="2592,392,2691,421"/><area shape="rect" id="node91" href="daemon_2repo-mgr_8h.html" title="repo&#45;mgr.h" alt="" coords="2744,315,2827,344"/><area shape="rect" id="node96" href="clone-mgr_8h.html" title="clone&#45;mgr.h" alt="" coords="2427,315,2517,344"/><area shape="rect" id="node101" href="transfer-mgr_8h.html" title="transfer&#45;mgr.h" alt="" coords="2101,237,2203,267"/><area shape="rect" id="node109" href="sync-mgr_8h.html" title="sync&#45;mgr.h" alt="" coords="2744,237,2829,267"/><area shape="rect" id="node111" href="wt-monitor_8h.html" title="wt&#45;monitor.h" alt="" coords="3125,237,3219,267"/><area shape="rect" id="node115" href="mq-mgr_8h.html" title="mq&#45;mgr.h" alt="" coords="2853,237,2931,267"/><area shape="rect" id="node117" href="http-tx-mgr_8h.html" title="http&#45;tx&#45;mgr.h" alt="" coords="2955,237,3051,267"/></map>
</div>
</div>
<p><a href="clone-mgr_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structIndexAux.html">IndexAux</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structMergeAux.html">MergeAux</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCompareAux.html">CompareAux</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfbaddde2b807762dde36d8143cb8d062bff">SEAFILE_DEBUG_SYNC</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a35f4ad46c9e15dc72ccb38574e0c62c6">CLONE_DB</a>&#160;&#160;&#160;&quot;clone.db&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a50841e5a1d701383bf3b5c0302545d9b">CHECK_CONNECT_INTERVAL</a>&#160;&#160;&#160;5 /* 5s */</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a371fa00197a050e76f04061d410b0097">clone_task_state_to_str</a> (int state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#ad97feb27f9f5e662efea51d3297b1376">clone_task_error_to_str</a> (int error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#af28bac46c2f7acc1fc6eef867db947e9">seaf_clone_manager_new</a> (<a class="el" href="daemon_2seafile-session_8h.html#a3412e7ea22f43083cdc07acffa80f859">SeafileSession</a> *<a class="el" href="ccnet-server_8c.html#af241ba8540cd17c31a02b56c2aaa126c">session</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#ad7860d1243e7f8ee8e9d3b8e6c032378">seaf_clone_manager_init</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#af1cec3356abdd2c8a92e8edc7ae79269">seaf_clone_manager_start</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#aaac97c14f78e703fd118de5bea1745e6">seaf_clone_manager_gen_default_worktree</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *worktree_parent, const char *repo_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a45fe95b1bbe19ee533a8f9e57884658e">seaf_clone_manager_check_worktree_path</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *path, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a06b26730e317a268b3127067ee545307">seaf_clone_manager_add_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *worktree_in, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#ab6b5a2b4f13b382b9c7034131fa92783">seaf_clone_manager_add_download_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *wt_parent, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a2849d011d1f918b3108c30495c98254b">seaf_clone_manager_cancel_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a131d57446fac0ffddf9dd4dbebe985ae">seaf_clone_manager_remove_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="clone-mgr_8h.html#a5feadb7226431f7237bdfee08ef1ef90">CloneTask</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#acb26f43fecfbf4f3b0c81ea6f7a6195f">seaf_clone_manager_get_task</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="clone-mgr_8c.html#a6b295c7d97d0c650eb97ea7a9c7eb98f">seaf_clone_manager_get_tasks</a> (<a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *mgr)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a50841e5a1d701383bf3b5c0302545d9b"></a><!-- doxytag: member="clone&#45;mgr.c::CHECK_CONNECT_INTERVAL" ref="a50841e5a1d701383bf3b5c0302545d9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="clone-mgr_8c.html#a50841e5a1d701383bf3b5c0302545d9b">CHECK_CONNECT_INTERVAL</a>&#160;&#160;&#160;5 /* 5s */</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00023">23</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a35f4ad46c9e15dc72ccb38574e0c62c6"></a><!-- doxytag: member="clone&#45;mgr.c::CLONE_DB" ref="a35f4ad46c9e15dc72ccb38574e0c62c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="clone-mgr_8c.html#a35f4ad46c9e15dc72ccb38574e0c62c6">CLONE_DB</a>&#160;&#160;&#160;&quot;clone.db&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00021">21</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a05d1af42442c934b555896d3fe55c79e"></a><!-- doxytag: member="clone&#45;mgr.c::DEBUG_FLAG" ref="a05d1af42442c934b555896d3fe55c79e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="user-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfbaddde2b807762dde36d8143cb8d062bff">SEAFILE_DEBUG_SYNC</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00007">7</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad97feb27f9f5e662efea51d3297b1376"></a><!-- doxytag: member="clone&#45;mgr.c::clone_task_error_to_str" ref="ad97feb27f9f5e662efea51d3297b1376" args="(int error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="clone-mgr_8h.html#ad97feb27f9f5e662efea51d3297b1376">clone_task_error_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>error</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00375">375</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (error &lt; 0 || error &gt;= <a class="code" href="clone-mgr_8h.html#a05589fbab0657f08285ebdfe93f5ec9ea5cc2e23ea05f81fca6b7aea2ccb6f780">N_CLONE_ERRORS</a>)
        <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">return</span> error_str[error];
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_ad97feb27f9f5e662efea51d3297b1376_icgraph.png" border="0" usemap="#clone-mgr_8c_ad97feb27f9f5e662efea51d3297b1376_icgraph" alt=""/></div>
<map name="clone-mgr_8c_ad97feb27f9f5e662efea51d3297b1376_icgraph" id="clone-mgr_8c_ad97feb27f9f5e662efea51d3297b1376_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#aa8c74c54ead60c71cdd371d9ebc3fd6c" title="seafile_get_clone_tasks" alt="" coords="213,5,376,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a371fa00197a050e76f04061d410b0097"></a><!-- doxytag: member="clone&#45;mgr.c::clone_task_state_to_str" ref="a371fa00197a050e76f04061d410b0097" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="clone-mgr_8h.html#a371fa00197a050e76f04061d410b0097">clone_task_state_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00367">367</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (state &lt; 0 || state &gt;= <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8acca394d0558d1cd602cc71c51d572725">N_CLONE_STATES</a>)
        <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">return</span> state_str[state];
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a371fa00197a050e76f04061d410b0097_icgraph.png" border="0" usemap="#clone-mgr_8c_a371fa00197a050e76f04061d410b0097_icgraph" alt=""/></div>
<map name="clone-mgr_8c_a371fa00197a050e76f04061d410b0097_icgraph" id="clone-mgr_8c_a371fa00197a050e76f04061d410b0097_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#aa8c74c54ead60c71cdd371d9ebc3fd6c" title="seafile_get_clone_tasks" alt="" coords="216,5,379,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab6b5a2b4f13b382b9c7034131fa92783"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_add_download_task" ref="ab6b5a2b4f13b382b9c7034131fa92783" args="(SeafCloneManager *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *wt_parent, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="clone-mgr_8h.html#ab6b5a2b4f13b382b9c7034131fa92783">seaf_clone_manager_add_download_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>magic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enc_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>random_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>wt_parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>email</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>more_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01409">1409</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    <span class="keywordtype">char</span> *wt_tmp, *worktree;
    <span class="keywordtype">char</span> *ret;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip adding clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        !check_encryption_args (magic, enc_version, random_key, error))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* After a repo was unsynced, the sync task may still be blocked in the</span>
<span class="comment">     * network, so the repo is not actually deleted yet.</span>
<span class="comment">     * In this case just return an error to the user.</span>
<span class="comment">     */</span>
    <a class="code" href="struct__SyncInfo.html">SyncInfo</a> *sync_info = <a class="code" href="sync-mgr_8c.html#afb758dbde64ac4505ad259f95601d45e">seaf_sync_manager_get_sync_info</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a6b2a5e1e723955885f9fb27c5f064df4">sync_mgr</a>,
                                                           repo_id);
    <span class="keywordflow">if</span> (sync_info &amp;&amp; sync_info-&gt;<a class="code" href="struct__SyncInfo.html#ad0f77a2b8e799b3a0abc417fce88843a">in_sync</a>) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="keywordflow">if</span> (repo != NULL &amp;&amp; repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a> != NULL) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }   

    <span class="keywordflow">if</span> (is_duplicate_task (mgr, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, 
                     <span class="stringliteral">&quot;Task is already in progress&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        <a class="code" href="seafile-crypt_8c.html#a9ada7f42f1f31b91dabdc5edde6b73f9">seafile_verify_repo_passwd</a>(repo_id, passwd, magic, enc_version) &lt; 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Incorrect password&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    wt_tmp = g_build_filename (wt_parent, repo_name, NULL);

    worktree = make_worktree_for_download (mgr, wt_tmp, error);
    <span class="keywordflow">if</span> (!worktree) {
        g_free (wt_tmp);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">/* If a repo was unsynced and then downloaded again, there may be</span>
<span class="comment">     * a garbage record for this repo. We don&#39;t want the downloaded blocks</span>
<span class="comment">     * be removed by GC.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (repo_version &gt; 0)
        <a class="code" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="comment">/* Delete orphan information in the db in case the repo was corrupt. */</span>
    <span class="keywordflow">if</span> (!repo)
        <a class="code" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c">seaf_repo_manager_remove_repo_ondisk</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id, FALSE);

    ret = add_task_common (mgr, repo_id, repo_version,
                           peer_id, repo_name, token, passwd,
                           enc_version, random_key,
                           worktree, peer_addr, peer_port,
                           email, more_info, error);
    g_free (worktree);
    g_free (wt_tmp);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_cgraph.png" border="0" usemap="#clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_cgraph" alt=""/></div>
<map name="clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_cgraph" id="clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_cgraph">
<area shape="rect" id="node3" href="sync-mgr_8c.html#afb758dbde64ac4505ad259f95601d45e" title="seaf_sync_manager_get_sync_info" alt="" coords="340,5,567,35"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6" title="seaf_repo_manager_get_repo" alt="" coords="357,59,549,88"/><area shape="rect" id="node7" href="seafile-crypt_8c.html#a9ada7f42f1f31b91dabdc5edde6b73f9" title="seafile_verify_repo_passwd" alt="" coords="363,112,544,141"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65" title="seaf_repo_manager_remove_garbage_repo" alt="" coords="319,165,588,195"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c" title="seaf_repo_manager_remove_repo_ondisk" alt="" coords="323,271,584,300"/><area shape="rect" id="node9" href="seafile-crypt_8c.html#aef671f4a46b3d132f4219e55fbcb72d9" title="seafile_derive_key" alt="" coords="703,59,833,88"/><area shape="rect" id="node11" href="seafile_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09" title="rawdata_to_hex" alt="" coords="711,112,825,141"/><area shape="rect" id="node17" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9" title="sqlite_query_exec" alt="" coords="971,269,1096,299"/><area shape="rect" id="node19" href="seafile_2lib_2utils_8c.html#a26f091009701c5a9d1886b9d6ceb9c8e" title="seaf_util_unlink" alt="" coords="712,323,824,352"/><area shape="rect" id="node21" href="branch-mgr_8c.html#ad5bd62cbe17cb8fe91bcd993956a1fbf" title="seaf_branch_manager_get_branch_list" alt="" coords="645,376,891,405"/><area shape="rect" id="node27" href="branch-mgr_8c.html#ac6476414064e0ff0c429629aaab0bfc9" title="seaf_branch_list_free" alt="" coords="960,429,1107,459"/><area shape="rect" id="node33" href="daemon_2repo-mgr_8c.html#ae586fb5fbd61d6b44be3e47e7b6c86da" title="seaf_repo_manager_branch_repo_unmap" alt="" coords="639,165,897,195"/><area shape="rect" id="node35" href="branch-mgr_8c.html#a16b2df7708f3a4c4b96e9135ec7e1a3d" title="seaf_branch_manager_del_branch" alt="" coords="659,219,877,248"/><area shape="rect" id="node23" href="seafile_2lib_2db_8c.html#a4d1d0eb407f8f5dd522c3875beb7b9c8" title="sqlite_query_prepare" alt="" coords="963,323,1104,352"/><area shape="rect" id="node25" href="branch-mgr_8c.html#a4d213520d8a22d5191051715ccbfd1dd" title="seaf_branch_new" alt="" coords="972,376,1095,405"/><area shape="rect" id="node29" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653" title="seaf_branch_unref" alt="" coords="1196,429,1324,459"/><area shape="rect" id="node31" href="branch-mgr_8c.html#a449a49952dc253bd7b16367869d0ebdc" title="seaf_branch_free" alt="" coords="1400,429,1523,459"/><area shape="rect" id="node38" href="seaf-db_8c.html#a5b034a1fc119b2c3a989a03e7bb220e5" title="seaf_db_statement_query" alt="" coords="948,216,1119,245"/><area shape="rect" id="node40" href="seaf-db_8c.html#a022621519c8205275746dafb4801013a" title="seaf_db_prepare_statement" alt="" coords="1169,243,1351,272"/><area shape="rect" id="node42" href="seaf-db_8c.html#a0cb484988d9e1c156227b99eba482e3c" title="seaf_db_statement_free" alt="" coords="1179,189,1341,219"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_icgraph.png" border="0" usemap="#clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_icgraph" alt=""/></div>
<map name="clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_icgraph" id="clone-mgr_8c_ab6b5a2b4f13b382b9c7034131fa92783_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#a704ca859f1a1f7044c27b27982658672" title="seafile_download" alt="" coords="317,5,440,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a06b26730e317a268b3127067ee545307"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_add_task" ref="a06b26730e317a268b3127067ee545307" args="(SeafCloneManager *mgr, const char *repo_id, int repo_version, const char *peer_id, const char *repo_name, const char *token, const char *passwd, const char *magic, int enc_version, const char *random_key, const char *worktree_in, const char *peer_addr, const char *peer_port, const char *email, const char *more_info, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="clone-mgr_8h.html#a6b3ef937f8308db69c87bb650cb42fe9">seaf_clone_manager_add_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>magic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enc_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>random_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>peer_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>email</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>more_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01291">1291</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    <span class="keywordtype">char</span> *worktree;
    <span class="keywordtype">char</span> *ret;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip adding clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        !check_encryption_args (magic, enc_version, random_key, error))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* After a repo was unsynced, the sync task may still be blocked in the</span>
<span class="comment">     * network, so the repo is not actually deleted yet.</span>
<span class="comment">     * In this case just return an error to the user.</span>
<span class="comment">     */</span>
    <a class="code" href="struct__SyncInfo.html">SyncInfo</a> *sync_info = <a class="code" href="sync-mgr_8c.html#afb758dbde64ac4505ad259f95601d45e">seaf_sync_manager_get_sync_info</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a6b2a5e1e723955885f9fb27c5f064df4">sync_mgr</a>,
                                                           repo_id);
    <span class="keywordflow">if</span> (sync_info &amp;&amp; sync_info-&gt;<a class="code" href="struct__SyncInfo.html#ad0f77a2b8e799b3a0abc417fce88843a">in_sync</a>) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="keywordflow">if</span> (repo != NULL &amp;&amp; repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a> != NULL) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Repo already exists&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }   

    <span class="keywordflow">if</span> (is_duplicate_task (mgr, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>, 
                     <span class="stringliteral">&quot;Task is already in progress&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (passwd &amp;&amp;
        <a class="code" href="seafile-crypt_8c.html#a9ada7f42f1f31b91dabdc5edde6b73f9">seafile_verify_repo_passwd</a>(repo_id, passwd, magic, enc_version) &lt; 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Incorrect password&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">if</span> (!<a class="code" href="clone-mgr_8c.html#a45fe95b1bbe19ee533a8f9e57884658e">seaf_clone_manager_check_worktree_path</a> (mgr, worktree_in, error))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">/* Return error if worktree_in conflicts with another repo or</span>
<span class="comment">     * is not a directory.</span>
<span class="comment">     */</span>
    worktree = make_worktree (mgr, worktree_in, FALSE, error);
    <span class="keywordflow">if</span> (!worktree) {
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">/* If a repo was unsynced and then downloaded again, there may be</span>
<span class="comment">     * a garbage record for this repo. We don&#39;t want the downloaded blocks</span>
<span class="comment">     * be removed by GC.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (repo_version &gt; 0)
        <a class="code" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65">seaf_repo_manager_remove_garbage_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);

    <span class="comment">/* Delete orphan information in the db in case the repo was corrupt. */</span>
    <span class="keywordflow">if</span> (!repo)
        <a class="code" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c">seaf_repo_manager_remove_repo_ondisk</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id, FALSE);

    ret = add_task_common (mgr, repo_id, repo_version,
                           peer_id, repo_name, token, passwd,
                           enc_version, random_key,
                           worktree, peer_addr, peer_port,
                           email, more_info,
                           error);
    g_free (worktree);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a06b26730e317a268b3127067ee545307_cgraph.png" border="0" usemap="#clone-mgr_8c_a06b26730e317a268b3127067ee545307_cgraph" alt=""/></div>
<map name="clone-mgr_8c_a06b26730e317a268b3127067ee545307_cgraph" id="clone-mgr_8c_a06b26730e317a268b3127067ee545307_cgraph">
<area shape="rect" id="node3" href="sync-mgr_8c.html#afb758dbde64ac4505ad259f95601d45e" title="seaf_sync_manager_get_sync_info" alt="" coords="280,5,507,35"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6" title="seaf_repo_manager_get_repo" alt="" coords="297,59,489,88"/><area shape="rect" id="node7" href="seafile-crypt_8c.html#a9ada7f42f1f31b91dabdc5edde6b73f9" title="seafile_verify_repo_passwd" alt="" coords="303,112,484,141"/><area shape="rect" id="node13" href="clone-mgr_8c.html#a45fe95b1bbe19ee533a8f9e57884658e" title="seaf_clone_manager_check_worktree_path" alt="" coords="257,165,529,195"/><area shape="rect" id="node17" href="daemon_2repo-mgr_8c.html#a7d2cf85f06fa2e7d459730f7494c1a65" title="seaf_repo_manager_remove_garbage_repo" alt="" coords="259,219,528,248"/><area shape="rect" id="node19" href="daemon_2repo-mgr_8c.html#a008f145440cf3620f7883d1fe109f69c" title="seaf_repo_manager_remove_repo_ondisk" alt="" coords="263,324,524,353"/><area shape="rect" id="node9" href="seafile-crypt_8c.html#aef671f4a46b3d132f4219e55fbcb72d9" title="seafile_derive_key" alt="" coords="644,112,775,141"/><area shape="rect" id="node11" href="seafile_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09" title="rawdata_to_hex" alt="" coords="652,59,767,88"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8c.html#a5fe41fb7382995f3f335e408ba4ddb30" title="seaf_repo_manager_get_repo_list" alt="" coords="601,165,817,195"/><area shape="rect" id="node21" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9" title="sqlite_query_exec" alt="" coords="912,297,1037,327"/><area shape="rect" id="node23" href="seafile_2lib_2utils_8c.html#a26f091009701c5a9d1886b9d6ceb9c8e" title="seaf_util_unlink" alt="" coords="653,427,765,456"/><area shape="rect" id="node25" href="branch-mgr_8c.html#ad5bd62cbe17cb8fe91bcd993956a1fbf" title="seaf_branch_manager_get_branch_list" alt="" coords="587,480,832,509"/><area shape="rect" id="node31" href="branch-mgr_8c.html#ac6476414064e0ff0c429629aaab0bfc9" title="seaf_branch_list_free" alt="" coords="901,400,1048,429"/><area shape="rect" id="node37" href="daemon_2repo-mgr_8c.html#ae586fb5fbd61d6b44be3e47e7b6c86da" title="seaf_repo_manager_branch_repo_unmap" alt="" coords="580,272,839,301"/><area shape="rect" id="node39" href="branch-mgr_8c.html#a16b2df7708f3a4c4b96e9135ec7e1a3d" title="seaf_branch_manager_del_branch" alt="" coords="600,219,819,248"/><area shape="rect" id="node27" href="seafile_2lib_2db_8c.html#a4d1d0eb407f8f5dd522c3875beb7b9c8" title="sqlite_query_prepare" alt="" coords="904,520,1045,549"/><area shape="rect" id="node29" href="branch-mgr_8c.html#a4d213520d8a22d5191051715ccbfd1dd" title="seaf_branch_new" alt="" coords="913,467,1036,496"/><area shape="rect" id="node33" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653" title="seaf_branch_unref" alt="" coords="1137,400,1265,429"/><area shape="rect" id="node35" href="branch-mgr_8c.html#a449a49952dc253bd7b16367869d0ebdc" title="seaf_branch_free" alt="" coords="1341,400,1464,429"/><area shape="rect" id="node42" href="seaf-db_8c.html#a5b034a1fc119b2c3a989a03e7bb220e5" title="seaf_db_statement_query" alt="" coords="889,219,1060,248"/><area shape="rect" id="node44" href="seaf-db_8c.html#a022621519c8205275746dafb4801013a" title="seaf_db_prepare_statement" alt="" coords="1111,245,1292,275"/><area shape="rect" id="node46" href="seaf-db_8c.html#a0cb484988d9e1c156227b99eba482e3c" title="seaf_db_statement_free" alt="" coords="1120,192,1283,221"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a06b26730e317a268b3127067ee545307_icgraph.png" border="0" usemap="#clone-mgr_8c_a06b26730e317a268b3127067ee545307_icgraph" alt=""/></div>
<map name="clone-mgr_8c_a06b26730e317a268b3127067ee545307_icgraph" id="clone-mgr_8c_a06b26730e317a268b3127067ee545307_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#aca75772f76f8eafb2b08a023cd476f65" title="seafile_clone" alt="" coords="256,5,355,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2849d011d1f918b3108c30495c98254b"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_cancel_task" ref="a2849d011d1f918b3108c30495c98254b" args="(SeafCloneManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#a2849d011d1f918b3108c30495c98254b">seaf_clone_manager_cancel_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01503">1503</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__CloneTask.html">CloneTask</a> *task;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip canceling clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    task = g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);
    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">switch</span> (task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a>) {
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a15a782f2367c11ca3a9ee11a3f9c4eec">CLONE_STATE_INIT</a>:
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8afd7df49789f27957a882d91822b78eff">CLONE_STATE_CONNECT</a>:
        transition_state (task, <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a5b171455c76672ef5f3808bbc9267cc3">CLONE_STATE_CANCELED</a>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8ae67f39ebed40e85b2d90de1f3119edca">CLONE_STATE_FETCH</a>:
        <span class="keywordflow">if</span> (!task-&gt;<a class="code" href="struct__CloneTask.html#ae9ed3b204a7c4364ef44b16a7056ccd1">http_sync</a>)
            <a class="code" href="transfer-mgr_8c.html#af834de917c22d13996383431bef032a0">seaf_transfer_manager_cancel_task</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#aa04a8214ef989d1e5d68799dc19cbf22">transfer_mgr</a>,
                                               task-&gt;<a class="code" href="struct__CloneTask.html#a6ffe70c7ca5bbb71b617eecb53c0244f">tx_id</a>,
                                               <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>);
        <span class="keywordflow">else</span>
            <a class="code" href="http-tx-mgr_8c.html#a1333f1b023ba910df52c75f6ec51c41d">http_tx_manager_cancel_task</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a3be7b98d0f1cc49d0fad03c68e63da74">http_tx_mgr</a>,
                                         task-&gt;<a class="code" href="struct__CloneTask.html#ad7e57c9ed10d8e043c61b3382dc7c76a">repo_id</a>,
                                         <a class="code" href="http-tx-mgr_8h.html#a16af7b253440dadd46a80a4b9fddba4da429731c6953f215203cf1b17fe92ebb1">HTTP_TASK_TYPE_DOWNLOAD</a>);
        transition_state (task, <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a7c3d6e2ad24a7e0f2adf534a42b235bc">CLONE_STATE_CANCEL_PENDING</a>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8aae34ed29b33feeb3d64a3e5efe2d8ff0">CLONE_STATE_INDEX</a>:
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8ad8e45ae1a104379cb606fd2c05a7c6cd">CLONE_STATE_CHECKOUT</a>:
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a54946986c45281155e2e59421c8a8a77">CLONE_STATE_MERGE</a>:
        <span class="comment">/* We cannot cancel an in-progress checkout, just</span>
<span class="comment">         * wait until it finishes.</span>
<span class="comment">         */</span>
        transition_state (task, <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a7c3d6e2ad24a7e0f2adf534a42b235bc">CLONE_STATE_CANCEL_PENDING</a>);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a7c3d6e2ad24a7e0f2adf534a42b235bc">CLONE_STATE_CANCEL_PENDING</a>:
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        seaf_warning (<span class="stringliteral">&quot;[Clone mgr] cannot cancel a not-running task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_cgraph.png" border="0" usemap="#clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_cgraph" alt=""/></div>
<map name="clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_cgraph" id="clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_cgraph">
<area shape="rect" id="node3" href="transfer-mgr_8c.html#af834de917c22d13996383431bef032a0" title="seaf_transfer_manager_cancel_task" alt="" coords="272,5,504,35"/><area shape="rect" id="node5" href="http-tx-mgr_8c.html#a1333f1b023ba910df52c75f6ec51c41d" title="http_tx_manager_cancel_task" alt="" coords="291,59,485,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_icgraph.png" border="0" usemap="#clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_icgraph" alt=""/></div>
<map name="clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_icgraph" id="clone-mgr_8c_a2849d011d1f918b3108c30495c98254b_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#a45a875dc129e03d7582cdd2645ecf548" title="seafile_cancel_clone_task" alt="" coords="273,5,447,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a45fe95b1bbe19ee533a8f9e57884658e"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_check_worktree_path" ref="a45fe95b1bbe19ee533a8f9e57884658e" args="(SeafCloneManager *mgr, const char *path, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean <a class="el" href="clone-mgr_8h.html#a45fe95b1bbe19ee533a8f9e57884658e">seaf_clone_manager_check_worktree_path</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01134">1134</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *repos, *ptr;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    GHashTableIter iter;
    gpointer key, value;
    <a class="code" href="struct__CloneTask.html">CloneTask</a> *task;

    <span class="keywordflow">if</span> (check_dir_inclusiveness (path, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>) != 0 ||
        <span class="comment">/* It&#39;s OK if path is included by the default worktree parent. */</span>
        check_dir_inclusiveness (path, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a1675cecb3e52d94845f2ae1b28fd011a">worktree_dir</a>) &lt; 0 ||
        check_dir_inclusiveness (path, <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ab2fe4d566fbe5b9cff50a9bef54cd931">session</a>-&gt;<a class="code" href="struct__CcnetClient.html#a3cef20728e78352e5fe1819b692ed8e3">config_dir</a>) != 0) {
        seaf_warning (<span class="stringliteral">&quot;Worktree path conflicts with seafile system path.\n&quot;</span>);
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                     <span class="stringliteral">&quot;Worktree conflicts system path&quot;</span>);
        <span class="keywordflow">return</span> FALSE;
    }

    repos = <a class="code" href="daemon_2repo-mgr_8c.html#a5fe41fb7382995f3f335e408ba4ddb30">seaf_repo_manager_get_repo_list</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, -1, -1);
    <span class="keywordflow">for</span> (ptr = repos; ptr != NULL; ptr = ptr-&gt;next) {
        repo = ptr-&gt;data;
        <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__SeafRepo.html#a4342ff79933f9cbdbbd34114e5a26df3">worktree</a> != NULL &amp;&amp;
            check_dir_inclusiveness (path, repo-&gt;<a class="code" href="struct__SeafRepo.html#a4342ff79933f9cbdbbd34114e5a26df3">worktree</a>) != 0) {
            seaf_warning (<span class="stringliteral">&quot;Worktree path conflict with repo %s.\n&quot;</span>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a>);
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                         <span class="stringliteral">&quot;Worktree conflicts existing repo&quot;</span>);
            g_list_free (repos);
            <span class="keywordflow">return</span> FALSE;
        }
    }
    g_list_free (repos);

    g_hash_table_iter_init (&amp;iter, mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>);
    <span class="keywordflow">while</span> (g_hash_table_iter_next (&amp;iter, &amp;key, &amp;value)) {
        task = value;
        <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> == <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8af1c3a28143f803ec77f12421a745c80e">CLONE_STATE_DONE</a> ||
            task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> == <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8aed32a49a21c225e3aa62f83b837e2e33">CLONE_STATE_ERROR</a> ||
            task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> == <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a5b171455c76672ef5f3808bbc9267cc3">CLONE_STATE_CANCELED</a>)
            <span class="keywordflow">continue</span>;
        <span class="keywordflow">if</span> (check_dir_inclusiveness (path, task-&gt;<a class="code" href="struct__CloneTask.html#a1d415384ea992d92e436c07bfc72a69d">worktree</a>) != 0) {
            seaf_warning (<span class="stringliteral">&quot;Worktree path conflict with clone %.8s.\n&quot;</span>,
                          task-&gt;<a class="code" href="struct__CloneTask.html#ad7e57c9ed10d8e043c61b3382dc7c76a">repo_id</a>);
            g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a88b2b3e2f6be1400399fbb41c341f1cd">SEAF_ERR_GENERAL</a>,
                         <span class="stringliteral">&quot;Worktree conflicts existing repo&quot;</span>);
            <span class="keywordflow">return</span> FALSE;
        }
    }

    <span class="keywordflow">return</span> TRUE;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_cgraph.png" border="0" usemap="#clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_cgraph" alt=""/></div>
<map name="clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_cgraph" id="clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_cgraph">
<area shape="rect" id="node3" href="daemon_2repo-mgr_8c.html#a5fe41fb7382995f3f335e408ba4ddb30" title="seaf_repo_manager_get_repo_list" alt="" coords="329,5,545,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_icgraph.png" border="0" usemap="#clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_icgraph" alt=""/></div>
<map name="clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_icgraph" id="clone-mgr_8c_a45fe95b1bbe19ee533a8f9e57884658e_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#a80c8591afe413de060923bf01abf2bf1" title="seafile_check_path_for_clone" alt="" coords="332,5,527,35"/><area shape="rect" id="node5" href="clone-mgr_8h.html#a6b3ef937f8308db69c87bb650cb42fe9" title="seaf_clone_manager_add_task" alt="" coords="328,59,531,88"/><area shape="rect" id="node7" href="seafile-rpc_8h.html#aca75772f76f8eafb2b08a023cd476f65" title="seafile_clone" alt="" coords="579,59,677,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaac97c14f78e703fd118de5bea1745e6"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_gen_default_worktree" ref="aaac97c14f78e703fd118de5bea1745e6" args="(SeafCloneManager *mgr, const char *worktree_parent, const char *repo_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="clone-mgr_8h.html#aaac97c14f78e703fd118de5bea1745e6">seaf_clone_manager_gen_default_worktree</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree_parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01061">1061</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *wt = g_build_filename (worktree_parent, repo_name, NULL);
    <span class="keywordtype">char</span> *worktree;

    worktree = make_worktree (mgr, wt, TRUE, NULL);
    <span class="keywordflow">if</span> (!worktree)
        <span class="keywordflow">return</span> wt;

    g_free (wt);
    <span class="keywordflow">return</span> worktree;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_aaac97c14f78e703fd118de5bea1745e6_icgraph.png" border="0" usemap="#clone-mgr_8c_aaac97c14f78e703fd118de5bea1745e6_icgraph" alt=""/></div>
<map name="clone-mgr_8c_aaac97c14f78e703fd118de5bea1745e6_icgraph" id="clone-mgr_8c_aaac97c14f78e703fd118de5bea1745e6_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#af344b899d6187329bbc1e4a4f8132bd5" title="seafile_gen_default_worktree" alt="" coords="329,5,519,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acb26f43fecfbf4f3b0c81ea6f7a6195f"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_get_task" ref="acb26f43fecfbf4f3b0c81ea6f7a6195f" args="(SeafCloneManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="clone-mgr_8h.html#a5feadb7226431f7237bdfee08ef1ef90">CloneTask</a>* <a class="el" href="clone-mgr_8h.html#acb26f43fecfbf4f3b0c81ea6f7a6195f">seaf_clone_manager_get_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01586">1586</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (<a class="code" href="struct__CloneTask.html">CloneTask</a> *) g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6b295c7d97d0c650eb97ea7a9c7eb98f"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_get_tasks" ref="a6b295c7d97d0c650eb97ea7a9c7eb98f" args="(SeafCloneManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="clone-mgr_8h.html#a6b295c7d97d0c650eb97ea7a9c7eb98f">seaf_clone_manager_get_tasks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01593">1593</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> g_hash_table_get_values (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a6b295c7d97d0c650eb97ea7a9c7eb98f_icgraph.png" border="0" usemap="#clone-mgr_8c_a6b295c7d97d0c650eb97ea7a9c7eb98f_icgraph" alt=""/></div>
<map name="clone-mgr_8c_a6b295c7d97d0c650eb97ea7a9c7eb98f_icgraph" id="clone-mgr_8c_a6b295c7d97d0c650eb97ea7a9c7eb98f_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#aa8c74c54ead60c71cdd371d9ebc3fd6c" title="seafile_get_clone_tasks" alt="" coords="261,5,424,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad7860d1243e7f8ee8e9d3b8e6c032378"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_init" ref="ad7860d1243e7f8ee8e9d3b8e6c032378" args="(SeafCloneManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#ad7860d1243e7f8ee8e9d3b8e6c032378">seaf_clone_manager_init</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00553">553</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> *sql;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneTasks &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, repo_name TEXT, &quot;</span>
        <span class="stringliteral">&quot;token TEXT, dest_id TEXT,&quot;</span>
        <span class="stringliteral">&quot;worktree_parent TEXT, passwd TEXT, &quot;</span>
        <span class="stringliteral">&quot;server_addr TEXT, server_port TEXT, email TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneTasksMoreInfo &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, more_info TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneEncInfo &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, enc_version INTEGER, random_key TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneVersionInfo &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, repo_version INTEGER);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    sql = <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS CloneServerURL &quot;</span>
        <span class="stringliteral">&quot;(repo_id TEXT PRIMARY KEY, server_url TEXT);&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9">sqlite_query_exec</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql) &lt; 0)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_cgraph.png" border="0" usemap="#clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_cgraph" alt=""/></div>
<map name="clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_cgraph" id="clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_cgraph">
<area shape="rect" id="node3" href="seafile_2lib_2db_8c.html#a34065420d7e15be3dd4e8bff5cb51fe9" title="sqlite_query_exec" alt="" coords="223,5,348,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_icgraph.png" border="0" usemap="#clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_icgraph" alt=""/></div>
<map name="clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_icgraph" id="clone-mgr_8c_ad7860d1243e7f8ee8e9d3b8e6c032378_icgraph">
<area shape="rect" id="node3" href="daemon_2seafile-session_8h.html#abe136340477380edec6a5deba0ff8e1a" title="seafile_session_prepare" alt="" coords="221,5,384,35"/><area shape="rect" id="node5" href="seaf-daemon_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="432,5,483,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af28bac46c2f7acc1fc6eef867db947e9"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_new" ref="af28bac46c2f7acc1fc6eef867db947e9" args="(SeafileSession *session)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a>* <a class="el" href="clone-mgr_8h.html#ae861dc0d625b2072ab3a0641a2aa6797">seaf_clone_manager_new</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="daemon_2seafile-session_8h.html#a3412e7ea22f43083cdc07acffa80f859">SeafileSession</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00383">383</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafCloneManager.html">SeafCloneManager</a> *mgr = g_new0 (<a class="code" href="struct__SeafCloneManager.html">SeafCloneManager</a>, 1);

    <span class="keywordtype">char</span> *db_path = g_build_path (<span class="stringliteral">&quot;/&quot;</span>, session-&gt;<a class="code" href="struct__SeafileSession.html#ae4df188e5674e3e4b405f14d0ee1bf9f">seaf_dir</a>, <a class="code" href="clone-mgr_8c.html#a35f4ad46c9e15dc72ccb38574e0c62c6">CLONE_DB</a>, NULL);
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#af6e9a0e79db923d4a7df37bc5588400a">sqlite_open_db</a> (db_path, &amp;mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>) &lt; 0) {
        g_critical (<span class="stringliteral">&quot;[Clone mgr] Failed to open db\n&quot;</span>);
        g_free (db_path);
        g_free (mgr);
        <span class="keywordflow">return</span> NULL;
    }

    mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a3ffe52698a800372c82b6d19215d5b82">seaf</a> = <a class="code" href="cluster-mgr_8c.html#af241ba8540cd17c31a02b56c2aaa126c">session</a>;
    mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a> = g_hash_table_new_full (g_str_hash, g_str_equal,
                                        g_free, (GDestroyNotify)clone_task_free);
    <span class="keywordflow">return</span> mgr;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_cgraph.png" border="0" usemap="#clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_cgraph" alt=""/></div>
<map name="clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_cgraph" id="clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_cgraph">
<area shape="rect" id="node3" href="seafile_2lib_2db_8c.html#af6e9a0e79db923d4a7df37bc5588400a" title="sqlite_open_db" alt="" coords="227,5,336,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_icgraph.png" border="0" usemap="#clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_icgraph" alt=""/></div>
<map name="clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_icgraph" id="clone-mgr_8c_af28bac46c2f7acc1fc6eef867db947e9_icgraph">
<area shape="rect" id="node3" href="daemon_2seafile-session_8h.html#a3eea8fbb412edb5ff72027285edb7c72" title="seafile_session_new" alt="" coords="228,5,369,35"/><area shape="rect" id="node5" href="seaf-daemon_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="419,5,469,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a131d57446fac0ffddf9dd4dbebe985ae"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_remove_task" ref="a131d57446fac0ffddf9dd4dbebe985ae" args="(SeafCloneManager *mgr, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#a131d57446fac0ffddf9dd4dbebe985ae">seaf_clone_manager_remove_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l01552">1552</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__CloneTask.html">CloneTask</a> *task;

    <span class="keywordflow">if</span> (!<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a5432788378b921624977855244c63a85">started</a>) {
        seaf_message (<span class="stringliteral">&quot;System not started, skip removing clone task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    task = g_hash_table_lookup (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);
    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> != <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8af1c3a28143f803ec77f12421a745c80e">CLONE_STATE_DONE</a> &amp;&amp;
        task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> != <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8aed32a49a21c225e3aa62f83b837e2e33">CLONE_STATE_ERROR</a> &amp;&amp;
        task-&gt;<a class="code" href="struct__CloneTask.html#aba8f694c35ee581602d51889dfcc6851">state</a> != <a class="code" href="clone-mgr_8h.html#ac36f475ca5b446f4fde4c9b90bec77c8a5b171455c76672ef5f3808bbc9267cc3">CLONE_STATE_CANCELED</a>) {
        seaf_warning (<span class="stringliteral">&quot;[Clone mgr] cannot remove running task.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__CloneTask.html#a6ffe70c7ca5bbb71b617eecb53c0244f">tx_id</a>)
        <a class="code" href="transfer-mgr_8c.html#ad58e56f4396d154be75bdb37bf4a53ae">seaf_transfer_manager_remove_task</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#aa04a8214ef989d1e5d68799dc19cbf22">transfer_mgr</a>,
                                           task-&gt;<a class="code" href="struct__CloneTask.html#a6ffe70c7ca5bbb71b617eecb53c0244f">tx_id</a>,
                                           <a class="code" href="transfer-mgr_8h.html#a394b3903fbf00ba2b6243f60689a5a5fa68841d8280724b9623db3dea4a78dde5">TASK_TYPE_DOWNLOAD</a>);

    <span class="comment">/* On-disk task should have been removed. */</span>

    g_hash_table_remove (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ac27110eab926004781f02c7b5e4d0370">tasks</a>, repo_id);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_cgraph.png" border="0" usemap="#clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_cgraph" alt=""/></div>
<map name="clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_cgraph" id="clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_cgraph">
<area shape="rect" id="node3" href="transfer-mgr_8c.html#ad58e56f4396d154be75bdb37bf4a53ae" title="seaf_transfer_manager_remove_task" alt="" coords="277,5,515,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_icgraph.png" border="0" usemap="#clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_icgraph" alt=""/></div>
<map name="clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_icgraph" id="clone-mgr_8c_a131d57446fac0ffddf9dd4dbebe985ae_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#a6b6845a0e962e66993f08211e2a4cebb" title="seafile_remove_clone_task" alt="" coords="279,5,457,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af1cec3356abdd2c8a92e8edc7ae79269"></a><!-- doxytag: member="clone&#45;mgr.c::seaf_clone_manager_start" ref="af1cec3356abdd2c8a92e8edc7ae79269" args="(SeafCloneManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="clone-mgr_8h.html#af1cec3356abdd2c8a92e8edc7ae79269">seaf_clone_manager_start</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="clone-mgr_8h.html#adedadaff7bf92a1799ae6bcd12162322">SeafCloneManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="clone-mgr_8c_source.html#l00614">614</a> of file <a class="el" href="clone-mgr_8c_source.html">clone-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="include_2ccnet_2proc-factory_8h.html#aa8eba73e6627b33e2cb2d91fd0ea9922">ccnet_proc_factory_register_processor</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#ab2fe4d566fbe5b9cff50a9bef54cd931">session</a>-&gt;<a class="code" href="struct__CcnetClient.html#a0323e7b06acd2088f195ca6b0688ed54">proc_factory</a>,
                                           <span class="stringliteral">&quot;seafile-checkff&quot;</span>,
                                           <a class="code" href="daemon_2processors_2checkff-proc_8h.html#a5fd38032a5f483b89c1c0a13b0477eff">SEAFILE_TYPE_CHECKFF_PROC</a>);

    mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#ad242e9e88dab10ffea500f6155816836">check_timer</a> = <a class="code" href="timer_8h.html#a68b6afb704a7f56b625ed78146691b7c">ccnet_timer_new</a> (check_connect_pulse, mgr,
                                        <a class="code" href="clone-mgr_8c.html#a50841e5a1d701383bf3b5c0302545d9b">CHECK_CONNECT_INTERVAL</a> * 1000);

    <span class="keywordtype">char</span> *sql = <span class="stringliteral">&quot;SELECT * FROM CloneTasks&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="seafile_2lib_2db_8c.html#a17cffec15ffa34446ad00f950eab6fe2">sqlite_foreach_selected_row</a> (mgr-&gt;<a class="code" href="struct__SeafCloneManager.html#a58b6344d07f7bbaa4fbd81b570cfbe65">db</a>, sql, restart_task, mgr) &lt; 0)
        <span class="keywordflow">return</span> -1;

    g_signal_connect (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>, <span class="stringliteral">&quot;repo-fetched&quot;</span>,
                      (GCallback)on_repo_fetched, mgr);
    g_signal_connect (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>, <span class="stringliteral">&quot;repo-http-fetched&quot;</span>,
                      (GCallback)on_repo_http_fetched, mgr);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="clone-mgr_8c_af1cec3356abdd2c8a92e8edc7ae79269_cgraph.png" border="0" usemap="#clone-mgr_8c_af1cec3356abdd2c8a92e8edc7ae79269_cgraph" alt=""/></div>
<map name="clone-mgr_8c_af1cec3356abdd2c8a92e8edc7ae79269_cgraph" id="clone-mgr_8c_af1cec3356abdd2c8a92e8edc7ae79269_cgraph">
<area shape="rect" id="node3" href="include_2ccnet_2proc-factory_8h.html#aa8eba73e6627b33e2cb2d91fd0ea9922" title="ccnet_proc_factory_register_processor" alt="" coords="231,5,476,35"/><area shape="rect" id="node5" href="timer_8h.html#a68b6afb704a7f56b625ed78146691b7c" title="ccnet_timer_new" alt="" coords="293,59,413,88"/><area shape="rect" id="node9" href="seafile_2lib_2db_8c.html#a17cffec15ffa34446ad00f950eab6fe2" title="sqlite_foreach_selected_row" alt="" coords="260,112,447,141"/><area shape="rect" id="node7" href="seafile_2lib_2utils_8c.html#ac0aa6c70f613ad3344b5f1f917b6b68a" title="timeval_from_msec" alt="" coords="525,59,661,88"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:55:47 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
