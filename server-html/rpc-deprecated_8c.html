<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile/common/rpc-deprecated.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile/common/rpc-deprecated.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="rpc-deprecated_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">gint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a8c310a9cb73f37048c8731f61b875db7">seafile_repo_size</a> (const char *repo_id, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#afb600f07a2183e34f31eb2fa5c783a15">seafile_branch_del</a> (const char *repo_id, const char *branch_name, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#af1251308e7e0c5e16435c893431f70fc">seafile_status</a> (const char *repo_id, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a5bb007b4c99262f41df4510520153dee">seafile_set_repo_lantoken</a> (const char *repo_id, const char *token, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a71c77438de4c0eedfb7cb7c1cb02576d">seafile_get_repo_lantoken</a> (const char *repo_id, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a44c13248d230153c03d45590ab434a9c">seafile_get_repo_list_pub</a> (int start, int limit, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GObject *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a4be3dbe527186e1687ad3c33bd4432d4">seafile_get_repo_pub</a> (const gchar *id, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GObject *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a3547a38fe3590d09bed824120ec100e9">seafile_get_commit_pub</a> (const gchar *id, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#a374cf49b787fef8fc91266c87cc15375">seafile_get_commit_list_pub</a> (const char *repo_id, int offset, int limit, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rpc-deprecated_8c.html#aae53e401e7b13b3ba97de36145547aa1">seafile_list_dir_pub</a> (const char *dir_id, GError **error)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="afb600f07a2183e34f31eb2fa5c783a15"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_branch_del" ref="afb600f07a2183e34f31eb2fa5c783a15" args="(const char *repo_id, const char *branch_name, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="rpc-deprecated_8c.html#afb600f07a2183e34f31eb2fa5c783a15">seafile_branch_del</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>branch_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00047">47</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    <a class="code" href="struct__SeafBranch.html">SeafBranch</a> *branch;

    <span class="keywordflow">if</span> (!repo_id || !branch_name) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Argument should not be null&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
    <span class="keywordflow">if</span> (!repo) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;No such repository&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    branch = <a class="code" href="branch-mgr_8c.html#a1dffc8c3c325e4ca1daf8a5d5f4f6956">seaf_branch_manager_get_branch</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#acd445f79648f74358e145f48f771e11c">branch_mgr</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, branch_name);
    <span class="keywordflow">if</span> (!branch) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;No such branch&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (strcmp(repo-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a>-&gt;<a class="code" href="struct__SeafBranch.html#ae6af0006b9b80ded4f0525a3be06ccda">name</a>, branch-&gt;<a class="code" href="struct__SeafBranch.html#ae6af0006b9b80ded4f0525a3be06ccda">name</a>) == 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>,
                     <span class="stringliteral">&quot;Cannot delete the branch which you are currently on&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/*</span>
<span class="comment">     * TODO: we just delete branch itself and need to remove commits using gc.</span>
<span class="comment">     */</span>
    <a class="code" href="daemon_2repo-mgr_8c.html#ae586fb5fbd61d6b44be3e47e7b6c86da">seaf_repo_manager_branch_repo_unmap</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, branch);
    <a class="code" href="branch-mgr_8c.html#a16b2df7708f3a4c4b96e9135ec7e1a3d">seaf_branch_manager_del_branch</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#acd445f79648f74358e145f48f771e11c">branch_mgr</a>, repo-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, branch-&gt;<a class="code" href="struct__SeafBranch.html#ae6af0006b9b80ded4f0525a3be06ccda">name</a>);
    <a class="code" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653">seaf_branch_unref</a> (branch);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a374cf49b787fef8fc91266c87cc15375"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_get_commit_list_pub" ref="a374cf49b787fef8fc91266c87cc15375" args="(const char *repo_id, int offset, int limit, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="seafile-rpc_8h.html#a938c90d06d75b64c6b7172beecc74c06">seafile_get_commit_list_pub</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00276">276</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;

    <span class="comment">/* correct parameter */</span>
    <span class="keywordflow">if</span> (offset &lt; 0)
        offset = 0;

    <span class="keywordflow">if</span> (!repo_id) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Argument should not be null&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
    <span class="keywordflow">if</span> (!repo || !check_repo_public(repo)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a4e83bbdab82c39e4738fd82c33a87ab4">SEAF_ERR_BAD_REPO</a>, <span class="stringliteral">&quot;No such repository&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="keywordflow">return</span> <a class="code" href="seafile_2common_2rpc-service_8c.html#a5594de7f321b08c515c465bc44e25c60">seafile_get_commit_list</a>(repo_id, offset, limit, error);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3547a38fe3590d09bed824120ec100e9"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_get_commit_pub" ref="a3547a38fe3590d09bed824120ec100e9" args="(const gchar *id, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GObject* <a class="el" href="seafile-rpc_8h.html#a3547a38fe3590d09bed824120ec100e9">seafile_get_commit_pub</a> </td>
          <td>(</td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00261">261</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafileCommit.html">SeafileCommit</a> *commit;
    <a class="code" href="struct__SeafCommit.html">SeafCommit</a> *c;

    c = <a class="code" href="commit-mgr_8c.html#adaf4b74c4dba25ddaa746f4ff9221b3f">seaf_commit_manager_get_commit</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a62979f26f91fc5e54e0a670e8d69ef67">commit_mgr</a>, <span class="keywordtype">id</span>);
    <span class="keywordflow">if</span> (!c || !check_commit_public(c))
        <span class="keywordflow">return</span> NULL;

    commit = <a class="code" href="seafile_2common_2rpc-service_8c.html#ae284b482780d940fb7b6a12fdd668ab3">convert_to_seafile_commit</a> (c);
    <a class="code" href="commit-mgr_8c.html#a436a9092e9c5711820dc1a09234aac04">seaf_commit_unref</a> (c);
    <span class="keywordflow">return</span> (GObject *)commit;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71c77438de4c0eedfb7cb7c1cb02576d"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_get_repo_lantoken" ref="a71c77438de4c0eedfb7cb7c1cb02576d" args="(const char *repo_id, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="seafile-rpc_8h.html#a9d9d4f0849de83211d4ab01eb1f183f4">seafile_get_repo_lantoken</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00151">151</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> *token;

    <span class="keywordflow">if</span> (!repo_id) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Arguments should not be empty&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    token = <a class="code" href="daemon_2repo-mgr_8c.html#a45b0ed6bbbdfac4fd104962800f426c3">seaf_repo_manager_get_repo_lantoken</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
    <span class="keywordflow">if</span> (!token)
        <span class="keywordflow">return</span> g_strdup(<a class="code" href="daemon_2repo-mgr_8h.html#afa2f07ad83586c04020cc7fa2760ff1a">DEFAULT_REPO_TOKEN</a>);

    <span class="keywordflow">return</span> token;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a44c13248d230153c03d45590ab434a9c"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_get_repo_list_pub" ref="a44c13248d230153c03d45590ab434a9c" args="(int start, int limit, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="seafile-rpc_8h.html#a44c13248d230153c03d45590ab434a9c">seafile_get_repo_list_pub</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00222">222</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">/* TODO: use start_id and limit */</span>
    GList *repos = <a class="code" href="daemon_2repo-mgr_8c.html#a5fe41fb7382995f3f335e408ba4ddb30">seaf_repo_manager_get_repo_list</a>(<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, start, limit);
    GList *ret = NULL;

    ret = convert_pubrepo_list (repos);
    g_list_free (repos);
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4be3dbe527186e1687ad3c33bd4432d4"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_get_repo_pub" ref="a4be3dbe527186e1687ad3c33bd4432d4" args="(const gchar *id, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GObject* <a class="el" href="seafile-rpc_8h.html#a4be3dbe527186e1687ad3c33bd4432d4">seafile_get_repo_pub</a> </td>
          <td>(</td>
          <td class="paramtype">const gchar *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00233">233</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *r;

    r = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, <span class="keywordtype">id</span>);
    <span class="keywordflow">if</span> (r == NULL || !check_repo_public(r))
        <span class="keywordflow">return</span> NULL;

    <a class="code" href="struct__SeafileRepo.html">SeafileRepo</a> *repo = <a class="code" href="repo_8c.html#aa79b3385c8305b8896783034e9aed0c0">seafile_repo_new</a> ();
    g_object_set (repo, <span class="stringliteral">&quot;id&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, <span class="stringliteral">&quot;name&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#a235da8ad7bdcaa5bf5b8e2b3e6e23b88">name</a>,
                  <span class="stringliteral">&quot;desc&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#a2bcd0258d3e8deb15a45aa8403c9156d">desc</a>, <span class="stringliteral">&quot;encrypted&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#ab50d0e015838fe83d735ba2d6cb40804">encrypted</a>,
                  <span class="stringliteral">&quot;head_branch&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a> ? r-&gt;<a class="code" href="struct__SeafRepo.html#a8e635ccff244ee483d3b4abe576e388e">head</a>-&gt;<a class="code" href="struct__SeafBranch.html#ae6af0006b9b80ded4f0525a3be06ccda">name</a> : NULL,
                  NULL);

    g_object_set (repo,
                  <span class="comment">/* &quot;auto-sync&quot;, r-&gt;auto_sync, */</span>
                  <span class="stringliteral">&quot;relay-id&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#a5ec79fa4b78423415fc5f31b90fa5bd1">relay_id</a>,
                  <span class="stringliteral">&quot;auto-sync&quot;</span>, r-&gt;<a class="code" href="struct__SeafRepo.html#a179d8ca9672a5eeafcbf535d0ccee45d">auto_sync</a>,
                  NULL);

    g_object_set (repo,
                  <span class="stringliteral">&quot;last-modify&quot;</span>, <a class="code" href="seafile_2common_2rpc-service_8c.html#a3e4e9d217daa4c70314c43c6065a57ea">seafile_repo_last_modify</a>(r-&gt;<a class="code" href="struct__SeafRepo.html#a9d6bc9ae525da00bc4c7d1f62dc9b762">id</a>, NULL),
                  NULL);

    <span class="keywordflow">return</span> (GObject *)repo;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aae53e401e7b13b3ba97de36145547aa1"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_list_dir_pub" ref="aae53e401e7b13b3ba97de36145547aa1" args="(const char *dir_id, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="seafile-rpc_8h.html#aae53e401e7b13b3ba97de36145547aa1">seafile_list_dir_pub</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00302">302</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="seafile-rpc_8h.html#a0911e519564e6bde5ff64ee7fc4682ba">seafile_list_dir</a> (dir_id, error);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8c310a9cb73f37048c8731f61b875db7"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_repo_size" ref="a8c310a9cb73f37048c8731f61b875db7" args="(const char *repo_id, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gint64 <a class="el" href="seafile-rpc_8h.html#a3fd3f9f88f965fa1db3c83399ff84075">seafile_repo_size</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00003">3</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafBranch.html">SeafBranch</a> *local;
    RepoSize *rs;

    <span class="keywordflow">if</span> (!repo_id) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Argument should not be null&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    local = <a class="code" href="branch-mgr_8c.html#a1dffc8c3c325e4ca1daf8a5d5f4f6956">seaf_branch_manager_get_branch</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#acd445f79648f74358e145f48f771e11c">branch_mgr</a>, repo_id, <span class="stringliteral">&quot;local&quot;</span>);
    <span class="keywordflow">if</span> (!local) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, -1, <span class="stringliteral">&quot;No local branch&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    rs = seaf_info_manager_get_repo_size_from_db (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;info_mgr, repo_id);
    <span class="keywordflow">if</span> (!rs) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, -1, <span class="stringliteral">&quot;Database error&quot;</span>);
        <a class="code" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653">seaf_branch_unref</a> (local);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">//no new commit on &quot;local&quot; branch</span>
    <span class="keywordflow">if</span> (strcmp (rs-&gt;commit_id, local-&gt;<a class="code" href="struct__SeafBranch.html#a244ae046d92274c745de9f2b4d115962">commit_id</a>) == 0) {
        <a class="code" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653">seaf_branch_unref</a> (local);
        gint64 <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a> = rs-&gt;size;
        g_free (rs);
        <span class="keywordflow">return</span> <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>;
    }

    gint64 <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a> = <a class="code" href="branch-mgr_8h.html#a33849d88532c230ad9eccbdb78f9b84b">seaf_branch_manager_calculate_branch_size</a> (
        <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#acd445f79648f74358e145f48f771e11c">branch_mgr</a>, repo_id, local-&gt;<a class="code" href="struct__SeafBranch.html#a244ae046d92274c745de9f2b4d115962">commit_id</a>);
    <a class="code" href="branch-mgr_8c.html#a2e44cba993ba080e7550a832f019f653">seaf_branch_unref</a> (local);
    g_free (rs);
    <span class="keywordflow">if</span> (size &lt; 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, -1, <span class="stringliteral">&quot;Calulate branch size error&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5bb007b4c99262f41df4510520153dee"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_set_repo_lantoken" ref="a5bb007b4c99262f41df4510520153dee" args="(const char *repo_id, const char *token, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="seafile-rpc_8h.html#abe3c924ad42ccd2b63f7a36041fbde6d">seafile_set_repo_lantoken</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00123">123</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> ret;

    <span class="keywordflow">if</span> (repo_id == NULL || token == NULL) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Arguments should not be empty&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (!<a class="code" href="daemon_2repo-mgr_8c.html#a4b2497e6cdde50c4ce3cb642370e06eb">seaf_repo_manager_repo_exists</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id)) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a4e83bbdab82c39e4738fd82c33a87ab4">SEAF_ERR_BAD_REPO</a>, <span class="stringliteral">&quot;Repo %s doesn&#39;t exist&quot;</span>, repo_id);
        <span class="keywordflow">return</span> -1;
    }

    ret = <a class="code" href="daemon_2repo-mgr_8c.html#a93b2f3d8f0964708f8fb0450fded2a42">seaf_repo_manager_set_repo_lantoken</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>,
                                               repo_id, token);
    <span class="keywordflow">if</span> (ret &lt; 0) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a7aec187daf50bdbbf10c9eb4ca50c981">SEAF_ERR_INTERNAL</a>,
                     <span class="stringliteral">&quot;Failed to set token for repo %s&quot;</span>, repo_id);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1251308e7e0c5e16435c893431f70fc"></a><!-- doxytag: member="rpc&#45;deprecated.c::seafile_status" ref="af1251308e7e0c5e16435c893431f70fc" args="(const char *repo_id, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="rpc-deprecated_8c.html#af1251308e7e0c5e16435c893431f70fc">seafile_status</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc-deprecated_8c_source.html#l00086">86</a> of file <a class="el" href="rpc-deprecated_8c_source.html">rpc-deprecated.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;
    <span class="keywordtype">char</span> *res_str;

    <span class="keywordflow">if</span> (!repo_id) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Argument should not be null&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    repo = <a class="code" href="daemon_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
    <span class="keywordflow">if</span> (!repo) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;No such repository&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">/* Return immediately if repo is locked, so that the GUI will not</span>
<span class="comment">     * be frozen.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (pthread_mutex_trylock (&amp;repo-&gt;<a class="code" href="struct__SeafRepo.html#aaa93119bb8b7b6038e9feb3c3a78b0ab">lock</a>) == EBUSY) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#a078ac87edb6f3284f1de598bdf2b0805">SEAF_ERR_REPO_LOCKED</a>, <span class="stringliteral">&quot;Repo is locked&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    res_str = <a class="code" href="daemon_2repo-mgr_8h.html#a47cf4677f4c176aa29a50e7401e58733">seaf_repo_status</a> (repo);
    <span class="keywordflow">if</span> (!res_str) {
        g_set_error (error, <a class="code" href="seafile_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, -1, <span class="stringliteral">&quot;Failed to status&quot;</span>);
        pthread_mutex_unlock (&amp;repo-&gt;<a class="code" href="struct__SeafRepo.html#aaa93119bb8b7b6038e9feb3c3a78b0ab">lock</a>);
        <span class="keywordflow">return</span> NULL;
    }

    pthread_mutex_unlock (&amp;repo-&gt;<a class="code" href="struct__SeafRepo.html#aaa93119bb8b7b6038e9feb3c3a78b0ab">lock</a>);

    <span class="keywordflow">return</span> res_str;
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 02:46:12 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
