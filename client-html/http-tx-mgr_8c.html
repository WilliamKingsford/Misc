<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile-4.1.2/daemon/http-tx-mgr.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile-4.1.2/daemon/http-tx-mgr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;common.h&quot;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;curl/curl.h&gt;</code><br/>
<code>#include &lt;jansson.h&gt;</code><br/>
<code>#include &lt;event2/buffer.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="ccnet-client_8h_source.html">ccnet/ccnet-client.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="seafile-config_8h_source.html">seafile-config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2seafile-session_8h_source.html">seafile-session.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="http-tx-mgr_8h_source.html">http-tx-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-error_8h_source.html">seafile-error.h</a>&quot;</code><br/>
<code>#include &quot;utils.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="diff-simple_8h_source.html">diff-simple.h</a>&quot;</code><br/>
<code>#include &quot;log.h&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for http-tx-mgr.c:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c__incl.png" border="0" usemap="#seafile-4_81_82_2daemon_2http-tx-mgr_8c" alt=""/></div>
<map name="seafile-4_81_82_2daemon_2http-tx-mgr_8c" id="seafile-4_81_82_2daemon_2http-tx-mgr_8c">
<area shape="rect" id="node13" href="ccnet-client_8h.html" title="ccnet/ccnet&#45;client.h" alt="" coords="2061,315,2197,344"/><area shape="rect" id="node37" href="seafile-config_8h.html" title="seafile&#45;config.h" alt="" coords="99,83,208,112"/><area shape="rect" id="node39" href="daemon_2seafile-session_8h.html" title="seafile&#45;session.h" alt="" coords="689,160,809,189"/><area shape="rect" id="node127" href="http-tx-mgr_8h.html" title="http&#45;tx&#45;mgr.h" alt="" coords="2268,237,2364,267"/><area shape="rect" id="node134" href="seafile-error_8h.html" title="seafile&#45;error.h" alt="" coords="2927,83,3028,112"/><area shape="rect" id="node137" href="diff-simple_8h.html" title="diff&#45;simple.h" alt="" coords="2521,160,2615,189"/><area shape="rect" id="node21" href="ccnet-session-base_8h.html" title="ccnet&#45;session&#45;base.h" alt="" coords="1799,392,1945,421"/><area shape="rect" id="node24" href="include_2ccnet_2message_8h.html" title="ccnet/message.h" alt="" coords="1969,392,2092,421"/><area shape="rect" id="node28" href="include_2ccnet_2processor_8h.html" title="ccnet/processor.h" alt="" coords="1548,392,1673,421"/><area shape="rect" id="node34" href="status-code_8h.html" title="ccnet/status&#45;code.h" alt="" coords="1543,469,1679,499"/><area shape="rect" id="node42" href="cevent_8h.html" title="ccnet/cevent.h" alt="" coords="231,392,337,421"/><area shape="rect" id="node48" href="mqclient-proc_8h.html" title="ccnet/mqclient&#45;proc.h" alt="" coords="1745,315,1892,344"/><area shape="rect" id="node53" href="job-mgr_8h.html" title="ccnet/job&#45;mgr.h" alt="" coords="5,547,117,576"/><area shape="rect" id="node56" href="block-mgr_8h.html" title="block&#45;mgr.h" alt="" coords="2356,392,2447,421"/><area shape="rect" id="node63" href="fs-mgr_8h.html" title="fs&#45;mgr.h" alt="" coords="959,315,1028,344"/><area shape="rect" id="node77" href="commit-mgr_8h.html" title="commit&#45;mgr.h" alt="" coords="512,469,613,499"/><area shape="rect" id="node84" href="branch-mgr_8h.html" title="branch&#45;mgr.h" alt="" coords="513,392,612,421"/><area shape="rect" id="node87" href="daemon_2repo-mgr_8h.html" title="repo&#45;mgr.h" alt="" coords="751,315,833,344"/><area shape="rect" id="node94" href="clone-mgr_8h.html" title="clone&#45;mgr.h" alt="" coords="148,469,239,499"/><area shape="rect" id="node99" href="transfer-mgr_8h.html" title="transfer&#45;mgr.h" alt="" coords="989,237,1091,267"/><area shape="rect" id="node115" href="sync-mgr_8h.html" title="sync&#45;mgr.h" alt="" coords="333,237,419,267"/><area shape="rect" id="node117" href="wt-monitor_8h.html" title="wt&#45;monitor.h" alt="" coords="1689,237,1783,267"/><area shape="rect" id="node125" href="mq-mgr_8h.html" title="mq&#45;mgr.h" alt="" coords="443,237,520,267"/><area shape="rect" id="node61" href="block_8h.html" title="block.h" alt="" coords="2332,469,2396,499"/><area shape="rect" id="node68" href="obj-store_8h.html" title="obj&#45;store.h" alt="" coords="843,547,925,576"/><area shape="rect" id="node71" href="cdc_8h.html" title="cdc/cdc.h" alt="" coords="1329,392,1407,421"/><area shape="rect" id="node75" href="seafile-crypt_8h.html" title="../common/seafile&#45;crypt.h" alt="" coords="921,392,1092,421"/><area shape="rect" id="node102" href="timer_8h.html" title="ccnet/timer.h" alt="" coords="1103,315,1201,344"/><area shape="rect" id="node104" href="include_2ccnet_2peer_8h.html" title="ccnet/peer.h" alt="" coords="1431,392,1524,421"/><area shape="rect" id="node109" href="object-list_8h.html" title="object&#45;list.h" alt="" coords="2281,547,2369,576"/><area shape="rect" id="node119" href="wt-monitor-structs_8h.html" title="wt&#45;monitor&#45;structs.h" alt="" coords="1167,392,1305,421"/><area shape="rect" id="node140" href="index_8h.html" title="index/index.h" alt="" coords="2684,237,2783,267"/></map>
</div>
</div>
<p><a href="http-tx-mgr_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__Connection.html">_Connection</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__ConnectionPool.html">_ConnectionPool</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__HttpTxPriv.html">_HttpTxPriv</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__HttpResponse.html">_HttpResponse</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__HttpRequest.html">_HttpRequest</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCheckProtocolData.html">CheckProtocolData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCheckHeadData.html">CheckHeadData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structGetFolderPermsData.html">GetFolderPermsData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCalcQuotaDeltaData.html">CalcQuotaDeltaData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCalcFsListData.html">CalcFsListData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct____attribute____.html">__attribute__</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCalcBlockListData.html">CalcBlockListData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSendBlockData.html">SendBlockData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structGetBlockData.html">GetBlockData</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile-4_81_82_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfba8a0ff30f6f8a39cdc72e0ed045762f7e">SEAFILE_DEBUG_TRANSFER</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a02e6d59009dee759528ec81fc9a8eeff">HTTP_OK</a>&#160;&#160;&#160;200</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a0c1fdbbb10800664989907cbd3a5a023">HTTP_BAD_REQUEST</a>&#160;&#160;&#160;400</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a92646f876056a1e5013e0050496dc04d">HTTP_FORBIDDEN</a>&#160;&#160;&#160;403</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#abd505b5244bd18ae61c581484b4bc5a0">HTTP_NOT_FOUND</a>&#160;&#160;&#160;404</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a71f74422b67ea7e609f97f035e8732ea">HTTP_NO_QUOTA</a>&#160;&#160;&#160;443</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#abf97213d568ebd9edd3597704d29f7f1">HTTP_REPO_DELETED</a>&#160;&#160;&#160;444</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a5d9777e02c26063c2985e39ef71091d2">HTTP_INTERNAL_SERVER_ERROR</a>&#160;&#160;&#160;500</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#ab37eef8c7539cecfc5de8723088a38d7">RESET_BYTES_INTERVAL_MSEC</a>&#160;&#160;&#160;1000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#acfc6c1ddecc516b7075c03f945c5cee9">HTTP_TIMEOUT_SEC</a>&#160;&#160;&#160;45</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a6dbd88fd52a1f923b6c34645cce35c32">ID_LIST_SEGMENT_N</a>&#160;&#160;&#160;1000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a67b56a4c47906fef2dce1f0eb13c6895">MAX_OBJECT_PACK_SIZE</a>&#160;&#160;&#160;(1 &lt;&lt; 20) /* 1MB */</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a7f001889686003b4656202668fe24f75">GET_FS_OBJECT_N</a>&#160;&#160;&#160;100</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__Connection.html">_Connection</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#af241e6d0ce6d580ee96096edbbda6b60">Connection</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__ConnectionPool.html">_ConnectionPool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#ab0dd327fd8279a69af9cee0403701095">ConnectionPool</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__HttpTxPriv.html">_HttpTxPriv</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a42765376cd3e90c86cec3c4a32431334">HttpTxPriv</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__HttpResponse.html">_HttpResponse</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a44d07c806661acc0907d528d7bdce04c">HttpResponse</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef size_t(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#aa553e8c85e0ea84d6de8365d1561756a">HttpRecvCallback</a> )(void *, size_t, size_t, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__HttpRequest.html">_HttpRequest</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#ae46215715e608f9a808dc8ce335acca5">HttpRequest</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef size_t(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a76020409d5fb99a0f728eed9102d6afb">HttpSendCallback</a> )(void *, size_t, size_t, void *)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a77c5dd6ef56236186f97a78e089235f4">http_tx_manager_new</a> (struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *<a class="el" href="server_2seafile-session_8h.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#af7268908c8fb9bdafab495f92ea07f86">http_tx_manager_start</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *mgr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a43e9d54b963e1bd9b8f43814a92563ea">http_tx_manager_check_protocol_version</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *host, <a class="el" href="http-tx-mgr_8h.html#a7966f73c8d9f6feb861d8aa85adcf2bc">HttpProtocolVersionCallback</a> callback, void *user_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a4f2b3d94b4366c519af0a69ebb6edc34">http_tx_manager_check_head_commit</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *repo_id, int repo_version, const char *host, const char *token, <a class="el" href="http-tx-mgr_8h.html#a7a1b96f515ee8993f2e9048942c917bf">HttpHeadCommitCallback</a> callback, void *user_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a66ce748eeb3d6bdd5213772d5d5e3898">http_folder_perm_req_free</a> (<a class="el" href="http-tx-mgr_8h.html#a3c623d7476d7489bd146f009223ad435">HttpFolderPermReq</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a24ed975a3f91c154ee960c03edeb05e1">http_folder_perm_res_free</a> (<a class="el" href="http-tx-mgr_8h.html#ada3e27a14e3258e50a70d90c3a790f16">HttpFolderPermRes</a> *res)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a24eb2fd0df4be5e88734649f6ff73fc3">http_tx_manager_get_folder_perms</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *host, GList *folder_perm_requests, <a class="el" href="http-tx-mgr_8h.html#a286ab36a4faf202f3a3969625e77be21">HttpGetFolderPermsCallback</a> callback, void *user_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a585b7bf53556be4ced268b966dd11fd2">http_tx_manager_add_upload</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *repo_id, int repo_version, const char *host, const char *token, int protocol_version, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a0bd2d454a6270528980a22372d300ddb">http_tx_manager_add_download</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *repo_id, int repo_version, const char *host, const char *token, const char *server_head_id, gboolean is_clone, const char *passwd, const char *worktree, int protocol_version, GError **error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a9405628380ded681f1831e92755869e3">get_block</a> (<a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *task, <a class="el" href="http-tx-mgr_8c.html#af241e6d0ce6d580ee96096edbbda6b60">Connection</a> *conn, const char *<a class="el" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a3cdcb1e4f4996dabc1adb7ae742ddfb4">http_tx_task_download_file_blocks</a> (<a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *task, const char *file_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a3cf653baf4245f9f361a2be605464035">http_tx_manager_get_upload_tasks</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">GList *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a4b8e6e4dd009a90d6fd8a42b6683995c">http_tx_manager_get_download_tasks</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a7ff95e76d064c44f4d9e3bdbf0b6b0b6">http_tx_manager_find_task</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *repo_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a1333f1b023ba910df52c75f6ec51c41d">http_tx_manager_cancel_task</a> (<a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *manager, const char *repo_id, int task_type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#ae22399dc7fe166fe634ba3738b657036">http_tx_task_get_rate</a> (<a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *task)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a67072054c5ac5f932ea490a3f2a87eb9">http_task_state_to_str</a> (int state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a96af3a00157e12d0ea5a88042a4f225c">http_task_rt_state_to_str</a> (int rt_state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http-tx-mgr_8c.html#a3b6822841a7614f31c8ef70ffa61d278">http_task_error_str</a> (int task_errno)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a05d1af42442c934b555896d3fe55c79e"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::DEBUG_FLAG" ref="a05d1af42442c934b555896d3fe55c79e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="user-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile-4_81_82_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfba8a0ff30f6f8a39cdc72e0ed045762f7e">SEAFILE_DEBUG_TRANSFER</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00019">19</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7f001889686003b4656202668fe24f75"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::GET_FS_OBJECT_N" ref="a7f001889686003b4656202668fe24f75" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a7f001889686003b4656202668fe24f75">GET_FS_OBJECT_N</a>&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l02629">2629</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0c1fdbbb10800664989907cbd3a5a023"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_BAD_REQUEST" ref="a0c1fdbbb10800664989907cbd3a5a023" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a0c1fdbbb10800664989907cbd3a5a023">HTTP_BAD_REQUEST</a>&#160;&#160;&#160;400</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00023">23</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a92646f876056a1e5013e0050496dc04d"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_FORBIDDEN" ref="a92646f876056a1e5013e0050496dc04d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a92646f876056a1e5013e0050496dc04d">HTTP_FORBIDDEN</a>&#160;&#160;&#160;403</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00024">24</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5d9777e02c26063c2985e39ef71091d2"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_INTERNAL_SERVER_ERROR" ref="a5d9777e02c26063c2985e39ef71091d2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a5d9777e02c26063c2985e39ef71091d2">HTTP_INTERNAL_SERVER_ERROR</a>&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00028">28</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71f74422b67ea7e609f97f035e8732ea"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_NO_QUOTA" ref="a71f74422b67ea7e609f97f035e8732ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a71f74422b67ea7e609f97f035e8732ea">HTTP_NO_QUOTA</a>&#160;&#160;&#160;443</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00026">26</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="abd505b5244bd18ae61c581484b4bc5a0"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_NOT_FOUND" ref="abd505b5244bd18ae61c581484b4bc5a0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#abd505b5244bd18ae61c581484b4bc5a0">HTTP_NOT_FOUND</a>&#160;&#160;&#160;404</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00025">25</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a02e6d59009dee759528ec81fc9a8eeff"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_OK" ref="a02e6d59009dee759528ec81fc9a8eeff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a02e6d59009dee759528ec81fc9a8eeff">HTTP_OK</a>&#160;&#160;&#160;200</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00022">22</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="abf97213d568ebd9edd3597704d29f7f1"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_REPO_DELETED" ref="abf97213d568ebd9edd3597704d29f7f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#abf97213d568ebd9edd3597704d29f7f1">HTTP_REPO_DELETED</a>&#160;&#160;&#160;444</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00027">27</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="acfc6c1ddecc516b7075c03f945c5cee9"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HTTP_TIMEOUT_SEC" ref="acfc6c1ddecc516b7075c03f945c5cee9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#acfc6c1ddecc516b7075c03f945c5cee9">HTTP_TIMEOUT_SEC</a>&#160;&#160;&#160;45</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00325">325</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6dbd88fd52a1f923b6c34645cce35c32"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::ID_LIST_SEGMENT_N" ref="a6dbd88fd52a1f923b6c34645cce35c32" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#a6dbd88fd52a1f923b6c34645cce35c32">ID_LIST_SEGMENT_N</a>&#160;&#160;&#160;1000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l01701">1701</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a67b56a4c47906fef2dce1f0eb13c6895"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::MAX_OBJECT_PACK_SIZE" ref="a67b56a4c47906fef2dce1f0eb13c6895" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-server_8c.html#a67b56a4c47906fef2dce1f0eb13c6895">MAX_OBJECT_PACK_SIZE</a>&#160;&#160;&#160;(1 &lt;&lt; 20) /* 1MB */</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l01799">1799</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab37eef8c7539cecfc5de8723088a38d7"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::RESET_BYTES_INTERVAL_MSEC" ref="ab37eef8c7539cecfc5de8723088a38d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="http-tx-mgr_8c.html#ab37eef8c7539cecfc5de8723088a38d7">RESET_BYTES_INTERVAL_MSEC</a>&#160;&#160;&#160;1000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00030">30</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="af241e6d0ce6d580ee96096edbbda6b60"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::Connection" ref="af241e6d0ce6d580ee96096edbbda6b60" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__Connection.html">_Connection</a> <a class="el" href="http-tx-mgr_8c.html#af241e6d0ce6d580ee96096edbbda6b60">Connection</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00036">36</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab0dd327fd8279a69af9cee0403701095"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::ConnectionPool" ref="ab0dd327fd8279a69af9cee0403701095" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__ConnectionPool.html">_ConnectionPool</a> <a class="el" href="http-tx-mgr_8c.html#ab0dd327fd8279a69af9cee0403701095">ConnectionPool</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00043">43</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa553e8c85e0ea84d6de8365d1561756a"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HttpRecvCallback" ref="aa553e8c85e0ea84d6de8365d1561756a" args=")(void *, size_t, size_t, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef size_t(* <a class="el" href="http-tx-mgr_8c.html#aa553e8c85e0ea84d6de8365d1561756a">HttpRecvCallback</a>)(void *, size_t, size_t, void *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00327">327</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae46215715e608f9a808dc8ce335acca5"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HttpRequest" ref="ae46215715e608f9a808dc8ce335acca5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__HttpRequest.html">_HttpRequest</a>  <a class="el" href="http-tx-mgr_8c.html#ae46215715e608f9a808dc8ce335acca5">HttpRequest</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a44d07c806661acc0907d528d7bdce04c"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HttpResponse" ref="a44d07c806661acc0907d528d7bdce04c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__HttpResponse.html">_HttpResponse</a>  <a class="el" href="http-tx-mgr_8c.html#a44d07c806661acc0907d528d7bdce04c">HttpResponse</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a76020409d5fb99a0f728eed9102d6afb"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HttpSendCallback" ref="a76020409d5fb99a0f728eed9102d6afb" args=")(void *, size_t, size_t, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef size_t(* <a class="el" href="http-tx-mgr_8c.html#a76020409d5fb99a0f728eed9102d6afb">HttpSendCallback</a>)(void *, size_t, size_t, void *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00425">425</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a42765376cd3e90c86cec3c4a32431334"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::HttpTxPriv" ref="a42765376cd3e90c86cec3c4a32431334" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__HttpTxPriv.html">_HttpTxPriv</a> <a class="el" href="http-tx-mgr_8c.html#a42765376cd3e90c86cec3c4a32431334">HttpTxPriv</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00054">54</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a9405628380ded681f1831e92755869e3"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::get_block" ref="a9405628380ded681f1831e92755869e3" args="(HttpTxTask *task, Connection *conn, const char *block_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8c.html#a9405628380ded681f1831e92755869e3">get_block</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8c.html#af241e6d0ce6d580ee96096edbbda6b60">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>block_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l02810">2810</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    CURL *curl;
    <span class="keywordtype">char</span> *url;
    <span class="keywordtype">int</span> <a class="code" href="block-tx-utils_8h.html#a2aaa5f99cdedb08950d78469e9e64edc">status</a>;
    <a class="code" href="struct__BHandle.html">BlockHandle</a> *block;
    <span class="keywordtype">int</span> ret = 0;

    block = <a class="code" href="block-mgr_8c.html#a056c34bef84deef28712969643b00dbc">seaf_block_manager_open_block</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>,
                                           task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>, task-&gt;<a class="code" href="struct__HttpTxTask.html#af0d9bc0f4289e7b270fd7398d2bf3b6d">repo_version</a>,
                                           <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>, <a class="code" href="block_8h.html#a99fb83031ce9923c84392b4e92f956b5a0a33c2a4005cb32ae50b7f3688cfbc76">BLOCK_WRITE</a>);
    <span class="keywordflow">if</span> (!block) {
        seaf_warning (<span class="stringliteral">&quot;Failed to open block %s in repo %.8s.\n&quot;</span>,
                      <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>, task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>);
        <span class="keywordflow">return</span> -1;
    }

    <a class="code" href="structGetBlockData.html">GetBlockData</a> data;
    memcpy (data.<a class="code" href="structGetBlockData.html#a1515b2bb9dd04955f67560b1519dd61c">block_id</a>, <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>, 40);
    data.<a class="code" href="structGetBlockData.html#a9314fa19bd161bbf4ebf6e9a0e8b6e3f">block</a> = block;
    data.<a class="code" href="structGetBlockData.html#acfae751c364f0708483f762bd6fb54c0">task</a> = task;

    curl = conn-&gt;<a class="code" href="struct__Connection.html#af8b983fae165a24c7f9cc24e47361d57">curl</a>;

    url = g_strdup_printf (<span class="stringliteral">&quot;%s/seafhttp/repo/%s/block/%s&quot;</span>,
                           task-&gt;<a class="code" href="struct__HttpTxTask.html#a846b22f672c2c90c4319732bbf3fc5a4">host</a>, task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>, <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>);

    <span class="keywordflow">if</span> (http_get (curl, url, task-&gt;<a class="code" href="struct__HttpTxTask.html#a7efdacb9425ad03ba280b6435b0e6ba6">token</a>, &amp;status, NULL, NULL,
                  get_block_callback, &amp;data) &lt; 0) {
        <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__HttpTxTask.html#ae22667654511c675acce777dcb74a890">state</a> == <a class="code" href="http-tx-mgr_8h.html#af4932c1ce85a6123a03c64cde0384dc5ace5e6d5d0a85c8b2f79aeb038c7ea9bc">HTTP_TASK_STATE_CANCELED</a>)
            <span class="keywordflow">goto</span> error;

        <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__HttpTxTask.html#a377ab043fcd84ccdf5d8c84d6e6fd18f">error</a> == <a class="code" href="http-tx-mgr_8h.html#a597f2c645b8d06d74fc53b1324fa7159a7d2b0dc48a6f7c202ac60e59eb473c9c">HTTP_TASK_OK</a>)
            task-&gt;<a class="code" href="struct__HttpTxTask.html#a377ab043fcd84ccdf5d8c84d6e6fd18f">error</a> = <a class="code" href="http-tx-mgr_8h.html#a597f2c645b8d06d74fc53b1324fa7159acf2d300b20f69c681bb82b34900a54f6">HTTP_TASK_ERR_NET</a>;
        ret = -1;
        <span class="keywordflow">goto</span> error;
    }

    <span class="keywordflow">if</span> (status != <a class="code" href="http-tx-mgr_8c.html#a02e6d59009dee759528ec81fc9a8eeff">HTTP_OK</a>) {
        seaf_warning (<span class="stringliteral">&quot;Bad response code for GET %s: %d.\n&quot;</span>, url, status);
        handle_http_errors (task, status);
        ret = -1;
        <span class="keywordflow">goto</span> error;
    }

    <a class="code" href="block-mgr_8c.html#aa78b63ce0fb941132f6db665de4966bc">seaf_block_manager_close_block</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>, block);

    <span class="keywordflow">if</span> (<a class="code" href="block-mgr_8c.html#a30d3350f36f7448fcf414ccc2cd59824">seaf_block_manager_commit_block</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>, block) &lt; 0) {
        seaf_warning (<span class="stringliteral">&quot;Failed to commit block %s in repo %.8s.\n&quot;</span>,
                      <a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>, task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>);
        task-&gt;<a class="code" href="struct__HttpTxTask.html#a377ab043fcd84ccdf5d8c84d6e6fd18f">error</a> = <a class="code" href="http-tx-mgr_8h.html#a597f2c645b8d06d74fc53b1324fa7159a3e94b4f3a5cae152befefab9cb2a2a6c">HTTP_TASK_ERR_WRITE_LOCAL_DATA</a>;
        ret = -1;
    }

    <a class="code" href="block-mgr_8c.html#a61d32d9d0d064dea33a1e2e7008215c1">seaf_block_manager_block_handle_free</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>, block);

    g_free (url);

    <span class="keywordflow">return</span> ret;

error:
    g_free (url);

    <a class="code" href="block-mgr_8c.html#aa78b63ce0fb941132f6db665de4966bc">seaf_block_manager_close_block</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>, block);
    <a class="code" href="block-mgr_8c.html#a61d32d9d0d064dea33a1e2e7008215c1">seaf_block_manager_block_handle_free</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>, block);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_cgraph" id="http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_cgraph">
<area shape="rect" id="node3" href="block-mgr_8c.html#a056c34bef84deef28712969643b00dbc" title="seaf_block_manager_open_block" alt="" coords="155,5,368,35"/><area shape="rect" id="node5" href="block-mgr_8c.html#aa78b63ce0fb941132f6db665de4966bc" title="seaf_block_manager_close_block" alt="" coords="152,59,371,88"/><area shape="rect" id="node7" href="block-mgr_8c.html#a30d3350f36f7448fcf414ccc2cd59824" title="seaf_block_manager_commit_block" alt="" coords="147,112,376,141"/><area shape="rect" id="node9" href="block-mgr_8c.html#a61d32d9d0d064dea33a1e2e7008215c1" title="seaf_block_manager_block_handle_free" alt="" coords="135,165,388,195"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_icgraph.png" border="0" usemap="#http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_icgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_icgraph" id="http-tx-mgr_8c_a9405628380ded681f1831e92755869e3_icgraph">
<area shape="rect" id="node3" href="http-tx-mgr_8h.html#a3cdcb1e4f4996dabc1adb7ae742ddfb4" title="http_tx_task_download_file_blocks" alt="" coords="135,5,359,35"/><area shape="rect" id="node5" href="daemon_2Backups_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="408,5,507,35"/><area shape="rect" id="node7" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="555,5,757,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a66ce748eeb3d6bdd5213772d5d5e3898"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_folder_perm_req_free" ref="a66ce748eeb3d6bdd5213772d5d5e3898" args="(HttpFolderPermReq *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="http-tx-mgr_8h.html#a66ce748eeb3d6bdd5213772d5d5e3898">http_folder_perm_req_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a3c623d7476d7489bd146f009223ad435">HttpFolderPermReq</a> *&#160;</td>
          <td class="paramname"><em>req</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00928">928</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!req)
        <span class="keywordflow">return</span>;
    g_free (req-&gt;<a class="code" href="struct__HttpFolderPermReq.html#aa33db724e9d1c9b0f37cbd297ed76063">token</a>);
    g_free (req);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a24ed975a3f91c154ee960c03edeb05e1"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_folder_perm_res_free" ref="a24ed975a3f91c154ee960c03edeb05e1" args="(HttpFolderPermRes *res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="http-tx-mgr_8h.html#a24ed975a3f91c154ee960c03edeb05e1">http_folder_perm_res_free</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#ada3e27a14e3258e50a70d90c3a790f16">HttpFolderPermRes</a> *&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00937">937</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    GList *ptr;

    <span class="keywordflow">if</span> (!res)
        <span class="keywordflow">return</span>;
    <span class="keywordflow">for</span> (ptr = res-&gt;<a class="code" href="struct__HttpFolderPermRes.html#a02929f1af633e277256696ffc7ec3220">user_perms</a>; ptr; ptr = ptr-&gt;next)
        <a class="code" href="daemon_2Backups_2repo-mgr_8c.html#a16e4a5db024bcc5baf2ef8a3f0623a41">folder_perm_free</a> ((<a class="code" href="struct__FolderPerm.html">FolderPerm</a> *)ptr-&gt;data);
    <span class="keywordflow">for</span> (ptr = res-&gt;<a class="code" href="struct__HttpFolderPermRes.html#a739b8d7b0272f8a9a59bced0f202b533">group_perms</a>; ptr; ptr = ptr-&gt;next)
        <a class="code" href="daemon_2Backups_2repo-mgr_8c.html#a16e4a5db024bcc5baf2ef8a3f0623a41">folder_perm_free</a> ((<a class="code" href="struct__FolderPerm.html">FolderPerm</a> *)ptr-&gt;data);
    g_free (res);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a24ed975a3f91c154ee960c03edeb05e1_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a24ed975a3f91c154ee960c03edeb05e1_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a24ed975a3f91c154ee960c03edeb05e1_cgraph" id="http-tx-mgr_8c_a24ed975a3f91c154ee960c03edeb05e1_cgraph">
<area shape="rect" id="node3" href="daemon_2Backups_2repo-mgr_8c.html#a16e4a5db024bcc5baf2ef8a3f0623a41" title="folder_perm_free" alt="" coords="228,5,345,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3b6822841a7614f31c8ef70ffa61d278"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_task_error_str" ref="a3b6822841a7614f31c8ef70ffa61d278" args="(int task_errno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="http-tx-mgr_8h.html#a3b6822841a7614f31c8ef70ffa61d278">http_task_error_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_errno</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03207">3207</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (task_errno &lt; 0 || task_errno &gt;= <a class="code" href="http-tx-mgr_8h.html#a597f2c645b8d06d74fc53b1324fa7159ad0fa9a44f6573e27948b91ef500a5c1b">N_HTTP_TASK_ERROR</a>)
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown error&quot;</span>;

    <span class="keywordflow">return</span> http_task_error_strs[task_errno];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a96af3a00157e12d0ea5a88042a4f225c"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_task_rt_state_to_str" ref="a96af3a00157e12d0ea5a88042a4f225c" args="(int rt_state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="http-tx-mgr_8h.html#a96af3a00157e12d0ea5a88042a4f225c">http_task_rt_state_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rt_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03198">3198</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (rt_state &lt; 0 || rt_state &gt;= <a class="code" href="http-tx-mgr_8h.html#ae97e5fbdbd28cab8bf8823ca4f66f617ae67f1dd2b61ce65971a1b3280d7977b5">N_HTTP_TASK_RT_STATE</a>)
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;

    <span class="keywordflow">return</span> http_task_rt_state_str[rt_state];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a67072054c5ac5f932ea490a3f2a87eb9"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_task_state_to_str" ref="a67072054c5ac5f932ea490a3f2a87eb9" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="http-tx-mgr_8h.html#a67072054c5ac5f932ea490a3f2a87eb9">http_task_state_to_str</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03189">3189</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (state &lt; 0 || state &gt;= <a class="code" href="http-tx-mgr_8h.html#af4932c1ce85a6123a03c64cde0384dc5ad8ba7b8530e5648c1220f8d2fe9c1ea9">N_HTTP_TASK_STATE</a>)
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;

    <span class="keywordflow">return</span> http_task_state_str[state];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0bd2d454a6270528980a22372d300ddb"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_add_download" ref="a0bd2d454a6270528980a22372d300ddb" args="(HttpTxManager *manager, const char *repo_id, int repo_version, const char *host, const char *token, const char *server_head_id, gboolean is_clone, const char *passwd, const char *worktree, int protocol_version, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#a0bd2d454a6270528980a22372d300ddb">http_tx_manager_add_download</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>server_head_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>is_clone</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>protocol_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l02414">2414</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__HttpTxTask.html">HttpTxTask</a> *task;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;

    <span class="keywordflow">if</span> (!repo_id || !token || !host || !server_head_id) {
        g_set_error (error, <a class="code" href="seafile-4_81_82_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Empty argument(s)&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (!is_clone) {
        repo = <a class="code" href="daemon_2Backups_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
        <span class="keywordflow">if</span> (!repo) {
            g_set_error (error, <a class="code" href="seafile-4_81_82_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Repo not found&quot;</span>);
            <span class="keywordflow">return</span> -1;
        }
    }

    clean_tasks_for_repo (manager, repo_id);

    task = http_tx_task_new (manager, repo_id, repo_version,
                             <a class="code" href="http-tx-mgr_8h.html#a16af7b253440dadd46a80a4b9fddba4da429731c6953f215203cf1b17fe92ebb1">HTTP_TASK_TYPE_DOWNLOAD</a>, is_clone,
                             host, token, passwd, worktree);

    memcpy (task-&gt;<a class="code" href="struct__HttpTxTask.html#adf8fd25193df2e73ec6e92f2eff9a5f1">head</a>, server_head_id, 40);
    task-&gt;<a class="code" href="struct__HttpTxTask.html#a6445d889b66d46f624a8ce480792f5f0">protocol_version</a> = protocol_version;

    task-&gt;<a class="code" href="struct__HttpTxTask.html#ae22667654511c675acce777dcb74a890">state</a> = <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>;

    g_hash_table_insert (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a054e2539c8af97620bcc0ab412398edf">download_tasks</a>,
                         g_strdup(repo_id),
                         task);

    <a class="code" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768">ccnet_job_manager_schedule_job</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#abcbb9886e315abb16c620ce49808a0b2">job_mgr</a>,
                                    http_download_thread,
                                    http_download_done,
                                    task);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a0bd2d454a6270528980a22372d300ddb_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a0bd2d454a6270528980a22372d300ddb_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a0bd2d454a6270528980a22372d300ddb_cgraph" id="http-tx-mgr_8c_a0bd2d454a6270528980a22372d300ddb_cgraph">
<area shape="rect" id="node3" href="daemon_2Backups_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6" title="seaf_repo_manager_get_repo" alt="" coords="277,5,469,35"/><area shape="rect" id="node5" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768" title="ccnet_job_manager_schedule_job" alt="" coords="264,59,483,88"/><area shape="rect" id="node7" href="job-mgr_8c.html#a6272c9579bee3c9bfb469e720e6a03e0" title="ccnet_job_new" alt="" coords="539,32,648,61"/><area shape="rect" id="node9" href="job-mgr_8c.html#a0df701b89788bcc8e5fd0035f30afe29" title="job_thread_create" alt="" coords="531,85,656,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a585b7bf53556be4ced268b966dd11fd2"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_add_upload" ref="a585b7bf53556be4ced268b966dd11fd2" args="(HttpTxManager *manager, const char *repo_id, int repo_version, const char *host, const char *token, int protocol_version, GError **error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#a585b7bf53556be4ced268b966dd11fd2">http_tx_manager_add_upload</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>protocol_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GError **&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l01332">1332</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__HttpTxTask.html">HttpTxTask</a> *task;
    <a class="code" href="struct__SeafRepo.html">SeafRepo</a> *repo;

    <span class="keywordflow">if</span> (!repo_id || !token || !host) {
        g_set_error (error, <a class="code" href="seafile-4_81_82_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Empty argument(s)&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    repo = <a class="code" href="daemon_2Backups_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6">seaf_repo_manager_get_repo</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a08681eb4d012b49f2552a91f4ba494f7">repo_mgr</a>, repo_id);
    <span class="keywordflow">if</span> (!repo) {
        g_set_error (error, <a class="code" href="seafile-4_81_82_2common_2log_8h.html#a8672557bc38a1d129649fe83577444ca">SEAFILE_DOMAIN</a>, <a class="code" href="seafile-error_8h.html#acf817c9ac99e8c572fa9ed3648a7db66">SEAF_ERR_BAD_ARGS</a>, <span class="stringliteral">&quot;Repo not found&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    clean_tasks_for_repo (manager, repo_id);

    task = http_tx_task_new (manager, repo_id, repo_version,
                             <a class="code" href="http-tx-mgr_8h.html#a16af7b253440dadd46a80a4b9fddba4da138a1036827f5836bd8e372ebe2aad95">HTTP_TASK_TYPE_UPLOAD</a>, FALSE,
                             host, token, NULL, NULL);

    task-&gt;<a class="code" href="struct__HttpTxTask.html#a6445d889b66d46f624a8ce480792f5f0">protocol_version</a> = protocol_version;

    task-&gt;<a class="code" href="struct__HttpTxTask.html#ae22667654511c675acce777dcb74a890">state</a> = <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceac3efc29c1793f3f902e002589c600b33">TASK_STATE_NORMAL</a>;

    g_hash_table_insert (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a791e15c45420b177bfc87284015ac9db">upload_tasks</a>,
                         g_strdup(repo_id),
                         task);

    <a class="code" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768">ccnet_job_manager_schedule_job</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#abcbb9886e315abb16c620ce49808a0b2">job_mgr</a>,
                                    http_upload_thread,
                                    http_upload_done,
                                    task);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a585b7bf53556be4ced268b966dd11fd2_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a585b7bf53556be4ced268b966dd11fd2_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a585b7bf53556be4ced268b966dd11fd2_cgraph" id="http-tx-mgr_8c_a585b7bf53556be4ced268b966dd11fd2_cgraph">
<area shape="rect" id="node3" href="daemon_2Backups_2repo-mgr_8c.html#af0276c036723560e3e8b9aa5529133d6" title="seaf_repo_manager_get_repo" alt="" coords="259,5,451,35"/><area shape="rect" id="node5" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768" title="ccnet_job_manager_schedule_job" alt="" coords="245,59,464,88"/><area shape="rect" id="node7" href="job-mgr_8c.html#a6272c9579bee3c9bfb469e720e6a03e0" title="ccnet_job_new" alt="" coords="520,32,629,61"/><area shape="rect" id="node9" href="job-mgr_8c.html#a0df701b89788bcc8e5fd0035f30afe29" title="job_thread_create" alt="" coords="512,85,637,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1333f1b023ba910df52c75f6ec51c41d"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_cancel_task" ref="a1333f1b023ba910df52c75f6ec51c41d" args="(HttpTxManager *manager, const char *repo_id, int task_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="http-tx-mgr_8h.html#a1333f1b023ba910df52c75f6ec51c41d">http_tx_manager_cancel_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03154">3154</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__HttpTxTask.html">HttpTxTask</a> *task = NULL;

    <span class="keywordflow">if</span> (task_type == <a class="code" href="http-tx-mgr_8h.html#a16af7b253440dadd46a80a4b9fddba4da429731c6953f215203cf1b17fe92ebb1">HTTP_TASK_TYPE_DOWNLOAD</a>)
        task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a054e2539c8af97620bcc0ab412398edf">download_tasks</a>, repo_id);
    <span class="keywordflow">else</span>
        task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a791e15c45420b177bfc87284015ac9db">upload_tasks</a>, repo_id);

    <span class="keywordflow">if</span> (!task)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__HttpTxTask.html#ae22667654511c675acce777dcb74a890">state</a> != <a class="code" href="http-tx-mgr_8h.html#af4932c1ce85a6123a03c64cde0384dc5ad33e055301cbadbb9544f199ee76c00e">HTTP_TASK_STATE_NORMAL</a>) {
        seaf_warning (<span class="stringliteral">&quot;Cannot cancel task not in NORMAL state.\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (task-&gt;<a class="code" href="struct__HttpTxTask.html#a42338e3407f898a2dc149f087cd0cea6">runtime_state</a> == <a class="code" href="http-tx-mgr_8h.html#ae97e5fbdbd28cab8bf8823ca4f66f617a529f48738b7509bb452c8f25915938cf">HTTP_TASK_RT_STATE_INIT</a>) {
        transition_state (task, <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceaae36dd6c8f3e2e25e7946660ec15cf7d">TASK_STATE_CANCELED</a>, <a class="code" href="transfer-mgr_8h.html#a67c6a75301d0b08cf078b0494e25a300acaea6e8f567a83d7ddff12cade4af1d5">TASK_RT_STATE_FINISHED</a>);
        <span class="keywordflow">return</span>;
    }

    <span class="comment">/* Only change state. runtime_state will be changed in worker thread. */</span>
    transition_state (task, <a class="code" href="transfer-mgr_8h.html#a724f9ce2351c125b3b7f6c7923822bceaae36dd6c8f3e2e25e7946660ec15cf7d">TASK_STATE_CANCELED</a>, task-&gt;<a class="code" href="struct__HttpTxTask.html#a42338e3407f898a2dc149f087cd0cea6">runtime_state</a>);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a1333f1b023ba910df52c75f6ec51c41d_icgraph.png" border="0" usemap="#http-tx-mgr_8c_a1333f1b023ba910df52c75f6ec51c41d_icgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a1333f1b023ba910df52c75f6ec51c41d_icgraph" id="http-tx-mgr_8c_a1333f1b023ba910df52c75f6ec51c41d_icgraph">
<area shape="rect" id="node3" href="clone-mgr_8h.html#a2849d011d1f918b3108c30495c98254b" title="seaf_clone_manager_cancel_task" alt="" coords="267,5,485,35"/><area shape="rect" id="node7" href="sync-mgr_8h.html#a0b90f2ae7c7e7a85ae97b7ade254572a" title="seaf_sync_manager_cancel_sync_task" alt="" coords="251,59,501,88"/><area shape="rect" id="node5" href="seafile-rpc_8h.html#a45a875dc129e03d7582cdd2645ecf548" title="seafile_cancel_clone_task" alt="" coords="587,5,760,35"/><area shape="rect" id="node9" href="daemon_2repo-mgr_8h.html#a9d2f586c85f26b2de677fd03606103aa" title="seaf_repo_manager_set_repo_property" alt="" coords="551,59,796,88"/><area shape="rect" id="node11" href="seafile-rpc_8h.html#a3880f357c6b6e7e350ce5a781e9668c1" title="seafile_set_repo_property" alt="" coords="908,5,1079,35"/><area shape="rect" id="node13" href="daemon_2repo-mgr_8h.html#a6ed05df6501a326fc58a0fefb91aef3d" title="seaf_repo_manager_set_repo_worktree" alt="" coords="868,59,1119,88"/><area shape="rect" id="node15" href="daemon_2repo-mgr_8h.html#ae3753999b4845dfe68bd6f098313280c" title="seaf_repo_manager_update_repos_server_host" alt="" coords="845,112,1141,141"/><area shape="rect" id="node17" href="seafile-rpc_8h.html#a2d3ae7fdb45f784fe4eb4abc2f4055c2" title="seafile_update_repos_server_host" alt="" coords="1191,112,1409,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4f2b3d94b4366c519af0a69ebb6edc34"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_check_head_commit" ref="a4f2b3d94b4366c519af0a69ebb6edc34" args="(HttpTxManager *manager, const char *repo_id, int repo_version, const char *host, const char *token, HttpHeadCommitCallback callback, void *user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#a4f2b3d94b4366c519af0a69ebb6edc34">http_tx_manager_check_head_commit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7a1b96f515ee8993f2e9048942c917bf">HttpHeadCommitCallback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00900">900</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structCheckHeadData.html">CheckHeadData</a> *data = g_new0 (<a class="code" href="structCheckHeadData.html">CheckHeadData</a>, 1);

    memcpy (data-&gt;<a class="code" href="structCheckHeadData.html#a7cca3e9041e496e0e7ea842dc5f6a92a">repo_id</a>, repo_id, 36);
    data-&gt;<a class="code" href="structCheckHeadData.html#aed6948b54cd29996fcb20d0e168df45b">repo_version</a> = repo_version;
    data-&gt;<a class="code" href="structCheckHeadData.html#a1c1fc026d492c1c81198cfe78b4df7d7">host</a> = g_strdup(host);
    data-&gt;<a class="code" href="structCheckHeadData.html#ad78a3cba7eec0e29aa1c2b622d2483e8">token</a> = g_strdup(token);
    data-&gt;<a class="code" href="structCheckHeadData.html#a43b5310afa49039a08b00112712247e8">callback</a> = callback;
    data-&gt;<a class="code" href="structCheckHeadData.html#adfbb3fdc584c3771393f722f9e96d9ec">user_data</a> = user_data;

    <a class="code" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768">ccnet_job_manager_schedule_job</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#abcbb9886e315abb16c620ce49808a0b2">job_mgr</a>,
                                    check_head_commit_thread,
                                    check_head_commit_done,
                                    data);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a4f2b3d94b4366c519af0a69ebb6edc34_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a4f2b3d94b4366c519af0a69ebb6edc34_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a4f2b3d94b4366c519af0a69ebb6edc34_cgraph" id="http-tx-mgr_8c_a4f2b3d94b4366c519af0a69ebb6edc34_cgraph">
<area shape="rect" id="node3" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768" title="ccnet_job_manager_schedule_job" alt="" coords="301,32,520,61"/><area shape="rect" id="node5" href="job-mgr_8c.html#a6272c9579bee3c9bfb469e720e6a03e0" title="ccnet_job_new" alt="" coords="576,5,685,35"/><area shape="rect" id="node7" href="job-mgr_8c.html#a0df701b89788bcc8e5fd0035f30afe29" title="job_thread_create" alt="" coords="568,59,693,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a43e9d54b963e1bd9b8f43814a92563ea"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_check_protocol_version" ref="a43e9d54b963e1bd9b8f43814a92563ea" args="(HttpTxManager *manager, const char *host, HttpProtocolVersionCallback callback, void *user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#a43e9d54b963e1bd9b8f43814a92563ea">http_tx_manager_check_protocol_version</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7966f73c8d9f6feb861d8aa85adcf2bc">HttpProtocolVersionCallback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00760">760</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structCheckProtocolData.html">CheckProtocolData</a> *data = g_new0 (<a class="code" href="structCheckProtocolData.html">CheckProtocolData</a>, 1);

    data-&gt;<a class="code" href="structCheckProtocolData.html#adb5bb5412e1bd26d4ac2ce541890a053">host</a> = g_strdup(host);
    data-&gt;<a class="code" href="structCheckProtocolData.html#a0e064a41b438275a9441c685377398bc">callback</a> = callback;
    data-&gt;<a class="code" href="structCheckProtocolData.html#a748633c8bd9a0296196c5f2d31dca622">user_data</a> = user_data;

    <a class="code" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768">ccnet_job_manager_schedule_job</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#abcbb9886e315abb16c620ce49808a0b2">job_mgr</a>,
                                    check_protocol_version_thread,
                                    check_protocol_version_done,
                                    data);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a43e9d54b963e1bd9b8f43814a92563ea_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a43e9d54b963e1bd9b8f43814a92563ea_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a43e9d54b963e1bd9b8f43814a92563ea_cgraph" id="http-tx-mgr_8c_a43e9d54b963e1bd9b8f43814a92563ea_cgraph">
<area shape="rect" id="node3" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768" title="ccnet_job_manager_schedule_job" alt="" coords="317,32,536,61"/><area shape="rect" id="node5" href="job-mgr_8c.html#a6272c9579bee3c9bfb469e720e6a03e0" title="ccnet_job_new" alt="" coords="592,5,701,35"/><area shape="rect" id="node7" href="job-mgr_8c.html#a0df701b89788bcc8e5fd0035f30afe29" title="job_thread_create" alt="" coords="584,59,709,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7ff95e76d064c44f4d9e3bdbf0b6b0b6"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_find_task" ref="a7ff95e76d064c44f4d9e3bdbf0b6b0b6" args="(HttpTxManager *manager, const char *repo_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a>* <a class="el" href="http-tx-mgr_8h.html#a7ff95e76d064c44f4d9e3bdbf0b6b0b6">http_tx_manager_find_task</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03141">3141</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__HttpTxTask.html">HttpTxTask</a> *task = NULL;

    task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a791e15c45420b177bfc87284015ac9db">upload_tasks</a>, repo_id);
    <span class="keywordflow">if</span> (task)
        <span class="keywordflow">return</span> task;

    task = g_hash_table_lookup (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a054e2539c8af97620bcc0ab412398edf">download_tasks</a>, repo_id);
    <span class="keywordflow">return</span> task;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a7ff95e76d064c44f4d9e3bdbf0b6b0b6_icgraph.png" border="0" usemap="#http-tx-mgr_8c_a7ff95e76d064c44f4d9e3bdbf0b6b0b6_icgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a7ff95e76d064c44f4d9e3bdbf0b6b0b6_icgraph" id="http-tx-mgr_8c_a7ff95e76d064c44f4d9e3bdbf0b6b0b6_icgraph">
<area shape="rect" id="node3" href="seafile-rpc_8h.html#a595bb81eb0939c6c6c9cc6acccc9e089" title="seafile_find_transfer_task" alt="" coords="232,5,403,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4b8e6e4dd009a90d6fd8a42b6683995c"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_get_download_tasks" ref="a4b8e6e4dd009a90d6fd8a42b6683995c" args="(HttpTxManager *manager)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="http-tx-mgr_8h.html#a4b8e6e4dd009a90d6fd8a42b6683995c">http_tx_manager_get_download_tasks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03135">3135</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> g_hash_table_get_values (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a054e2539c8af97620bcc0ab412398edf">download_tasks</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a24eb2fd0df4be5e88734649f6ff73fc3"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_get_folder_perms" ref="a24eb2fd0df4be5e88734649f6ff73fc3" args="(HttpTxManager *manager, const char *host, GList *folder_perm_requests, HttpGetFolderPermsCallback callback, void *user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#a24eb2fd0df4be5e88734649f6ff73fc3">http_tx_manager_get_folder_perms</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GList *&#160;</td>
          <td class="paramname"><em>folder_perm_requests</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a286ab36a4faf202f3a3969625e77be21">HttpGetFolderPermsCallback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l01244">1244</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structGetFolderPermsData.html">GetFolderPermsData</a> *data = g_new0 (<a class="code" href="structGetFolderPermsData.html">GetFolderPermsData</a>, 1);

    data-&gt;<a class="code" href="structGetFolderPermsData.html#a72d431889ce1b64a3c3d90d92f8ae2ff">host</a> = g_strdup(host);
    data-&gt;<a class="code" href="structGetFolderPermsData.html#a2d5b8cf445f884d3da214f8382b20eae">requests</a> = folder_perm_requests;
    data-&gt;<a class="code" href="structGetFolderPermsData.html#a31d36185f257a4f8acec1b29212d6f11">callback</a> = callback;
    data-&gt;<a class="code" href="structGetFolderPermsData.html#a6686f4e3da2c44730bc7fa160efdcc40">user_data</a> = user_data;

    <a class="code" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768">ccnet_job_manager_schedule_job</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#abcbb9886e315abb16c620ce49808a0b2">job_mgr</a>,
                                    get_folder_perms_thread,
                                    get_folder_perms_done,
                                    data);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a24eb2fd0df4be5e88734649f6ff73fc3_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a24eb2fd0df4be5e88734649f6ff73fc3_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a24eb2fd0df4be5e88734649f6ff73fc3_cgraph" id="http-tx-mgr_8c_a24eb2fd0df4be5e88734649f6ff73fc3_cgraph">
<area shape="rect" id="node3" href="job-mgr_8h.html#ac2bb163f21ddd6494f8d0101cc989768" title="ccnet_job_manager_schedule_job" alt="" coords="280,32,499,61"/><area shape="rect" id="node5" href="job-mgr_8c.html#a6272c9579bee3c9bfb469e720e6a03e0" title="ccnet_job_new" alt="" coords="555,5,664,35"/><area shape="rect" id="node7" href="job-mgr_8c.html#a0df701b89788bcc8e5fd0035f30afe29" title="job_thread_create" alt="" coords="547,59,672,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3cf653baf4245f9f361a2be605464035"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_get_upload_tasks" ref="a3cf653baf4245f9f361a2be605464035" args="(HttpTxManager *manager)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GList* <a class="el" href="http-tx-mgr_8h.html#a3cf653baf4245f9f361a2be605464035">http_tx_manager_get_upload_tasks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03129">3129</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> g_hash_table_get_values (manager-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#a791e15c45420b177bfc87284015ac9db">upload_tasks</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a77c5dd6ef56236186f97a78e089235f4"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_new" ref="a77c5dd6ef56236186f97a78e089235f4" args="(struct _SeafileSession *seaf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a>* <a class="el" href="http-tx-mgr_8h.html#a77c5dd6ef56236186f97a78e089235f4">http_tx_manager_new</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct__SeafileSession.html">_SeafileSession</a> *&#160;</td>
          <td class="paramname"><em>seaf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00204">204</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__HttpTxManager.html">HttpTxManager</a> *mgr = g_new0 (<a class="code" href="struct__HttpTxManager.html">HttpTxManager</a>, 1);
    <a class="code" href="struct__HttpTxPriv.html">HttpTxPriv</a> *<a class="code" href="monitor-tool_8c.html#a694b59386a408403dbb70994ed5beaa1">priv</a> = g_new0 (<a class="code" href="struct__HttpTxPriv.html">HttpTxPriv</a>, 1);

    mgr-&gt;<a class="code" href="struct__HttpTxManager.html#ad5c870a6f4bb5650395080acc7bbf6fe">seaf</a> = <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>;

    priv-&gt;<a class="code" href="struct__HttpTxPriv.html#a054e2539c8af97620bcc0ab412398edf">download_tasks</a> = g_hash_table_new_full (g_str_hash, g_str_equal,
                                                  g_free,
                                                  (GDestroyNotify)http_tx_task_free);
    priv-&gt;<a class="code" href="struct__HttpTxPriv.html#a791e15c45420b177bfc87284015ac9db">upload_tasks</a> = g_hash_table_new_full (g_str_hash, g_str_equal,
                                                g_free,
                                                (GDestroyNotify)http_tx_task_free);

    priv-&gt;<a class="code" href="struct__HttpTxPriv.html#a55f095d958fe9573451cca5af1e80b36">connection_pools</a> = g_hash_table_new (g_str_hash, g_str_equal);
    pthread_mutex_init (&amp;priv-&gt;<a class="code" href="struct__HttpTxPriv.html#a2ebdb95274bdc8f807bbf479a6e382c3">pools_lock</a>, NULL);

    mgr-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a> = <a class="code" href="monitor-tool_8c.html#a694b59386a408403dbb70994ed5beaa1">priv</a>;

    <span class="keywordflow">return</span> mgr;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a77c5dd6ef56236186f97a78e089235f4_icgraph.png" border="0" usemap="#http-tx-mgr_8c_a77c5dd6ef56236186f97a78e089235f4_icgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a77c5dd6ef56236186f97a78e089235f4_icgraph" id="http-tx-mgr_8c_a77c5dd6ef56236186f97a78e089235f4_icgraph">
<area shape="rect" id="node3" href="daemon_2seafile-session_8h.html#a3eea8fbb412edb5ff72027285edb7c72" title="seafile_session_new" alt="" coords="207,5,348,35"/><area shape="rect" id="node5" href="seaf-daemon_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="397,5,448,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af7268908c8fb9bdafab495f92ea07f86"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_manager_start" ref="af7268908c8fb9bdafab495f92ea07f86" args="(HttpTxManager *mgr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#af7268908c8fb9bdafab495f92ea07f86">http_tx_manager_start</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a7c69d87e68c1a35fe66267a237990b1b">HttpTxManager</a> *&#160;</td>
          <td class="paramname"><em>mgr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l00253">253</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    curl_global_init (CURL_GLOBAL_ALL);

    <span class="comment">/* TODO: add a timer to clean up unused Http connections. */</span>

    mgr-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>-&gt;<a class="code" href="struct__HttpTxPriv.html#af018ae2712ad3a0ea19d3d22b7ea28c6">reset_bytes_timer</a> = <a class="code" href="timer_8h.html#a68b6afb704a7f56b625ed78146691b7c">ccnet_timer_new</a> (reset_bytes,
                                                    mgr,
                                                    <a class="code" href="http-tx-mgr_8c.html#ab37eef8c7539cecfc5de8723088a38d7">RESET_BYTES_INTERVAL_MSEC</a>);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_af7268908c8fb9bdafab495f92ea07f86_cgraph.png" border="0" usemap="#http-tx-mgr_8c_af7268908c8fb9bdafab495f92ea07f86_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_af7268908c8fb9bdafab495f92ea07f86_cgraph" id="http-tx-mgr_8c_af7268908c8fb9bdafab495f92ea07f86_cgraph">
<area shape="rect" id="node3" href="timer_8h.html#a68b6afb704a7f56b625ed78146691b7c" title="ccnet_timer_new" alt="" coords="207,5,327,35"/><area shape="rect" id="node5" href="seafile-4_81_82_2lib_2utils_8c.html#ac0aa6c70f613ad3344b5f1f917b6b68a" title="timeval_from_msec" alt="" coords="376,5,512,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3cdcb1e4f4996dabc1adb7ae742ddfb4"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_task_download_file_blocks" ref="a3cdcb1e4f4996dabc1adb7ae742ddfb4" args="(HttpTxTask *task, const char *file_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#a3cdcb1e4f4996dabc1adb7ae742ddfb4">http_tx_task_download_file_blocks</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l02880">2880</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__Seafile.html">Seafile</a> *file;
    <a class="code" href="struct__HttpTxPriv.html">HttpTxPriv</a> *<a class="code" href="monitor-tool_8c.html#a694b59386a408403dbb70994ed5beaa1">priv</a> = <a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a3be7b98d0f1cc49d0fad03c68e63da74">http_tx_mgr</a>-&gt;<a class="code" href="struct__HttpTxManager.html#a3e124361f6d9812dd9e4fb15e7ea41e7">priv</a>;
    <a class="code" href="struct__ConnectionPool.html">ConnectionPool</a> *pool;
    <a class="code" href="struct__Connection.html">Connection</a> *conn;
    <span class="keywordtype">int</span> ret = 0;

    file = <a class="code" href="fs-mgr_8c.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>,
                                        task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>,
                                        task-&gt;<a class="code" href="struct__HttpTxTask.html#af0d9bc0f4289e7b270fd7398d2bf3b6d">repo_version</a>,
                                        file_id);
    <span class="keywordflow">if</span> (!file) {
        seaf_warning (<span class="stringliteral">&quot;Failed to find seafile object %s in repo %.8s.\n&quot;</span>,
                      file_id, task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>);
        <span class="keywordflow">return</span> -1;
    }

    pool = find_connection_pool (priv, task-&gt;<a class="code" href="struct__HttpTxTask.html#a846b22f672c2c90c4319732bbf3fc5a4">host</a>);
    <span class="keywordflow">if</span> (!pool) {
        seaf_warning (<span class="stringliteral">&quot;Failed to create connection pool for host %s.\n&quot;</span>, task-&gt;<a class="code" href="struct__HttpTxTask.html#a846b22f672c2c90c4319732bbf3fc5a4">host</a>);
        task-&gt;<a class="code" href="struct__HttpTxTask.html#a377ab043fcd84ccdf5d8c84d6e6fd18f">error</a> = <a class="code" href="http-tx-mgr_8h.html#a597f2c645b8d06d74fc53b1324fa7159a1b9f5fdd07452b49a753f1064b000db4">HTTP_TASK_ERR_NOT_ENOUGH_MEMORY</a>;
        <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (file);
        <span class="keywordflow">return</span> -1;
    }

    conn = connection_pool_get_connection (pool);
    <span class="keywordflow">if</span> (!conn) {
        seaf_warning (<span class="stringliteral">&quot;Failed to get connection to host %s.\n&quot;</span>, task-&gt;<a class="code" href="struct__HttpTxTask.html#a846b22f672c2c90c4319732bbf3fc5a4">host</a>);
        task-&gt;<a class="code" href="struct__HttpTxTask.html#a377ab043fcd84ccdf5d8c84d6e6fd18f">error</a> = <a class="code" href="http-tx-mgr_8h.html#a597f2c645b8d06d74fc53b1324fa7159a1b9f5fdd07452b49a753f1064b000db4">HTTP_TASK_ERR_NOT_ENOUGH_MEMORY</a>;
        <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (file);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> i;
    <span class="keywordtype">char</span> *<a class="code" href="block-tx-utils_8h.html#a2d616e1f81d11995c8b388444be651ef">block_id</a>;
    <span class="keywordflow">for</span> (i = 0; i &lt; file-&gt;<a class="code" href="struct__Seafile.html#af2d5c5e5bb56d38122dead42128b9c20">n_blocks</a>; ++i) {
        block_id = file-&gt;<a class="code" href="struct__Seafile.html#aacaedff2674132faf3d522ba8df6e268">blk_sha1s</a>[i];
        <span class="keywordflow">if</span> (!<a class="code" href="block-mgr_8c.html#acc8d899bbbf17d0db6d07c9eda67fd0c">seaf_block_manager_block_exists</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a4b29afaa0ca920084596a236c8460df2">block_mgr</a>,
                                              task-&gt;<a class="code" href="struct__HttpTxTask.html#aa59aeedc8cf62fbeecf3c04bf6127811">repo_id</a>,
                                              task-&gt;<a class="code" href="struct__HttpTxTask.html#af0d9bc0f4289e7b270fd7398d2bf3b6d">repo_version</a>,
                                              block_id)) {
            ret = <a class="code" href="http-tx-mgr_8c.html#a9405628380ded681f1831e92755869e3">get_block</a> (task, conn, block_id);
            <span class="keywordflow">if</span> (ret &lt; 0 || task-&gt;state == <a class="code" href="http-tx-mgr_8h.html#af4932c1ce85a6123a03c64cde0384dc5ace5e6d5d0a85c8b2f79aeb038c7ea9bc">HTTP_TASK_STATE_CANCELED</a>)
                <span class="keywordflow">break</span>;
        }
    }

    connection_pool_return_connection (pool, conn);

    <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (file);

    <span class="keywordflow">return</span> ret;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_cgraph.png" border="0" usemap="#http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_cgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_cgraph" id="http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_cgraph">
<area shape="rect" id="node3" href="fs-mgr_8c.html#a029c16e2ecdf6eafd96edb2ee4e6beac" title="seaf_fs_manager_get_seafile" alt="" coords="296,45,488,75"/><area shape="rect" id="node9" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a" title="seafile_unref" alt="" coords="344,99,440,128"/><area shape="rect" id="node11" href="block-mgr_8c.html#acc8d899bbbf17d0db6d07c9eda67fd0c" title="seaf_block_manager_block_exists" alt="" coords="281,152,503,181"/><area shape="rect" id="node13" href="http-tx-mgr_8c.html#a9405628380ded681f1831e92755869e3" title="get_block" alt="" coords="353,205,431,235"/><area shape="rect" id="node5" href="fs-mgr_8c.html#aaf788c4f305d5509b791f64615fa9112" title="seafile_ref" alt="" coords="639,5,721,35"/><area shape="rect" id="node7" href="obj-store_8c.html#a6e93a0214f9cb8a7fc837a2bc3a3c529" title="seaf_obj_store_read_obj" alt="" coords="599,59,761,88"/><area shape="rect" id="node15" href="block-mgr_8c.html#a056c34bef84deef28712969643b00dbc" title="seaf_block_manager_open_block" alt="" coords="573,125,787,155"/><area shape="rect" id="node17" href="block-mgr_8c.html#aa78b63ce0fb941132f6db665de4966bc" title="seaf_block_manager_close_block" alt="" coords="571,179,789,208"/><area shape="rect" id="node19" href="block-mgr_8c.html#a30d3350f36f7448fcf414ccc2cd59824" title="seaf_block_manager_commit_block" alt="" coords="565,232,795,261"/><area shape="rect" id="node21" href="block-mgr_8c.html#a61d32d9d0d064dea33a1e2e7008215c1" title="seaf_block_manager_block_handle_free" alt="" coords="553,285,807,315"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_icgraph.png" border="0" usemap="#http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_icgraph" alt=""/></div>
<map name="http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_icgraph" id="http-tx-mgr_8c_a3cdcb1e4f4996dabc1adb7ae742ddfb4_icgraph">
<area shape="rect" id="node3" href="daemon_2Backups_2repo-mgr_8c.html#a450e5bcc50da4c40b7ba2bde33a22a84" title="checkout_file" alt="" coords="280,5,379,35"/><area shape="rect" id="node5" href="daemon_2repo-mgr_8h.html#a836678a67f23541ed108f922f0848e52" title="seaf_repo_fetch_and_checkout" alt="" coords="427,5,629,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae22399dc7fe166fe634ba3738b657036"></a><!-- doxytag: member="http&#45;tx&#45;mgr.c::http_tx_task_get_rate" ref="ae22399dc7fe166fe634ba3738b657036" args="(HttpTxTask *task)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="http-tx-mgr_8h.html#ae22399dc7fe166fe634ba3738b657036">http_tx_task_get_rate</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http-tx-mgr_8h.html#a3ef685a6dcf2af7909e698d37b21d5e2">HttpTxTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http-tx-mgr_8c_source.html#l03183">3183</a> of file <a class="el" href="http-tx-mgr_8c_source.html">http-tx-mgr.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> task-&gt;<a class="code" href="struct__HttpTxTask.html#a651e7b5f81850c38468bbb102a18d878">last_tx_bytes</a>;
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:59:46 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
