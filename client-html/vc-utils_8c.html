<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile-4.1.2/daemon/vc-utils.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">seafile-4.1.2/daemon/vc-utils.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;common.h&quot;</code><br/>
<code>#include &quot;log.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="seafile-error_8h_source.html">seafile-error.h</a>&quot;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;glib/gstdio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="daemon_2seafile-session_8h_source.html">seafile-session.h</a>&quot;</code><br/>
<code>#include &quot;utils.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="fs-mgr_8h_source.html">fs-mgr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="merge_8h_source.html">merge.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vc-utils_8h_source.html">vc-utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vc-common_8h_source.html">vc-common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="index_8h_source.html">index/index.h</a>&quot;</code><br/>
</div>
<p><a href="vc-utils_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile-4_81_82_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfbaf5a571e26ec63be52c6f28f2c6b71a7d">SEAFILE_DEBUG_MERGE</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#a4b086cedacd72882aa71266710f3d869">commit_trees_cb</a> (const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const char *worktree, struct <a class="el" href="structcache__tree.html">cache_tree</a> *it, struct <a class="el" href="structcache__entry.html">cache_entry</a> **cache, int entries, const char *base, int baselen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#ab93fff6b962d6fd7482c95d17c8bf6eb">update_index</a> (struct <a class="el" href="structindex__state.html">index_state</a> *istate, const char *<a class="el" href="index_8h.html#a35caece3e3575d32521f820a8f0a24a7">index_path</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#a4642df9b122253404e9618cedd3d7e18">seaf_remove_empty_dir</a> (const char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#afa0ef6de91f37ec2adcfbfa16a70e0d0">compare_file_content</a> (const char *path, <a class="el" href="seafile-4_81_82_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> *st, const unsigned char *ce_sha1, <a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *crypt, int repo_version)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#a4b8dc271b94740a5cb1e32827ee88d29">update_worktree</a> (struct <a class="el" href="structunpack__trees__options.html">unpack_trees_options</a> *o, gboolean recover_merge, const char *conflict_head_id, const char *default_conflict_suffix, int *finished_entries)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#afe4721091f815b2382d2cc8b30e97cf0">delete_path</a> (const char *worktree, const char *<a class="el" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, unsigned int <a class="el" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>, gint64 old_mtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#a7564d102761a05b137c2b06fa5e1f004">fill_seafile_blocks</a> (const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, const unsigned char *<a class="el" href="test-seafile-fmt_8c.html#a0f4af80189728258cd27679dee8ab2dc">sha1</a>, <a class="el" href="structBlockList.html">BlockList</a> *bl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vc-utils_8c.html#a679a356f1eff6a4f953fe26f3f841f93">collect_new_blocks_from_index</a> (const char *repo_id, int <a class="el" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, struct <a class="el" href="structindex__state.html">index_state</a> *index, <a class="el" href="structBlockList.html">BlockList</a> *bl)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a05d1af42442c934b555896d3fe55c79e"></a><!-- doxytag: member="vc&#45;utils.c::DEBUG_FLAG" ref="a05d1af42442c934b555896d3fe55c79e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="user-mgr_8c.html#a05d1af42442c934b555896d3fe55c79e">DEBUG_FLAG</a>&#160;&#160;&#160;<a class="el" href="seafile-4_81_82_2common_2log_8h.html#ab0ef81bf7d4daa70c41b9e89e6543bfbaf5a571e26ec63be52c6f28f2c6b71a7d">SEAFILE_DEBUG_MERGE</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00004">4</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a679a356f1eff6a4f953fe26f3f841f93"></a><!-- doxytag: member="vc&#45;utils.c::collect_new_blocks_from_index" ref="a679a356f1eff6a4f953fe26f3f841f93" args="(const char *repo_id, int version, struct index_state *index, BlockList *bl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="vc-utils_8h.html#a679a356f1eff6a4f953fe26f3f841f93">collect_new_blocks_from_index</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structindex__state.html">index_state</a> *&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l01117">1117</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> i;
    <span class="keyword">struct </span><a class="code" href="structcache__entry.html">cache_entry</a> *ce;

    <span class="keywordflow">for</span> (i = 0; i &lt; index-&gt;<a class="code" href="structindex__state.html#a15b38cdd30ad2374bc12da429f39312f">cache_nr</a>; ++i) {
        ce = index-&gt;<a class="code" href="structindex__state.html#a8aa7a8aa984ec5a39ff2eee96412db07">cache</a>[i];
        <span class="keywordflow">if</span> (ce-&gt;<a class="code" href="structcache__entry.html#a4dab14fd813a1bb6b67352674ff4afb2">ce_flags</a> &amp; <a class="code" href="index_8h.html#a1d46becf22e28d6f8bffa8ee949acb45">CE_UPDATE</a>)
            <a class="code" href="vc-utils_8c.html#a7564d102761a05b137c2b06fa5e1f004">fill_seafile_blocks</a> (repo_id, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, ce-&gt;<a class="code" href="structcache__entry.html#a119ab5c5e9db495e6e5f8d301f01421c">sha1</a>, bl);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b086cedacd72882aa71266710f3d869"></a><!-- doxytag: member="vc&#45;utils.c::commit_trees_cb" ref="a4b086cedacd72882aa71266710f3d869" args="(const char *repo_id, int version, const char *worktree, struct cache_tree *it, struct cache_entry **cache, int entries, const char *base, int baselen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="vc-utils_8h.html#a40a8e3a1dc14697c58656246b3fa9ca0">commit_trees_cb</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcache__tree.html">cache_tree</a> *&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcache__entry.html">cache_entry</a> **&#160;</td>
          <td class="paramname"><em>cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>entries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>baselen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00030">30</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__SeafDir.html">SeafDir</a> *seaf_dir;
    GList *dirents = NULL, *ptr;
    <span class="keywordtype">int</span> i;

    <span class="keywordflow">for</span> (i = 0; i &lt; entries; i++) {
        <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *seaf_dent;
        <span class="keywordtype">char</span> *<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>;
        <span class="keyword">struct </span><a class="code" href="structcache__entry.html">cache_entry</a> *ce = cache[i];
        <span class="keyword">struct </span><a class="code" href="structcache__tree__sub.html">cache_tree_sub</a> *sub;
        <span class="keyword">const</span> <span class="keywordtype">char</span> *path, *slash;
        <span class="keywordtype">int</span> pathlen, entlen;
        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>;
        <span class="keywordtype">char</span> hex[41];
        <span class="keywordtype">unsigned</span> <a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>;
        guint64 <a class="code" href="index_8h.html#adb9fb1ca66f1a67516c2ee1492e6ab2b">mtime</a>;
        gint64 <a class="code" href="index_8h.html#af931a8871310b4dad23f0f0b0f623560">size</a>;
        <span class="keywordtype">char</span> *modifier;

        <span class="keywordflow">if</span> (ce-&gt;<a class="code" href="structcache__entry.html#a4dab14fd813a1bb6b67352674ff4afb2">ce_flags</a> &amp; <a class="code" href="index_8h.html#aa5ee599d9d7af67f19dba204ce9030c0">CE_REMOVE</a>)
            <span class="keywordflow">continue</span>; <span class="comment">/* entry being removed */</span>

        path = ce-&gt;<a class="code" href="structcache__entry.html#a792e4ea24cb16c76abe3229651e414a0">name</a>;
        pathlen = ce_namelen(ce);
        <span class="keywordflow">if</span> (pathlen &lt;= baselen || memcmp(base, path, baselen))
            <span class="keywordflow">break</span>; <span class="comment">/* at the end of this level */</span>

        slash = strchr(path + baselen, <span class="charliteral">&#39;/&#39;</span>);
        <span class="keywordflow">if</span> (slash) {
            entlen = slash - (path + baselen);
            sub = <a class="code" href="cache-tree_8c.html#ad6f290b64591d50637ff248e16896f84">cache_tree_find_subtree</a>(it, path + baselen, entlen, 0);
            g_return_val_if_fail (sub != NULL, -1);
            <span class="comment">/* Skip cache entries in the sub level. */</span>
            i += sub-&gt;cache_tree-&gt;entry_count - 1;

            sha1 = sub-&gt;cache_tree-&gt;sha1;
            mtime = sub-&gt;cache_tree-&gt;mtime;
            mode = S_IFDIR;
            name = g_strndup(path + baselen, entlen);

            <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (sha1, hex, 20);
            seaf_dent = <a class="code" href="fs-mgr_8c.html#a07b91f8db9de0262970252a95f5e9f2f">seaf_dirent_new</a> (<a class="code" href="fs-mgr_8c.html#aed9f5302d562729d419a4ef8f60ffbd1">dir_version_from_repo_version</a>(<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>),
                                         hex, mode, name, mtime, NULL, -1);
            g_free(name);

            dirents = g_list_prepend (dirents, seaf_dent);
        } <span class="keywordflow">else</span> {
            sha1 = ce-&gt;<a class="code" href="structcache__entry.html#a119ab5c5e9db495e6e5f8d301f01421c">sha1</a>;
            mode = ce-&gt;<a class="code" href="structcache__entry.html#a5fcbcc4e7265ae8150f136380ed92c05">ce_mode</a>;
            mtime = ce-&gt;<a class="code" href="structcache__entry.html#a1c66f1f4e7773a56010e7ec64bd38a95">ce_mtime</a>.<a class="code" href="structcache__time64.html#ae37877c7f3995f5a44a4a9fd7bb91d46">sec</a>;
            size = ce-&gt;<a class="code" href="structcache__entry.html#a869a62534c704e5d24ee26cf2f7b86b7">ce_size</a>;
            modifier = ce-&gt;<a class="code" href="structcache__entry.html#a786aa5bc6234542fe202023bcf721afd">modifier</a>;
            entlen = pathlen - baselen;
            name = g_strndup(path + baselen, entlen);
            <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (sha1, hex, 20);

            <span class="keywordflow">if</span> (<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a> &gt; 0) {
                seaf_dent =
                    <a class="code" href="fs-mgr_8c.html#a07b91f8db9de0262970252a95f5e9f2f">seaf_dirent_new</a> (<a class="code" href="fs-mgr_8c.html#aed9f5302d562729d419a4ef8f60ffbd1">dir_version_from_repo_version</a>(<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>),
                                     hex, mode, name, mtime, modifier, size);
            } <span class="keywordflow">else</span> {
                seaf_dent = <a class="code" href="fs-mgr_8c.html#a07b91f8db9de0262970252a95f5e9f2f">seaf_dirent_new</a> (0, hex, mode, name, 0, NULL, -1);
            }

            g_free(name);

            dirents = g_list_prepend (dirents, seaf_dent);
        }

<span class="preprocessor">#if DEBUG</span>
<span class="preprocessor"></span>        fprintf(stderr, <span class="stringliteral">&quot;cache-tree update-one %o %.*s\n&quot;</span>,
                mode, entlen, path + baselen);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }

    <span class="comment">/* Sort dirents in descending order. */</span>
    dirents = g_list_sort (dirents, compare_dirents);

    seaf_dir = <a class="code" href="fs-mgr_8c.html#ae49e883dd4aa920a40b870092677ae35">seaf_dir_new</a> (NULL, dirents, <a class="code" href="fs-mgr_8c.html#aed9f5302d562729d419a4ef8f60ffbd1">dir_version_from_repo_version</a>(<a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>));
    <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#a130e83c1ad29d78ef1a5b6baef1754d5">hex_to_rawdata</a> (seaf_dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>, it-&gt;<a class="code" href="structcache__tree.html#a662341619d00b9fd6cbd25ea74cc22dd">sha1</a>, 20);

    <span class="comment">/* Dir&#39;s mtime is the latest of all dir entires. */</span>
    guint64 dir_mtime = 0;
    <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *dent;
    <span class="keywordflow">for</span> (ptr = dirents; ptr; ptr = ptr-&gt;next) {
        dent = ptr-&gt;data;
        <span class="keywordflow">if</span> (dent-&gt;<a class="code" href="struct__SeafDirent.html#a42acf83af54b1c20696b5f288bbdd681">mtime</a> &gt; dir_mtime)
            dir_mtime = dent-&gt;<a class="code" href="struct__SeafDirent.html#a42acf83af54b1c20696b5f288bbdd681">mtime</a>;
    }
    it-&gt;<a class="code" href="structcache__tree.html#a799abd380209b4a12555f11f0e112c90">mtime</a> = dir_mtime;

    <span class="keywordflow">if</span> (!<a class="code" href="fs-mgr_8c.html#a9262b8849eabb4d72009ca1feb396c20">seaf_fs_manager_object_exists</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>,
                                        repo_id, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>,
                                        seaf_dir-&gt;<a class="code" href="struct__SeafDir.html#a5f55fde50d62b2d20d0a3dfddaed7a7c">dir_id</a>))
        <a class="code" href="fs-mgr_8c.html#a6335345f24b4ae73c65cf12e2b2d57b3">seaf_dir_save</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>, repo_id, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, seaf_dir);

<span class="preprocessor">#if DEBUG</span>
<span class="preprocessor"></span>    <span class="keywordflow">for</span> (p = dirents; p; p = p-&gt;next) {
        <a class="code" href="struct__SeafDirent.html">SeafDirent</a> *tmp = (<a class="code" href="struct__SeafDirent.html">SeafDirent</a> *)p-&gt;data;
        fprintf(stderr, <span class="stringliteral">&quot;dump dirent name %s id %s\n&quot;</span>, tmp-&gt;<a class="code" href="struct__SeafDirent.html#a400094123179edfd24b0db4925780624">name</a>, tmp-&gt;<a class="code" href="struct__SeafDirent.html#ae85b031142d8a9360ba9c2ab8961a451">id</a>);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <a class="code" href="fs-mgr_8c.html#ae04d3c4669cd7b0fc691cd2da6dc2de1">seaf_dir_free</a> (seaf_dir);
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afa0ef6de91f37ec2adcfbfa16a70e0d0"></a><!-- doxytag: member="vc&#45;utils.c::compare_file_content" ref="afa0ef6de91f37ec2adcfbfa16a70e0d0" args="(const char *path, SeafStat *st, const unsigned char *ce_sha1, SeafileCrypt *crypt, int repo_version)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="vc-utils_8h.html#a040158be07f3403d0df49c37546223cf">compare_file_content</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="seafile-4_81_82_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> *&#160;</td>
          <td class="paramname"><em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>ce_sha1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSeafileCrypt.html">SeafileCrypt</a> *&#160;</td>
          <td class="paramname"><em>crypt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repo_version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00341">341</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="struct__CDCFileDescriptor.html">CDCFileDescriptor</a> cdc;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>[20];

    <span class="keywordflow">if</span> (st-&gt;st_size == 0) {
        memset (sha1, 0, 20);
    } <span class="keywordflow">else</span> {
        memset (&amp;cdc, 0, <span class="keyword">sizeof</span>(cdc));
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#a1aa5b89184d542ad96548d7a311c44e1">block_sz</a> = <a class="code" href="fs-mgr_8c.html#a056e47c5aca021aae437a764b3bc7c29">calculate_chunk_size</a> (st-&gt;st_size);
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#a756f439fffd667631f76a28a1d379c5d">block_min_sz</a> = cdc.<a class="code" href="struct__CDCFileDescriptor.html#a1aa5b89184d542ad96548d7a311c44e1">block_sz</a> &gt;&gt; 2;
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#aa4fc3655afc5a6658c151b4a2231aa5c">block_max_sz</a> = cdc.<a class="code" href="struct__CDCFileDescriptor.html#a1aa5b89184d542ad96548d7a311c44e1">block_sz</a> &lt;&lt; 2;
        cdc.<a class="code" href="struct__CDCFileDescriptor.html#accd5f7e587ad3e5139a7b8be3788affa">write_block</a> = <a class="code" href="fs-mgr_8c.html#a7182f3f9fdba2447f48c1978deea35d5">seafile_write_chunk</a>;
        <span class="keywordflow">if</span> (<a class="code" href="cdc_8c.html#ab0a7b062dc6ce4e3f4963c6cad019e8e">filename_chunk_cdc</a> (path, &amp;cdc, crypt, FALSE) &lt; 0) {
            g_warning (<span class="stringliteral">&quot;Failed to chunk file.\n&quot;</span>);
            <span class="keywordflow">return</span> -1;
        }

        <span class="keywordflow">if</span> (repo_version &gt; 0)
            <a class="code" href="fs-mgr_8c.html#a2709f56fced7ef68b2db3e35a3eddb41">seaf_fs_manager_calculate_seafile_id_json</a> (repo_version, &amp;cdc, sha1);
        <span class="keywordflow">else</span>
            memcpy (sha1, cdc.<a class="code" href="struct__CDCFileDescriptor.html#accaeb7b6792d0efe869be299050b3a87">file_sum</a>, 20);

        <span class="keywordflow">if</span> (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>)
            free (cdc.<a class="code" href="struct__CDCFileDescriptor.html#a9b2807f7c178d725387b6d0a1319c9cf">blk_sha1s</a>);
    }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    <span class="keywordtype">char</span> id1[41], id2[41];
    <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (sha1, id1, 20);
    <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (ce_sha1, id2, 20);
    seaf_debug (<span class="stringliteral">&quot;id1: %s, id2: %s.\n&quot;</span>, id1, id2);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">return</span> hashcmp (sha1, ce_sha1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe4721091f815b2382d2cc8b30e97cf0"></a><!-- doxytag: member="vc&#45;utils.c::delete_path" ref="afe4721091f815b2382d2cc8b30e97cf0" args="(const char *worktree, const char *name, unsigned int mode, gint64 old_mtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="vc-utils_8h.html#afe4721091f815b2382d2cc8b30e97cf0">delete_path</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>worktree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint64&#160;</td>
          <td class="paramname"><em>old_mtime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00876">876</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> path[<a class="code" href="seafile-4_81_82_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>];
    <a class="code" href="seafile-4_81_82_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> st;
    <span class="keywordtype">int</span> len = strlen(<a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);

    <span class="keywordflow">if</span> (!len) {
        g_warning (<span class="stringliteral">&quot;entry name should not be empty.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    snprintf (path, <a class="code" href="seafile-4_81_82_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>, <span class="stringliteral">&quot;%s/%s&quot;</span>, worktree, <a class="code" href="index_8h.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);

    <span class="keywordflow">if</span> (!S_ISDIR(<a class="code" href="index_8h.html#ac1b4d694fc07a39e06900e82872aac7f">mode</a>)) {
        <span class="comment">/* file doesn&#39;t exist in work tree */</span>
        <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a> (path, &amp;st) &lt; 0 || !S_ISREG(st.st_mode)) {
            <span class="keywordflow">return</span> 0;
        }

        <span class="comment">/* file has been changed. */</span>
        <span class="keywordflow">if</span> (old_mtime != st.st_mtime) {
            g_warning (<span class="stringliteral">&quot;File %s is changed. Skip removing the file.\n&quot;</span>, path);
            <span class="keywordflow">return</span> -1;
        }

        <span class="comment">/* first unlink the file. */</span>
        <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#a26f091009701c5a9d1886b9d6ceb9c8e">seaf_util_unlink</a> (path) &lt; 0) {
            g_warning (<span class="stringliteral">&quot;Failed to remove %s: %s.\n&quot;</span>, path, strerror(errno));
            <span class="keywordflow">return</span> -1;
        }
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> (<a class="code" href="vc-utils_8c.html#a4642df9b122253404e9618cedd3d7e18">seaf_remove_empty_dir</a> (path) &lt; 0) {
            g_warning (<span class="stringliteral">&quot;Failed to remove dir %s: %s.\n&quot;</span>, path, strerror(errno));
            <span class="keywordflow">return</span> -1;
        }
    }

    <span class="comment">/* then remove all empty directories upwards. */</span>
    <span class="comment">/* offset = base_len + len; */</span>
    <span class="comment">/* do { */</span>
    <span class="comment">/*     if (path[offset] == &#39;/&#39;) { */</span>
    <span class="comment">/*         path[offset] = &#39;\0&#39;; */</span>
    <span class="comment">/*         int ret = seaf_remove_empty_dir (path); */</span>
    <span class="comment">/*         if (ret &lt; 0) { */</span>
    <span class="comment">/*             break; */</span>
    <span class="comment">/*         } */</span>
    <span class="comment">/*     } */</span>
    <span class="comment">/* } while (--offset &gt; base_len); */</span>

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7564d102761a05b137c2b06fa5e1f004"></a><!-- doxytag: member="vc&#45;utils.c::fill_seafile_blocks" ref="a7564d102761a05b137c2b06fa5e1f004" args="(const char *repo_id, int version, const unsigned char *sha1, BlockList *bl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="vc-utils_8h.html#a7564d102761a05b137c2b06fa5e1f004">fill_seafile_blocks</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>repo_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>sha1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBlockList.html">BlockList</a> *&#160;</td>
          <td class="paramname"><em>bl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l01096">1096</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> file_id[41];
    <a class="code" href="struct__Seafile.html">Seafile</a> *seafile;
    <span class="keywordtype">int</span> i;

    <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ae947b53110fc0132e83445d76ddded09">rawdata_to_hex</a> (<a class="code" href="index_8h.html#a96e76167c968d38441e90ee0488ee4aa">sha1</a>, file_id, 20);
    seafile = <a class="code" href="fs-mgr_8c.html#a029c16e2ecdf6eafd96edb2ee4e6beac">seaf_fs_manager_get_seafile</a> (<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>-&gt;<a class="code" href="struct__SeafileSession.html#a7ab44dd0bf8e3b3df6ee858e7d07e86d">fs_mgr</a>, repo_id, <a class="code" href="block-tx-utils_8h.html#a1abe2c64ac9f8bc05bbb1719cad360f3">version</a>, file_id);
    <span class="keywordflow">if</span> (!seafile) {
        g_warning (<span class="stringliteral">&quot;Failed to find file %s.\n&quot;</span>, file_id);
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">for</span> (i = 0; i &lt; seafile-&gt;<a class="code" href="struct__Seafile.html#af2d5c5e5bb56d38122dead42128b9c20">n_blocks</a>; ++i)
        <a class="code" href="fs-mgr_8c.html#a8dda70e7563d2ae6a19e7407e67dc38e">block_list_insert</a> (bl, seafile-&gt;<a class="code" href="struct__Seafile.html#aacaedff2674132faf3d522ba8df6e268">blk_sha1s</a>[i]);

    <a class="code" href="fs-mgr_8c.html#a0a491c647769cf7bd09d5092ab84b85a">seafile_unref</a> (seafile);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4642df9b122253404e9618cedd3d7e18"></a><!-- doxytag: member="vc&#45;utils.c::seaf_remove_empty_dir" ref="a4642df9b122253404e9618cedd3d7e18" args="(const char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="vc-utils_8h.html#a4642df9b122253404e9618cedd3d7e18">seaf_remove_empty_dir</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00174">174</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="seafile-4_81_82_2lib_2utils_8h.html#a5b073bcbe1516b249924c3702002d32c">SeafStat</a> st;
    GDir *dir;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *dname;
    <span class="keywordtype">char</span> *full_path;
    GError *error = NULL;

    <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#ab46893ad4a68049bcd80eac8dcc2e299">seaf_stat</a> (path, &amp;st) &lt; 0 || !S_ISDIR(st.st_mode))
        <span class="keywordflow">return</span> 0;

    <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#abab8a37cf996c1cf68c1cc8f6dfc757c">seaf_util_rmdir</a> (path) &lt; 0) {
        dir = g_dir_open (path, 0, &amp;error);
        <span class="keywordflow">if</span> (!dir) {
            seaf_warning (<span class="stringliteral">&quot;Failed to open dir %s: %s.\n&quot;</span>, path, error-&gt;message);
            <span class="keywordflow">return</span> -1;
        }

        <span class="comment">/* Remove all ignored hidden files. */</span>
        <span class="keywordflow">while</span> ((dname = g_dir_read_name (dir)) != NULL) {
            <span class="keywordflow">if</span> (<a class="code" href="daemon_2Backups_2repo-mgr_8c.html#a1705de1c533ed3783c9e7ad4b34f4b96">seaf_repo_manager_is_ignored_hidden_file</a>(dname)) {
                full_path = g_build_path (<span class="stringliteral">&quot;/&quot;</span>, path, dname, NULL);
                <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#a26f091009701c5a9d1886b9d6ceb9c8e">seaf_util_unlink</a> (full_path) &lt; 0)
                    seaf_warning (<span class="stringliteral">&quot;Failed to remove file %s: %s.\n&quot;</span>,
                                  full_path, strerror(errno));
                g_free (full_path);
            }
        }

        g_dir_close (dir);

        <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#abab8a37cf996c1cf68c1cc8f6dfc757c">seaf_util_rmdir</a> (path) &lt; 0) {
            seaf_warning (<span class="stringliteral">&quot;Failed to remove dir %s: %s.\n&quot;</span>, path, strerror(errno));
            <span class="keywordflow">return</span> -1;
        }
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab93fff6b962d6fd7482c95d17c8bf6eb"></a><!-- doxytag: member="vc&#45;utils.c::update_index" ref="ab93fff6b962d6fd7482c95d17c8bf6eb" args="(struct index_state *istate, const char *index_path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="vc-utils_8h.html#ab93fff6b962d6fd7482c95d17c8bf6eb">update_index</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structindex__state.html">index_state</a> *&#160;</td>
          <td class="paramname"><em>istate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>index_path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00142">142</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> index_shadow[<a class="code" href="seafile-4_81_82_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>];
    <span class="keywordtype">int</span> <a class="code" href="index_8c.html#a37ae9831253a5201f6d773a14e1da9ac">index_fd</a>;
    <span class="keywordtype">int</span> ret = 0;

    snprintf (index_shadow, <a class="code" href="seafile-4_81_82_2common_2common_8h.html#a169a119979344433b9e2a39e4e8e334a">SEAF_PATH_MAX</a>, <span class="stringliteral">&quot;%s.shadow&quot;</span>, <a class="code" href="index_8c.html#a35caece3e3575d32521f820a8f0a24a7">index_path</a>);
    index_fd = <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#a822971bc55edc699449c6f6f2e03225e">seaf_util_create</a> (index_shadow, O_RDWR | O_CREAT | O_TRUNC | O_BINARY,
                                 0666);
    <span class="keywordflow">if</span> (index_fd &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Failed to open shadow index: %s.\n&quot;</span>, strerror(errno));
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (<a class="code" href="index_8c.html#a00594b344a866bd98aa1dad7d4a7b434">write_index</a> (istate, index_fd) &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Failed to write shadow index: %s.\n&quot;</span>, strerror(errno));
        close (index_fd);
        <span class="keywordflow">return</span> -1;
    }
    close (index_fd);

    ret = <a class="code" href="seafile-4_81_82_2lib_2utils_8c.html#a46307856992913eeb741c8203cfc93c2">seaf_util_rename</a> (index_shadow, <a class="code" href="index_8c.html#a35caece3e3575d32521f820a8f0a24a7">index_path</a>);
    <span class="keywordflow">if</span> (ret &lt; 0) {
        g_warning (<span class="stringliteral">&quot;Failed to update index errno=%d %s\n&quot;</span>, errno, strerror(errno));
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b8dc271b94740a5cb1e32827ee88d29"></a><!-- doxytag: member="vc&#45;utils.c::update_worktree" ref="a4b8dc271b94740a5cb1e32827ee88d29" args="(struct unpack_trees_options *o, gboolean recover_merge, const char *conflict_head_id, const char *default_conflict_suffix, int *finished_entries)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="vc-utils_8h.html#a34c7ef093d343b749951dd962eb6ebd2">update_worktree</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structunpack__trees__options.html">unpack_trees_options</a> *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gboolean&#160;</td>
          <td class="paramname"><em>recover_merge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>conflict_head_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>default_conflict_suffix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>finished_entries</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vc-utils_8c_source.html#l00833">833</a> of file <a class="el" href="vc-utils_8c_source.html">vc-utils.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span><a class="code" href="structindex__state.html">index_state</a> *result = &amp;o-&gt;<a class="code" href="structunpack__trees__options.html#a091d6e59892b9009809e45dfb38c24da">result</a>;
    <span class="keywordtype">int</span> i;
    <span class="keyword">struct </span><a class="code" href="structcache__entry.html">cache_entry</a> *ce;
    <span class="keywordtype">int</span> errs = 0;
    GHashTable *conflict_hash, *no_conflict_hash;

    <span class="keywordflow">for</span> (i = 0; i &lt; result-&gt;<a class="code" href="structindex__state.html#a15b38cdd30ad2374bc12da429f39312f">cache_nr</a>; ++i) {
        ce = result-&gt;<a class="code" href="structindex__state.html#a8aa7a8aa984ec5a39ff2eee96412db07">cache</a>[i];
        <span class="keywordflow">if</span> (ce-&gt;<a class="code" href="structcache__entry.html#a4dab14fd813a1bb6b67352674ff4afb2">ce_flags</a> &amp; <a class="code" href="index_8h.html#ab8db831d893aba29775bf7251661296b">CE_WT_REMOVE</a>)
            errs |= unlink_entry (ce, o);
    }

    conflict_hash = g_hash_table_new_full (g_str_hash, g_str_equal,
                                           g_free, g_free);
    no_conflict_hash = g_hash_table_new_full (g_str_hash, g_str_equal,
                                              g_free, NULL);

    <span class="keywordflow">for</span> (i = 0; i &lt; result-&gt;<a class="code" href="structindex__state.html#a15b38cdd30ad2374bc12da429f39312f">cache_nr</a>; ++i) {
        ce = result-&gt;<a class="code" href="structindex__state.html#a8aa7a8aa984ec5a39ff2eee96412db07">cache</a>[i];
        <span class="keywordflow">if</span> (ce-&gt;<a class="code" href="structcache__entry.html#a4dab14fd813a1bb6b67352674ff4afb2">ce_flags</a> &amp; <a class="code" href="index_8h.html#a1d46becf22e28d6f8bffa8ee949acb45">CE_UPDATE</a>) {
            errs |= checkout_entry (ce, o, recover_merge,
                                    conflict_head_id,
                                    conflict_hash, no_conflict_hash);
        }
        <span class="keywordflow">if</span> (finished_entries)
            *finished_entries = *finished_entries + 1;
    }

    g_hash_table_destroy (conflict_hash);
    g_hash_table_destroy (no_conflict_hash);

    <span class="keywordflow">if</span> (errs != 0)
        <span class="keywordflow">return</span> -1;
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 02:52:53 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
