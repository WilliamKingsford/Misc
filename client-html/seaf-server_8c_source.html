<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: seafile-4.1.2/server/seaf-server.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">seafile-4.1.2/server/seaf-server.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="seaf-server_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;common.h&quot;</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;getopt.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;glib.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;glib-object.h&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="code" href="ccnet_8h.html">ccnet.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;searpc-server.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;searpc-client.h&gt;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="server_2seafile-session_8h.html">seafile-session.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="seafile-rpc_8h.html">seafile-rpc.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="include_2ccnet_2rpcserver-proc_8h.html">ccnet/rpcserver-proc.h</a>&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="include_2ccnet_2threaded-rpcserver-proc_8h.html">ccnet/threaded-rpcserver-proc.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;log.h&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;utils.h&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="check-tx-slave-v2-proc_8h.html">processors/check-tx-slave-v2-proc.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="check-tx-slave-v3-proc_8h.html">processors/check-tx-slave-v3-proc.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="recvfs-proc_8h.html">processors/recvfs-proc.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;processors/putfs-proc.h&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="recvbranch-proc_8h.html">processors/recvbranch-proc.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="sync-repo-slave-proc_8h.html">processors/sync-repo-slave-proc.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="putcommit-v2-proc_8h.html">processors/putcommit-v2-proc.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="putcommit-v3-proc_8h.html">processors/putcommit-v3-proc.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="recvcommit-v3-proc_8h.html">processors/recvcommit-v3-proc.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="putcs-v2-proc_8h.html">processors/putcs-v2-proc.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;processors/checkbl-proc.h&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;processors/checkff-proc.h&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="putca-proc_8h.html">processors/putca-proc.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="check-protocol-slave-proc_8h.html">processors/check-protocol-slave-proc.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="recvfs-v2-proc_8h.html">processors/recvfs-v2-proc.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="recvbranch-v2-proc_8h.html">processors/recvbranch-v2-proc.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="putfs-v2-proc_8h.html">processors/putfs-v2-proc.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="cdc_8h.html">cdc/cdc.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="seaf-server_8c.html#ae66636d1834d105bd51d89ff01acfe15">00046</a> <a class="code" href="struct__SeafileSession.html">SeafileSession</a> *<a class="code" href="seaf-daemon_8c.html#ae66636d1834d105bd51d89ff01acfe15">seaf</a>;
<a name="l00047"></a><a class="code" href="seaf-server_8c.html#afcd4df5ae9b3664064f70e23b7acbd28">00047</a> SearpcClient *<a class="code" href="seaf-daemon_8c.html#afcd4df5ae9b3664064f70e23b7acbd28">ccnetrpc_client</a>;
<a name="l00048"></a><a class="code" href="seaf-server_8c.html#a735d100fbadb11c7d2cfd40860a09d5e">00048</a> SearpcClient *<a class="code" href="seaf-server_8c.html#a735d100fbadb11c7d2cfd40860a09d5e">ccnetrpc_client_t</a>;
<a name="l00049"></a><a class="code" href="seaf-server_8c.html#ab4446176aa39199f6249742036fe9079">00049</a> SearpcClient *<a class="code" href="seaf-server_8c.html#ab4446176aa39199f6249742036fe9079">async_ccnetrpc_client</a>;
<a name="l00050"></a><a class="code" href="seaf-server_8c.html#a86d15446eeda16575d807c660dc5a906">00050</a> SearpcClient *<a class="code" href="seaf-server_8c.html#a86d15446eeda16575d807c660dc5a906">async_ccnetrpc_client_t</a>;
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="seaf-server_8c.html#a9319f4233d0597188c3119f4dc7b3f0f">00052</a> <span class="keywordtype">char</span> *<a class="code" href="seaf-server_8c.html#a9319f4233d0597188c3119f4dc7b3f0f">pidfile</a> = NULL;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *short_options = <span class="stringliteral">&quot;hvc:d:l:fg:G:P:mCD:&quot;</span>;
<a name="l00055"></a>00055 <span class="keyword">static</span> <span class="keyword">struct </span>option long_options[] = {
<a name="l00056"></a>00056     { <span class="stringliteral">&quot;help&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;h&#39;</span>, },
<a name="l00057"></a>00057     { <span class="stringliteral">&quot;version&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;v&#39;</span>, },
<a name="l00058"></a>00058     { <span class="stringliteral">&quot;config-file&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;c&#39;</span> },
<a name="l00059"></a>00059     { <span class="stringliteral">&quot;seafdir&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;d&#39;</span> },
<a name="l00060"></a>00060     { <span class="stringliteral">&quot;log&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;l&#39;</span> },
<a name="l00061"></a>00061     { <span class="stringliteral">&quot;debug&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;D&#39;</span> },
<a name="l00062"></a>00062     { <span class="stringliteral">&quot;foreground&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;f&#39;</span> },
<a name="l00063"></a>00063     { <span class="stringliteral">&quot;ccnet-debug-level&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;g&#39;</span> },
<a name="l00064"></a>00064     { <span class="stringliteral">&quot;seafile-debug-level&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;G&#39;</span> },
<a name="l00065"></a>00065     { <span class="stringliteral">&quot;master&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;m&#39;</span>},
<a name="l00066"></a>00066     { <span class="stringliteral">&quot;pidfile&quot;</span>, required_argument, NULL, <span class="charliteral">&#39;P&#39;</span> },
<a name="l00067"></a>00067     { <span class="stringliteral">&quot;cloud-mode&quot;</span>, no_argument, NULL, <span class="charliteral">&#39;C&#39;</span>},
<a name="l00068"></a>00068     { NULL, 0, NULL, 0, },
<a name="l00069"></a>00069 };
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="monitor-tool_8c.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a> ()
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073     fprintf (stderr, <span class="stringliteral">&quot;usage: seaf-server [-c config_dir] [-d seafile_dir]\n&quot;</span>);
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keyword">static</span> <span class="keywordtype">void</span> register_processors (<a class="code" href="struct__CcnetClient.html">CcnetClient</a> *<a class="code" href="monitor-tool_8c.html#ae6c1fa423e7fbf3f8de619294cb6b4b3">client</a>)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-check-tx-slave-v2&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00079"></a>00079                             <a class="code" href="check-tx-slave-v2-proc_8h.html#a2803af7f9aede78deb1f0325992100b4">SEAFILE_TYPE_CHECK_TX_SLAVE_V2_PROC</a>, NULL);
<a name="l00080"></a>00080     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-check-tx-slave-v3&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00081"></a>00081                             <a class="code" href="check-tx-slave-v3-proc_8h.html#a54b674dab22c8deb77085fef0c01ce56">SEAFILE_TYPE_CHECK_TX_SLAVE_V3_PROC</a>, NULL);
<a name="l00082"></a>00082     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-recvfs&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00083"></a>00083                             <a class="code" href="recvfs-proc_8h.html#a610d5e63e55e0d679b68c9228c19af7c">SEAFILE_TYPE_RECVFS_PROC</a>, NULL);
<a name="l00084"></a>00084     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-putfs&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00085"></a>00085                             <a class="code" href="daemon_2processors_2putfs-proc_8h.html#a0c189c7936af9203386d7c4017327e97">SEAFILE_TYPE_PUTFS_PROC</a>, NULL);
<a name="l00086"></a>00086     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-recvbranch&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00087"></a>00087                             <a class="code" href="recvbranch-proc_8h.html#a0e6636b2a26529d4d5048321a98657bb">SEAFILE_TYPE_RECVBRANCH_PROC</a>, NULL);
<a name="l00088"></a>00088     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-sync-repo-slave&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00089"></a>00089                             <a class="code" href="sync-repo-slave-proc_8h.html#aab1c92f6228922b2af979d8ec20c036d">SEAFILE_TYPE_SYNC_REPO_SLAVE_PROC</a>, NULL);
<a name="l00090"></a>00090     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-putcommit-v2&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00091"></a>00091                             <a class="code" href="putcommit-v2-proc_8h.html#a210355d083c8c018c435ee528915c0d2">SEAFILE_TYPE_PUTCOMMIT_V2_PROC</a>, NULL);
<a name="l00092"></a>00092     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-putcommit-v3&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00093"></a>00093                             <a class="code" href="putcommit-v3-proc_8h.html#ae3fa002b953d9480bdbfb61a7974e62a">SEAFILE_TYPE_PUTCOMMIT_V3_PROC</a>, NULL);
<a name="l00094"></a>00094     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-recvcommit-v3&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00095"></a>00095                             <a class="code" href="recvcommit-v3-proc_8h.html#afba17c5d730d5eeeddb80bf4d41a3077">SEAFILE_TYPE_RECVCOMMIT_V3_PROC</a>, NULL);
<a name="l00096"></a>00096     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-putcs-v2&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00097"></a>00097                             <a class="code" href="putcs-v2-proc_8h.html#aa9529adb7217a7340814a300770b6350">SEAFILE_TYPE_PUTCS_V2_PROC</a>, NULL);
<a name="l00098"></a>00098     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-checkbl&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00099"></a>00099                             <a class="code" href="daemon_2processors_2checkbl-proc_8h.html#a16be113d11bd26f846655f65b76fbb88">SEAFILE_TYPE_CHECKBL_PROC</a>, NULL);
<a name="l00100"></a>00100     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-checkff&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00101"></a>00101                             <a class="code" href="daemon_2processors_2checkff-proc_8h.html#a5fd38032a5f483b89c1c0a13b0477eff">SEAFILE_TYPE_CHECKFF_PROC</a>, NULL);
<a name="l00102"></a>00102     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-putca&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00103"></a>00103                             <a class="code" href="putca-proc_8h.html#ac57ebddc88f743fb39729ed817f53a4e">SEAFILE_TYPE_PUTCA_PROC</a>, NULL);
<a name="l00104"></a>00104     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-check-protocol-slave&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00105"></a>00105                             <a class="code" href="check-protocol-slave-proc_8h.html#aff79df2eddbd670fccdf56c6bbded2cc">SEAFILE_TYPE_CHECK_PROTOCOL_SLAVE_PROC</a>, NULL);
<a name="l00106"></a>00106     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-recvfs-v2&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00107"></a>00107                             <a class="code" href="recvfs-v2-proc_8h.html#a599b7457ab5cc7bc265f5dba6f76be21">SEAFILE_TYPE_RECVFS_V2_PROC</a>, NULL);
<a name="l00108"></a>00108     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-recvbranch-v2&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00109"></a>00109                             <a class="code" href="recvbranch-v2-proc_8h.html#a7bab37ddeb71763288c90e09cebef179">SEAFILE_TYPE_RECVBRANCH_V2_PROC</a>, NULL);
<a name="l00110"></a>00110     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafile-putfs-v2&quot;</span>, <span class="stringliteral">&quot;basic&quot;</span>,
<a name="l00111"></a>00111                             <a class="code" href="putfs-v2-proc_8h.html#a24c05bd7e4decbcfbf39a7d45dc5c3d0">SEAFILE_TYPE_PUTFS_V2_PROC</a>, NULL);
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="preprocessor">#include &lt;searpc.h&gt;</span>
<a name="l00115"></a>00115 <span class="preprocessor">#include &quot;searpc-signature.h&quot;</span>
<a name="l00116"></a>00116 <span class="preprocessor">#include &quot;searpc-marshal.h&quot;</span>
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keyword">static</span> <span class="keywordtype">void</span> start_rpc_service (<a class="code" href="struct__CcnetClient.html">CcnetClient</a> *<a class="code" href="monitor-tool_8c.html#ae6c1fa423e7fbf3f8de619294cb6b4b3">client</a>, <span class="keywordtype">int</span> cloud_mode)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120     searpc_server_init (register_marshals);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     searpc_create_service (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>);
<a name="l00123"></a>00123     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>, <span class="stringliteral">&quot;rpc-inner&quot;</span>,
<a name="l00124"></a>00124                             <a class="code" href="include_2ccnet_2rpcserver-proc_8h.html#ad0828c8ef7b3fe603ec4ec0fe810b366">CCNET_TYPE_RPCSERVER_PROC</a>, NULL);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     searpc_create_service (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>);
<a name="l00127"></a>00127     <a class="code" href="ccnet_8h.html#a431e05069ff47a725a9b74aaa9ccefa7">ccnet_register_service</a> (client, <span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>, <span class="stringliteral">&quot;rpc-inner&quot;</span>,
<a name="l00128"></a>00128                             <a class="code" href="include_2ccnet_2threaded-rpcserver-proc_8h.html#a98d4dd17f15fc58c4de2b4bcf133381f">CCNET_TYPE_THREADED_RPCSERVER_PROC</a>, NULL);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="comment">/* threaded services */</span>
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">/* repo manipulation */</span>
<a name="l00133"></a>00133     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00134"></a>00134                                      <a class="code" href="seafile-4_81_82_2common_2rpc-service_8c.html#a37949d30db3977c8fbb573881173987b">seafile_get_repo</a>,
<a name="l00135"></a>00135                                      <span class="stringliteral">&quot;seafile_get_repo&quot;</span>,
<a name="l00136"></a>00136                                      searpc_signature_object__string());
<a name="l00137"></a>00137     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00138"></a>00138                                      <a class="code" href="seafile-4_81_82_2common_2rpc-service_8c.html#a3743ba1324330f8ef0cb9a5c33a52e92">seafile_destroy_repo</a>,
<a name="l00139"></a>00139                                      <span class="stringliteral">&quot;seafile_destroy_repo&quot;</span>,
<a name="l00140"></a>00140                                      searpc_signature_int__string());
<a name="l00141"></a>00141     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00142"></a>00142                                      <a class="code" href="seafile-4_81_82_2common_2rpc-service_8c.html#aba4837db052d18cd952ad53e10ebd379">seafile_get_repo_list</a>,
<a name="l00143"></a>00143                                      <span class="stringliteral">&quot;seafile_get_repo_list&quot;</span>,
<a name="l00144"></a>00144                                      searpc_signature_objlist__int_int());
<a name="l00145"></a>00145     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00146"></a>00146                                      <a class="code" href="seafile-rpc_8h.html#a91cd7b63d88371419401b198362b3a7f">seafile_set_repo_owner</a>,
<a name="l00147"></a>00147                                      <span class="stringliteral">&quot;seafile_set_repo_owner&quot;</span>,
<a name="l00148"></a>00148                                      searpc_signature_int__string_string());
<a name="l00149"></a>00149     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00150"></a>00150                                      <a class="code" href="seafile-rpc_8h.html#a9f18b5e528f0333fe1807b5f768cc925">seafile_get_repo_owner</a>,
<a name="l00151"></a>00151                                      <span class="stringliteral">&quot;seafile_get_repo_owner&quot;</span>,
<a name="l00152"></a>00152                                      searpc_signature_string__string());
<a name="l00153"></a>00153     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00154"></a>00154                                      <a class="code" href="seafile-rpc_8h.html#a168ca0f45201bfc64cb4ad0b21b9af09">seafile_get_orphan_repo_list</a>,
<a name="l00155"></a>00155                                      <span class="stringliteral">&quot;seafile_get_orphan_repo_list&quot;</span>,
<a name="l00156"></a>00156                                      searpc_signature_objlist__void());
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00159"></a>00159                                      <a class="code" href="seafile-rpc_8h.html#a450668769b2161f9d76f4d7663f45909">seafile_edit_repo</a>,
<a name="l00160"></a>00160                                      <span class="stringliteral">&quot;seafile_edit_repo&quot;</span>,
<a name="l00161"></a>00161                                      searpc_signature_int__string_string_string_string());
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00164"></a>00164                                      <a class="code" href="seafile-rpc_8h.html#a6c29644f23cbf13f04050a998019d625">seafile_change_repo_passwd</a>,
<a name="l00165"></a>00165                                      <span class="stringliteral">&quot;seafile_change_repo_passwd&quot;</span>,
<a name="l00166"></a>00166                                      searpc_signature_int__string_string_string_string());
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00169"></a>00169                                      <a class="code" href="seafile-rpc_8h.html#a89f61f0fd15ceaa7f322c903c86df4ee">seafile_is_repo_owner</a>,
<a name="l00170"></a>00170                                      <span class="stringliteral">&quot;seafile_is_repo_owner&quot;</span>,
<a name="l00171"></a>00171                                      searpc_signature_int__string_string());
<a name="l00172"></a>00172     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00173"></a>00173                                      <a class="code" href="seafile-rpc_8h.html#a85d4378fd394bf96f7e656f8942de5e2">seafile_list_owned_repos</a>,
<a name="l00174"></a>00174                                      <span class="stringliteral">&quot;seafile_list_owned_repos&quot;</span>,
<a name="l00175"></a>00175                                      searpc_signature_objlist__string());
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00178"></a>00178                                      <a class="code" href="seafile-rpc_8h.html#ae8090a04d3bd893f99cf270c384742d4">seafile_server_repo_size</a>,
<a name="l00179"></a>00179                                      <span class="stringliteral">&quot;seafile_server_repo_size&quot;</span>,
<a name="l00180"></a>00180                                      searpc_signature_int64__string());
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00183"></a>00183                                      <a class="code" href="seafile-rpc_8h.html#a85a43f6dbf54740ab189a03cfff1c42a">seafile_repo_set_access_property</a>,
<a name="l00184"></a>00184                                      <span class="stringliteral">&quot;seafile_repo_set_access_property&quot;</span>,
<a name="l00185"></a>00185                                      searpc_signature_int__string_string());
<a name="l00186"></a>00186     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00187"></a>00187                                      <a class="code" href="seafile-rpc_8h.html#ae1411100e182292df76d574e280bec67">seafile_repo_query_access_property</a>,
<a name="l00188"></a>00188                                      <span class="stringliteral">&quot;seafile_repo_query_access_property&quot;</span>,
<a name="l00189"></a>00189                                      searpc_signature_string__string());
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00192"></a>00192                                      <a class="code" href="seafile-rpc_8h.html#a93e7b49d18006617aa4516bd42491a6b">seafile_revert_on_server</a>,
<a name="l00193"></a>00193                                      <span class="stringliteral">&quot;seafile_revert_on_server&quot;</span>,
<a name="l00194"></a>00194                                      searpc_signature_int__string_string_string());
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00197"></a>00197                                      <a class="code" href="seafile-rpc_8h.html#a49e773ba62447aeee429c05526e9fe4b">seafile_diff</a>,
<a name="l00198"></a>00198                                      <span class="stringliteral">&quot;seafile_diff&quot;</span>,
<a name="l00199"></a>00199                                      searpc_signature_objlist__string_string_string_int());
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00202"></a>00202                                      <a class="code" href="seafile-rpc_8h.html#ad0046dd7f54f3f6466fdd5462ec3be09">seafile_post_file</a>,
<a name="l00203"></a>00203                                      <span class="stringliteral">&quot;seafile_post_file&quot;</span>,
<a name="l00204"></a>00204                     searpc_signature_int__string_string_string_string_string());
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00207"></a>00207                                      <a class="code" href="seafile-rpc_8h.html#a1a998fe5394bde98de369bb09d44f70f">seafile_post_file_blocks</a>,
<a name="l00208"></a>00208                                      <span class="stringliteral">&quot;seafile_post_file_blocks&quot;</span>,
<a name="l00209"></a>00209                     searpc_signature_string__string_string_string_string_string_string_int64_int());
<a name="l00210"></a>00210     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00211"></a>00211                                      <a class="code" href="seafile-rpc_8h.html#a02980e6bc1e034fcb9da0aa301d761ca">seafile_post_multi_files</a>,
<a name="l00212"></a>00212                                      <span class="stringliteral">&quot;seafile_post_multi_files&quot;</span>,
<a name="l00213"></a>00213                     searpc_signature_string__string_string_string_string_string_int());
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00216"></a>00216                                      <a class="code" href="seafile-rpc_8h.html#a7595a518a68147313ebd7a1aa71f2322">seafile_put_file</a>,
<a name="l00217"></a>00217                                      <span class="stringliteral">&quot;seafile_put_file&quot;</span>,
<a name="l00218"></a>00218                     searpc_signature_string__string_string_string_string_string_string());
<a name="l00219"></a>00219     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00220"></a>00220                                      <a class="code" href="seafile-rpc_8h.html#a25f91f3c41fb4b368fb525ec4ab1a30b">seafile_put_file_blocks</a>,
<a name="l00221"></a>00221                                      <span class="stringliteral">&quot;seafile_put_file_blocks&quot;</span>,
<a name="l00222"></a>00222                     searpc_signature_string__string_string_string_string_string_string_string_int64());
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00225"></a>00225                                      <a class="code" href="seafile-rpc_8h.html#a934daaf851e7f23cefd422427d9b795d">seafile_post_empty_file</a>,
<a name="l00226"></a>00226                                      <span class="stringliteral">&quot;seafile_post_empty_file&quot;</span>,
<a name="l00227"></a>00227                         searpc_signature_int__string_string_string_string());
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00230"></a>00230                                      <a class="code" href="seafile-rpc_8h.html#a9d3919cc8c6627f8beb3d1f33e69768b">seafile_post_dir</a>,
<a name="l00231"></a>00231                                      <span class="stringliteral">&quot;seafile_post_dir&quot;</span>,
<a name="l00232"></a>00232                         searpc_signature_int__string_string_string_string());
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00235"></a>00235                                      <a class="code" href="seafile-rpc_8h.html#a4409282dfb298151ee16322df030c3c2">seafile_del_file</a>,
<a name="l00236"></a>00236                                      <span class="stringliteral">&quot;seafile_del_file&quot;</span>,
<a name="l00237"></a>00237                         searpc_signature_int__string_string_string_string());
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00240"></a>00240                                      <a class="code" href="seafile-rpc_8h.html#ad50653717ae1dbd6449ee0cb40dc34f8">seafile_copy_file</a>,
<a name="l00241"></a>00241                                      <span class="stringliteral">&quot;seafile_copy_file&quot;</span>,
<a name="l00242"></a>00242        searpc_signature_object__string_string_string_string_string_string_string_int_int());
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00245"></a>00245                                      <a class="code" href="seafile-rpc_8h.html#a0b65aadaede7a2d567461f15dbbc577c">seafile_move_file</a>,
<a name="l00246"></a>00246                                      <span class="stringliteral">&quot;seafile_move_file&quot;</span>,
<a name="l00247"></a>00247        searpc_signature_object__string_string_string_string_string_string_string_int_int());
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00250"></a>00250                                      <a class="code" href="seafile-rpc_8h.html#ad84817a5c2b15566c7b81206c35a3722">seafile_rename_file</a>,
<a name="l00251"></a>00251                                      <span class="stringliteral">&quot;seafile_rename_file&quot;</span>,
<a name="l00252"></a>00252                     searpc_signature_int__string_string_string_string_string());
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00255"></a>00255                                      <a class="code" href="seafile-rpc_8h.html#a50b441eb99cd3d759800aea927d45958">seafile_is_valid_filename</a>,
<a name="l00256"></a>00256                                      <span class="stringliteral">&quot;seafile_is_valid_filename&quot;</span>,
<a name="l00257"></a>00257                                      searpc_signature_int__string_string());
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00260"></a>00260                                      <a class="code" href="seafile-rpc_8h.html#aad7f4a20e680bf093c79e08fe00b7b98">seafile_create_repo</a>,
<a name="l00261"></a>00261                                      <span class="stringliteral">&quot;seafile_create_repo&quot;</span>,
<a name="l00262"></a>00262                                      searpc_signature_string__string_string_string_string());
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00265"></a>00265                                      <a class="code" href="seafile-rpc_8h.html#ad3ec04046452856df8534dffa428a4b4">seafile_create_enc_repo</a>,
<a name="l00266"></a>00266                                      <span class="stringliteral">&quot;seafile_create_enc_repo&quot;</span>,
<a name="l00267"></a>00267                                      searpc_signature_string__string_string_string_string_string_string_int());
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00270"></a>00270                                      <a class="code" href="seafile-4_81_82_2common_2rpc-service_8c.html#af0444c8f4e9da68a1f837c64059e7680">seafile_get_commit</a>,
<a name="l00271"></a>00271                                      <span class="stringliteral">&quot;seafile_get_commit&quot;</span>,
<a name="l00272"></a>00272                                      searpc_signature_object__string_int_string());
<a name="l00273"></a>00273     
<a name="l00274"></a>00274     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00275"></a>00275                                      <a class="code" href="seafile-rpc_8h.html#a0911e519564e6bde5ff64ee7fc4682ba">seafile_list_dir</a>,
<a name="l00276"></a>00276                                      <span class="stringliteral">&quot;seafile_list_dir&quot;</span>,
<a name="l00277"></a>00277                                      searpc_signature_objlist__string_string_int_int());
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00280"></a>00280                                      <a class="code" href="seafile-rpc_8h.html#ab551e00392256159c04e864bc366d70f">seafile_list_dir_with_perm</a>,
<a name="l00281"></a>00281                                      <span class="stringliteral">&quot;list_dir_with_perm&quot;</span>,
<a name="l00282"></a>00282                                      searpc_signature_objlist__string_string_string_string_int_int());
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00285"></a>00285                                      <a class="code" href="seafile-rpc_8h.html#aeca5b5d1a13e4f2be71f60fa9a44357a">seafile_list_file</a>,
<a name="l00286"></a>00286                                      <span class="stringliteral">&quot;seafile_list_file&quot;</span>,
<a name="l00287"></a>00287                                      searpc_signature_string__string_string_int_int());
<a name="l00288"></a>00288     
<a name="l00289"></a>00289     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00290"></a>00290                                      <a class="code" href="seafile-rpc_8h.html#a2037a0ed58aac272c469ad5ad071e7c7">seafile_get_file_size</a>,
<a name="l00291"></a>00291                                      <span class="stringliteral">&quot;seafile_get_file_size&quot;</span>,
<a name="l00292"></a>00292                                      searpc_signature_int64__string_int_string());
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00295"></a>00295                                      <a class="code" href="seafile-rpc_8h.html#a5558311c95c7f92fa3287f4ed10bbde0">seafile_get_dir_size</a>,
<a name="l00296"></a>00296                                      <span class="stringliteral">&quot;seafile_get_dir_size&quot;</span>,
<a name="l00297"></a>00297                                      searpc_signature_int64__string_int_string());
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00300"></a>00300                                      <a class="code" href="seafile-rpc_8h.html#a2381564c8052bbdceb293fc956132cf8">seafile_list_dir_by_path</a>,
<a name="l00301"></a>00301                                      <span class="stringliteral">&quot;seafile_list_dir_by_path&quot;</span>,
<a name="l00302"></a>00302                                      searpc_signature_objlist__string_string_string());
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00305"></a>00305                                      <a class="code" href="seafile-rpc_8h.html#a5666cc9db4a21fe897b0b79230cf2266">seafile_get_dirid_by_path</a>,
<a name="l00306"></a>00306                                      <span class="stringliteral">&quot;seafile_get_dirid_by_path&quot;</span>,
<a name="l00307"></a>00307                                      searpc_signature_string__string_string_string());
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00310"></a>00310                                      <a class="code" href="seafile-rpc_8h.html#ab0bb80d094703d717977085aa783392c">seafile_get_file_id_by_path</a>,
<a name="l00311"></a>00311                                      <span class="stringliteral">&quot;seafile_get_file_id_by_path&quot;</span>,
<a name="l00312"></a>00312                                      searpc_signature_string__string_string());
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00315"></a>00315                                      <a class="code" href="seafile-rpc_8h.html#a782dbf37e15755683fbd92611ae91dfe">seafile_get_dir_id_by_path</a>,
<a name="l00316"></a>00316                                      <span class="stringliteral">&quot;seafile_get_dir_id_by_path&quot;</span>,
<a name="l00317"></a>00317                                      searpc_signature_string__string_string());
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00320"></a>00320                                      <a class="code" href="seafile-rpc_8h.html#a0b950a15857e029dc9abc8be50866267">seafile_get_dirent_by_path</a>,
<a name="l00321"></a>00321                                      <span class="stringliteral">&quot;seafile_get_dirent_by_path&quot;</span>,
<a name="l00322"></a>00322                                      searpc_signature_object__string_string());
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00325"></a>00325                                      <a class="code" href="seafile-rpc_8h.html#a0a130f7f9ed101dde61884e80c4c68c7">seafile_list_file_revisions</a>,
<a name="l00326"></a>00326                                      <span class="stringliteral">&quot;seafile_list_file_revisions&quot;</span>,
<a name="l00327"></a>00327                                      searpc_signature_objlist__string_string_int_int());
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00330"></a>00330                                      <a class="code" href="seafile-rpc_8h.html#aec9c3bfdbd7f6669a812e1b50b5e47d1">seafile_calc_files_last_modified</a>,
<a name="l00331"></a>00331                                      <span class="stringliteral">&quot;seafile_calc_files_last_modified&quot;</span>,
<a name="l00332"></a>00332                                      searpc_signature_objlist__string_string_int());
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00335"></a>00335                                      <a class="code" href="seafile-rpc_8h.html#a7e65ef3b077b140b210d2f000aca9ccb">seafile_revert_file</a>,
<a name="l00336"></a>00336                                      <span class="stringliteral">&quot;seafile_revert_file&quot;</span>,
<a name="l00337"></a>00337                                      searpc_signature_int__string_string_string_string());
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00340"></a>00340                                      <a class="code" href="seafile-rpc_8h.html#a9cb900df6bedc9d01c23b1d565d47fb1">seafile_revert_dir</a>,
<a name="l00341"></a>00341                                      <span class="stringliteral">&quot;seafile_revert_dir&quot;</span>,
<a name="l00342"></a>00342                                      searpc_signature_int__string_string_string_string());
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00345"></a>00345                                      <a class="code" href="seafile-rpc_8h.html#a7b67d46b00d1a82f522c41084d526db0">seafile_get_deleted</a>,
<a name="l00346"></a>00346                                      <span class="stringliteral">&quot;get_deleted&quot;</span>,
<a name="l00347"></a>00347                                      searpc_signature_objlist__string_int());
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">/* share repo to user */</span>
<a name="l00350"></a>00350     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00351"></a>00351                                      <a class="code" href="seafile-rpc_8h.html#ad4de30b5ea6e3671dd037fb22212267c">seafile_add_share</a>,
<a name="l00352"></a>00352                                      <span class="stringliteral">&quot;seafile_add_share&quot;</span>,
<a name="l00353"></a>00353                                      searpc_signature_int__string_string_string_string());
<a name="l00354"></a>00354     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00355"></a>00355                                      <a class="code" href="seafile-rpc_8h.html#a6c26fbf15aad343038cfce8b3150b258">seafile_list_share_repos</a>,
<a name="l00356"></a>00356                                      <span class="stringliteral">&quot;seafile_list_share_repos&quot;</span>,
<a name="l00357"></a>00357                                      searpc_signature_objlist__string_string_int_int());
<a name="l00358"></a>00358     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00359"></a>00359                                      <a class="code" href="seafile-rpc_8h.html#a2ec5cfcd4769bce2623ab85921530963">seafile_remove_share</a>,
<a name="l00360"></a>00360                                      <span class="stringliteral">&quot;seafile_remove_share&quot;</span>,
<a name="l00361"></a>00361                                      searpc_signature_int__string_string_string());
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00364"></a>00364                                      <a class="code" href="seafile-rpc_8h.html#a2985ba1f21ec5ba73666fe98446db317">seafile_set_share_permission</a>,
<a name="l00365"></a>00365                                      <span class="stringliteral">&quot;set_share_permission&quot;</span>,
<a name="l00366"></a>00366                                      searpc_signature_int__string_string_string_string());
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="comment">/* share repo to group */</span>
<a name="l00369"></a>00369     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00370"></a>00370                                      <a class="code" href="seafile-rpc_8h.html#abfe46ccaf4d56449fe2612e027a35d3e">seafile_group_share_repo</a>,
<a name="l00371"></a>00371                                      <span class="stringliteral">&quot;seafile_group_share_repo&quot;</span>,
<a name="l00372"></a>00372                                      searpc_signature_int__string_int_string_string());
<a name="l00373"></a>00373     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00374"></a>00374                                      <a class="code" href="seafile-rpc_8h.html#a787e67f4d050123966d87e1f8968f74c">seafile_group_unshare_repo</a>,
<a name="l00375"></a>00375                                      <span class="stringliteral">&quot;seafile_group_unshare_repo&quot;</span>,
<a name="l00376"></a>00376                                      searpc_signature_int__string_int_string());
<a name="l00377"></a>00377     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00378"></a>00378                                      <a class="code" href="seafile-rpc_8h.html#a902391cf49184a965bc1dfb63e1bff05">seafile_get_shared_groups_by_repo</a>,
<a name="l00379"></a>00379                                      <span class="stringliteral">&quot;seafile_get_shared_groups_by_repo&quot;</span>,
<a name="l00380"></a>00380                                      searpc_signature_string__string());
<a name="l00381"></a>00381     
<a name="l00382"></a>00382     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00383"></a>00383                                      <a class="code" href="seafile-rpc_8h.html#ac9278f00f66c4e479ca10fcad557bdc4">seafile_get_group_repoids</a>,
<a name="l00384"></a>00384                                      <span class="stringliteral">&quot;seafile_get_group_repoids&quot;</span>,
<a name="l00385"></a>00385                                      searpc_signature_string__int());
<a name="l00386"></a>00386     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00387"></a>00387                                      <a class="code" href="seafile-rpc_8h.html#af6589478beae20feca7818873e34ed4d">seafile_get_group_repos_by_owner</a>,
<a name="l00388"></a>00388                                      <span class="stringliteral">&quot;get_group_repos_by_owner&quot;</span>,
<a name="l00389"></a>00389                                      searpc_signature_objlist__string());
<a name="l00390"></a>00390     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00391"></a>00391                                      <a class="code" href="seafile-rpc_8h.html#afcc664a04bf4e3939b97bc2dc5a1c6c1">seafile_get_group_repo_owner</a>,
<a name="l00392"></a>00392                                      <span class="stringliteral">&quot;get_group_repo_owner&quot;</span>,
<a name="l00393"></a>00393                                      searpc_signature_string__string());
<a name="l00394"></a>00394     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00395"></a>00395                                      <a class="code" href="seafile-rpc_8h.html#abbfdcc9a3284d3fb3544e137461cf375">seafile_remove_repo_group</a>,
<a name="l00396"></a>00396                                      <span class="stringliteral">&quot;seafile_remove_repo_group&quot;</span>,
<a name="l00397"></a>00397                                      searpc_signature_int__int_string());    
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00400"></a>00400                                      <a class="code" href="seafile-rpc_8h.html#a5ce9f3842c9c198c1f62dc198b4072b0">seafile_set_group_repo_permission</a>,
<a name="l00401"></a>00401                                      <span class="stringliteral">&quot;set_group_repo_permission&quot;</span>,
<a name="l00402"></a>00402                                      searpc_signature_int__int_string_string());
<a name="l00403"></a>00403     
<a name="l00404"></a>00404     <span class="comment">/* branch and commit */</span>
<a name="l00405"></a>00405     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00406"></a>00406                                      <a class="code" href="seafile-4_81_82_2common_2rpc-service_8c.html#acd2313411e6837feaa74fa6185524c7c">seafile_branch_gets</a>,
<a name="l00407"></a>00407                                      <span class="stringliteral">&quot;seafile_branch_gets&quot;</span>,
<a name="l00408"></a>00408                                      searpc_signature_objlist__string());
<a name="l00409"></a>00409     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00410"></a>00410                                      <a class="code" href="seafile-4_81_82_2common_2rpc-service_8c.html#a5594de7f321b08c515c465bc44e25c60">seafile_get_commit_list</a>,
<a name="l00411"></a>00411                                      <span class="stringliteral">&quot;seafile_get_commit_list&quot;</span>,
<a name="l00412"></a>00412                                      searpc_signature_objlist__string_int_int());
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="comment">/* token */</span>
<a name="l00415"></a>00415     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00416"></a>00416                                      <a class="code" href="seafile-rpc_8h.html#a7cc6e48cba322bb99eedc17a313c32a5">seafile_generate_repo_token</a>,
<a name="l00417"></a>00417                                      <span class="stringliteral">&quot;seafile_generate_repo_token&quot;</span>,
<a name="l00418"></a>00418                                      searpc_signature_string__string_string());
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00421"></a>00421                                      <a class="code" href="seafile-rpc_8h.html#a61ff8046326767ed109aeb5c543116c4">seafile_delete_repo_token</a>,
<a name="l00422"></a>00422                                      <span class="stringliteral">&quot;seafile_delete_repo_token&quot;</span>,
<a name="l00423"></a>00423                                      searpc_signature_int__string_string_string());
<a name="l00424"></a>00424     
<a name="l00425"></a>00425     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00426"></a>00426                                      <a class="code" href="seafile-rpc_8h.html#a69a0028dc3a20616750f4ee54f516007">seafile_list_repo_tokens</a>,
<a name="l00427"></a>00427                                      <span class="stringliteral">&quot;seafile_list_repo_tokens&quot;</span>,
<a name="l00428"></a>00428                                      searpc_signature_objlist__string());
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00431"></a>00431                                      <a class="code" href="seafile-rpc_8h.html#aee7fa2786083f5e71e1e415f7f244510">seafile_list_repo_tokens_by_email</a>,
<a name="l00432"></a>00432                                      <span class="stringliteral">&quot;seafile_list_repo_tokens_by_email&quot;</span>,
<a name="l00433"></a>00433                                      searpc_signature_objlist__string());
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00436"></a>00436                                      <a class="code" href="seafile-rpc_8h.html#ab175c0bc5eac14a5537f0980b86eac8f">seafile_delete_repo_tokens_by_peer_id</a>,
<a name="l00437"></a>00437                                      <span class="stringliteral">&quot;seafile_delete_repo_tokens_by_peer_id&quot;</span>,
<a name="l00438"></a>00438                                      searpc_signature_int__string_string());
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00441"></a>00441                                      <a class="code" href="seafile-rpc_8h.html#aeff6221a90258509665ada13dcecca07">seafile_delete_repo_tokens_by_email</a>,
<a name="l00442"></a>00442                                      <span class="stringliteral">&quot;delete_repo_tokens_by_email&quot;</span>,
<a name="l00443"></a>00443                                      searpc_signature_int__string());
<a name="l00444"></a>00444     
<a name="l00445"></a>00445     <span class="comment">/* quota */</span>
<a name="l00446"></a>00446     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00447"></a>00447                                      <a class="code" href="seafile-rpc_8h.html#a84df7395eba2792897d03f51846de993">seafile_get_user_quota_usage</a>,
<a name="l00448"></a>00448                                      <span class="stringliteral">&quot;seafile_get_user_quota_usage&quot;</span>,
<a name="l00449"></a>00449                                      searpc_signature_int64__string());
<a name="l00450"></a>00450     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00451"></a>00451                                      <a class="code" href="seafile-rpc_8h.html#ac85bc7ce33240e2690891ba235bffa57">seafile_get_user_share_usage</a>,
<a name="l00452"></a>00452                                      <span class="stringliteral">&quot;seafile_get_user_share_usage&quot;</span>,
<a name="l00453"></a>00453                                      searpc_signature_int64__string());
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="comment">/* virtual repo */</span>
<a name="l00456"></a>00456     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00457"></a>00457                                      <a class="code" href="seafile-rpc_8h.html#a6df55a091037823173919427428416d6">seafile_create_virtual_repo</a>,
<a name="l00458"></a>00458                                      <span class="stringliteral">&quot;create_virtual_repo&quot;</span>,
<a name="l00459"></a>00459                                      searpc_signature_string__string_string_string_string_string_string());
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00462"></a>00462                                      <a class="code" href="seafile-rpc_8h.html#a0e73f036405348d720cd3266f60775a4">seafile_get_virtual_repos_by_owner</a>,
<a name="l00463"></a>00463                                      <span class="stringliteral">&quot;get_virtual_repos_by_owner&quot;</span>,
<a name="l00464"></a>00464                                      searpc_signature_objlist__string());
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00467"></a>00467                                      <a class="code" href="seafile-rpc_8h.html#a50a28a1660ef677fd2fc7d8abf147e08">seafile_get_virtual_repo</a>,
<a name="l00468"></a>00468                                      <span class="stringliteral">&quot;get_virtual_repo&quot;</span>,
<a name="l00469"></a>00469                                      searpc_signature_object__string_string_string());
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="comment">/* Clean trash */</span>
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00474"></a>00474                                      <a class="code" href="seafile-rpc_8h.html#a3605dbb4e067b69bda64dcfb7ae3d5d7">seafile_clean_up_repo_history</a>,
<a name="l00475"></a>00475                                      <span class="stringliteral">&quot;clean_up_repo_history&quot;</span>,
<a name="l00476"></a>00476                                      searpc_signature_int__string_int());
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="comment">/* -------- rpc services -------- */</span>
<a name="l00479"></a>00479     <span class="comment">/* token for web access to repo */</span>
<a name="l00480"></a>00480     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00481"></a>00481                                      <a class="code" href="seafile-rpc_8h.html#aabaf6cca4798bc65106015467c54195c">seafile_web_get_access_token</a>,
<a name="l00482"></a>00482                                      <span class="stringliteral">&quot;seafile_web_get_access_token&quot;</span>,
<a name="l00483"></a>00483                                      searpc_signature_string__string_string_string_string());
<a name="l00484"></a>00484     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00485"></a>00485                                      <a class="code" href="seafile-rpc_8h.html#a1a335736f394397d1aef7bf6f85b562b">seafile_web_query_access_token</a>,
<a name="l00486"></a>00486                                      <span class="stringliteral">&quot;seafile_web_query_access_token&quot;</span>,
<a name="l00487"></a>00487                                      searpc_signature_object__string());
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <span class="comment">/* Copy task related. */</span>
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00492"></a>00492                                      <a class="code" href="seafile-rpc_8h.html#a68957c621178267e5b30834fe7e72f3e">seafile_get_copy_task</a>,
<a name="l00493"></a>00493                                      <span class="stringliteral">&quot;get_copy_task&quot;</span>,
<a name="l00494"></a>00494                                      searpc_signature_object__string());
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00497"></a>00497                                      <a class="code" href="seafile-rpc_8h.html#ad02333752248a9c26da760d36df31911">seafile_cancel_copy_task</a>,
<a name="l00498"></a>00498                                      <span class="stringliteral">&quot;cancel_copy_task&quot;</span>,
<a name="l00499"></a>00499                                      searpc_signature_int__string());
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <span class="comment">/* chunk server manipulation */</span>
<a name="l00502"></a>00502     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00503"></a>00503                                      <a class="code" href="seafile-rpc_8h.html#a6cc01f1b6e6fe3199aa3cfa616f67e77">seafile_add_chunk_server</a>,
<a name="l00504"></a>00504                                      <span class="stringliteral">&quot;seafile_add_chunk_server&quot;</span>,
<a name="l00505"></a>00505                                      searpc_signature_int__string());
<a name="l00506"></a>00506     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00507"></a>00507                                      <a class="code" href="seafile-rpc_8h.html#ae7c26e3f867887629dfa945f03b4107f">seafile_del_chunk_server</a>,
<a name="l00508"></a>00508                                      <span class="stringliteral">&quot;seafile_del_chunk_server&quot;</span>,
<a name="l00509"></a>00509                                      searpc_signature_int__string());
<a name="l00510"></a>00510     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00511"></a>00511                                      <a class="code" href="seafile-rpc_8h.html#a1134308e0a4799d521ce655a7ca67de0">seafile_list_chunk_servers</a>,
<a name="l00512"></a>00512                                      <span class="stringliteral">&quot;seafile_list_chunk_servers&quot;</span>,
<a name="l00513"></a>00513                                      searpc_signature_string__void());
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">/* password management */</span>
<a name="l00516"></a>00516     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00517"></a>00517                                      <a class="code" href="seafile-rpc_8h.html#ab5458e1a5520c557de4de85bdc009b4e">seafile_check_passwd</a>,
<a name="l00518"></a>00518                                      <span class="stringliteral">&quot;seafile_check_passwd&quot;</span>,
<a name="l00519"></a>00519                                      searpc_signature_int__string_string());
<a name="l00520"></a>00520     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00521"></a>00521                                      <a class="code" href="seafile-rpc_8h.html#aca84820efcd379c140a0f545d869e06c">seafile_set_passwd</a>,
<a name="l00522"></a>00522                                      <span class="stringliteral">&quot;seafile_set_passwd&quot;</span>,
<a name="l00523"></a>00523                                      searpc_signature_int__string_string_string());
<a name="l00524"></a>00524     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00525"></a>00525                                      <a class="code" href="seafile-rpc_8h.html#a687cfc420233ac4399b22e2d4f08dfa9">seafile_unset_passwd</a>,
<a name="l00526"></a>00526                                      <span class="stringliteral">&quot;seafile_unset_passwd&quot;</span>,
<a name="l00527"></a>00527                                      searpc_signature_int__string_string());
<a name="l00528"></a>00528     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00529"></a>00529                                      <a class="code" href="seafile-rpc_8h.html#a513c2414194c69845a825f29a530fa17">seafile_is_passwd_set</a>,
<a name="l00530"></a>00530                                      <span class="stringliteral">&quot;seafile_is_passwd_set&quot;</span>,
<a name="l00531"></a>00531                                      searpc_signature_int__string_string());
<a name="l00532"></a>00532     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-rpcserver&quot;</span>,
<a name="l00533"></a>00533                                      <a class="code" href="seafile-rpc_8h.html#aa078bc05d9652df2dcf09ab961c0bad7">seafile_get_decrypt_key</a>,
<a name="l00534"></a>00534                                      <span class="stringliteral">&quot;seafile_get_decrypt_key&quot;</span>,
<a name="l00535"></a>00535                                      searpc_signature_object__string_string());
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="comment">/* quota management */</span>
<a name="l00538"></a>00538     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00539"></a>00539                                      <a class="code" href="seafile-rpc_8h.html#abc988eaeaa474905d3813379521a65ba">seafile_set_user_quota</a>,
<a name="l00540"></a>00540                                      <span class="stringliteral">&quot;set_user_quota&quot;</span>,
<a name="l00541"></a>00541                                      searpc_signature_int__string_int64());
<a name="l00542"></a>00542     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00543"></a>00543                                      <a class="code" href="seafile-rpc_8h.html#a206d766cca282de7537ba6944d647535">seafile_get_user_quota</a>,
<a name="l00544"></a>00544                                      <span class="stringliteral">&quot;get_user_quota&quot;</span>,
<a name="l00545"></a>00545                                      searpc_signature_int64__string());
<a name="l00546"></a>00546     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00547"></a>00547                                      <a class="code" href="seafile-rpc_8h.html#aecbcba79538e08bfd246ae1f9712d262">seafile_check_quota</a>,
<a name="l00548"></a>00548                                      <span class="stringliteral">&quot;check_quota&quot;</span>,
<a name="l00549"></a>00549                                      searpc_signature_int__string());
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="comment">/* repo permission */</span>
<a name="l00552"></a>00552     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00553"></a>00553                                      <a class="code" href="seafile-rpc_8h.html#a08aee810f1817dab2113146569f87655">seafile_check_permission</a>,
<a name="l00554"></a>00554                                      <span class="stringliteral">&quot;check_permission&quot;</span>,
<a name="l00555"></a>00555                                      searpc_signature_string__string_string());
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <span class="comment">/* folder permission */</span>
<a name="l00558"></a>00558     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00559"></a>00559                                      <a class="code" href="seafile-rpc_8h.html#a8aeb542c060102ba5fbb1b48dcfed8a4">seafile_check_permission_by_path</a>,
<a name="l00560"></a>00560                                      <span class="stringliteral">&quot;check_permission_by_path&quot;</span>,
<a name="l00561"></a>00561                                      searpc_signature_string__string_string_string());
<a name="l00562"></a>00562     
<a name="l00563"></a>00563     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00564"></a>00564                                      <a class="code" href="seafile-rpc_8h.html#afe1b27d9de0f1e158b20becea072e012">seafile_get_file_id_by_commit_and_path</a>,
<a name="l00565"></a>00565                                      <span class="stringliteral">&quot;seafile_get_file_id_by_commit_and_path&quot;</span>,
<a name="l00566"></a>00566                                      searpc_signature_string__string_string_string());
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (!cloud_mode) {
<a name="l00569"></a>00569         searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00570"></a>00570                                          <a class="code" href="seafile-rpc_8h.html#a69f79dca769a3be522915924d3115a54">seafile_set_inner_pub_repo</a>,
<a name="l00571"></a>00571                                          <span class="stringliteral">&quot;set_inner_pub_repo&quot;</span>,
<a name="l00572"></a>00572                                          searpc_signature_int__string_string());
<a name="l00573"></a>00573         searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00574"></a>00574                                          <a class="code" href="seafile-rpc_8h.html#a37fef4c797c7fd777b756636a850e95b">seafile_unset_inner_pub_repo</a>,
<a name="l00575"></a>00575                                          <span class="stringliteral">&quot;unset_inner_pub_repo&quot;</span>,
<a name="l00576"></a>00576                                          searpc_signature_int__string());
<a name="l00577"></a>00577         searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00578"></a>00578                                          <a class="code" href="seafile-rpc_8h.html#a29bc76a3f7aaa63f43cc4ed5e606a298">seafile_is_inner_pub_repo</a>,
<a name="l00579"></a>00579                                          <span class="stringliteral">&quot;is_inner_pub_repo&quot;</span>,
<a name="l00580"></a>00580                                          searpc_signature_int__string());
<a name="l00581"></a>00581         searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00582"></a>00582                                          <a class="code" href="seafile-rpc_8h.html#a313c00e02a78f9f997edece057626bf4">seafile_list_inner_pub_repos</a>,
<a name="l00583"></a>00583                                          <span class="stringliteral">&quot;list_inner_pub_repos&quot;</span>,
<a name="l00584"></a>00584                                          searpc_signature_objlist__void());
<a name="l00585"></a>00585         searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00586"></a>00586                                          <a class="code" href="seafile-rpc_8h.html#a9f9f68a7da18f473741db94e39a26abf">seafile_count_inner_pub_repos</a>,
<a name="l00587"></a>00587                                          <span class="stringliteral">&quot;count_inner_pub_repos&quot;</span>,
<a name="l00588"></a>00588                                          searpc_signature_int64__void());
<a name="l00589"></a>00589         searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00590"></a>00590                                          <a class="code" href="seafile-rpc_8h.html#ad5f3347e3311cc9b6b4d3c7449972ce4">seafile_list_inner_pub_repos_by_owner</a>,
<a name="l00591"></a>00591                                          <span class="stringliteral">&quot;list_inner_pub_repos_by_owner&quot;</span>,
<a name="l00592"></a>00592                                          searpc_signature_objlist__string());
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="comment">/* History */</span>
<a name="l00596"></a>00596     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00597"></a>00597                                      <a class="code" href="seafile-rpc_8h.html#a8bfdaa02feed77fc4c05dd5453fa045f">seafile_set_repo_history_limit</a>,
<a name="l00598"></a>00598                                      <span class="stringliteral">&quot;set_repo_history_limit&quot;</span>,
<a name="l00599"></a>00599                                      searpc_signature_int__string_int());
<a name="l00600"></a>00600     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00601"></a>00601                                      <a class="code" href="seafile-rpc_8h.html#acbab254dbcc8772910eb4aa8d59bd5a6">seafile_get_repo_history_limit</a>,
<a name="l00602"></a>00602                                      <span class="stringliteral">&quot;get_repo_history_limit&quot;</span>,
<a name="l00603"></a>00603                                      searpc_signature_int__string());
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <span class="comment">/* System default library */</span>
<a name="l00606"></a>00606     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00607"></a>00607                                      <a class="code" href="seafile-rpc_8h.html#accff7db1f2007d88e9106be75c1da2ec">seafile_get_system_default_repo_id</a>,
<a name="l00608"></a>00608                                      <span class="stringliteral">&quot;get_system_default_repo_id&quot;</span>,
<a name="l00609"></a>00609                                      searpc_signature_string__void());
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="comment">/* Trashed repos. */</span>
<a name="l00612"></a>00612     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00613"></a>00613                                      <a class="code" href="seafile-rpc_8h.html#ad575814d54007e1061949941cc76d995">seafile_get_trash_repo_list</a>,
<a name="l00614"></a>00614                                      <span class="stringliteral">&quot;get_trash_repo_list&quot;</span>,
<a name="l00615"></a>00615                                      searpc_signature_objlist__int_int());
<a name="l00616"></a>00616     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00617"></a>00617                                      <a class="code" href="seafile-rpc_8h.html#adb58bb8b0be6699f21c2b725bfda2819">seafile_del_repo_from_trash</a>,
<a name="l00618"></a>00618                                      <span class="stringliteral">&quot;del_repo_from_trash&quot;</span>,
<a name="l00619"></a>00619                                      searpc_signature_int__string());
<a name="l00620"></a>00620     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00621"></a>00621                                      <a class="code" href="seafile-rpc_8h.html#a175d23909743423196ad9b3474730f32">seafile_restore_repo_from_trash</a>,
<a name="l00622"></a>00622                                      <span class="stringliteral">&quot;restore_repo_from_trash&quot;</span>,
<a name="l00623"></a>00623                                      searpc_signature_int__string());
<a name="l00624"></a>00624     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00625"></a>00625                                      <a class="code" href="seafile-rpc_8h.html#ad47ea31282fff44622c120c055537bd9">seafile_get_trash_repos_by_owner</a>,
<a name="l00626"></a>00626                                      <span class="stringliteral">&quot;get_trash_repos_by_owner&quot;</span>,
<a name="l00627"></a>00627                                      searpc_signature_objlist__string());
<a name="l00628"></a>00628     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00629"></a>00629                                      <a class="code" href="seafile-rpc_8h.html#a0488179c974eb2af746908bca68a86df">seafile_empty_repo_trash</a>,
<a name="l00630"></a>00630                                      <span class="stringliteral">&quot;empty_repo_trash&quot;</span>,
<a name="l00631"></a>00631                                      searpc_signature_int__void());
<a name="l00632"></a>00632     searpc_server_register_function (<span class="stringliteral">&quot;seafserv-threaded-rpcserver&quot;</span>,
<a name="l00633"></a>00633                                      <a class="code" href="seafile-rpc_8h.html#ade55ecf65abdf342aff78f2771a3d0e3">seafile_empty_repo_trash_by_owner</a>,
<a name="l00634"></a>00634                                      <span class="stringliteral">&quot;empty_repo_trash_by_owner&quot;</span>,
<a name="l00635"></a>00635                                      searpc_signature_int__string());
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="keyword">static</span> <span class="keyword">struct </span>event sigusr1;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="keyword">static</span> <span class="keywordtype">void</span> sigusr1Handler (<span class="keywordtype">int</span> fd, <span class="keywordtype">short</span> event, <span class="keywordtype">void</span> *user_data)
<a name="l00641"></a>00641 {
<a name="l00642"></a>00642     <a class="code" href="seafile-4_81_82_2common_2log_8c.html#a0a551d197d87846e9c1f598b4765e8b2">seafile_log_reopen</a> ();
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00646"></a>00646 set_signal_handlers (<a class="code" href="struct__SeafileSession.html">SeafileSession</a> *<a class="code" href="cluster-mgr_8c.html#af241ba8540cd17c31a02b56c2aaa126c">session</a>)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00649"></a>00649 <span class="preprocessor"></span>    signal (SIGPIPE, SIG_IGN);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="comment">/* design as reopen log */</span>
<a name="l00652"></a>00652     event_set(&amp;sigusr1, SIGUSR1, EV_SIGNAL | EV_PERSIST, sigusr1Handler, NULL);
<a name="l00653"></a>00653     event_add(&amp;sigusr1, NULL);
<a name="l00654"></a>00654 <span class="preprocessor">#endif</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span>}
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00658"></a>00658 create_sync_rpc_clients (<span class="keyword">const</span> <span class="keywordtype">char</span> *config_dir)
<a name="l00659"></a>00659 {
<a name="l00660"></a>00660     <a class="code" href="struct__CcnetClient.html">CcnetClient</a> *sync_client;
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="comment">/* sync client and rpc client */</span>
<a name="l00663"></a>00663     sync_client = <a class="code" href="ccnet-client_8h.html#a5cf76124997152de1dd741da96de7fcc">ccnet_client_new</a> ();
<a name="l00664"></a>00664     <span class="keywordflow">if</span> ( (<a class="code" href="ccnet-client_8h.html#ada6cbac352344fffe896488a7d11d6e3">ccnet_client_load_confdir</a>(sync_client, config_dir)) &lt; 0 ) {
<a name="l00665"></a>00665         seaf_warning (<span class="stringliteral">&quot;Read config dir error\n&quot;</span>);
<a name="l00666"></a>00666         exit(1);
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (<a class="code" href="ccnet-client_8h.html#a5572822ea4ea913b4dc9604f3ab8d7f7">ccnet_client_connect_daemon</a> (sync_client, <a class="code" href="ccnet-client_8h.html#a7a0779f0ad3db8ddda265e84eaa364f3af0c50c00c26e3c36ab2cdc497695cba4">CCNET_CLIENT_SYNC</a>) &lt; 0)
<a name="l00670"></a>00670     {
<a name="l00671"></a>00671         seaf_warning (<span class="stringliteral">&quot;Connect to server fail: %s\n&quot;</span>, strerror(errno));
<a name="l00672"></a>00672         exit(1);
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <a class="code" href="seaf-daemon_8c.html#afcd4df5ae9b3664064f70e23b7acbd28">ccnetrpc_client</a> = <a class="code" href="ccnet_8h.html#a683c03dadcad9abc9a4f364e22f027a0">ccnet_create_rpc_client</a> (sync_client, NULL, <span class="stringliteral">&quot;ccnet-rpcserver&quot;</span>);
<a name="l00676"></a>00676     <a class="code" href="seaf-server_8c.html#a735d100fbadb11c7d2cfd40860a09d5e">ccnetrpc_client_t</a> = <a class="code" href="ccnet_8h.html#a683c03dadcad9abc9a4f364e22f027a0">ccnet_create_rpc_client</a> (sync_client,
<a name="l00677"></a>00677                                                  NULL,
<a name="l00678"></a>00678                                                  <span class="stringliteral">&quot;ccnet-threaded-rpcserver&quot;</span>);
<a name="l00679"></a>00679 }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00682"></a>00682 create_async_rpc_clients (<a class="code" href="struct__CcnetClient.html">CcnetClient</a> *client)
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684     <a class="code" href="seaf-server_8c.html#ab4446176aa39199f6249742036fe9079">async_ccnetrpc_client</a> = <a class="code" href="ccnet_8h.html#a7a77a44f41cb3b29c8487d6d7ad84fc5">ccnet_create_async_rpc_client</a> (
<a name="l00685"></a>00685         client, NULL, <span class="stringliteral">&quot;ccnet-rpcserver&quot;</span>);
<a name="l00686"></a>00686     <a class="code" href="seaf-server_8c.html#a86d15446eeda16575d807c660dc5a906">async_ccnetrpc_client_t</a> = <a class="code" href="ccnet_8h.html#a7a77a44f41cb3b29c8487d6d7ad84fc5">ccnet_create_async_rpc_client</a> (
<a name="l00687"></a>00687         client, NULL, <span class="stringliteral">&quot;ccnet-threaded-rpcserver&quot;</span>);
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00691"></a>00691 remove_pidfile (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="seaf-server_8c.html#a9319f4233d0597188c3119f4dc7b3f0f">pidfile</a>)
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (pidfile) {
<a name="l00694"></a>00694         g_unlink (pidfile);
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696 }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00699"></a>00699 write_pidfile (<span class="keyword">const</span> <span class="keywordtype">char</span> *pidfile_path)
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (!pidfile_path)
<a name="l00702"></a>00702         <span class="keywordflow">return</span> -1;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704     pid_t pid = getpid();
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     FILE *pidfile = g_fopen(pidfile_path, <span class="stringliteral">&quot;w&quot;</span>);
<a name="l00707"></a>00707     <span class="keywordflow">if</span> (!pidfile) {
<a name="l00708"></a>00708         seaf_warning (<span class="stringliteral">&quot;Failed to fopen() pidfile %s: %s\n&quot;</span>,
<a name="l00709"></a>00709                       pidfile_path, strerror(errno));
<a name="l00710"></a>00710         <span class="keywordflow">return</span> -1;
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <span class="keywordtype">char</span> buf[32];
<a name="l00714"></a>00714     snprintf (buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d\n&quot;</span>, pid);
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (fputs(buf, pidfile) &lt; 0) {
<a name="l00716"></a>00716         seaf_warning (<span class="stringliteral">&quot;Failed to write pidfile %s: %s\n&quot;</span>,
<a name="l00717"></a>00717                       pidfile_path, strerror(errno));
<a name="l00718"></a>00718         fclose (pidfile);
<a name="l00719"></a>00719         <span class="keywordflow">return</span> -1;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     fflush (pidfile);
<a name="l00723"></a>00723     fclose (pidfile);
<a name="l00724"></a>00724     <span class="keywordflow">return</span> 0;
<a name="l00725"></a>00725 }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00728"></a>00728 load_history_config ()
<a name="l00729"></a>00729 {
<a name="l00730"></a>00730     <span class="keywordtype">int</span> keep_history_days;
<a name="l00731"></a>00731     GError *error = NULL;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     seaf-&gt;<a class="code" href="struct__SeafileSession.html#ad1d597138a7b676e94cd273a4a446776">keep_history_days</a> = -1;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     keep_history_days = g_key_file_get_integer (seaf-&gt;<a class="code" href="struct__SeafileSession.html#a71aad27bec82b81e5e6f4fd6d96502ac">config</a>,
<a name="l00736"></a>00736                                                 <span class="stringliteral">&quot;history&quot;</span>, <span class="stringliteral">&quot;keep_days&quot;</span>,
<a name="l00737"></a>00737                                                 &amp;error);
<a name="l00738"></a>00738     <span class="keywordflow">if</span> (error == NULL)
<a name="l00739"></a>00739         seaf-&gt;<a class="code" href="struct__SeafileSession.html#ad1d597138a7b676e94cd273a4a446776">keep_history_days</a> = keep_history_days;
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00743"></a>00743 on_seaf_server_exit(<span class="keywordtype">void</span>)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745     <span class="keywordflow">if</span> (pidfile)
<a name="l00746"></a>00746         remove_pidfile (pidfile);
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00750"></a>00750 <span class="preprocessor"></span><span class="comment">/* Get the commandline arguments in unicode, then convert them to utf8  */</span>
<a name="l00751"></a>00751 <span class="keyword">static</span> <span class="keywordtype">char</span> **
<a name="l00752"></a>00752 get_argv_utf8 (<span class="keywordtype">int</span> *argc)
<a name="l00753"></a>00753 {
<a name="l00754"></a>00754     <span class="keywordtype">int</span> i = 0;
<a name="l00755"></a>00755     <span class="keywordtype">char</span> **argv = NULL;
<a name="l00756"></a>00756     <span class="keyword">const</span> <span class="keywordtype">wchar_t</span> *cmdline = NULL;
<a name="l00757"></a>00757     <span class="keywordtype">wchar_t</span> **argv_w = NULL;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     cmdline = GetCommandLineW();
<a name="l00760"></a>00760     argv_w = CommandLineToArgvW (cmdline, argc);
<a name="l00761"></a>00761     <span class="keywordflow">if</span> (!argv_w) {
<a name="l00762"></a>00762         printf(<span class="stringliteral">&quot;failed to CommandLineToArgvW(), GLE=%lu\n&quot;</span>, GetLastError());
<a name="l00763"></a>00763         <span class="keywordflow">return</span> NULL;
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766     argv = (<span class="keywordtype">char</span> **)malloc (<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*) * (*argc));
<a name="l00767"></a>00767     <span class="keywordflow">for</span> (i = 0; i &lt; *argc; i++) {
<a name="l00768"></a>00768         argv[i] = wchar_to_utf8 (argv_w[i]);
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="keywordflow">return</span> argv;
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 <span class="preprocessor">#endif</span>
<a name="l00774"></a>00774 <span class="preprocessor"></span>
<a name="l00775"></a>00775 <span class="keywordtype">int</span>
<a name="l00776"></a><a class="code" href="seaf-server_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">00776</a> <a class="code" href="monitor-tool_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
<a name="l00777"></a>00777 {
<a name="l00778"></a>00778     <span class="keywordtype">int</span> c;
<a name="l00779"></a>00779     <span class="keywordtype">char</span> *config_dir = <a class="code" href="option_8h.html#a3e535652a6a9608e8bda98044454fa89">DEFAULT_CONFIG_DIR</a>;
<a name="l00780"></a>00780     <span class="keywordtype">char</span> *seafile_dir = NULL;
<a name="l00781"></a>00781     <span class="keywordtype">char</span> *logfile = NULL;
<a name="l00782"></a>00782     <span class="keyword">const</span> <span class="keywordtype">char</span> *debug_str = NULL;
<a name="l00783"></a>00783     <span class="keywordtype">int</span> daemon_mode = 1;
<a name="l00784"></a>00784     <span class="keywordtype">int</span> is_master = 0;
<a name="l00785"></a>00785     <a class="code" href="struct__CcnetClient.html">CcnetClient</a> *<a class="code" href="monitor-tool_8c.html#ae6c1fa423e7fbf3f8de619294cb6b4b3">client</a>;
<a name="l00786"></a>00786     <span class="keywordtype">char</span> *ccnet_debug_level_str = <span class="stringliteral">&quot;info&quot;</span>;
<a name="l00787"></a>00787     <span class="keywordtype">char</span> *seafile_debug_level_str = <span class="stringliteral">&quot;debug&quot;</span>;
<a name="l00788"></a>00788     <span class="keywordtype">int</span> cloud_mode = 0;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00791"></a>00791 <span class="preprocessor"></span>    argv = get_argv_utf8 (&amp;argc);
<a name="l00792"></a>00792 <span class="preprocessor">#endif</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>
<a name="l00794"></a>00794     <span class="keywordflow">while</span> ((c = getopt_long (argc, argv, short_options, 
<a name="l00795"></a>00795                              long_options, NULL)) != EOF)
<a name="l00796"></a>00796     {
<a name="l00797"></a>00797         <span class="keywordflow">switch</span> (c) {
<a name="l00798"></a>00798         <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:
<a name="l00799"></a>00799             exit (1);
<a name="l00800"></a>00800             <span class="keywordflow">break</span>;
<a name="l00801"></a>00801         <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:
<a name="l00802"></a>00802             exit (1);
<a name="l00803"></a>00803             <span class="keywordflow">break</span>;
<a name="l00804"></a>00804         <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l00805"></a>00805             config_dir = optarg;
<a name="l00806"></a>00806             <span class="keywordflow">break</span>;
<a name="l00807"></a>00807         <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
<a name="l00808"></a>00808             seafile_dir = g_strdup(optarg);
<a name="l00809"></a>00809             <span class="keywordflow">break</span>;
<a name="l00810"></a>00810         <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:
<a name="l00811"></a>00811             daemon_mode = 0;
<a name="l00812"></a>00812             <span class="keywordflow">break</span>;
<a name="l00813"></a>00813         <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:
<a name="l00814"></a>00814             logfile = g_strdup(optarg);
<a name="l00815"></a>00815             <span class="keywordflow">break</span>;
<a name="l00816"></a>00816         <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
<a name="l00817"></a>00817             debug_str = optarg;
<a name="l00818"></a>00818             <span class="keywordflow">break</span>;
<a name="l00819"></a>00819         <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:
<a name="l00820"></a>00820             ccnet_debug_level_str = optarg;
<a name="l00821"></a>00821             <span class="keywordflow">break</span>;
<a name="l00822"></a>00822         <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>:
<a name="l00823"></a>00823             seafile_debug_level_str = optarg;
<a name="l00824"></a>00824             <span class="keywordflow">break</span>;
<a name="l00825"></a>00825         <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:
<a name="l00826"></a>00826             is_master = 1;
<a name="l00827"></a>00827         <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:
<a name="l00828"></a>00828             pidfile = optarg;
<a name="l00829"></a>00829             <span class="keywordflow">break</span>;
<a name="l00830"></a>00830         <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:
<a name="l00831"></a>00831             cloud_mode = 1;
<a name="l00832"></a>00832             <span class="keywordflow">break</span>;
<a name="l00833"></a>00833         <span class="keywordflow">default</span>:
<a name="l00834"></a>00834             <a class="code" href="monitor-tool_8c.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a> ();
<a name="l00835"></a>00835             exit (1);
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     argc -= optind;
<a name="l00840"></a>00840     argv += optind;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00843"></a>00843 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (daemon_mode) {
<a name="l00844"></a>00844 <span class="preprocessor">#ifndef __APPLE__</span>
<a name="l00845"></a>00845 <span class="preprocessor"></span>        daemon (1, 0);
<a name="l00846"></a>00846 <span class="preprocessor">#else   </span><span class="comment">/* __APPLE */</span>
<a name="l00847"></a>00847         <span class="comment">/* daemon is deprecated under APPLE</span>
<a name="l00848"></a>00848 <span class="comment">         * use fork() instead</span>
<a name="l00849"></a>00849 <span class="comment">         * */</span>
<a name="l00850"></a>00850         <span class="keywordflow">switch</span> (fork ()) {
<a name="l00851"></a>00851           <span class="keywordflow">case</span> -1:
<a name="l00852"></a>00852               seaf_warning (<span class="stringliteral">&quot;Failed to daemonize&quot;</span>);
<a name="l00853"></a>00853               exit (-1);
<a name="l00854"></a>00854               <span class="keywordflow">break</span>;
<a name="l00855"></a>00855           <span class="keywordflow">case</span> 0:
<a name="l00856"></a>00856               <span class="comment">/* all good*/</span>
<a name="l00857"></a>00857               <span class="keywordflow">break</span>;
<a name="l00858"></a>00858           <span class="keywordflow">default</span>:
<a name="l00859"></a>00859               <span class="comment">/* kill origin process */</span>
<a name="l00860"></a>00860               exit (0);
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862 <span class="preprocessor">#endif  </span><span class="comment">/* __APPLE */</span>
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 <span class="preprocessor">#endif </span><span class="comment">/* !WIN32 */</span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866     <a class="code" href="cdc_8c.html#a7a5ca54f7b8bcecb394a101dfc8d24ff">cdc_init</a> ();
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 <span class="preprocessor">#if !GLIB_CHECK_VERSION(2, 35, 0)</span>
<a name="l00869"></a>00869 <span class="preprocessor"></span>    g_type_init();
<a name="l00870"></a>00870 <span class="preprocessor">#endif</span>
<a name="l00871"></a>00871 <span class="preprocessor"></span><span class="preprocessor">#if !GLIB_CHECK_VERSION(2,32,0)</span>
<a name="l00872"></a>00872 <span class="preprocessor"></span>    g_thread_init (NULL);
<a name="l00873"></a>00873 <span class="preprocessor">#endif</span>
<a name="l00874"></a>00874 <span class="preprocessor"></span>
<a name="l00875"></a>00875     <span class="keywordflow">if</span> (!debug_str)
<a name="l00876"></a>00876         debug_str = g_getenv(<span class="stringliteral">&quot;SEAFILE_DEBUG&quot;</span>);
<a name="l00877"></a>00877     <a class="code" href="seafile-4_81_82_2common_2log_8c.html#a4fccfb3551c675cb4e694d3890d194d3">seafile_debug_set_flags_string</a> (debug_str);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (seafile_dir == NULL)
<a name="l00880"></a>00880         seafile_dir = g_build_filename (config_dir, <span class="stringliteral">&quot;seafile&quot;</span>, NULL);
<a name="l00881"></a>00881     <span class="keywordflow">if</span> (logfile == NULL)
<a name="l00882"></a>00882         logfile = g_build_filename (seafile_dir, <span class="stringliteral">&quot;seafile.log&quot;</span>, NULL);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     <span class="keywordflow">if</span> (<a class="code" href="seafile-4_81_82_2common_2log_8c.html#a6e6769e8c0eb9342d644e867b7026a20">seafile_log_init</a> (logfile, ccnet_debug_level_str,
<a name="l00885"></a>00885                           seafile_debug_level_str) &lt; 0) {
<a name="l00886"></a>00886         seaf_warning (<span class="stringliteral">&quot;Failed to init log.\n&quot;</span>);
<a name="l00887"></a>00887         exit (1);
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     client = <a class="code" href="ccnet_8h.html#af7167784ea116e9b3ffc6697a661871c">ccnet_init</a> (config_dir);
<a name="l00891"></a>00891     <span class="keywordflow">if</span> (!client)
<a name="l00892"></a>00892         exit (1);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     register_processors (client);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     start_rpc_service (client, cloud_mode);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     create_sync_rpc_clients (config_dir);
<a name="l00899"></a>00899     create_async_rpc_clients (client);
<a name="l00900"></a>00900 
<a name="l00901"></a>00901     seaf = <a class="code" href="daemon_2seafile-session_8c.html#a3eea8fbb412edb5ff72027285edb7c72">seafile_session_new</a> (seafile_dir, client);
<a name="l00902"></a>00902     <span class="keywordflow">if</span> (!seaf) {
<a name="l00903"></a>00903         seaf_warning (<span class="stringliteral">&quot;Failed to create seafile session.\n&quot;</span>);
<a name="l00904"></a>00904         exit (1);
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906     seaf-&gt;<a class="code" href="struct__SeafileSession.html#af1ee61f2323dfe64cdaaf23903f302b2">is_master</a> = is_master;
<a name="l00907"></a>00907     seaf-&gt;<a class="code" href="struct__SeafileSession.html#add541d96cca483ad72ff56ad061d1d32">ccnetrpc_client</a> = <a class="code" href="seaf-daemon_8c.html#afcd4df5ae9b3664064f70e23b7acbd28">ccnetrpc_client</a>;
<a name="l00908"></a>00908     seaf-&gt;<a class="code" href="struct__SeafileSession.html#a9ce7e5664feff9d1c1e52b98b06fe06b">async_ccnetrpc_client</a> = <a class="code" href="seaf-server_8c.html#ab4446176aa39199f6249742036fe9079">async_ccnetrpc_client</a>;
<a name="l00909"></a>00909     seaf-&gt;<a class="code" href="struct__SeafileSession.html#aabb28a744ee4dcf6103daf85df45ecf9">ccnetrpc_client_t</a> = <a class="code" href="seaf-server_8c.html#a735d100fbadb11c7d2cfd40860a09d5e">ccnetrpc_client_t</a>;
<a name="l00910"></a>00910     seaf-&gt;<a class="code" href="struct__SeafileSession.html#a208425e672bcd947af6ed96020c094f6">async_ccnetrpc_client_t</a> = <a class="code" href="seaf-server_8c.html#a86d15446eeda16575d807c660dc5a906">async_ccnetrpc_client_t</a>;
<a name="l00911"></a>00911     seaf-&gt;<a class="code" href="struct__SeafileSession.html#afb8783129c8485f3b490b33973e1894f">client_pool</a> = <a class="code" href="ccnet_8h.html#a1edce3f5b84b0a0b6ab28779f7e6ac52">ccnet_client_pool_new</a> (config_dir);
<a name="l00912"></a>00912     seaf-&gt;<a class="code" href="struct__SeafileSession.html#a65f4d1d214fce9bd718d84aa87b9bd9c">cloud_mode</a> = cloud_mode;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     load_history_config ();
<a name="l00915"></a>00915 
<a name="l00916"></a>00916     g_free (seafile_dir);
<a name="l00917"></a>00917     g_free (logfile);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     set_signal_handlers (seaf);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="comment">/* init seaf */</span>
<a name="l00922"></a>00922     <span class="keywordflow">if</span> (<a class="code" href="fuse_2seafile-session_8c.html#a5dbc4cb373997a756130cfe875b86ce6">seafile_session_init</a> (seaf) &lt; 0)
<a name="l00923"></a>00923         exit (1);
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="keywordflow">if</span> (<a class="code" href="daemon_2seafile-session_8c.html#ae4d67eb6012e42ab5d7893a4a6738225">seafile_session_start</a> (seaf) &lt; 0)
<a name="l00926"></a>00926         exit (1);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="keywordflow">if</span> (pidfile) {
<a name="l00929"></a>00929         <span class="keywordflow">if</span> (write_pidfile (pidfile) &lt; 0) {
<a name="l00930"></a>00930             ccnet_message (<span class="stringliteral">&quot;Failed to write pidfile\n&quot;</span>);
<a name="l00931"></a>00931             <span class="keywordflow">return</span> -1;
<a name="l00932"></a>00932         }
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934     atexit (on_seaf_server_exit);
<a name="l00935"></a>00935 
<a name="l00936"></a>00936     <span class="comment">/* Create a system default repo to contain the tutorial file. */</span>
<a name="l00937"></a>00937     <a class="code" href="server_2seafile-session_8c.html#a747d2b438f6f32b6cfb0f4dc42bcefb8">schedule_create_system_default_repo</a> (seaf);
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <a class="code" href="ccnet_8h.html#ab0e38835459a7490cf3a9ebf6e7c92fa">ccnet_main</a> (client);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="keywordflow">return</span> 0;
<a name="l00942"></a>00942 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 19 2015 03:19:54 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
